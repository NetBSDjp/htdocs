<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1994-2003
        The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.org">
<title>How to actually perform a CVS pull-up</title>
</head>

<body bgcolor="#FFFFFF" text="#000000">

<h1>How to actually perform a CVS pull-up</h1>

For a given release cycle, typically in the beginning, developers may
be expected to do pull-ups themselves after approval from the release
engineering team.<p>

Let us say you are pulling up the changes between <code>foo.c</code>
1.19 and 1.21.<p>

(Nota bene: the idea of "pulling up to 1.21" is meaningless -- you are
always applying diffs between two versions. One of them might be the
base tag, but in any case, since you are pulling up diffs, you always
need to know the two versions between which the changes occurred.)<p>

First, and foremost, make sure you are starting with a clean
<code>foo.c</code>

<blockquote>
	cvs update -rnetbsd-1-4 foo.c
</blockquote>

(See note at the end about the effect of this command.)<p>

Then, you need to patch up foo.c to add the changes you want to pull
up. There are two ways of doing this. You can create a patch file and
apply it, or you can use cvs update's <code>-j</code> flag to avoid
needing that.<p>

The incantation:

<blockquote>
	cvs diff -kk -c -r1.19 -r1.21 foo.c &gt;/tmp/patch
</blockquote>

will produce a patch file which you can then apply by doing

<blockquote>
	patch &lt;/tmp/patch
</blockquote>

or by feeding it directly to patch via a pipe.  The command

<blockquote>
	cvs update -kk -j1.19 -j1.21 foo.c
</blockquote>

is essentially equivalent to the two steps listed above, and will
similarly patch your file.<p>

Now manually examine the file to make sure What You Wanted Done Is
Done.  If you are trying to make <code>foo.c</code> identical to the
head (presumably 1.21 is the head and 1.19 was the branch point or
some such), you can do a

<blockquote>
	cvs diff -kk -r1.21 foo.c
</blockquote>

and this should produce no diff (-kk prevents the expansion of RCS
IDs).  If <code>foo.c</code> isn't supposed to be identical to the
head, you are going to have to make sure things are okay manually or
use creative sets of cvs diffs to assure that what you wanted done was
done.<p>

In any case, once done, do a:

<blockquote>
	cvs commit foo.c
</blockquote>

The format of the commit message on a release branch has over time
been formalized to ease tracking and maintenance.  The format of the
first line of the commit message should be one of the following:

<ul>
<li><tt>Pull up revision 1.45 (requested by <em>user</em>):</tt>
<li><tt>Pull up revision 1.45 (via patch, requested by <em>user</em>):</tt>
<li><tt>Pull up revisions 1.1-1.5 (new, requested by <em>user</em>):</tt>
<li><tt>Apply patch (requested by <em>user</em>):</tt>
</ul>

or obvious minor variations over these themes.  The rest of the commit
message shall contain a free-format text explaining why the pull-up
was done.  This message should preferably be an "externally sensible"
message explaining <b>what</b> was fixed, not the exact details of how
it was done.  The text of this message should be indented by two
spaces, and for patch releases this text should also go in as an entry
in the appropriate CHANGES file.<p>

If the pull-up fixes a formally reported problem, this should be noted
as <b>Fixes PR#nnnn</b> at the end of the commit message text.<p>

The fact that we want exact revision numbers recorded in the commit
message means, BTW, that you must <em>not</em> do a bunch of pull-ups
in the same directory and then commit them with a message like "sync
with trunk," because that won't say what versions you pulled up.
<p>

<hr>

<p>
Note that the command

<blockquote>
	cvs update -rnetbsd-1-4 foo.c
</blockquote>

will glue <code>foo.c</code> to "netbsd-1-4" (see what happens to
<code>CVS/Entries</code>), and subsequent CVS commands will thus apply
to this release until you unstick this "glue" with

<blockquote>
	cvs update -A foo.c
</blockquote>
<p>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
        src="../../images/NetBSD-flag.png" border="0"  
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../developers/"><img
        src="../../images/NetBSD-flag.png" border="0"  
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../developers/"><img
        src="../../images/empty.gif" border="0"  
        width="1" height="1" alt="NetBSD ">Developer Documentation</a>      
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">(Contact us)</a>
  $NetBSD: howto-pullup.html,v 1.15 2004/10/30 22:34:20 jschauma Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
  The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
