<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html lang="ja">
<head>
<!-- Copyright (c) 1994-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
<link rev="made" href="mailto:www@jp.NetBSD.org">
<title>NetBSD開発者ドキュメンテーション: リリースの構築とパッケージング</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h2> NetBSD開発者ドキュメンテーション: リリースエンジニアリング:</h2>
<h2> リリースおよびスナップショットの構築とパッケージング </h2>

<p>
ここからの説明は、NetBSD バージョン 1.5 およびそれ以降のリリースおよび
スナップショットの構築に関するものです。ソースツリーからリリースを含む.tgz
ファイルのセットを作成するまでに踏む段階をカバーしています。
もちろんスナップショットであることを明確に記すべきですが、この方法でスナップショットも作成できます。

<p>
<strong>注意: スナップショットをアップロードするとき、
<a href="/developers/features/index.html">機能一覧</a>をアップデートし忘れないでください。</strong>

<p>
NetBSD のリリース方式は <em>release(7)</em> マニュアルページで説明されています。
また、 <b>/usr/share/mk/bsd.README</b> ファイルも有用な資料です。

<p>

.tgzファイルは二つの段階を踏んで構築されます。まず初めに、
基本配布物を構築します。次の段階で X Window System の配布ファイルを構築します。
アーキテクチャーによっては、さらに段階を踏んで、インストール用のもの
(ブートローダーやブートフロッピーイメージなど)構築する必要があります。
次に挙げる段階は全て、NetBSDソースツリーのルートへたどり着くためには、
`src'に移動するものと仮定しています。
<p>

昔のバージョンでは、NetBSD には (合衆国) 国内専用の部分がありました。
これは、合衆国とカナダ以外へは合法的に持ち出すことができなかった DES
に基づくコードを含んだ部分です。詳細は
<a href="../../Misc/crypto-export.html">NetBSD の暗号コードの輸出について</a>
のページをご覧ください。

<p>
リリースを構築し、パッケージ化するステップは以下の通りです。

<h3> I. 基本システムの構築 </h3>

<ol>

<li> 構築に必要な変数を設定します。以下に挙げる変数を、
環境変数 (優先度最低)、 <b>/etc/mk.conf</b>、または make のコマンドライン
(優先度最高) で設定可能です。
以下は、<b>/etc/mk.conf</b> ファイルの例です。
<blockquote><pre>
# ソースツリーの場所。
BSDSRCDIR=/home/cjs/netbsd/src
# 構築で作られるオブジェクトファイルの場所。
BSDOBJDIR=/home/cjs/netbsd/obj
# これら二つは実際には必要ありません; あとで再構築する際に
# 楽になります。厳密な定義については /usr/share/mk/bsd.README
# を参照してください。 src 最上層の Makefile もあわせて参照してください。
BUILD=1
UPDATE=1
# バイナリーのインストール先
DESTDIR=/usr/home/cjs/netbsd/destdir
# 実際のリリースファイルが置かれる場所
RELEASEDIR=/usr/home/cjs/netbsd/release
</pre></blockquote>

注意: src ディレクトリー内のスクリプトのなかには、 <b>DESTDIR</b>
を環境変数で設定しておかなければならないものがあります (たとえば checkflist、後述)
また、<b>DESTDIR</b> を <b>/etc/mk.conf</b> で設定すると、pkgsrc
のパッケージ構築で問題が起きる可能性もあります。
<b>DESTDIR</b> と <b>RELEASEDIR</b> は、環境変数か make
のコマンドラインで設定するのが簡単かつ安全でしょう。</li>

<li> ソースのあるディレクトリーに移動して、リリースを構築します。
<blockquote><pre>
cd src
make obj
make release
</pre></blockquote>

ここで、いくつかの変数を make のコマンドラインで指定するのもよいかもしれません。
たとえば以下のようにします。
<blockquote><pre>
make DESTDIR=/home/destdir RELEASEDIR=/home/releasedir release
</pre></blockquote>

</ol>

<h3> II. X の構築 </h3>

<p> Xのセットを構築しパッケージングする情報は、
上記主要セットと同じです。
X のソースがあるディレクトリーに移動して、以下のようにします。
<blockquote><pre>make release</pre></blockquote>
または、make のコマンドラインで変数を指定する場合は以下のようにします。
<blockquote><pre>
make DESTDIR=/home/destdir RELEASEDIR=/home/release
</pre></blockquote>

<p>
I および II では、セットリストが最新のものであると仮定することに注意して下さい。
セットリストが最新であるかチェックしたいかもしれません。それぞれ、
`make release' するかわりに以下のようにします。

<blockquote><pre>
cd src
make obj
# オブジェクトコードを構築し、インストールする。
make build
# 配布物のうち最後のものをインストールします。
cd src/etc && make distribution
# xsrc のオブジェクトコードを構築し、インストールする。
cd xsrc && make build
</pre></blockquote>

<p> セットリストが正確であるかチェックし、適切にアップデートして、
セット用のtarファイルを作るために、以下のようにします。
<blockquote><pre>
cd src/distrib/sets
sh ./checkflist -both
</pre></blockquote>
必要ならば、ここで src/distrib/sets/lists/*/* ファイルを編集します。
<blockquote><pre>
cd src/etc
make INSTALL_DONE=1 release
cd xsrc
make INSTALL_DONE=1 release
</pre></blockquote>

<h3> III. インストール用のものの構築 </h3>

<p>
ほとんどのアーキテクチャーでは、インストール用の基本的なものは
上述の I において `make release' で処理されます。ただし、これらの一部には、
src/distrib/<i>arch</i> 以下でアーキテクチャー依存の手順が必要なものがあります。
そのような手順のなかには、この説明でまだ記してないものもあります。
ここでできた成果物は、 (<i>release</i>(7)
マニュアルページに列挙されている慣習に従って)
<b>$RELEASEDIR</b> 以下に手動で置く必要があります。

<p>
CD-ROM 作成用に、リリースの ISO9660 イメージを作るには、
上述の I と II の手順を踏み、また、<i>mkisofs</i>(8)
(<i><a
href="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/sysutils/cdrtools/README.html">cdrtools</a></i>
パッケージにあります) をパスの通ったところにインストールしておきます。
それから、
<blockquote><pre>
cd src/etc
make iso-image
</pre></blockquote>
とすると、ISO9660 イメージが作られ、<b>$RELEASEDIR/installation/cdrom</b> に保存されます。

<hr>

<p>
このページには、手を入れる余地がまだ大いにありえます。
このページへのコメントやアップデートは、 <a href="mailto:cjs@NetBSD.org">
cjs@NetBSD.org</a> へ送ってください。
<p>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
        src="../../../images/NetBSD-flag.png" border="0"  
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">ホームページ</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../developers/"><img
        src="../../../images/NetBSD-flag.png" border="0"  
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../developers/"><img
        src="../../../images/empty.gif" border="0"  
        width="1" height="1" alt="NetBSD ">開発者ドキュメンテーション</a>      
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  (連絡先 - <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">英語</a>,
       <a href="mailto:www@jp.NetBSD.org">日本語:
       www@jp.NetBSD.org</a>)<br>
  $NetBSD: build-release.html,v 1.33 2006/03/01 13:34:44 kano Exp $<br>
  <!-- Based on english version: -->
  <!-- NetBSD: build-release.html,v 1.33 2006/03/01 13:34:44 kano Exp   -->
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
  The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
