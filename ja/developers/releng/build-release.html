<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1994-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.org">
<title>NetBSD Developer Documentation: Building and Packaging a Release</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h2> NetBSD Developer Documentation: Release Engineering:</h2>
<h2> Building and Packaging a Release or Snapshot </h2>

<p>
These instructions are for building releases and snapshots of NetBSD version
1.5 or later. They cover the steps to go from a source tree to
a set of .tgz files comprising a release. You can also make a snapshot 
this way, though of course it should be clearly labeled as such.

<p>
<strong>NOTE: when uploading a snapshot, please do not forget to update
the <a href="../features/">feature table</a>.</strong>

<p>
The NetBSD release format is described in the <em>release(7)</em> manual page. 
The file <b>/usr/share/mk/bsd.README</b> is also useful documentation.

<p>

The .tgz files are built in two steps. In the first, you build
the base distribution. The second step is to build the X Window System
distribution files. Some architectures require extra steps to build
installation materials (such as boot loaders or boot floppy images). All
of the following steps assume that you change to `src' to get to the root
of your NetBSD source tree.
<p>

In earlier versions, there was a (US) domestic section of NetBSD containing
code based on DES which could not be legally exported from the United
States or Canada. For more details please see our page on 
<a href="../../Misc/crypto-export.html">Exportability of NetBSD crypto
code</a>.

<p>
The steps to build and package a release are as follows.

<h3> I. Building the Base System </h3>

<ol>

<li> Set the variables you will need for your build. The 
following can be set in the environment (lowest priority) or in 
<b>/etc/mk.conf</b> or on the make command line (highest priority). 
Here is an example <b>/etc/mk.conf</b> file:
<blockquote><pre>
# The location of your source tree.
BSDSRCDIR=/home/cjs/netbsd/src
# The location of the object files produced by the build.
BSDOBJDIR=/home/cjs/netbsd/obj
# These two aren't really necessary; they just make life
# easier if/when you rebuild later. See /usr/share/mk/bsd.README
# for exact definitions. See also the top-level Makefile in src.
BUILD=1
UPDATE=1
# Where to install the binaries
DESTDIR=/usr/home/cjs/netbsd/destdir
# Where to put the actual release files
RELEASEDIR=/usr/home/cjs/netbsd/release
</pre></blockquote>

Note that some scripts in the src directory require <b>DESTDIR</b> to be 
set in the environment (e.g. checkflist, see below). Also setting 
<b>DESTDIR</b> in
<b>/etc/mk.conf</b> may affect building of packages in pkgsrc.
You may find it easier and safer to set <b>DESTDIR</b> and
<b>RELEASEDIR</b> in the environment or on the make command line.</li>

<li> Change to your source directory, and build the release.
<blockquote><pre>
cd src
make obj
make release
</pre></blockquote>

Or you may wish to set some variables on the make command line. For
example:
<blockquote><pre>
make DESTDIR=/home/destdir RELEASEDIR=/home/releasedir release
</pre></blockquote>

</ol>

<h3> II. Building X </h3>

<p> The information for building and packaging the X sets is similar
to the main sets above. 
Change directory into your X source directory and type:
<blockquote><pre>make release</pre></blockquote>
or if you are specifying variables on the make command line:
<blockquote><pre>
make DESTDIR=/home/destdir RELEASEDIR=/home/release
</pre></blockquote>

<p>
Note that I and II assume that the set-lists are up-to-date.
You may want to check them. Instead of doing `make release'
in each case:

<blockquote><pre>
cd src
make obj
# Build the object code and install it.
make build
# Install the final bits of the distribution.
cd src/etc && make distribution
# Make the xsrc object code and install it.
cd xsrc && make build
</pre></blockquote>

<p> To check the set-lists for accuracy, update them appropriately,
and then make the tar files for the sets, do the following: 
<blockquote><pre>
cd src/distrib/sets
sh ./checkflist -both
</pre></blockquote>
Now edit the files src/distrib/sets/lists/*/* as necessary.
<blockquote><pre>
cd src/etc
make INSTALL_DONE=1 release
cd xsrc
make INSTALL_DONE=1 release
</pre></blockquote>

<h3> III. Building Installation Materials </h3>

<p>
On most architectures, the basic installation materials are 
handled by the `make release' in step I above. However, sometimes there are 
architecture-dependent things that need to be done  
under src/distrib/<i>arch</i>; some of these are not yet
documented here. The results then need to be put in <b>$RELEASEDIR</b> 
by hand (following the conventions listed in the <i>release</i>(7) manual 
page). 

<p>
To produce an ISO9660 image of a release for making CD-ROMs, do
steps I and II and ensure that you have <i>mkisofs</i>(8) (from
the <i><a
href="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/sysutils/cdrecord/README.html">cdrecord</a></i>
package) installed on your machine and in your path. 
Then:
<blockquote><pre>
cd src/etc
make iso-image
</pre></blockquote>
will make an ISO9660 image and save it in <b>$RELEASEDIR/installation/cdrom</b>.

<hr>

<p>
This page can still use a lot of work. Comments and updates
for this page may be sent to <a href="mailto:cjs@NetBSD.org">
cjs@NetBSD.org</a>.
<p>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
        src="../../images/NetBSD-flag.png" border="0"  
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../developers/"><img
        src="../../images/NetBSD-flag.png" border="0"  
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../developers/"><img
        src="../../images/empty.gif" border="0"  
        width="1" height="1" alt="NetBSD ">Developer Documentation</a>      
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">(Contact us)</a>
  $NetBSD: build-release.html,v 1.32 2004/10/30 22:34:20 jschauma Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
  The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
