<?xml version="1.0"?>
<!DOCTYPE webpage
  PUBLIC "-//NetBSD//DTD Website-based NetBSD Extension//EN"
	 "http://www.NetBSD.org/XML/htdocs/lang/share/xml/website-netbsd.dtd">

<webpage id="ports-sgimips-faq">
<config param="desc" value="NetBSD/sgimips: Frequently Asked Questions"/>
<config param="cvstag" value="$NetBSD: faq.xml,v 1.4 2009/09/19 22:56:15 snj Exp $"/>
<config param="rcsdate" value="$Date: 2009/09/19 22:56:15 $"/>
<head>

<!-- Copyright (c) 1994-2005
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->

<title>NetBSD/sgimips: Frequently Asked Questions</title>
</head>


<sect1 role="toc">

<sect2 id="general">
<title>General Questions</title>

<sect3 id="serialconsole">
<title>Things worth knowing about the Indy serial console</title>
<para>
Note that this information may apply to other models too. To get the machine
to boot up with a serial console, make sure the keyboard is unplugged when
turning on the machine. The serial console runs on serial #1, at 9600,
8N1 by default.
</para>
<para>
It is also possible to do a "<code>setenv console d</code>" in the PROM
monitor to get the console to serial #1, or a "<code>setenv console d2</code>"
to get it to serial #2 (default is "<code>g</code>"). Optionally, the console's
speed can be set with "<code>setenv dbaud &lt;bps&gt;</code>". After setting
these PROM variables either do an "<code>init</code>" or a reboot of the
machine.
</para>
<para>

When booting up IRIX on the console, logins on the serial console
might be disabled. You can enable them by editing /etc/inittab
and adding the following line:
</para>

<programlisting>st:23:respawn:/sbin/getty systty co_9600        # serial console - HF</programlisting>

<para>
Don't forget to re-read the inittab then with "<code>init q</code>".
</para>
<para>

The serial port pinouts are the same as SPARC systems' serial ports, so
Macintosh serial cables work great for serial-console cables, as long as
you are willing to do it without hardware handshaking lines.  See the <ulink
url="../../docs/Hardware/Misc/serial.html">NetBSD Serial Port
Primer</ulink> for more information. 
</para>
</sect3>

<sect3 id="resetting-eaddr">
<title>How do I reset $eaddr on IP22 etc.?</title>
<para>
Here's a method to set the ethernet address that works on at
least the Indy, and perhaps also other machines with HPC3's.
</para>
<para>

All disclaimers apply yadda yadda.
</para>
<para>

At the PROM prompt:
</para>
<programlisting>dump -w -x 0xbfbe04e8</programlisting>
<para>

Sanity check the output here to see if it matches the address
given in the 'ec0: bad ethernet address' error message. If not,
you may not want to overwrite whatever is there instead.
</para>

<programlisting>fill -w -v 0xGG 0xbfbe04e8
fill -w -v 0xHH 0xbfbe04ec
fill -w -v 0xII 0xbfbe04f0
fill -w -v 0xJJ 0xbfbe04f4
fill -w -v 0xKK 0xbfbe04f8
fill -w -v 0xLL 0xbfbe04fc</programlisting>

<para>

Where GG:HH:II:JJ:KK:LL is the intended ethernet address. It's a
very good idea to reuse the address the machine was shipped with.
Check the back of the machine if you cannot remember it.
</para>
<para>

Power down, wait one full minute and then power up. All variables
will have been reset as with the resetenv command, except $eaddr.
</para>
</sect3>

<sect3 id="prom-tftp-client-failing">
<title>PROM tftp client failing with default NetBSD tftpd settings</title>
<para>

The PROM tftp client on SGI machines can fail with default NetBSD tftpd
settings.  The problem is that your current PROM may not support port
numbers with the sign bit set.  The workaround is to limit the port
numbers of anonymous connections to 32767.  The following tunables
should fix your problem:
</para>
<programlisting># sysctl -w net.inet.ip.anonportmin=20000
# sysctl -w net.inet.ip.anonportmax=32767</programlisting>
</sect3>


<sect3 id="prom-issues">
<title>Other PROM issues you might encounter</title>
<para>

There are a few gotchas depending on your PROM version and the
OS (SASH) version installed:
</para>

<orderedlist>
<listitem> Old versions of SASH have an issue with incorrectly reporting
     the memory map. If the kernel panics with a UVM related message
     on boot (even before the copyright message), try booting the
     kernel directly from the PROM rather than via sash (An I2 also
     had this problem before upgrading to IRIX 6.x -- it was running
     5.3 before).</listitem>

<listitem> Another old PROM issue -- old PROMs don't understand ELF, so
     you may need an ECOFF kernel.  A workaround for this is to use
     sash, which seems to understand ELF even in IRIX 5.x, but see
     problem #1.</listitem>
</orderedlist>

</sect3>

<sect3 id="sgivol">
<title>Updating the bootloader (using sgivol)</title>
<para>
When installing NetBSD using sysinst, it will leave space at the start of the
disk for the partition that will be used by the PROM to load the bootloader,
etc. This partition is called the Volume Header.
This needs to be a minimum of 3135 blocks (see SGI_BOOT_BLOCK_SIZE_VOLHDR in
<filename>/usr/include/sys/bootblock.h</filename>). An example disklabel is
shown below.  Partition <code>i</code> will be used for the Volume Header as
is SGI convention (partition 8). 
</para>
<programlisting>
sgimips# disklabel sd0
# /dev/rsd0c:
type: SCSI
disk: mydisk
label: fictitious
flags:
bytes/sector: 512
sectors/track: 135
tracks/cylinder: 8
sectors/cylinder: 1080
cylinders: 4078
total sectors: 4404240
rpm: 7200
interleave: 0
trackskew: 0
cylinderskew: 0
headswitch: 0           # microseconds
track-to-track seek: 0  # microseconds
drivedata: 0

16 partitions:
#        size    offset     fstype [fsize bsize cpg/sgs]
 a:   3377306      3183     4.2BSD   1024  8192 45640  # (Cyl.      2*-    3130*)
 b:   1024000   3380489       swap                     # (Cyl.   3130*-    4078+)
 c:   4404489         0    unknown                     # (Cyl.      0 -    4078+)
 i:      3183         0    unknown                     # (Cyl.      0 -       2*)
</programlisting>
<para>
After installing NetBSD, you can use the sgivol utility (located in
/usr/mdec) to manipulate this partition. If not set up already, it must be
initialised (N.B. sysinst will set this up correctly):
</para>
<programlisting>sgivol -i sd0</programlisting>
<para>
To upgrade the bootloader (or change it if the disk is moved to a different
model of machine), first delete the existing file:
</para>
<programlisting>sgivol -d boot sd0</programlisting>
<para>
Next, copy the appropriate bootloader as filename 'boot' into the 
volume header:
</para>
<programlisting>sgivol -w boot /usr/mdec/ip2xboot sd0</programlisting>
<para>
You can have multiple bootloaders present (with different
names). This is very useful when booting different versions of NetBSD
(e.g., to upgrade from NetBSD 3 to 5.0 using a new INSTALL kernel) as
changes in bootinfo mean that NetBSD 4.0 and earlier kernels will not work
with a newer bootloader.
</para>
<para>
The contents of the volume header can be viewed by using the following
command:
</para>
<programlisting>sgivol sd0</programlisting>
<para>
Example output is shown below:
</para>
<programlisting>disklabel shows 4404240 sectors
checksum: 00000000
root part: 0
swap part: 1
bootfile: /netbsd

Volume header files:
sgilabel offset    2 blocks, length      512 bytes (1 blocks)
ide      offset    3 blocks, length   322048 bytes (629 blocks)
sash     offset  632 blocks, length   322048 bytes (629 blocks)
boot     offset 1261 blocks, length    53296 bytes (105 blocks)

SGI partitions:
 0:a blocks  3377306 first     3183 type  4 (BSD4.2)
 1:b blocks  1024000 first  3380489 type  3 (Raw)
 8:i blocks     3199 first        0 type  0 (Volume Header)
10:k blocks  4404489 first        0 type  6 (Volume)
</programlisting>
<para>
See the <ulink
url="http://man.NetBSD.org/cgi-bin/man-cgi?boot+8.sgimips+NetBSD-current">boot(8)</ulink>
and <ulink
url="http://man.NetBSD.org/cgi-bin/man-cgi?sgivol+8.sgimips+NetBSD-current">sgivol(8)</ulink>
man pages for more information.
</para>
</sect3>

</sect2>

<sect2 id="other">
<title>Other sources of information</title>

<sect3 id="on-site">
<title>Other NetBSD Documentation</title>

<itemizedlist>
<listitem><ulink url="../../docs/network/netboot/">Diskless NetBSD HOW-TO</ulink></listitem>
<listitem><ulink url="../../docs/Hardware/Misc/serial.html">NetBSD Serial 
Port Primer</ulink></listitem>
</itemizedlist>
</sect3>

<sect3 id="off-site">
<title>Other Off-Site Documentation</title>

<itemizedlist>
<listitem> The <ulink url="http://www.reputable.com/indytech.html">Indy tech</ulink>
     site has a lot of information on the SGI Indy hardware.</listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/init.cgi">SGI
     techpubs library</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/O2_OG">O2
     Workstation Hardware Reference Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/Indigo2_OG">Indigo2
     Workstation Owner's Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/Indy_OwnerGd">Indy
     Workstation Owner's Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/Indigo_OG">IRIS
     Indigo Workstation Owner's Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=0650&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_Developer/DevDriver_PG">IRIX
     Device Driver Programmer's Guide</ulink></listitem>
</itemizedlist>
</sect3>
</sect2>

</sect1>
<parentsec url="./" text="NetBSD/sgimips Port Page"/>
</webpage>
