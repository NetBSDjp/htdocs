<?xml version="1.0" encoding="ISO-2022-JP"?>
<!DOCTYPE webpage
  PUBLIC "-//NetBSD//DTD Website-based NetBSD Extension//EN"
	 "http://www.NetBSD.org/XML/htdocs/lang/share/xml/website-netbsd.dtd">

<webpage id="ja-Ports-sgimips-faq">
<config param="desc" value="NetBSD/sgimips: よくある質問"/>
<config param="cvstag" value="$NetBSD: faq.xml,v 1.6 2006/01/11 19:22:04 tsutsui Exp $"/>
<!-- Based on english version: -->
<!-- NetBSD: faq.xml,v 1.6 2006/01/11 19:22:04 tsutsui Exp   -->
<config param="rcsdate" value="$Date: 2006/01/11 19:22:04 $"/>
<head>

<!-- Copyright (c) 1994-2005
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->

<title>NetBSD/sgimips: よくある質問</title>
</head>


<sect1 role="toc">

<sect2 id="general">
<title>全般的な質問</title>

<sect3 id="serialconsole">
<title>Indy のシリアルコンソールに関して知っておく価値のある事柄</title>
<para>
この情報は他の機種にも適用できるかもしれないことに留意しておいてください。
マシンをシリアルコンソールでブートできるようにするため、
マシンを立ち上げるときはキーボードを外しておいてください。
シリアルコンソールは、デフォルトでは serial #1 で、 9600、 8N1 で動作します。
</para>
<para>
PROM モニターで "<code>setenv console d</code>" とすることでコンソールを
serial #1 に、 "<code>setenv console d2</code>" とすることで serial #2
にすることもできます (デフォルトは "<code>g</code>" です) 。また、
コンソールの速度は "<code>setenv dbaud &lt;bps&gt;</code>" で設定できます。
これらの PROM 変数を設定した後は、 "<code>init</code>" するか、マシンを
リブートする必要があります。
</para>
<para>

Irix をコンソールからブートした場合、シリアルコンソール上でのログインが
できなくなります。 /etc/inittab を編集して下記の行を追加することで、
ログインできるようになります。
</para>

<programlisting>st:23:respawn:/sbin/getty systty co_9600        # serial console - HF</programlisting>

<para>
このあと、忘れずに "<code>init q</code>" して inittab を再読み込みしてください。
</para>
<para>

シリアルポートのピン配置は SPARC システムのシリアルポートと同じですので、
ハードウェアハンドシェーキング線を使わない用途に限れば、 Macintosh
のシリアルケーブルはシリアルコンソール用のケーブルとしてしっかり使えます。
詳細については、 <ulink url="../../Documentation/Hardware/Misc/serial.html">NetBSD
シリアルポート入門</ulink>を参照してください。
</para>
</sect3>


<sect3 id="bootstrapping">
<title>NetBSD/sgimips のブートの方法は?</title>
<para>
<itemizedlist>
    <listitem><para>NetBSD 3.0 以降の sgimipscd.iso イメージはブート可能です。
    NetBSD をマシンにインストールするための最も簡単な方法は、このイメージを
    CD に焼いて、その CD でブートすることです。 CD からブートする方法の説明は
    <ulink url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0.2/sgimips/INSTALL.html#Install%20via%20a%20bootable%20CD-ROM"/>
    にあります。
    もちろん、対象のマシンに CD ドライブがあることが前提です。 CD ドライブがない場合は、
    ネットブートすることになるでしょう。
    </para></listitem>
<listitem><para>CD ドライブがない場合は、 SGI の ARCS firmware を使ってカーネルを
     ネットブートすることが必要です。ネットブートの設定についての詳細は
     <ulink url="../../Documentation/network/netboot/">Diskless NetBSD HOW-TO</ulink>
     を参照してください。おおまかな手順は以下のとおりです:
     </para>

     <orderedlist>
     <listitem> etc.tgz と base.tgz を、たとえば /home/indy/root 以下に展開します。
          展開した root/dev ディレクトリーで "<code>sh MAKEDEV all</code>" を実行します。 </listitem>
     <listitem> マシンの PROM に入り、 MAC アドレスを調べます。調べるには、
          "<code>printenv eaddr</code>" とします。</listitem>
     <listitem><para>DHCP を設定します。以下のような内容を <filename>/etc/dhcpd.conf</filename> に書きます:</para>
<programlisting>ddns-update-style       none;
subnet 10.0.0.0 netmask 255.255.255.0 {			# Adjust
	host indy {
		hardware ethernet 08:00:69:09:93:78;    # Adjust to your MAC address
		fixed-address 10.0.0.15;                # Adjust
		#filename "/netbsd";                    # XXX Do NOT set!
		option root-path "/home/indy/root";
		server-name="10.0.0.3";
	}
}</programlisting>
     <para>
     "<code>filename</code>" は設定できないことに注意してください。
     設定してしまうと、それ以外の値を、後述する PROM の <code>boot</code>
     コマンドで、カーネル名として指定できなくなります。
     </para>
     </listitem>

     <listitem> 再度マシンの PROM に入り、 IP アドレスが正しく設定されているか
          確認してください:
     <programlisting>&gt;&gt; <emphasis role="bold">printenv netaddr</emphasis>
netaddr=1.2.3.4
&gt;&gt; <emphasis role="bold">setenv netaddr 10.0.0.15</emphasis>
&gt;&gt; <emphasis role="bold">printenv netaddr</emphasis>
netaddr=10.0.0.15</programlisting>
     </listitem>

     <listitem><filename>/etc/inetd.conf</filename> で tftp が使えるようになっていることを確認し、
          それから適切なカーネル (たとえば <filename>netbsd.IP22</filename> とする) を <filename>/tftpboot</filename> に置きます。
	</listitem>

     <listitem> PROM に、ネットブートして "netbsd.IP22" カーネルをロードするよう
          指示する:
     <programlisting>&gt;&gt; <emphasis role="bold">boot -f bootp():/netbsd.IP22</emphasis>
Setting $netaddr to 10.0.0.15 (from server 10.0.0.3)
Obtaining /netbsd-IP22 from server 10.0.0.3
...</programlisting>
     </listitem>

     <listitem> ルートデバイスを尋ねられたら、選択肢を調べるために "<code>?</code>"
          と入力します。たとえば "<code>sq0</code>" は Indy のイーサネットです。</listitem>
     <listitem> ダンプデバイスは、単に RETURN を押します</listitem>
     <listitem> ブート用のディスクを用意していなければ、
          ルートファイルシステムはきっと nfs 経由のものでしょうから、
          ルートデバイスとしては "<code>nfs</code>" と答えます。</listitem>
     </orderedlist>

     問題が起きた場合は、 &man.tcpdump.8; か pkgsrc/net/ethereal を使って
     ネットワークトラフィックのデバッグをしてください。 PROM コマンドの
     より詳しい説明は、 Irix
     <ulink url="http://www.mcsr.olemiss.edu/cgi-bin/man-cgi?prom">prom</ulink>
     マニュアルページを見てください。</listitem>

<listitem> それから、 NetBSD の FFS とディスクラベルを持つセカンドハードディスク
     を用意します。さらに、セカンドディスク上の root/swap を使うよう
     カーネルに指示します。ただし、現在、 firmware は FFS ファイルシステムから
     カーネルをブートすることができません。今のところは、ネット経由で
     ブートする必要があります。</listitem>
</itemizedlist>
</para>

<para>
ブートを始めるには以下のファイルが必要です:
</para>

<variablelist>
<varlistentry>
<term>スナップショット:</term>
<listitem><ulink url="ftp://ftp.NetBSD.org/pub/NetBSD/arch/sgimips/snapshot/">ftp://ftp.NetBSD.org/pub/NetBSD/arch/sgimips/snapshot/</ulink>
</listitem>
</varlistentry>
<varlistentry>
<term>カーネル:</term>
<listitem><ulink url="ftp://ftp.NetBSD.org/pub/NetBSD/arch/sgimips/netbsd.ip32">ftp://ftp.NetBSD.org/pub/NetBSD/arch/sgimips/netbsd.ip32</ulink></listitem>
</varlistentry>
</variablelist>
</sect3>

<sect3 id="crosscompiling">
<title>sgimips カーネルをクロスコンパイルする方法は?</title>
<para>

NetBSD 1.6 およびそれ以降のシステムでは、ベースシステムのクロス構築を完全にサポートしています。
これは、構築するユーザーが root でなくても、また、 NetBSD 以外のホスト上ででも可能です。
詳細は、 <ulink url="../../Documentation/">NetBSD ドキュメンテーションのページ</ulink>
以下にある <ulink url="../../Documentation/cross/">NetBSD のクロス構築</ulink>
をご覧ください。
</para>
</sect3>

<sect3 id="cross-build-boot-cd">
<title>sgimips 用のブート可能なインストール CD をクロス構築する方法は?</title>
<para>
<ulink url="#crosscompiling">クロスコンパイルの説明</ulink>に従って、
sgimips のリリースをクロス構築します (たとえば <code>build.sh release</code>) 。
構築後、 <filename>src/etc</filename> ディレクトリーへ移動し、
ツールディレクトリーに作成されたラッパースクリプト nbmake-sgimips を使ってブート可能な cd を作ります。
</para>
<programlisting>$TOOLDIR/bin/nbmake-sgimips iso-image</programlisting>
<para>
できあがったイメージは、普通の cd 書き込みツールを使って CD-RW に焼くことができます。
</para>
</sect3>

<sect3 id="resetting-eaddr">
<title>IP22 その他で $eaddr をリセットする方法は ?</title>
<para>
ここに示すのは、少なくとも Indy と、おそらく HPC3 を持つ他のマシンでも
使える、イーサネットアドレスの設定方法です。
</para>
<para>

一切の責任を持たないので…以下省略。
</para>
<para>

PROM プロンプトで:
</para>
<programlisting>dump -w -x 0xbfbe04e8</programlisting>
<para>

この出力の妥当性チェックとして、 'ec0: bad ethernet address'
エラーメッセージで示されるアドレスと一致するかどうか調べます。
もし一致していなければ、なにも上書きすべきではないでしょう。
</para>

<programlisting>fill -w -v 0xGG 0xbfbe04e8
fill -w -v 0xHH 0xbfbe04ec
fill -w -v 0xII 0xbfbe04f0
fill -w -v 0xJJ 0xbfbe04f4
fill -w -v 0xKK 0xbfbe04f8
fill -w -v 0xLL 0xbfbe04fc</programlisting>

<para>

ここで、 GG:HH:II:JJ:KK:LL が、予定しているイーサネットアドレスになるように
します。マシンに附属してきたアドレスを使うのがよいでしょう。
わからなければマシンの背面を調べてください。
</para>
<para>

電源を落とし、一分間待ってから電源を入れます。これで、 $eaddr 以外の
すべての変数は、 resetenv コマンドを使ったときのようにリセットされています。
</para>
</sect3>

<sect3 id="prom-tftp-client-failing">
<title>PROM tftp クライアントがデフォルトの設定の NetBSD の tftpd との組み合わせでうまく動きません</title>
<para>

SGI マシンの PROM tftp クライアントは、デフォルトの設定の NetBSD の tftpd
との組み合わせで、うまく動作しないことがあります。そのマシンの PROM が
符号ビットの立ったポート番号に対応していないせいかもしれません。
これに対する次善策は、匿名コネクション用のポート番号の上限を
32767 にすることです。次のように調整すると解決するはずです:
</para>
<programlisting># sysctl -w net.inet.ip.anonportmin=20000
# sysctl -w net.inet.ip.anonportmax=32767</programlisting>
</sect3>


<sect3 id="prom-issues">
<title>このほかにありそうな PROM の問題</title>
<para>

PROM バージョンやインストールされた OS (SASH) バージョンによる、
いくつかの問題があります:
</para>

<orderedlist>
<listitem> 古いバージョンの SASH には、メモリーマップを誤って報告するという
     問題があります。ブート  (copyright message 以前でも) 時に、カーネルが
     UVM 絡みのメッセージとともに panic する場合は、 sash を介さずに
     PROM から直接カーネルをブートしてみてください  (IRIX 6.x
     にアップグレード前の (5.3 が動作している) I2
     にもこの問題があります) 。</listitem>

<listitem> もうひとつの古い PROM の問題 -- 古い PROM は ELF を扱えないため、
     ECOFF カーネルが必要かもしれません。これの回避策は sash (IRIX 5.x
     においてでも ELF を理解するようです) を使うことですが、
     問題 #1 を見てください。</listitem>
</orderedlist>

</sect3>

</sect2>

<sect2 id="other">
<title>他の情報源</title>

<sect3 id="on-site">
<title>NetBSD ドキュメンテーション</title>

<itemizedlist>
<listitem><ulink url="../../Documentation/network/netboot/">Diskless NetBSD HOW-TO</ulink></listitem>
<listitem><ulink url="../../Documentation/Hardware/Misc/serial.html">NetBSD
シリアルポート入門</ulink></listitem>
</itemizedlist>
</sect3>

<sect3 id="off-site">
<title>サイト外のドキュメンテーション</title>

<itemizedlist>
<listitem> <ulink url="http://www.reputable.com/indytech.html">Indy tech</ulink>
     サイトには、 SGI Indy ハードウェアに関する多くの情報があります。</listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/init.cgi">SGI
     techpubs library</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/O2_OG">O2
     Workstation Hardware Reference Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/Indigo2_OG">Indigo2
     Workstation Owner's Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/Indy_OwnerGd">Indy
     Workstation Owner's Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=hdwr&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_EndUser/Indigo_OG">IRIS
     Indigo Workstation Owner's Guide</ulink></listitem>
<listitem> <ulink url="http://techpubs.sgi.com/library/tpl/cgi-bin/browse.cgi?coll=0650&amp;db=bks&amp;cmd=toc&amp;pth=/SGI_Developer/DevDriver_PG">IRIX
     Device Driver Programmer's Guide</ulink></listitem>
</itemizedlist>
</sect3>
</sect2>

</sect1>
<parentsec url="./" text="NetBSD/sgimips Port Page"/>
</webpage>
