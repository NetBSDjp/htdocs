<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1997, 1998
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<TITLE>NetBSD/mac68k FAQ - Errors</TITLE>
</HEAD>
<BODY>
<A NAME="errors"></A> <H1>10. <A NAME="s10"></A>Errors</H1>
<P>
<HR>
<a href="./#toc10">Contents of this section</a><hr>
</P>

<A NAME="H.A"></A> <H2>10.1 <A NAME="ss10.1"></A> When rebooting it says, <CODE>"WARNING: cannot set battery backed clock..."</CODE>.  Should I be concerned?</H2>

<P>Not really, but it means that you are using a rather old kernel.  Newer
kernels give the error message 
<A HREF="#H.Y">below</A>
.</P>
<P></P>

<A NAME="H.Y"></A> <H2>10.2 <A NAME="ss10.2"></A> When rebooting it says, <CODE>"NetBSD/mac68k does not trust itself to update the RTC on shutdown."</CODE>  Should I be concerned?</H2>

<P>No.  This is simply an indication that NetBSD/mac68k would rather not set
your Real Time Clock since NetBSD
<A HREF="faq-3.html#A.P">loses more time the longer it runs</A>

(this would lead to your clock being off in MacOS as well).  The code to
update the RTC on most machines does exist, though, and you can turn it on
in the kernel if you truly wish to do so.</P>
<P></P>

<A NAME="H.B"></A> <H2>10.3 <A NAME="ss10.3"></A> When I boot, I get the following error message:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
init: not found
panic: no init
Pausing forever.
</PRE>
</CODE></BLOCKQUOTE>

What's wrong?</P>
<P></P>
<P><CODE>/sbin/init</CODE> was not installed.  Use the Installer to "ls /sbin/init"
and make sure it is there.  Make sure that you have installed a base
distribution set such as the NetBSD 1.3 release, or a -current snapshot:
<UL>
<LI>
<a href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5/mac68k/binary/sets/">ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5/mac68k/binary/sets/</a>
</LI>
<LI>
<A HREF="ftp://ftp.netbsd.org/pub/NetBSD/arch/mac68k/new/">ftp://ftp.netbsd.org/pub/NetBSD/arch/mac68k/new/</A>
</LI>
</UL>
</P>
<P></P>

<A NAME="H.C"></A> <H2>10.4 <A NAME="ss10.4"></A> When I boot, I get the following unusual lines:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
  audio at mainbus0 not configured
  floppy at mainbus0 not configured
</PRE>
</CODE></BLOCKQUOTE>

What's wrong?</P>
<P></P>
<P>Audio support has been available since the prior to the 1.2 release.  You
should now see a line like:
<BLOCKQUOTE><CODE>
<PRE>
asc0 at obio0: Apple Sound Chip
</PRE>
</CODE></BLOCKQUOTE>

Upgrade to a newer release or try running -current if you want minimal
sound support for ASC-based machines.  EASC-based machines currently don't
work quite right, but support is in the works.</P>
<P>However, floppy support has not been implemented yet.  It is in the works,
though. </P>
<P></P>

<A NAME="H.E"></A> <H2>10.5 <A NAME="ss10.5"></A> My keyboard locks up after I type a few commands.  What's wrong?</H2>

<P>If you were at the bottom of the screen when this occurred, then
this is the infamous "scrolling while ADB input is being received"
problem.  There are a few ways to avoid it:
<OL>
<LI>always type "clear" before the screen has a chance to scroll</LI>
<LI>edit /etc/ttys and use an external terminal on one of your serial
ports</LI>
<LI>use "dt", Lawrence Kesteloot's desktop program (this is a good
solution)</LI>
<LI>since this problem has been fixed on all machines that I know of
since the 1.1 release, the best solution is to upgrade to a much newer
kernel. </LI>
</OL>
</P>
<P></P>

<A NAME="H.F"></A> <H2>10.6 <A NAME="ss10.6"></A> I just switched the SCSI ID's of my drives, and now my machine freezes after:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
changing root device to sd1a.
Swapping 409 and 401.
Swapdev = 409, dumpdev=ffffffff.
</PRE>
</CODE></BLOCKQUOTE>

What's wrong?</P>
<P></P>
<P>You need to edit the <CODE>/etc/fstab</CODE> file to mount the new root
partition.  You can also simply use the Installer utility to delete the
current <CODE>/etc/fstab</CODE> and then do a "Build Devices" to create a new
one which the correct SCSI ID's for your drives.</P>
<P></P>

<A NAME="H.G"></A> <H2>10.7 <A NAME="ss10.7"></A> The NetBSD 1.1 distribution kernel will not boot on my IIci.  What's wrong?</H2>

<P>Your symptoms probably look like:
<BLOCKQUOTE>
If I boot with extra-debugger info on, using multi-user, I get:
<PRE>
Changing root device to sd1a.
PRAM: 0x30d482dc, macos_boottime: 0x30d482d1.
vm_fault(10c000, 8bb3000, 1, 0) -&gt; 1vm_fault(10c000, 8bb3000, 1, 0) -&gt; 
1vm_fault(10c000, 8bb3000, 1, 0) -&gt;
</PRE>

then it hangs.
</BLOCKQUOTE>
</P>
<P>Unfortunately, the 1.1 distribution kernel has quite a few bugs in it and
does not run very well on many machines, especially the IIci.  Try the
<a href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5/mac68k/">1.5
distribution</A>
<P>

<A NAME="H.H"></A> <H2>10.8 <A NAME="ss10.8"></A> When I try <CODE>netstat -r</CODE> I get:  <CODE>netstat: kvm_read kvm_read: Bad address</CODE>.  What's wrong?</H2>

<P>This is nothing to worry about.  Basically, the file <CODE>/netbsd</CODE> is
not your current kernel.  A number of programs (such as <CODE>ps</CODE>, <CODE>who</CODE>,
<CODE>systat</CODE> etc.) and libkvm, access <CODE>/netbsd</CODE> to learn what's going
on in the kernel.  So you can simply rename your current kernel to
<CODE>/netbsd</CODE> to make this kind of error go away.  Make sure that you
are not overwriting a working kernel when you do this, though, unless that
is exactly what you intend to do.</P>
<P></P>

<A NAME="H.J"></A> <H2>10.9 <A NAME="ss10.9"></A> When I try <CODE>netstat -r</CODE> I get an endless stream of question marks.  What's wrong?</H2>

<P>That's a mis-match between libkvm/netstat and /netbsd.  Or it's that
you're running a kernel that's not named /netbsd.  Other symptoms of this
problem are likely to be that <CODE>who</CODE>, <CODE>ps</CODE>, <CODE>ifconfig</CODE>, and
<CODE>systat</CODE> will not work either.  If you update your binaries and your
kernel at the same time, then you should be OK. </P>
<P></P>

<A NAME="H.M"></A> <H2>10.10 <A NAME="ss10.10"></A> I just upgraded to a new kernel and now <CODE>w</CODE>, <CODE>ps</CODE>, and <CODE>netstat</CODE>, among others, don't work.  What happened?</H2>

<P>One of two things.  Either your currently booted kernel isn't named
<CODE>/netbsd</CODE> or else you have a mismatch between your kernel and the
binaries you are using.  In the first case, simply making a link from your
currently booted kernel to <CODE>/netbsd</CODE> will solve the problem.</P>
<P>In the second case, dynamically linked binaries can usually be fixed by
upgrading libkvm to match your new kernel.  Statically linked binaries need
to be replaced with more recent versions.  Since they are statically
linked, if you are going to recompile them yourself, you need to rebuild
libkvm.a <B>before</B> you rebuild the program in question.</P>
<P>Thanks to John Wittkowski (jpw@netscape.com), here is a list of most of the
programs (besides <CODE>/bin/ps</CODE>) that depend on libkvm (all of these are
in <CODE>/usr/bin</CODE>): 
<UL>
<LI><CODE>fstat</CODE></LI>
<LI><CODE>gdb</CODE></LI>
<LI><CODE>ipcs</CODE></LI>
<LI><CODE>netstat</CODE></LI>
<LI><CODE>nfsstat</CODE></LI>
<LI><CODE>systat</CODE></LI>
<LI><CODE>uptime</CODE></LI>
<LI><CODE>vmstat</CODE></LI>
<LI><CODE>w</CODE></LI>
</UL>
</P>
<P></P>

<A NAME="H.T"></A> <H2>10.11 <A NAME="ss10.11"></A> After changing kernels, I get a "proc size mismatch" error when I try to use ps.  What's wrong?</H2>

<P>Like the previous three questions on this subject, the answer is most
likely that your libkvm is out of sync with your kernel or binaries.  To
solve this problem, you can either get a binary distribution which matches
your kernel, or you can build you own by following the instructions below:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
If you get the &quot;proc size mismatch&quot; error and you determine
that you need to update your libs, here's what to do:

1. Get all the source code. If you're not willing to do this
   and recompile things than you'll have to find someone who
   will do it for you and you can try installing everything
   by hand.

2. Make sure that your include files are up to date. Do 
   this by:
      cd /usr/src
      make includes
   This will take a while. I had some trouble with this
   because some of the Makefiles didn't have the INSTALL
   variable defined. Whenever the &quot;make includes&quot; failed,
   I went to the last directory listed and added the
   following line to the Makefile:
      INSTALL=/usr/bin/install
   I had to do this several times before the make finished
   without any errors.

   (If you make sure that /usr/bin/make and all the files in
   /usr/share/mk are up to date first, the above difficulties
   can probably be avoided --Colin)

3. Rebuild the libkvm and install it:
      cd /usr/src/lib/libkvm
      make
      make install
   Note that in order to get the libkvm to compile on
   my system I had to add the following link:
      cd /usr/include/machine
      ln -s ../m68k/kcore.h kcore.h
   This may have been a quirk of my system so try 
   compiling without it first.

4. Then rebuild the binaries that are STATICALLY linked to
   libkvm. The only statically linked program that I am 
   aware of is &quot;/bin/ps&quot;. To rebuild ps, simply:
      cd /usr/src/bin/ps
      make
      make install

5. You may or may not need to rebuild the binaries that
   are dynamically linked to libkvm. This is because (I
   think) if the major version number of the lib changes
   then the old binaries will expect the old version
   number and not work with the newer version of the lib.
   For example, my old libkvm was libkvm.so.4.0. The new
   one was libkvm.so.5.0. Without recompiling the 
   dynamically linked binaries, it would still complain
   about &quot;proc size mismatch&quot; (if the 4.0 lib was still
   there) or some lib missing error (if the 4.0 lib
   had been removed from /usr/lib). If the version minor
   number changes (4.0 to 4.1, for example), I think it
   will run with a warning and so you may not need to
   recompile all of these things.

   The dynamically linked binaries that I am aware of
   will give the  &quot;proc size mismatch&quot; error (if the 4.0
   lib was still there) or some lib missing error (if the
   4.0 lib had been removed from /usr/lib). If the version
   minor number changes (4.0 to 4.1, for example), I think
   it will run with a warning, and you may not need to
   recompile all of these things.

   The dynamically linked binaries that I am aware of
   are:
      /usr/bin/fstat
      /usr/bin/gdb
      /usr/bin/ipcs
      /usr/bin/netstat
      /usr/bin/nfsstat
      /usr/bin/systat
      /usr/bin/uptime (linked to /usr/bin/w)
      /usr/bin/vmstat
      /usr/bin/w
   Note that /usr/bin/uptime is a link to /usr/bin/w and
   will be set up properly when you do the &quot;make install&quot;
   for w.

   To recompile these, do the following:
      cd /usr/src/usr.bin/&lt;cmd&gt;
      make 
      make install
   For example, to recompile /usr/bin/vmstat:
      cd /usr/src/usr.bin/vmstat
      make
      make install
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Much thanks to John Wittkowski (jpw@netscape.com) for providing such a
detailed answer for this one.</P>
<P></P>

<A NAME="H.I"></A> <H2>10.12 <A NAME="ss10.12"></A> Whenever I make extensive use of the serial ports, I get a lot of fifo overruns.  Is there a fix?</H2>

<P>This error was due to a bug in the serial drivers.  A fix has been made,
but it did not make it into the 1.1 distribution kernel.  Kernels since
that time should have the fix incorporated.</P>
<P>(NOTE: If you are currently seeing this error, please read the paragraph at
the bottom of this answer)</P>
<P>Here is the latest from Bill Studenmund (wrstuden@loki.stanford.edu):
<BLOCKQUOTE><CODE>
<PRE>
I'm pleased to announce that we seem to have fixed the serial port
problems. The current source on ftp.netbsd.org should be correct.

The problem turns out that we misunderstood how to set up the interrupt
levels (spltty specifically). We were turning off interrupts to the
chip when we should only have been turning off the passing of data to
the kernel. We were supposed to stop characters coming out of a
temporary buffer (the ring buffer) when in fact we were stopping characters
entering it. Thus it never did much, and we got lots of errors. :-(

I've gotten ppp to work very solidly. I've transfered a couple of meg
over the line w/o a single fifo error. :-)

The changed file is sys/arch/mac68k/include/param.h. Note that changing
it will mean a lot of the kernel needs re-compiling.

Noud de Brouwer, who is running a neighborhood ISP has used it, and gotten
some very impressive numbers. Like over 6k bytes/sec. :-)

WARNING about high speeds: If, while transfering data at over say 28800
(non-scientifically-picked number), you want to do something else, like
compile, log in elsewhere, or use ethernet, you might have problems.
You might not. Every time a byte gets received, the CPU has to drop
what it's doing, save what it's doing, get the byte, store it, and
resume what you're doing. It's life w/o DMA. :-( It works, but takes
a bit of CPU. Just be aware.
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Recently, a change in the interrupt handling has caused this error to start
cropping up again.  Although a fix has been committed, newer serial drivers
should permanently fix the problem.  When the new serial drivers are
committed, a note will be made of it.</P>
<P></P>

<A NAME="H.S"></A> <H2>10.13 <A NAME="ss10.13"></A> When I boot, I get the following error message:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
Bootstrapping the pmap system.
Failure in BSD boot.  nextpa=0x106000, high[0]=0x100000.
panic: You're hosed!
</PRE>
</CODE></BLOCKQUOTE>

What's wrong?</P>
<P>You forgot to put your Mac into 32-bit mode in the Memory control panel.
Do this, and, barring other problems, it should boot fine.</P>
<P>The above is true unless you have a 24-bit video board installed.  For some
reason, the 1.2 kernels seem to have trouble detecting that the machine is
in 32-bit mode when one of these boards (e.g. an Apple 8.24 video card or a
Radius Preciesion Color Pro 24XP board) is installed.</P>
<P>This problem was not present in the 1.1 kernels, so hopefully a getting a
more recent kernel will fix the problem (assuming the problem has been
fixed by now), unless you are willing to simply remove the board for now.</P>
<P></P>

<A NAME="H.K"></A> <H2>10.14 <A NAME="ss10.14"></A> When going multi-user, I get the following error message:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
Mar  2 13:03:04 myname init: kernel security level changed from 0 to 1
mrg: no trace functionality enabled
panic: kernel jump to zero
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>This is normal if you're using the serial console boot and have not fixed
your <CODE>/etc/ttys</CODE> to disable the getty on <CODE>/dev/ttye0</CODE> and
enable the getty on <CODE>/dev/tty00</CODE> like so:</P>
<P>Change /etc/ttys from this:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Define console that we actually run getty on
ttye0 &quot;/usr/libexec/getty Pc&quot; vt220 on secure
.
.
.
#Hardwired lines are marked off ...
tty00 &quot;/usr/libexec/getty std.9600&quot; unknown off secure
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>to this:</P>
<P>
<BLOCKQUOTE><CODE>
<PRE>
# Define console that we actually run getty on
ttye0 &quot;/usr/libexec/getty Pc&quot; vt220 off secure
.
.
.
#Hardwired lines are marked off ...
tty00 &quot;/usr/libexec/getty std.9600&quot; unknown on secure
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Thanks to Brian Wimberly (brianw@scripps.edu) for the above fix.</P>
<P></P>

<A NAME="H.L"></A> <H2>10.15 <A NAME="ss10.15"></A> Now that I've got ethernet working, my machine hangs a lot with the message:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
/netbsd: Panic switch: PC is 0x7f734.
/netbsd: ae0: warning - receiver ring buffer overrun
</PRE>
</CODE></BLOCKQUOTE>

Isn't ethernet working?</P>
<P>From Steve Weiss (srw@izzy.net):
<BLOCKQUOTE>
This bug is known and fixed.
</BLOCKQUOTE>

<BLOCKQUOTE>
A little over a month ago I found a bug in dev/if_ae.c, the apple ethernet
card driver, in which it failed to lower the interrupt that the card raises
when its tally count registers overflow. This results in a perpetual
interrupt hang. The mean time to fail is a function of network traffic.
</BLOCKQUOTE>

<BLOCKQUOTE>
Allen fixed this and checked the edits back into the source tree on
February 2. There are several kernels in his outgoing directory on puma
that have been built with this problem corrected. The earliest being
netbsd.please.test (4feb), and the latest being netbsd.GENERIC-5 (7mar).
Check the README in
</BLOCKQUOTE>

<BLOCKQUOTE>
<A HREF="ftp://ftp.macbsd.com/pub/outgoing/briggs/">ftp://ftp.macbsd.com/pub/outgoing/briggs/</A>
</BLOCKQUOTE>

<BLOCKQUOTE>
My IIci used to hang every 3-5 minutes before this fix (we have very high
traffic) and now it has been up for about 2 weeks running GENERIC-3.
</BLOCKQUOTE>
</P>
<P></P>

<A NAME="H.U"></A> <H2>10.16 <A NAME="ss10.16"></A> Now that I've installed an ethernet card, I get the following message:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
/netbsd: ae0: warning - receiver ring buffer overrun
/netbsd: ae0: device timeout, recovered
</PRE>
</CODE></BLOCKQUOTE>

Is this a problem?</P>
<P>If these messages continue after boot, you probably have a problem.
However, if you only seem the during boot, they are most likely caused by
the card having already been initialized by the MacOS before you booted
NetBSD.</P>
<P>Thanks to Henry B. Hotz (h.b.hotz@jpl.nasa.gov) for answering this one.</P>
<P></P>

<A NAME="H.N"></A> <H2>10.17 <A NAME="ss10.17"></A> Whenever I telnet into my Mac running NetBSD from a machine running MacOS, SunOS, or Solaris, I have severe terminal emulation problems. What's wrong?</H2>

<P>From Scott Reynolds (scottr@og.org):</P>
<P>
<BLOCKQUOTE>
This is a pretty well-known problem, and stems from the fact that Sun's
telnet (and HP's, at least up to HP-UX 9.x) is based on very old, and
broken, code.  There are two workarounds for this:  (a) get new telnet
source from ftp.cray.com, compile, and install it on the Sun, or (b) add
"-k" to the entry in inetd.conf for telnetd.  The former solution is
preferred; the latter is a kludge that will help the situation, but you
will probably find other strangeness coming from "good" telnets.
</BLOCKQUOTE>
</P>
<P>Presumably, the Mac version of telnet suffers from a similar problem.
Using rlogin instead usually works for me, but I'd recommend using ssh if
it's available.</P>
<P></P>

<A NAME="H.O"></A> <H2>10.18 <A NAME="ss10.18"></A> Why does Booter 1.9.2 always crash with an <CODE>Unimplemented Trap</CODE> system error?</H2>

<P>From Bill Studenmund (wrstuden@loki.stanford.edu):
<BLOCKQUOTE>
I bet you have a "minimal" installed MacOS, no? There is a call that was
part of an experiment for supporting booting w/ VM on. The project wasn't
completed, and this call was left in. It is not implimented on minimal
systems, but is on full installs.
</BLOCKQUOTE>
</P>
<P>Upgrading to Booter 1.9.4 or later should fix the problem.</P>
<P></P>

<A NAME="H.P"></A> <H2>10.19 <A NAME="ss10.19"></A> Why do I get the message <CODE>savecore: can't find device 0/0</CODE> when I go multi-user?</H2>

<P>From Allen Briggs (briggs@puma.macbsd.com):
<BLOCKQUOTE>
That's because the file <CODE>/netbsd</CODE> and the current kernel are not the
same, and <CODE>savecore</CODE> needs to get the default dump device from the
kernel, but if <CODE>/netbsd</CODE> and the current running kernel don't match,
it gets confused.  So do a few other programs.
</BLOCKQUOTE>
</P>
<P></P>

<A NAME="H.Q"></A> <H2>10.20 <A NAME="ss10.20"></A> Now that I've added an ethernet card right next to my video card, why does MacBSD refuse to boot?</H2>

<P>If it hangs right after recognizing either the video card or the ethernet
card, then you have probably been bitten by the interrupt conflict bug.
For some time now, it seems that certain combinations of video and ethernet
cards seem to have an interrupt conflict, usually causing the machine to
hang on boot.</P>
<P>Although removing one of the cards will solve the problem, you might want
to try a newer kernel as this kind of bug has been solved in several
instances.</P>
<P>Allen Briggs (briggs@puma.macbsd.com) has provided a HOWTO on locating the
information necessary to help fix this kind of problem:
<A HREF="http://www.macbsd.com/macbsd/howto/video.html">http://www.macbsd.com/macbsd/howto/video.html</A>
</P>
<P></P>

<A NAME="H.R"></A> <H2>10.21 <A NAME="ss10.21"></A> Why do I get the line: <CODE>ae0: NIC memory corrupt - invalid packet length 65280</CODE> when I boot?</H2>

<P>The full text of the error message is probably something more like:
<BLOCKQUOTE><CODE>
<PRE>
ae0: length does not match next packet pointer
ae0: len 0000 nlen ff00 start 0c first 00 curr 20 next 00 stop 40
ae0: NIC memory corrupt - invalid packet length 65280
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>This is most likely because you had MacOS networking enabled at the time
you booted (most likely EtherTalk or MacTCP).  Try booting with extensions
off (well, at least those extensions) and it should go away.  Occasionally,
the boot process will hang at this point if you don't turn them off.</P>
<P>Thanks to Isaac Salpeter (isaac@ticalc.org) for the above answer.</P>
<P>According to Allen Briggs (briggs@puma.macbsd.com), these messages are
fairly harmless, and you can eliminate them by compiling a kernel without
the DIAGNOSTIC option enabled in its configuration file.</P>
<P></P>

<A NAME="H.V"></A> <H2>10.22 <A NAME="ss10.22"></A> When attempting to mount my filesystems, why do I get an error like <CODE>/dev/sd0a on /: specified device does not match mounted device</CODE>?</H2>

<P>This indicates that your <CODE>/etc/fstab</CODE> doesn't match the actual
layout of the partitions on your disk.  A likely cause it that versions 1.1a
through 1.1c of the Installer utility create a possibly incorrect version
of <CODE>/etc/fstab</CODE> putting all of your partitions on sd0.  If you're
not using sd0, there are a couple of solutions: 
<OL>
<LI>Use the Installer to copyout <CODE>/etc/fstab</CODE>, edit it to reflect
reality in a text editor, and then use the Installer to copy it back in.</LI>
<li>Upgrade to latest version of the Installer:
<a href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5/mac68k/installation/misc/Installer.sea.hqx">ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5/mac68k/installation/misc/Installer.sea.hqx</a>

and do another "Build Devices" from the Installer menu.</LI>
</OL>
</P>
<P>Another possibility is that NetBSD 1.3 and later ignore Apple Driver type
partitions when filling in the disklabel, so some of your partitions might
move around due to this.  Doing a <CODE>disklabel sdX</CODE> where "X" is the
device number of the drive in question should give you a listing of the
current layout of your partitions so you can fix your <CODE>/etc/fstab</CODE>.</P>
<P></P>

<A NAME="H.W"></A> <H2>10.23 <A NAME="ss10.23"></A> I added a non-standard ADB device and now my machine gives the following error:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
panic:  ResHndls table too small!
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>From Bob Nestor (rnestor@metronet.com):
<BLOCKQUOTE>
The error comes from running out of ResHandles while making calls for ROM 
Resources. This is part of the MRG code solution for the ADB, so it probably 
won't be a problem at all with the Hardware Direct ADB solution.  I'm not 
sure why the ResHandles Table gets exhausted with certain ADB devices, 
but it does.  I recall working with someone on this some time ago, and we 
increased the table size to a value larger than the total number of 
Resources in the ROM and still couldn't eliminate the error.  It's 
probably a case where there's an error in the use of the ResHandles Table 
*and* a loop of some kind in the ADB ROM routines trying to handle these 
devices.  There are some ROM patches for the ADB routines in MacOS that 
we're not currently using in the MRG code in NetBSD, and they may be 
related this this problem.
</BLOCKQUOTE>

<BLOCKQUOTE>
So, unless someone wants to dig back into the MRG code to solve this, real 
solutions are to either wait for the Hardware Direct code or run without 
the offending ADB device.
</BLOCKQUOTE>
</P>
<P></P>

<A NAME="H.X"></A> <H2>10.24 <A NAME="ss10.24"></A> Whenever I install something using the Installer, I get an error saying:  <CODE>Warning: Battery clock earlier than filesystem date</CODE>.  What's wrong?</H2>

<P>From Nico van Eikema Hommes (hommes@ccc.uni-erlangen.de):
<BLOCKQUOTE>
I think I have figured out what happens: it is a fug (that is a bug that
would, in a Microsoft program, be called a "feature" :-> ) in the Installer.
The timestamp is set to the local MacOS time (a cpin followed by ls shows
this), but it should be set to GMT. When the filesystem is mounted during
the boot process, the timestamp is interpreted as GMT, what it should be,
and the offset, which for MET is positive, is added to it. That of course
gives a later time than that of the battery clock.
The irregularity of course came from the time elapsed between installing
and booting. The negative offset for US-based systems probably caused this
to remain unnoticed.
</BLOCKQUOTE>
</P>
<P>The latest version of the installer (i.e. 1.1e) fixes this problem by using
GMT for reads and writes instead of the local timezone (which is what the
MacOS uses).</P>
<P></P>

<A NAME="H.Z"></A> <H2>10.25 <A NAME="ss10.25"></A> When I boot, I get the error: <CODE>"kernal is not in a format the booter can understand"</CODE>.  What's wrong?</H2>

<P>You are probably trying to boot from a MacOS partition and have forgotten
to extract the raw kernel file from archive that it is in (many kernel
files are uploaded as tar archives, gzipped archives, or both).  You can
get a copy of the enhanced Stuffit Expander or the MacGzip and Tar
utilities to extract the raw kernel file.  Make sure that you do not do any
sort of end-of-line (i.e. text) translation in the process, or you will
corrupt the kernel binary.</P>
<P></P>

<A NAME="H.AA"></A> <H2>10.26 <A NAME="ss10.26"></A> Why am I getting the message: <CODE>"sn0: receive descriptors exhausted"</CODE>?</H2>

<P>From Denny Gentry (denny1@home.com):
<BLOCKQUOTE>
The sonic DMAs a received packet into a data buffer. It then
needs a descriptor to write the address of the buffer and some
information about the packet (like its length) to hand it to the
driver. If it runs out, it interrupts.
</BLOCKQUOTE>

<BLOCKQUOTE>
Usually this means the sn driver didn't get to run for a long time
to clean up its descriptors. This can happen if there is a lot of
SCSI activity, since SCSI interrupts will block network interrupts.
Early in the morning the /etc/daily (etc) scripts run, causing lots of
disk activity. If someone tried to reach your machine while the
disk grinding was going on, it could easily cause it to run
out of descriptors.
</BLOCKQUOTE>

<BLOCKQUOTE>
A few weeks ago I submitted changes to increase the number of
receive descriptors by using a seperate 4K page just for
RX descs. Scott checked those changes in, so make sure you have a
"recent" kernel. I note from another message you sent that
you're running 1.2D, a 1.2G kernel will have more descriptors.
</BLOCKQUOTE>

<BLOCKQUOTE>
Since the Sonic requires its descriptors to be physically
contiguous, giving it even more descriptors would require having
a way to allocate physically contiguous memory.
</BLOCKQUOTE>
</P>
<P></P>

<A NAME="H.AB"></A> <H2>10.27 <A NAME="ss10.27"></A> My boot hangs shortly after printing <CODE>"warning: no /dev/console"</CODE> What's wrong?</H2>

<P>This and the similar message:
<BLOCKQUOTE><CODE>
<PRE>
warning: lookup /dev/console: error #
</PRE>
</CODE></BLOCKQUOTE>

both indicate that the kernel can't find the console device.  This means
that you probably forgot to build devices while in the Installer.  Reboot
the machine, mount any non-root partitions you have using the Installer's
Mini-Shell, and choose the "Build Devices" menu item to set up the proper
devices.</P>
<P>Thanks to Bill Studenmund (wrstuden@loki.stanford.edu) for the above
information. </P>
<P></P>

<A NAME="H.AC"></A> <H2>10.28 <A NAME="ss10.28"></A> I just upgraded my kernel, and now when I boot, I get the following message:</H2>

<P>
<BLOCKQUOTE><CODE>
<PRE>
You booted with booter version 1.8.
Booter version 1.11 is necessary to fully support this kernel.
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>From Scott Reynolds (scottr@netbsd.org):
<BLOCKQUOTE>
Harmless message, unless you are using a miniroot.  (Well, if you're using
a miniroot, the manner in which you are currently doing it is deprecated,
anyway.)  You can safely use new kernels with booter versions 1.9.5 or
later, regardless of the warning message.
</BLOCKQUOTE>

<BLOCKQUOTE>
The booter version passed in has been out of date for quite some time.
That's one of the reasons the next version of the Booter is 1.11, not
1.10.3; I wanted to circumvent any potential trouble with a Booter that
actually had the version number fixed. 
</BLOCKQUOTE>
</P>
<P></P>

<A NAME="H.AD"></A> <H2>10.29 <A NAME="ss10.29"></A> My machine hangs when I try to shut it down or reboot it.  How can I get around this?</H2>

<P>This is a problem that seems to most often plague IIcx users, but it has
been seen in other older II-series Mac's as well.  It appears to be a
result of some strange low-memory interaction that depends on the size of
the kernel and the location of certain data structures within it.</P>
<P>One workaround for this problem is to compile a custom kernel with
unnecessary device drivers removed.  This will often fix the problem (but
not always).  Another possible workaround is to try to reboot the machine
and shutdown from MacOS instead.  If the reboot hangs as well (as is often
the case), the best you can do is shutdown to single-user mode, sync the
disks, and then manually power off or reboot the machine.</P>
<P></P>

<P>
<HR>

<A HREF="faq-9.html">Previous Chapter</A>
<HR>
</P>
<P>

Table of contents of <a href="./#toc10">this chapter</a>,
General <a href="./">table of contents</a>
<p>

<a href="#s10">Beginning of this Chapter</a>
<p>

<hr>
<address>
  <small>
  <a href="../../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: faq-10.html,v 1.1.1.3 2002/12/17 14:23:32 kano Exp $<br>
  <a href="../../../Misc/disclaimer.html">Copyright &copy; 1994-2001
  The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
