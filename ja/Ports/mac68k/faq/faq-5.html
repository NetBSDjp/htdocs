<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1997, 1998
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<TITLE>NetBSD/mac68k FAQ - Administration</TITLE>
</HEAD>
<BODY>
<A NAME="admin"></A> <H1>5. <A NAME="s5"></A>Administration</H1>
<P>
<HR>
<a href="./#toc5">Contents of this section</a><hr>
</P>

<A NAME="C.A"></A> <H2>5.1 <A NAME="ss5.1"></A> How do I bring the system up in single/multi-user mode?</H2>

<P>Select Options->Booting... in the Booter.  If you want to boot single-
user, check the box.  To boot multi-user, uncheck the box.</P>
<P></P>
<P></P>

<A NAME="C.B"></A> <H2>5.2 <A NAME="ss5.2"></A> Why isn't <CODE>adduser</CODE> implemented? or How <EM>do</EM> I add a new user?</H2>

<P>To manually add a user, follow the steps below, or you can read the
<CODE>adduser(8)</CODE> man page for a more complete description of the process.
<OL>
<LI>edit the password file with <CODE>vipw</CODE>:
<BLOCKQUOTE><CODE>
<PRE>
        # vipw
</PRE>
</CODE></BLOCKQUOTE>
</LI>
<LI>add entry for the new user, write, and quit <CODE>vipw</CODE></LI>
<LI>add entry for the user in <CODE>/etc/groups</CODE></LI>
<LI>create the home directory</LI>
<LI>chown the home directory to the new userid.group</LI>
<LI>set the initial password if necessary
<BLOCKQUOTE><CODE>
<PRE>
        # passwd [username]
</PRE>
</CODE></BLOCKQUOTE>
</LI>
</OL>
</P>
<P></P>
<P>If, however, you actually have a large number of users, or you just prefer
to use a script to do it, you might want to try Hubert Feyrer's
(Hubert.Feyrer@rz.uni-regensburg.de) answer:
<BLOCKQUOTE><CODE>
<A HREF="ftp://ftp.uni-regensburg.de:/pub/NetBSD-Amiga/contrib/adduser-1.2.tar.gz">ftp://ftp.uni-regensburg.de:/pub/NetBSD-Amiga/contrib/adduser-1.2.tar.gz</A>
</CODE></BLOCKQUOTE>

or
<BLOCKQUOTE><CODE>
<A HREF="ftp://ftp.netbsd.org/pub/NetBSD-Amiga/contrib/adduser-1.2.tar.gz">ftp://ftp.netbsd.org/pub/NetBSD-Amiga/contrib/adduser-1.2.tar.gz</A>
</CODE></BLOCKQUOTE>

It's written in perl and might need some customizations.</P>
<P>Another possible solution
<BLOCKQUOTE><CODE>
<A HREF="ftp://ftp.quick.com.au/pub/unix/adduser.sh">ftp://ftp.quick.com.au/pub/unix/adduser.sh</A>
</CODE></BLOCKQUOTE>

was suggested by  Simon J. Gerraty (sjg@zen.void.oz.au), who writes:
<BLOCKQUOTE><CODE>
<PRE>
This works fine on NetBSD, SunOS, Solaris, HP-UX and probably others.

It will use vipw so file locking, etc. is not an issue, and will
populate the user's home dir with default files if a suitable
prototype directory is available.

You can have it prompt you for user-id full name, or give it
everything on the command line.
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Keep in mind that none of these scripts are the "official" NetBSD
solution and I cannot guarantee they will work in the way you would like.
The <CODE>adduser(8)</CODE> manual page is still the "official" answer.</P>
<P></P>

<A NAME="C.C"></A> <H2>5.3 <A NAME="ss5.3"></A> Once I've booted single-user, how do I bring the system up into multi-user?</H2>

<P>Exit the single-user shell with "exit" or ctrl-D.</P>
<P></P>
<P></P>

<A NAME="C.D"></A> <H2>5.4 <A NAME="ss5.4"></A> My filesystem is mounted read-only.  How do I mount it read/write?</H2>

<P>Use <CODE>mount -u /</CODE>.  More than likely, you booted single-user which
mounts the Root filesystem read-only by default.  This gives you a chance
to run fsck by hand before bringing the system up into multi-user.  One
other way to mount all the filesystems in <CODE>/etc/fstab</CODE> as read/write
is to use <CODE>mount -a</CODE>.</P>
<P>However, the best way to do this is to go into multi-user mode by exiting
from your single-user shell.  This will mount all of the filesystems in
<CODE>/etc/fstab</CODE> in whatever mode they are listed.</P>
<P></P>

<A NAME="C.E"></A> <H2>5.5 <A NAME="ss5.5"></A> When is it safe to use fsck?</H2>

<P>Only use fsck on an unmounted or read-only filesystem.  Running
fsck on a r/w filesystem is dangerous and could corrupt the filesystem.
If you bring the system up into single-user mode, the system will be
mounted read-only.  From there you can do an
<BLOCKQUOTE><CODE>
<PRE>
fsck -p
</PRE>
</CODE></BLOCKQUOTE>

to check all filesystems before bringing the system up into multi-user
mode.  If the filesystem has previously been marked "clean," and you still
want to check it, you can use the <CODE>-f</CODE> flag to <CODE>fsck</CODE>.</P>
<P>If you do make any changes to the filesystem using fsck, it is probably
best to type:
<BLOCKQUOTE><CODE>
<PRE>
reboot -n
</PRE>
</CODE></BLOCKQUOTE>

to reboot the machine immediately without syncing the disks.</P>
<P></P>
<P></P>

<A NAME="C.F"></A> <H2>5.6 <A NAME="ss5.6"></A> How do I shutdown the machine?</H2>

<P>Use
<BLOCKQUOTE><CODE>
<PRE>
shutdown -h now
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Please note that this is one of the commands in NetBSD that seems to stop
working on some machines from time to time.  Occasionally it will hang
before finishing the shutdown sequence.  You can almost always reboot
and shutdown in the MacOS instead.</P>
<P>If rebooting does not work either, you might try running <CODE>shutdown</CODE> to
go single-user, then run <CODE>sync</CODE> to sync the disks, and finally power off
the machine manually.  This should avoid filesystem damage.</P>
<P></P>

<A NAME="C.G"></A> <H2>5.7 <A NAME="ss5.7"></A> How do I reboot the machine?</H2>

<P>Use
<BLOCKQUOTE><CODE>
<PRE>
shutdown -r now
</PRE>
</CODE></BLOCKQUOTE>

or
<BLOCKQUOTE><CODE>
<PRE>
reboot
</PRE>
</CODE></BLOCKQUOTE>
</P>
<P>Please note that this is another one of the commands that seems to stop
working on some machines from time to time.  The major symptom is that the
machine will appear to reboot, then it will hang before actually
restarting.  Sometimes compiling a custom kernel with all the unnecessary
devices deleted will fix the problem.</P>
<P>As a last resort to avoid power-cycling the machine and possible
file-system damage, you can <CODE>shutdown</CODE> to single-user mode, run the
<CODE>sync</CODE> command to sync the disks, and then restart the Mac via the
programmer's switch or keyboard command.</P>
<P></P>

<A NAME="C.H"></A> <H2>5.8 <A NAME="ss5.8"></A> How do I set the TZ environment variable to my timezone?</H2>

<P>See the question below on 
<A HREF="#C.H">setting the correct time</A>
.</P>
<P></P>

<A NAME="C.Q"></A> <H2>5.9 <A NAME="ss5.9"></A> How do I set the correct time (and timezone) in MacBSD?</H2>

<P>Here is a quick summary of how to correctly set the time and timezone under
MacBSD:
<OL>
<LI>In the MacOS, set the time and timezone correctly:
<UL>
<LI>In the Map control panel, choose your city or one in the same
timezone and set it.  Make sure that the timezone setting
is correct (for standard time, not DST).</LI>
<LI>In the Date &amp; Time control panel, make sure that your
clock is set correctly.</LI>
<LI>If you have a newer version of the control panel, also make
sure that the timezone and Daylight Savings checkbox are
properly set (I think this may override the Map control panel)</LI>
</UL>

</LI>
<LI>In the Booter, set the appropriate GMT bias:
<UL>
<LI>Choose Options->Booting</LI>
<LI>Set the GMT bias to the number of minutes <EM>east</EM> of GMT
for your timezone (i.e. -6 hours for CST, so -360), or
<EM>west</EM> of GMT (i.e. a positive multiple of 60).</LI>
<LI>If you have Booter 1.9.7 or later, select the option to
automatically figure out the GMT bias instead of setting
it manually (this uses the settings established in the
MacOS above).</LI>
</UL>
</LI>
<LI>Under NetBSD, set the appropriate local time zone:
<UL>
<LI>remove the current timezone file (<CODE>rm /etc/localtime</CODE>)</LI>
<LI>make the appropriate symbolic link from
<CODE>/usr/share/zoneinfo/*</CODE> to <CODE>/etc/localtime</CODE><BR>
(<CODE>ln -s /usr/share/zoneinfo/yourtimezone /etc/localtime</CODE>)</LI>
</UL>
</LI>
</OL>
</P>
<P>The timezone specification in the kernel configuration file (via
<CODE>options DST</CODE> and <CODE>options TIMEZONE</CODE>) is now obsolete.  The proper
link from <CODE>/usr/share/zoneinfo/</CODE> to <CODE>/etc/localtime</CODE> combined
with a correctly set clock (and time zone in newer versions of the Date &
Time control panel) and Map control panel and the correct GMT bias in the
Booter described above should handle this just fine.  Keep in mind that if
your <CODE>/usr</CODE> directory is not on your root partition, you might want
to copy the zoneinfo file to <CODE>/etc/localtime</CODE> instead of making a
link in order ensure that the file will be present even when your
<CODE>/usr</CODE> partition isn't mounted.</P>
<P>However, instead of setting the GMT bias in the Booter, you can also
compile the offset in to the kernel with: 
<BLOCKQUOTE><CODE>
options RTC_OFFSET=###
</CODE></BLOCKQUOTE>
</P>
<P>The default timezone is probably either EST or PST, so you may initially
experience some warnings like:
<BLOCKQUOTE><CODE>
<PRE>
Warning: Battery clock earlier than filesystem date
</PRE>
</CODE></BLOCKQUOTE>

until your filesystem has caught up with the local time.</P>
<P>The following people helped with this one:
<UL>
<LI>Futoshi Miyamori (futoshi@sramhb.sra.co.jp)</LI>
<LI>Tatsuaki Wada (wada@emws1.ee.ibaraki.ac.jp)</LI>
<LI>Mack Nagashima (mackn@CSUA.Berkeley.EDU)</LI>
<LI>Joel Klecker (jk@esperance.com)</LI>
<LI>Perry E. Metzger (perry@piermont.com)</LI>
<LI>Bill Studenmund (wrstuden@loki.stanford.edu)</LI>
<LI>Marc LaViolette (marclavi@gmc.ulaval.ca)</LI>
</UL>
</P>
<P></P>
<P></P>

<A NAME="C.I"></A> <H2>5.10 <A NAME="ss5.10"></A> What is the /kern directory used for?</H2>

<P>It is used for mounting the kernfs filesystem.  See "man mount_kernfs".</P>
<P></P>
<P></P>

<A NAME="C.J"></A> <H2>5.11 <A NAME="ss5.11"></A> What is the /proc directory used for?</H2>

<P>It is used for mounting the procfs filesystem.  Consult <I>The Design
and Implementation of the 4.3BSD UNIX Operating System</I> by Leffler,
McKusick, et al., p. 104-5, 436.  Also see "man mount_procfs".</P>
<P></P>
<P></P>

<A NAME="C.K"></A> <H2>5.12 <A NAME="ss5.12"></A> How do I change the information that gets displayed via finger?</H2>

<P>Use the "chfn" command.  Or use <CODE>vipw</CODE> to edit <CODE>/etc/master.passwd</CODE></P>
<P></P>

<A NAME="C.L"></A> <H2>5.13 <A NAME="ss5.13"></A> What files do I need to configure in order run NetBSD? </H2>

<P>Although NetBSD is fairly usable with almost no configuration file editing,
it is useful to configure the following files:
<UL>
<LI><CODE>/etc/rc.conf</CODE> - this file controls what daemons are run on a
multi-user boot.  You'll need to at least set the "rc_configured" variable
to "YES".</LI>
<LI><CODE>/etc/passwd</CODE> - give yourself a password entry (use vipw)</LI>
<LI><CODE>/etc/group</CODE> - be sure to put yourself in group wheel</LI>
<LI><CODE>/etc/myname</CODE> - fully-qualified domain name of your host</LI>
<LI><CODE>/etc/motd</CODE> - Message Of The Day, displayed upon user login</LI>
<LI><CODE>/etc/hosts</CODE> - simple name to address mappings if you don't
want to set up named, or don't know how</LI>
<LI><CODE>/etc/resolve.conf</CODE> - configuration for the resolver, allowing
you to do hostname lookups</LI>
<LI><CODE>/etc/hostname.xxx</CODE> - where xxx is your primary network interface,
should you have one. Its format documented in <CODE>/etc/netstart</CODE>.  This
is the old way of configuring a network interface.</LI>
<LI><CODE>/etc/ifconfig.xxx</CODE> - the new way of configuring a network
interface.  Should contain the arguments you would give to <CODE>ifconfig</CODE>.</LI>
<LI><CODE>/usr/share/skel/*</CODE> - skeletal login files</LI>
</UL>
</P>
<P>In general, if there is some facility that you need to configure, there is
probably a man page for it in section (5) of the man pages.  You may find
the rc.conf(5) manual page especially useful.</P>
<P>Thanks to Brian Gaeke (brg@dgate.org) for much of the above information.</P>
<P></P>

<A NAME="C.M"></A> <H2>5.14 <A NAME="ss5.14"></A> Is there anything I can read to find out more about administering my NetBSD system?</H2>

<P>Check out the 
<A HREF="../meta-faq/meta-faq-5.html">Recommended Reading</A>

section of the Meta-FAQ.</P>
<P>The 
<A HREF="http://cynjut.neonramp.com/FAQ.html">*BSD FAQ</A>

also contains a lot of useful information on NetBSD administration.</P>
<P></P>

<A NAME="C.N"></A> <H2>5.15 <A NAME="ss5.15"></A> I'm having a little bit of trouble trying to mount a NetBSD directory with my Linux box over NFS (the other way it works very well).</H2>

<P>Are you using an older GENERIC kernel?  If so, this is your problem.  The
GENERIC configuration did not have the NFSSERVER option set in its config
file until NetBSD 1.2E.  You can either build your own kernel with this
option set (see <CODE>man 8 config</CODE> for details on configuring your own
kernel, or look at the
<A HREF="http://www.macbsd.com/macbsd/howto/kernel.html">Kernel building HOWTO</A>
),
or get a more recent -current GENERIC kernel.</P>
<P></P>

<A NAME="C.O"></A> <H2>5.16 <A NAME="ss5.16"></A> Is there any reason to run in single-user mode? </H2>

<P>Several, you might want to:
<UL>
<LI><CODE>fsck</CODE> your filesystem due to suspected corruption</LI>
<LI>edit corrupted system configuration files in <CODE>/etc</CODE></LI>
<LI>install a new set of binaries which you downloaded or compiled yourself</LI>
<LI>make a backup of your filesystem without worrying about interference from user processes</LI>
</UL>
</P>
<P>Thanks to Ken Nakata (kenn@eden.rutgers.edu) for the above answer.</P>
<P></P>

<A NAME="C.P"></A> <H2>5.17 <A NAME="ss5.17"></A> I'd like to change the message in <CODE>/etc/motd</CODE>, but a while after I changed it, something reset it to its original contents.</H2>

<P>You need to change the part after the header (i.e. the kernel info line).
If you delete the header, then one of the tasks in <CODE>/etc/rc.local</CODE>
will overwrite your changes on boot. </P>
<P></P>

<A NAME="C.R"></A> <H2>5.18 <A NAME="ss5.18"></A> How do I go about setting up networking under NetBSD?</H2>

<P>Please see the 
<A HREF="faq-8.html#F.G">answer</A>
 below in the
<A HREF="faq-8.html#comm">Communications and Networking</A>
 section.</P>
<P></P>
<P></P>

<P>
<HR>
<A HREF="faq-6.html">Next Chapter</A> |
<A HREF="faq-4.html">Previous Chapter</A>
<HR>
</P>
<P>

Table of contents of <a href="./#toc5">this chapter</a>,
General <a href="./">table of contents</a>
<p>

<a href="#s5">Beginning of this Chapter</a>
<p>

<hr>
<address>
  <small>
  <a href="../../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: faq-5.html,v 1.1.1.2 2002/03/16 04:47:41 kano Exp $<br>
  <a href="../../../Misc/disclaimer.html">Copyright &copy; 1994-2001
  The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
