NetBSD/hpcmips installation 
	- to make your file system on Compact Flush -
$NetBSD: install.txt,v 1.2 2000/03/22 05:28:46 jun Exp $

0. NetBSD/hpcmips kernel with sysinst

NetBSD/hpcmips has bootloader and system installer.
on
ftp://ftp.netbsd.org/pub/NetBSD/arch/hpcmips/snapshot/20000208/installation
[20000208 is snapshot release date,try to use newer one if exists.]

get binary mode
	netbsd
	pbsdboot.exe
pbsdboot.exe is WindowsCE applicaton.start pbsdboot and
 - set hardware type (NEC MobileGear R500...)
 - kernel path. (\Storage Card\netbsd)

[CAUTION! once NetBSD/hpcmips booting,your CE machine lost 
memories on WindowsCE era.please backup such as  outlook
mail data ,PocketExcel datas on your CE memories.]

click boot button and you get into NetBSD/hpcmips.

NetBSD/hpcmips kernel with system installer costs almost 6MB memory area.
Please allocate Windows CE memory to load sysinst-netbsd kernel.
If you failed pbsdboot.exe with "cannot allocate heap" error,
allocate more memory and less disk from Windows CE 
[Setting]->[ControlPanel]->[System]->[Memory].

If you have failed with sysinst system installation,
read below sequence.

1. CF partition
fdisk CF partition
/dev/wd1a	ffs   112M	
/dev/wd1b	swap   10M	
/dev/wd1e	msdos	5M

tips:
How to create CE-readable msdos partition on CF?
    - make sysid 6 primary partition with fdisk.
    - Set CF to Windows CE CF slot.
    - Windows CE will do formatting sysid 6 partition.
    
fdisk command results.
      .........

disklabel command results.

disklabel wd0   --- print wd0 partition information
disklabel wd0 > label.CF  --- dump wd0 partition information
edit label.CF   --- edit wd0 partition information

On typcal 128M cf last lines:
#        size  offset  fstype [fsize bsize  cpg]
  a:   209920    4352  4.2BSD   1024  4096   16  # (Cyl.    17 - 836)
  b:    12800  214272    swap                    # (Cyl.   837 - 886)
  c:   222720    4352  unused      0     0       # (Cyl.    17 - 886)
  d:   227584       0  unused      0     0       # (Cyl.     0 - 888)
  e:     4320      32   MSDOS                    # (Cyl.     0*- 16 )

more info. 
http://www.netbsd.org/Ports/i386/faq.html#msdos_partition

On typcal fstab entry:
/dev/wd0a  /  ffs rw 1 1
/dev/wd0b none swap sw 0 0
/kern     /kern kernfs rw
/dev/wd0e /msdos msdos rw 0 0

2. newfs & mount PC
newfs /dev/wd1a 
mount /dev/wd1a /mnt
mount -t msdos /dev/wd1e /msdos2

tips:
pbsdboot.exe can find /netbsd kernel on CF ffs partition.
if your CF has both msdos partition and ffs partition,
pbsdboot.exe can find ffs:/netbsd from Windows CE environment.
if so,you don't need to set kernel file on msdos partition.

3. get distribution
get base.tgz etc.tgz kern.tgz
	ftp://ftp.netbsd.org/pub/NetBSD/arch/hpcmips/snapshot/


4. copy kernel
tar xzvf kern.tgz
	netbsd    - root wd0a swap wd0b

cp -p netbsd /mnt/netbsd
cp -p netbsd /msdos2/netbsd

5. copy pbsdboot
uudecode /usr/src/arch/hpcmips/stand/pbsdboot/pbsdboot.uu
cp -p pbsdboot.exe /msdos2/pbsdboot.exe

6. extract sets
tar xzvf base.tgz -C /mnt
tar xzvf etc.tgz  -C /mnt

if you have no distrib sets space,
 cd /; ftp -o "|tar xpfz -" ftp://.....
can extract sets directry.

7. make device nodes

cd /mnt/dev
sh ./MAKEDEV all

8. check /etc

cp /mnt/etc/fstab.wd /mnt/etc/fstab
edit /etc/fstab

edit /etc/rc.conf

rc_configured=NO  -> rc_configured=YES

9. Full installation

to Make Build,need 500M over storage.

CF slot:NE-2000 Compatible CF Ether Card
PCMCIA slot: Adaptec PCMCIA SCSI Card+SCSI Hard Disk

% df
Filesystem  1K-blocks     Used    Avail Capacity  Mounted on
/dev/sd0a      808619   146213   621975    19%    /
kernfs              1        1        0   100%    /kern
procfs              4        4        0   100%    /proc
/dev/sd0e     2103325   271547  1726611    13%    /usr/src

