<?xml version="1.0" encoding="ISO-2022-JP"?>
<!DOCTYPE webpage
  PUBLIC "-//NetBSD//DTD Website-based NetBSD Extension//EN"
    "http://www.NetBSD.org/XML/htdocs/lang/share/xml/website-netbsd.dtd">

<webpage id="ja-Ports-macppc-faq">
<config param="desc" value="NetBSD/macppc よくある質問"/>
<config param="cvstag" value="$NetBSD: faq.xml,v 1.2 2005/12/23 20:28:25 jmmv Exp $"/>
<!-- Based on english version: -->
<!-- NetBSD: faq.xml,v 1.2 2005/12/23 20:28:25 jmmv Exp   -->
<config param="rcsdate" value="$Date: 2005/12/23 20:28:25 $"/>
<head>
<!-- Copyright (c) 1998-2005
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<title>NetBSD/macppc よくある質問</title>
</head>

<sect1 role="toc">

<sect2 id="general">
<title>一般的な問題と質問</title>

<sect3 id="intro">
<title>序</title>

<para>NetBSD/macppc に関するよくある質問 (と回答)
をいくつか掲げます。</para>

<para>この FAQ は作成作業中です。さらなる情報、質問、回答があれば、
<ulink url="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</ulink> までメールを
(訳註: 英語で) 送ってください。</para>

<para>以下の関連情報も見てください:</para>

<itemizedlist>
  <listitem>
    <para><ulink url="SystemDisk-tutorial/">NetBSD/macppc System Disk
    チュートリアル</ulink>。</para>
  </listitem>

  <listitem>
    <para><ulink url="models.html">NetBSD/macppc
    機種対応ページ</ulink>。</para>
  </listitem>

  <listitem>
    <para><ulink url="nvedit.html">NetBSD/macppc nvedit HOW-TO</ulink>:
    NVRAMRC の内容の編集方法の案内。</para>
  </listitem>

  <listitem>
    <para><ulink url="partitioning.html">NetBSD/macppc パーティショニング
    HOW-TO</ulink>。</para>
  </listitem>

  <listitem>
    <para><ulink url="x11.html">NetBSD/macppc X11 FAQ</ulink>.</para>
  </listitem>

  <listitem>
    <para><ulink url="../../Documentation/elf.html">NetBSD ELF
    FAQ</ulink>.</para>
  </listitem>

  <listitem>
    <para>NetBSD のプラットフォーム独立なワークステーションコンソールドライバーについての
    <ulink url="../../Documentation/wscons/">wscons FAQ</ulink>.</para>
  </listitem>
</itemizedlist>

<para>さらに追加情報を提供しています:</para>

<itemizedlist>
  <listitem>
    <para><ulink
    url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">NetBSD
    2.0 インストールノート</ulink> &mdash; 対応ハードウェアとインストール方法。
    </para>
  </listitem>

  <listitem>
    <para><ulink url="../../MailingLists/#port-macppc"> port-macppc 
    メーリングリスト</ulink> &mdash; さらなる質問があれば参加してください。
    </para>
  </listitem>

  <listitem>
    <para><ulink url="../../Documentation/network/netboot/">Diskless NetBSD
    HOW-TO</ulink>.</para>
  </listitem>

  <listitem>
    <para><ulink url="../../Documentation/Hardware/Misc/serial.html">NetBSD
    シリアルポート入門</ulink>。</para>
  </listitem>

  <listitem>
    <para><ulink url="../../Documentation/">NetBSD
    一般のドキュメンテーション</ulink>
    &mdash; NetBSD/macppc 特有でない質問向け。</para>
  </listitem>
</itemizedlist>

</sect3>

<sect3 id="boot-trouble">
<title>NetBSD がブートできません。助けて !</title>

<para>残念ながら、この問題にはいくつか原因があります。これは実際には、
私たちの望んだことではなく、大抵は、対応機種の多様さや、
Apple が発表せずに行なったラインの変更のせいです。</para>

<para>まず最初に、お使いの<ulink url="models.html">機種</ulink>が対応しているかどうか
確かめてください。それから、あなたは<emphasis>実際に</emphasis>インストールノートを
ひととおり読み、また、あなたの機種のものと違う Open Firmware バージョン向けの
指示は無視しましたか? さらに、この FAQ 項目をひととおり読んでみて、
それでもまだ NetBSD をブートできないようなら、
<ulink url="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</ulink>
に投稿してください。</para>

<para>問題を切り分けるため、下記のメッセージを見てください。
</para>

<screen>Open Firmware, 1.0.5
To continue booting the MacOS type:
BYE&lt;return&gt;
To continue booting from the default boot device type:
BOOT&lt;return&gt;
ok
<prompt>0 &gt; </prompt></screen>

<para>もしこのようなメッセージが画面 (またはシリアルコンソール) に出ていなければ、
正しく Open Firmware に入っていません。マシンが MacOS のブートを始めている
(つまり、画面がグレーに変わり、 happy mac や broken folder や点滅する
クエスチョンマークが出る)
場合は、まず <xref
linkend="ofw-access" />を見てください。
古い mac で画面が真っ黒になる場合は、
<xref linkend="ofw-boot-serial" />を見てください。
画面がまったくもって妙な場合は、
<xref linkend="non-sync-monitor" />の修正方法を見てください。
Open Firmware でおかしな設定をしたせいで、 Open Firmware に入れなくなったり MacOS
がブートしなくなってしまった場合は、 <xref linkend="ofw-clear"
/>を見てください。</para>

<para>OK、これで、 Open Firmware のプロンプト ("<literal>0&nbsp;&gt;</literal>") で止まるよう
に設定してあれば、 Open Firmware が起動してユーザーコマンドが使えるようになります。
ここで止まらないように設定してあれば、 Open Firmware は以前に行なった設定
(Open Firmware の変数 <literal>boot-command</literal>、 <literal>boot-device</literal>、
<literal>boot-file</literal>) に基づいてブートしようとします。
Open Firmware のコマンドラインインターフェース使用の手引きについては、
<xref linkend="ofw-use" />を見てください。</para>

<para>ふつうは、次の段階が最もトリッキーです &mdash; Open Firmware がブートローダーを
正しい場所からロードできるようにします。どのようなブート方法がサポートされているか
(<xref linkend="boot-support" />)、 Open Firmware
のブートコマンド (<xref linkend="boot-disk" />)、 Open
Firmware のブートでのありがちな問題 (<xref linkend="common-of-probs" />) を見てください。
ネットブートに関連する質問は、
<ulink url="../../Documentation/network/netboot/">Diskless HOW-TO</ulink>、
特に
<ulink url="../../Documentation/network/netboot/intro.macppc.html">macppc 固有な部分</ulink>
の章、および netboot でありがちな問題 (<xref
linkend="netboot-probs" />) でカバーしています。</para>

<screen><prompt>0 &gt; </prompt><emphasis role="bold">boot enet:,ofwboot.xcf</emphasis> file: 192.168.0.11,/ofwboot.xcfloading XCOFF
tsize=C280 dsize=14AC bsize=2620 entry=600000
SECTIONS:
.text    00600000 00600000 0000C280 000000E0
.data    0060D000 0060D000 000014AC 0000C360
.bss     0060E4B0 0060E4B0 00002620 00000000
loading .text, done..
loading .data, done..
clearing .bss, done..</screen>

<para>メモリーアドレッシングに問題がある場合は、ここで止まって
<literal>CLAIM failed</literal> と出力されることがあります (<xref linkend="ofw-claim-failed"
/>参照)。</para>

<screen>&gt;&gt; NetBSD/macppc OpenFirmware Boot, Revision 1.3
&gt;&gt; (tsubai@mint.iri.co.jp, Sun Nov 26 01:41:27 JST 2000)
1701508+177748 [100+68176+55886]=0x1e9468</screen>

<para>ここで止まる場合、 Open Firmware 1.0.5 や 2.0.x のマシンの
<literal>real-base</literal> (<xref linkend="ofw-real-base"
/>参照) を設定する必要があります。
<literal>READ TIMEOUT@</literal> とのメッセージがたくさん出る場合 (<xref 
linkend="ofw-read-timeout" />参照) は、
Open Firmware がフロッピーディスクを読むところで問題が起きています。
ここを過ぎれば、カーネルのロードが始まります。
もし、そこで問題があったら、それはもはや Open Firmware の問題ではなく、
ほとんど NetBSD の問題でしょう。</para>

<para>ラップトップで画面が真っ黒になる場合、
途中で LCD の明るさが下げられたのかもしれません。<xref linkend="black-lcd"
/>をご覧ください。</para>

<screen>start=0x100000
Copyright (c) 1996, 1997, 1998, 1999, 2000, 2001
    The NetBSD Foundation, Inc.  All rights reserved.
Copyright (c) 1982, 1986, 1989, 1991, 1993
    The Regents of the University of California.  All rights reserved.

NetBSD 1.5S (AL) #0: Thu Mar 15 00:52:56 PST 2001
    mw@al:/usr/src/sys/arch/macppc/compile/AL
total memory = 192 MB
avail memory = 172 MB
using 2483 buffers containing 9932 KB of memory
[...]
boot device: sd0
root on sd0a dumps on sd0b
root file system type: ffs</screen>

<para>ときどき、カーネルは自身がどこからブートしたかがわからなくなります。
ルートデバイスを埋め込んだカーネルを再構築するとよいかもしれません。<xref
linkend="dash-a" />をご覧ください。</para>

<para>新しい PowerBook がここでハングする場合、
<xref linkend="powerbook" />を見てください。</para>

<screen>swapctl: adding /dev/sd0b as swap device at priority 0
Automatic boot in progress: starting file system checks.
[...]</screen>

<para>OK、これで「マルチユーザーモード」に入り、ブートの過程が終わりました。
キーボードが機能しない場合は、<xref linkend="powerbook"
/>を見てください。</para>

<para>sysinst を使い、<literal>I can not find any
hard disk for use by NetBSD</literal> と言われた場合は、<xref
linkend="nodisk" />を参照すべきです。</para>

</sect3>

<sect3 id="macos-newbie">
<title>助けてください、 MacOS のことを何も知らないのです!</title>

<para>MacOS のことを知らないことが問題となりうるかどうかは、お持ちの<ulink
url="models.html">機種</ulink>によります。古い機種の一部では、 NetBSD/macppc
をブートできるようにするためには nvram パッチが必要になります。たいてい、この
パッチを当てるための最も簡単な方法は、 MacOS ユーティリティーを使うことです。
基本的なこと (BinHex ファイルの展開のために StuffIt Expander を使うことや、
MacOS アプリケーションの起動方法や、それどころか MacOS Finder でのファイルの
コピー方法など) を知らない場合、 MacOS の使用を避けるようにしたほうが
よいでしょう (MacOS のことを知っておきたいというのなら別ですが) 。</para>

<para>unix 萌えな人たちが簡単にできる (MacOS 経験者のほとんどにとっては大変な)
セットアップ方法があります。この FAQ 項目は、そういった unix 萌えな人たち向け
のものです; INSTALL ノートは、 MacOS 経験者で最小限の unix
の知識しかない人向けに書かれているからです。</para>

<sect4 id="macos-newbie-of3">
<title>Open Firmware 3 システムの場合</title>

<para>NetBSD をひとつのハードドライブ上にすべて置いておきたい場合は、ふたつの
方法があります。一方の非常に簡単な方法は、簡単に MacOS をブートさせ、
MacOS ユーティリティーまたは pdisk でディスクを分割し直し、それから
<filename>ofwboot.xcf</filename> ブートローダーを HFS パーティションにコピーする方法です。
<ulink url="partitioning.html">パーティショニング HOW-TO</ulink> をご覧ください。</para>

<para>MacOS を使えない、または使いたくない場合でも、ディスクを分割するために、
やはり何らかのオペレーティングシステムをブートする必要があります。
これに使えるオープンソース OS は、今のところ、三つ (NetBSD、 Darwin、 Linux) あります。
NetBSD <command>pdisk</command> を使ってディスクを分割し、 HFS ファイルシステムを作って、
<filename>ofwboot.xcf</filename> を HFS パーティションにコピーします。</para>

<itemizedlist>
  <listitem>
    <para>NetBSD をブートし、<ulink
    url="partitioning.html#pdisk">pdisk</ulink> を使ってディスクを分割し、
    <ulink
    url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/sysutils/hfsutils/README.html">
    hfstools</ulink> を使ってパーティションをフォーマットしてから
    ブートローダーをコピーします。</para>
  </listitem>

  <listitem>
    <para><ulink
    url="http://developer.apple.com/darwin/projects/darwin/">Darwin</ulink>
    (Apple のオープンソース BSD) をブートし、 (Darwin ネイティブの pdisk ではなく) NetBSD の <ulink
    url="partitioning.html#pdisk">pdisk</ulink> を使ってディスクを分割し、
    以下のコマンドを実行します (もちろん、ディスクとパーティションの番号は
    適宜読み替えてください):</para>

    <screen><prompt>#</prompt> <userinput>newfs_hfs /dev/disk0s3</userinput>
<prompt>#</prompt> <userinput>mkdir -p /mnt</userinput>
<prompt>#</prompt> <userinput>mount /dev/disk0s3 /mnt</userinput>
<prompt>#</prompt> <userinput>cp ofwboot.xcf /mnt</userinput></screen>
  </listitem>

  <listitem>
    <para>Linux をブートし (Linux ネイティブの pdisk ではなく) NetBSD の <ulink
    url="partitioning.html#pdisk">pdisk</ulink> を使ってディスクを分割します。
    ディストリビューションによってははじめから HFS ファイルシステムを取り扱えるものもあります。
    些細なことでも結構ですので、さらに情報をお持ちのかたは <ulink
    url="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</ulink>
    までメールでお知らせください。</para>
  </listitem>
</itemizedlist>

<para>少し妥協する気があるのなら、 <filename>ofwboot.xcf</filename>
をネットブートサーバー、 ISO 9660 CD-R、または
MS-DOS ディスク上に置いておくことができます (<literal>boot-device</literal>
をブートローダーの場所に、 <literal>boot-file</literal> をカーネルへのパスに設定します)。
<xref linkend="ofw-variables" />の情報を見てください。</para>

</sect4>

<sect4 id="macos-newbie-ofpre3">
<title>初期の、 Open Firmware 1.0.5、 2.0.x、または 2.4
システムの場合</title>

<para>こちらは、多くの機種がデフォルトでシリアルコンソール (<xref
linkend="ofw-input-output-devices" /> 参照) を使うようになっているので、若干興味深いものになります。
手っ取り早くデフォルトのコンソールを設定する方法は、マシンの電源を入れて
起動音が鳴ったら、 <literal>Command-Option-O-F</literal> の 4 個のキーを、
画面が黒、グレーまたは白に変わるまで押し続けることです。
画面が黒くなった場合は、ハードウェアの問題またはシリアルコンソールを意味します。
グレーは Open Firmware に入れず、 MacOS をブートしようとしていることを意味します。
白 (文字が出る) は、デフォルトがローカルコンソールだったことを意味します。</para>

<para>画面上またはシリアルコンソールで <literal>0&nbsp;&gt;</literal> という Open Firmware
プロンプトに達すれば、 INSTALL ノートの "Getting to the Open Firmware Prompt
(Without using MacOS)" の節に従って NetBSD のインストールを始められます。
もしお使いのシステムで NetBSD がブートできなければ、 <ulink
url="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</ulink>
に投稿して、その機種用の nvram パッチを送ってくれるよう頼んでみてください。
シリアルコンソールを使って nvram パッチを Open Firmware
に適用することができます。この手順については <ulink
url="nvedit.html">NetBSD/macppc nvedit HOW-TO</ulink> を見てください。
これを行えば、問題はないはずです。</para>

</sect4>

<para>健闘を祈ります!</para>

</sect3>

<sect3 id="disk-sharing">
<title>マシン上の OS 間でファイルを共有する方法は ?</title>

<para>この項目は<ulink url="partitioning.html">パーティショニング
HOW-TO</ulink> に統合されました。</para>

</sect3>

<sect3 id="partitions">
<title>Explaining the partition naming schemes</title>

<para>この項目は<ulink url="partitioning.html#nomenclature">パーティショニング
HOW-TO</ulink> へ移動しました。</para>

</sect3>

<sect3 id="scroll-speed">
<title>なぜテキストの画面スクロールがこんなに遅いの?</title>

<para>GENERIC カーネルのテキストコンソールのコードは最適化されていません。
NetBSD 1.6 以降には高速化されたテキストコンソールコードがありますが、
これはデフォルトでは有効になっていません。</para>

<para>カーネルを再構築する必要があります。
<ulink url="../../Documentation/kernel/#how_to_build_a_kernel">
カーネルコンフィギュレーション</ulink>に次の行を追加してください:</para>

<programlisting>options OFB_ENABLE_CACHE</programlisting>

<para>X11 サーバーに関する情報は、 <ulink url="x11.html">NetBSD/macppc      
X11 FAQ</ulink> を見てください。</para>

</sect3>

<sect3 id="usb-mouse-bug">
<title>USB マウスが認識されません</title>

<para>キーボードでなく、
Mac 本体背面に直接接続してみてください。</para>

</sect3>

<sect3 id="ethernet-bad-date">
<title>イーサネットが機能しません</title>

<para>(ケーブルや<ulink url="../../Documentation/network/">設定上の</ulink>問題といった)
定番の原因のほか、 NetBSD/macppc では、 PRAM に保存されている日付が古すぎる場合
(システムの電池が切れたり、日付が 1904 年や 1956 年に設定されるような方法で
リセットされたような場合など)
に、ネットワークインターフェースの使用に問題があるようです。
この場合の症状は、 <literal>ifconfig</literal> では問題がないように見えるものの、
パケットがまったく送出・受信されないというものです。</para>

<screen><prompt>%</prompt> <userinput>ping 10.0.1.1</userinput>
PING 10.0.1.1 (10.0.1.1): 56 data bytes
<userinput>^C</userinput>
----10.0.1.2 PING Statistics----
0 packets transmitted, 0 packets received,</screen>

解決法は、 &man.date.1; を使って時刻を正しく設定することです。

</sect3>

<sect3 id="power-manager">
<title>PowerBook や iBook で、電源入、バッテリー充電、
充電器の認識ができません</title>

<para>電源管理メモリーがおかしくなっているかもしれません。</para>

<para>リセット方法については <ulink
url="http://docs.info.apple.com/article.html?artnum=14449">TIL
14449</ulink> を見てください。</para>

</sect3>

<sect3 id="timedrift">
<title>PowerComputing 互換機の時計がずれまくります。</title>

<para>あー、これは Open Firmware 内の <literal>timebase</literal> がハードウェアと
合致していないためです。正す必要があります。</para>

<para>Adam Lebsack による<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/08/03/0003.html">記事</ulink>
を見てください。</para>

</sect3>

<sect3 id="dash-a">
<title>カーネルがいつもルートデバイスを尋ねてくるのはなぜですか ?</title>

<para>多くの人が、 NetBSD/macppc システムを無人でブートさせられないと報告しています。
Open Firmware はカーネルを正しくロードするものの、
カーネルはルートデバイス (つまり / ファイルシステムの所在)
を見つけられていないようです。</para>

<para>プロンプトで、ルートディスク (大抵は <literal>sd0a</literal> か <literal>wd0a</literal>
のようなもの)、スワップ (大抵は <literal>sd0b</literal> か <literal>wd0b</literal>
のようなもの)、ファイルシステムの種類 (大抵は <literal>ffs</literal>、 <literal>nfs</literal>
または <literal>cd9660</literal>) を入力してください。</para>

<para>これが修正されるまでの次善策があります。次のような設定で
<ulink url="../../Documentation/kernel/#how_to_build_a_kernel">カーネルを
コンパイル</ulink>する必要があります:</para>

<programlisting>#config		netbsd	root on ? type ? #to automatically detect root device
config		netbsd	root on sd0a type ffs #for SCSI disk
#config		netbsd	root on wd0a type ffs #for IDE disk
#config		netbsd	root on ? type nfs #for netboot</programlisting>

<para>ここで <literal>sd0a</literal>
はルートファイルシステムのあるパーティション名です。</para>

</sect3>

</sect2>

<sect2 id="hardware">
<title>対応ハードウェア</title>

<sect3 id="supported-models">
<title>NetBSD/macppc 対応機種</title>

<para><ulink url="models.html">NetBSD/macppc
対応機種一覧</ulink>を見てください。また、<xref
linkend="peripherals" />で対応周辺機器の一覧も併せて見てください。</para>

</sect3>

<sect3 id="nubus">
<title>NuBus ベースの Power Mac (7100, 8100 等) はサポートされていますか?</title>

<para>いいえ。 NetBSD/macppc は NuBus に対応していません。
さらに、 NuBus ベースの Power Mac は Open Firmware を持っていませんが、
NetBSD/macppc のブートストラップやコンソール操作は
Open Firmware に強く依存しています。</para>

<para>NuBus ベースの Power Macintosh マシンは、 4 グループに分類されます:</para>

<itemizedlist>
  <listitem>
    <para><emphasis>Apple PDM</emphasis>: あらゆる x1xx なマシン、たとえば 6100,
    6150, 7100, 8100</para>
  </listitem>

  <listitem>
    <para><emphasis>Apple PERFORMA class</emphasis>: 52xx, 53xx, 62xx, 63xx
    (6360 は除く)</para>
  </listitem>

  <listitem>
    <para><emphasis>Apple POWERBOOK (or 'M2') class</emphasis>: 1400, 2300,
    5300</para>
  </listitem>

  <listitem>
    <para><emphasis>Power Computing "Power" シリーズ</emphasis>:
    "Power 100" や "Power 120" など</para>
  </listitem>
</itemizedlist>

<para>これらの機種では、たとえプロセッサーを G3 にアップグレードしても、
他の部分が未サポートなので、動作しません。
(しかし、ロジックボードを完全にアップグレードすれば、
新しい機種と同等になるので、動作するでしょう。)</para>

<para>現在、これらの機種に対応するための作業をしている人を私たちは知りません。
もし、この作業に興味があれば、 (訳註: 英語で)
<ulink url="mailto:port-macppc@NetBSD.org">私たちにお知らせください</ulink>。</para>

<para>私たちはすでに 603 マイクロプロセッサーをサポートしており、また、
RS/6000 移植の取り組みにおいて 601 マイクロプロセッサーサポートの作業中です。
そして、 <ulink url="../mac68k/">NetBSD/mac68k</ulink> ではマザーボードの
チップセットをサポートしています。あとは、単に、これらのドライバーの共有と、
現在サポートされている macppc マシンのブートの Open Firmware での方法と
互換なブートローダーの解決だけの問題です。どこから始めればよいかと、何が必要かについては、
David A Gatwood の <ulink
url="http://mail-index.NetBSD.org/port-macppc/2002/01/14/0021.html">記事</ulink>
を参照してください。</para>

</sect3>

<sect3 id="68k-upgrade">
<title>PowerPC プロセッサーにアップグレードした 68k ベースの Mac
はサポートされていますか?</title>

<para>いいえ。上記と同じ理由からです。
(これは<emphasis>プロセッサー</emphasis>だけをアップグレードした場合の話です。
マザーボードをすべてアップグレードすれば、
新しい機種と同等になるので、動作するでしょう。)</para>

</sect3>

<sect3 id="601">
<title>Power Macintosh 7200 や 7500 (601 プロセッサー)
はサポートされていますか?</title>

<para>これらの機種は PCI と Open Firmware を持っていますが、 PowerPC 601
プロセッサーを使っているため、今のところ非対応です。しかし、
7500 のプロセッサーはアップグレード可能なので、 603/604/G3/G4 へ換装すれば
NetBSD が動作するでしょう。
<xref linkend="cpu-upgrade" />を見てください。</para>

<para>また、 RS/6000 ポートにおいて作業が進行中であり、これにより
NetBSD に 601 サポートがもたらされるでしょう。これが達成されれば、
あとは rs6000 と macppc でのコードの共有の問題になります。</para>

</sect3>

<sect3 id="powerbook">
<title>PowerPC ベースの PowerBook はサポートされていますか?</title>

<para>多くの機種をサポートしています。 <ulink url="models.html">NetBSD/macppc
対応機種のリスト</ulink>を見てください。</para>

<para>PowerBook 1400、 2300、 5300 は、
Open Firmware を持たないため、非対応です。</para>

<para>新しく発表されたラップトップの機種は、従来と異なる内蔵キーボードを持っていることがあり、
NetBSD が対応するのにしばらく時間がかかります。新しく発表された機種をお持ちの方は、<ulink
url="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</ulink>
へ投稿してみてください。</para>

<para> パワーマネージメントは未サポートですので注意してください。
NetBSD の動作中は PowerBook のサスペンド、レジュームはできません。</para>

<para>このほか、<xref linkend="power-manager" />も見てください。</para>

</sect3>

<sect3 id="cpu-upgrade">
<title>CPU アップグレードに対応していますか?</title>

<para>もちろん!</para>

<para>多くの人々が、遅い 601、 603、 604 や G3 CPU を、より速い 604、 G3 や G4 CPU
にアップグレードしています。最初の PowerPC 601 チップを持った
PowerMacintosh 7500 では、事実上必須でしょう。</para>

<para>PCI PowerMacintosh システム (7300 - 9600)、対応 PowerBook および初期の
G3 システムにもとから搭載されている CPU のアップグレードの成功が
報告されています。よく目にする製造元は、 Newer Technology、
Powerlogix、 Sonnet、 XLR8 です。その CPU が MacOS で動作していれば、 NetBSD
でも動作するはずです。</para>

<para>初期の PCI PowerMacintosh システム (7300 - 9600) に新しい CPU を装着すると、
NetBSD がブートしないという報告があります。これに該当する場合 (つまり、
604 にダウングレードすれば NetBSD が動作する場合) 、いったん
MacOS をブートして、お使いの CPU ドーターカード用の <literal>nvramrc</literal>
パッチをインストールする必要があります。そうした後は、 System Disk
を使っては<emphasis>いけません</emphasis>。 System Disk は、自分の <literal>nvramrc</literal> で
先般の CPU メーカーの <literal>nvramrc</literal> を上書きしてしまうからです。
System Disk のかわりに <ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/macos-utils/bootvars/">Boot
Variables</ulink> を使ってください。これは、 PowerMacintosh 7300 - 8600 内蔵の
<literal>/chaos/control</literal> を使った場合にモニターが同期しない可能性があるということです。
<xref linkend="non-sync-monitor"
/>をご覧ください。</para>

<para>他の機種では、 MacOS の "virtual firmware"
型のパッチは必要ないようです &mdash; NetBSD は CPU を適切に初期化します。</para>

<para>残念ながら、 Metabox Jocard G4 には問題があります。これについては、
Thomas Michael Wanka の<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/09/01/0002.html">記事</ulink> 
を見てください。</para>

<para>一部機種での CPU アップグレードの組み合わせによっては、
古いシステムで G3 または G4 CPU の L2 キャッシュを有効に
するために特別にカーネルをコンパイルする必要があるかもしれません。これは
普通は必要なく、 "ちゃんと動き" ます。動かない場合は、次のようなメッセージが表示されます:</para> <screen>cpu0 at
mainbus0: L2 cache not enabled</screen>

<para>もし、ブート時にこのようなメッセージが出力された場合には、
この<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/01/05/0000.html">記事</ulink>
と、この<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/01/05/0007.html">記事</ulink>
の示すとおりにすべきです。</para>

<para>L3 キャッシュがデフォルトでは有効にならない場合は、この<ulink
url="http://mail-index.NetBSD.org/port-macppc/2003/02/27/0000.html">記事</ulink>
で示されている方法に従ってください。</para>

</sect3>

<sect3 id="peripherals">
<title>どんな周辺機器に対応していますか ?</title>

<para><ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">
NetBSD/macppc 2.0 インストールノート</ulink>の "Supported devices"
節に、完全な一覧が載っています。
特記ない限り、サードパーティー製デバイス (PCI や cardbus など)
は、 NetBSD/macppc のブート用には使えません。</para>

<itemizedlist>
  <listitem>
    <para>CPU</para>

    <itemizedlist>
      <listitem>
        <para>PowerPC 603, 604, G3, G4 (およびこれらの亜種):
        <xref linkend="cpu-upgrade" />を参照。</para>
      </listitem>

      <listitem>
        <para>マルチプロセッサーカードのサポートは、 NetBSD/macppc 2.0
        およびそれ以降で利用可能になっています。
        <filename>GENERIC.MP</filename> カーネルを使うか、カーネルコンフィギュレーションに "<literal>options
        MULTIPROCESSOR</literal>" を追加する必要があります。
        そうしないと、 NetBSD は CPU を 1 個しか使いません。</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>イーサネット</para>

    <itemizedlist>
      <listitem>
        <para>オンボード 79C950 (MACE) イーサネット
        (<emphasis>mc</emphasis>)</para>
      </listitem>

      <listitem>
        <para>オンボード bmac イーサネット、ただし 10Base-T のみ
        (<emphasis>bm</emphasis>)</para>
      </listitem>

      <listitem>
        <para>オンボード gmac イーサネット (<emphasis>gem</emphasis>)</para>
      </listitem>

      <listitem>
        <para>オンボード AirPort (別名 AirMac) (<emphasis>wi</emphasis>):
        <xref linkend="airport" />参照</para>
      </listitem>

      <listitem>
        <para>PCI, PCMCIA, cardbus および USB のイーサネットデバイス
        (<emphasis>tlp</emphasis>, <emphasis>epic</emphasis>,
        <emphasis>ex</emphasis>, <emphasis>fxp</emphasis>,
        <emphasis>rtk</emphasis>, <emphasis>vr</emphasis>,
        <emphasis>ne</emphasis>, <emphasis>aue</emphasis>,
        <emphasis>cue</emphasis>, and <emphasis>kue</emphasis>): 具体的には、
        Asante, Farallon, SMC, 3Com, Intel, RealTek, D-Link, NE2000, 
        その他これらと互換のデバイス</para>
      </listitem>
    </itemizedlist>

  </listitem>

  <listitem>
    <para>SCSI</para>

    <itemizedlist>
      <listitem>
        <para>オンボード 53c94 SCSI コントローラー
        (<emphasis>esp</emphasis>).</para>
      </listitem>

      <listitem>
        <para>オンボード MESH SCSI コントローラー
        (<emphasis>mesh</emphasis>).</para>
      </listitem>

      <listitem>
        <para>Adaptec / Future Domain PCI SCSI (<emphasis>ahc</emphasis>):
        多くの Adaptec 製カードは Macintosh firmware を内蔵しており、
        NetBSD/macppc のブートに使用可能。<xref linkend="boot-pci" />参照。</para>
      </listitem>

      <listitem>
        <para>Advansys 1200[A,B] 9xx[U,UA] PCI SCSI
        (<emphasis>adv</emphasis>).</para>
      </listitem>

      <listitem>
        <para>AMD 53c974 (<emphasis>pcscp</emphasis>).</para>
      </listitem>

      <listitem>
        <para>Apple 53c875 Ultra Wide SCSI (一部のベージュ G3 モデルで使用)
        (<emphasis>siop</emphasis>): NetBSD をブートするにはファームウェアのアップデートが必要な可能性あり。
        <ulink
        url="http://docs.info.apple.com/article.html?artnum=25176">Mac OS X
        SCSI Card Updater</ulink> を使用のこと。</para>
      </listitem>

      <listitem>
        <para>NCR/Symbios 53c8xx (<emphasis>siop</emphasis>)
        </para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>IDE</para>

    <itemizedlist>
      <listitem>
        <para>オンボード IDE コントローラー (<emphasis>wdc</emphasis>)</para>
      </listitem>

      <listitem>
        <para>Promise Ultra66 (<emphasis>pciide</emphasis>)</para>
      </listitem>

      <listitem>
        <para>Acard ATP-850/860 コントローラー (Sonnet Tempo ATA/66
        や Acard AEC-6210/6260 など) (<emphasis>pciide</emphasis>)</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>入力デバイス</para>

    <itemizedlist>
      <listitem>
        <para>ほとんどの ADB キーボード、マウス、トラックボール、トラックパッド。</para>
      </listitem>

      <listitem>
        <para>ほとんどの USB キーボード、マウス、トラックボール、トラックパッド。</para>
      </listitem>

      <listitem>
        <para>ほとんどの PS/2 キーボード、マウス、トラックボール (3 ボタンマウスの
        中ボタンは機能しないかもしれません)。</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>ビデオ (<xref linkend="ofw-input-output-devices" />参照)</para>

    <itemizedlist>
      <listitem>
        <para>ほとんどの機種のオンボードビデオ (<emphasis>ofb</emphasis>):
        <ulink url="models.html#no.ofw.fb">機種によっては</ulink>、オンボードビデオを
        使っては NetBSD/macppc をブートすることができません。</para>
      </listitem>

      <listitem>
        <para>Open Firmware がサポートしている PCI ビデオカード
        (<emphasis>ofb</emphasis>): ATI, IMS, Matrox, NVIDIA
        が、 Open Firmware 対応機種を出しています。</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>Audio</para>

    <itemizedlist>
      <listitem>
        <para>ほとんどの機種でのオンボード AWACS オーディオ (実験的なもの&mdash;
        いくつかの G4 マシンで割り込みの衝突があるため、デフォルトでは無効)
        (<emphasis>awacs</emphasis>).</para>
      </listitem>

      <listitem>
        <para>USB オーディオ (<emphasis>uaudio</emphasis>).</para>
      </listitem>

      <listitem>
        <para>PCI オーディオカード、ただし、しっかりテストされたのは Ensoniq AudioPCI
        (<emphasis>eap</emphasis>) だけですが。</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>シリアル。NetBSD/macppc は、オンボードシリアルポートを
    <filename>tty00</filename> および <filename>tty01</filename> として参照します。Open
    Firmware は以下に挙げる名前を使います。</para>

    <itemizedlist>
      <listitem>
        <para>オンボード RS-422 シリアルポート (モデムポートは
        <emphasis>ttya</emphasis> 、プリンターポートは
        <emphasis>ttyb</emphasis>): オンボードシリアルのサポートは非常に貧弱で、
        システムをハングさせる可能性もあります。<xref linkend="badserial"
        />参照。</para>
      </listitem>

      <listitem>
        <para>Xserve の RS-232 オンボードシリアルポート: 
        シリアルコンソールとして使用可能です</para>
      </listitem>

      <listitem>
        <para>Gee Three Stealth Serial Port および Griffin Technology
        gPort: これらはデスクトップ G3 および G4 モデルの内蔵モデムを置き換えるもので、
        シリアルコンソールとして使用可能です。</para>
      </listitem>

      <listitem>
        <para>USB、 PCI、および cardbus ベースのシリアルポート。</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>USB デバイス</para>

    <itemizedlist>
      <listitem><para>増設 USB デバイスの多くに対応しています。
      <ulink url="../../Hardware/usb.html">機種独立の USB
      ドライバー</ulink>のページを見てください。</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>PCMCIA および CardBus カード</para>

    <itemizedlist>
      <listitem>
        <para>多くのカードに対応していますが、 NetBSD/macppc ではテストされていません。
        <ulink
        url="../../Hardware/pcmcia.html">機種独立の PCMCIA
        ドライバー</ulink>や、<ulink
        url="../../Hardware/cardbus.html">機種独立の Cardbus
        ドライバー</ulink>のページを見てください。</para>
      </listitem>
    </itemizedlist>
  </listitem>

  <listitem>
    <para>PCI カード</para>

    <itemizedlist>
      <listitem>
        <para>多くのカードに対応していますが、 NetBSD/macppc ではテストされていません。
        <ulink
        url="../../Hardware/pci.html">機種独立の PCI
        ドライバー</ulink>のページを見てください。</para>
      </listitem>
    </itemizedlist>
  </listitem>
</itemizedlist>

<para>NetBSD/macppc で未対応のものは、</para>

<itemizedlist>
  <listitem>
    <para>ブート用として以外の (内蔵や USB の) フロッピードライブ。</para>
  </listitem>

  <listitem>
    <para>電源管理。</para>
  </listitem>

  <listitem>
    <para>仮想端末やカラーテキストといった、完全な
    <ulink url="../../Documentation/wscons/">wscons</ulink> 機能。</para>
  </listitem>

  <listitem>
    <para>ディスク、 CD-RW、スキャナーといった、通常の FireWire (IEEE 1394)
    デバイス。</para>
  </listitem>

  <listitem>
    <para>オンボードビデオキャプチャー。</para>
  </listitem>

  <listitem>
    <para>AirPort Extreme.</para>
  </listitem>
</itemizedlist>

</sect3>

<sect3 id="badserial">
<title>シリアルポートの使用に問題が起こります!</title>

<para>これは、内蔵シリアルポートがあまりうまく動作しないせいです。実際のところ、
コンソールの使用ぐらいでしかうまく使えません (それすら、
時々不確実になります) 。</para>

<para>これが修正されるまでは、モデム、 ppp、 palm との同期その他が使えるとは
思わないでください。もし、あなたにシリアルドライバーについての経験があり、
手助けをする気がおありなら、どうか <ulink
url="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</ulink>
までご連絡ください。</para>

</sect3>

<sect3 id="pppmacppc">
<title>ppp を使う方法は?</title>

<para>うぐぅ。残念なことですが、内蔵シリアルポートが動作しないため、
ppp ドライバーには若干のバグがつぶされずに残っています。</para>

<para>Donald Lee の、 Cyclades PCI カードで ppp を走らせた方法についての<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/07/26/0023.html">記事</ulink>
を見てください。</para>

</sect3>

<sect3 id="airport">
<title>AirPort あるいは AirMac ネットワークを使う方法は?</title>

<para>ワイヤレスネットワーキングは NetBSD 1.6 から対応しました。AirPort
Extreme は、今のところサポートされていません。</para>

<para>手短に言えば、必要なことは、ワイヤレスカードを、 DHCP を使って IP アドレスを
得るよう設定することと、正しいメディアタイプ (大抵は <literal>DS11</literal>)
および (<literal>nwid</literal> パラメーターを使って) 正しいネットワーク
を設定することです。たとえば、閉じた AirPort ベースステーションに接続するため、
筆者は <filename>/etc/rc.conf</filename> に以下のように書きました:</para>

<programlisting>ifconfig_wi0="nwid Gizmonet media DS11"
dhclient=YES
dhclient_flags="wi0"</programlisting>

<para>リブートの都度、 AirPort カードは <literal>Gizmonet</literal>
のベースステーションを探して IP アドレスを要求します。</para>

<para>より詳しい情報は、 &man.ifconfig.8;, &man.wiconfig.8;,
&man.wi.4;, &man.ifmedia.4; にあります。このほか、<ulink
url="../../Documentation/network/wavelan.html">Using WaveLAN IEEE under
NetBSD</ulink> ページも見てください。</para>

<para>AirPort ベースステーションを MacOS でセットアップし、さらに暗号化を
使っている場合には、<literal>AirPort Admin
Utility</literal> を実行し、
ベースステーションを設定し、同じネットワークパスワードを探す必要があります。
Apple の AirPort Admin Utility の使い方の詳細は、<ulink
url="http://www.info.apple.com/kbnum/n106864">www.info.apple.com</ulink>
を見てください。</para>

</sect3>

</sect2>

<sect2 id="open-firmware">
<title>Open Firmware</title>

<sect3 id="ofw">
<title>Open Firmware って何ですか? なぜ注意を払わねばならないのですか ?</title>

<para>手短にいえば、 Open Firmware は FORTH 言語によるコマンド環境であって、
NetBSD カーネルは、システムについての情報の取得や一部のデバイスの
制御のためにこれを使っています。これは、ほとんどの PowerPC ベースの
Macintosh システムでブート ROM に組み込まれており、私たちは
カーネルをディスクやネットワークからロードするためにこれを使っています。</para>

<para>Open Firmware は、 "IEEE Std 1275-1994: IEEE Standard for
Boot Firmware (Initialization Configuration) Firmware: Core Requirements
and Practices" とその補遺で仕様が定められた、
プラットフォーム独立のブートファームウェアです。
Sun の OpenBoot firmware を元にしており、
プロセッサー独立のインターフェース言語である ANS Forth を使っています。</para>

<para>Open Firmware のより詳しい情報は、<ulink
url="http://playground.sun.com/1275/home.html">Open Firmware
ワーキンググループホームページ</ulink>や<ulink
url="http://bananajr6000.apple.com">Apple Computer Open Firmware Home 
Page</ulink>にあります。また、 Apple は、
<ulink
url="http://developer.apple.com/technotes/tn/tn1061.html">1061</ulink>
のような良質の Technical Notes をいくつか提供しています。</para>

</sect3>

<sect3 id="ofw-version">
<title>私の機種の Open Firmware のバージョンは ?</title>

<para><ulink url="models.html">対応機種</ulink>ページを見てください。
あなたの機種が載っていなければ、 Open Firmware を使って確かめられます。
Open Firmware プロンプトで (<xref linkend="ofw-access" />および<xref
linkend="ofw-use" />を参照) 次のようにタイプします:</para>

<screen><prompt>0 &gt; </prompt><userinput>dev /openprom</userinput>
<prompt>0 &gt; </prompt><userinput>.properties</userinput>
name                    openprom
device_type             BootROM
model                   OpenFirmware 3
relative-addressing
supports-bootinfo

 ok</screen>

<para>ちなみに、 G3 や G4 プロセッサーを積んでいない機種は Open Firmware 1.0.5 か
2.0.x です。内蔵フロッピードライブを持たないデスクトップの機種はすべて
Open Firmware 3 です。内蔵 SCSI を持たないラップトップの機種はすべて
Open Firmware 3 です。</para>

<note>
  <para>Open Firmware 3 のシステムは、 <emphasis>BootROM</emphasis> とも呼ばれる
  書き換え可能な "ファームウェア" を持っています。この BootROM のバージョンは、
  Open Firmware のバージョンと混同しがちですが別のものです。 Apple ファームウェア
  アップデーターを使うと、 BootROM をアップデートします。これは、
  Open Firmware のバージョンを変えるものでは<emphasis
  role="strong">ありません</emphasis> -
  Open Firmware 3 のままです。 BootROM というのは、システムの電源を入れるか
  リセットしたときに、最初に実行されるものです。それから BootROM
  は Open Firmware をロードし、 Open Firmware がオペレーティングシステムを
  ブートします。</para>

  <para>この BootROM のバージョンは、 MacOS の Apple System Profiler を使うとわかります。
  これは、しばしば、ブートして Open Firmware に入ったときに画面の最初の行に
  記されます。たとえば、私の PowerBook (FireWire) では、次のように表示されます:</para>

  <screen>Apple PowerBook3,1 2.1f1 BootROM built on 01/29/00 at 22:38:07
Copyright 1994-2000 Apple Computer, Inc.
All Rights Reserved

Welcome to Open Firmware.
[...]</screen>

  <para>これは、 BootROM のバージョンが 2.1f1 であることを示しています。</para>
</note>

</sect3>

<sect3 id="ofw-bugs">
<title>私の機種の Open Firmware の動作にバグはありますか ?</title>

<para>ありえます。
<ulink url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">
NetBSD/macppc 2.0 インストールノート</ulink>に、そのようなバグを
回避するためのパッチ適用やアップグレードについての説明があります。
Open Firmware 3 のシステムについては "Updating your BootROM" の節を、
Open Firmware 1.0.5、 2.0.x、 2.4 のシステムについては
"Older Open Firmware System Preparation" の節を見てください。</para>

</sect3>

<sect3 id="ofw-access">
<title>Open Firmware プロンプトに入る方法は?</title>

<para><ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">NetBSD 
2.0 インストールノート</ulink>を読んでください。特に、お使いの Open
Firmware のバージョン向けの
"Getting to the Open Firmware Prompt" の節まで読んでください。</para>

<para>これが面倒な方は、 Apple の <literal>System Disk</literal> を使って、
マシン起動時は常に Open Firmware に入るよう設定することができます。
この方法については簡単な<ulink
url="SystemDisk-tutorial/">チュートリアル</ulink>をご覧ください。</para>

</sect3>

<sect3 id="ofw-boot-serial">
<title>Open Firmware に入ろうとすると、ブートが止まり、
モニターに何も表示されなくなります。</title>

<para><ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">NetBSD 
2.0 インストールノート</ulink>を読みませんでしたね? 特に、
"Getting to the Open Firmware Prompt on Older Models" の節は読んでください。
やや長たらしいですが、 Open Firmware をセットアップするための適切な手順を非常に明解に説明しています。</para>

<para>簡単にいうと、あらゆる Open Firmware 1.0.5 のシステムおよびほとんどの
Open Firmware 2.0.x のシステムは、デフォルトのコンソールとして、
ADB キーボードやオンボードビデオに接続されたモニターではなく `Modem'
シリアルポートを使うようになっています。 MacOS ベースのユーティリティーを
使ってこれらを適切に設定するか、そうでなければ、キーボードとスクリーンで
使えるよう一時的にシリアルコンソールから制御を奪う必要がある<emphasis>でしょう</emphasis>。</para>

<para>Open Firmware は、ほとんどの DB15 から VGA への変換アダプター上での設定を
無視するようです。機種によって、 640 x 480 ・ 60 Hz か、直前に MacOS
で選択した解像度のどちらかがデフォルトになります。お使いのモニターが
その解像度を扱えることを確認してください。</para>

<para><ulink url="SystemDisk-tutorial/">System Disk</ulink> を使ってシステムを適切に
設定したとしても、 PowerMacintosh 7300 - 8600 の機種を使っている場合は、
<literal>/chaos/control</literal> オンボードビデオが正しく同期するよう、
さらにパッチを適用する必要があります(<xref linkend="non-sync-monitor" />参照)。</para>

<para>Performa 5500 と 6500 では、オンボードビデオを使うために NVRAMRC
パッチを当てる必要があります。これらの機種に関する<ulink
url="models.html#5500">脚註</ulink>を参照してください。</para>

<para><xref linkend="ofw-input-output-devices" />も併せて参照してください。</para>

</sect3>

<sect3 id="ofw-boot-video">
<title>PCI ビデオカードを使う方法は?</title>

<para>この節では、 Open Firmware に PCI ベースのビデオカードを使うよう伝える方法を、
カードをコンピューターと別に購入した場合とカードが附属していた場合の両方に
ついて説明します。 Macintosh や互換機の一部機種 (詳しくは
<ulink url="models.html#no.fb">NetBSD/macppc機種対応</ulink>ページを参照) は、
オンボードのビデオインターフェースを持っていません。これらの機種では、
PCI スロットの一つにビデオカードが挿されて出荷されています。</para>

<para>いずれの場合も、ビデオカードが Open Firmware に対応している必要があります。</para>

<para>Open Firmware が使うデバイスパスは、カードとそれが挿さっている PCI
スロットによって異なります。お使いのビデオカードのパスと、
それを使うように Open Firmware に伝える方法を調べておく必要があります。</para>

<orderedlist>
  <listitem>
    <para>Open Firmware プロンプト (<literal>0 &gt;</literal>
    プロンプト) に入ります。方法は<xref linkend="ofw-access" />をご覧ください。</para>

    <para>古い機種では最初にシリアルコンソールを使う必要があるかもしれません。</para>
  </listitem>

  <listitem>
    <para>Open Firmware に触るのはこれが初めてという方は、
    <xref linkend="ofw-use" />を読んでおくといいかもしれません。</para>
  </listitem>

  <listitem>
    <screen><prompt>0 &gt; </prompt><userinput>dev / ls</userinput></screen>

    <para>これで、お使いのシステムの全デバイスの一覧が表示されます。ビデオカード
    に合致する項目を探します。たとえば、 PowerMacintosh 9500/150 での一覧を
    抜粋します:</para>

    <screen><prompt>0 &gt; </prompt><userinput>dev /</userinput>
<prompt>0 &gt; </prompt><userinput>ls</userinput>
  [...]
FF8313F0: /bandit@F4000000
  [...]
FF83F8A0:   /ATY,mach64@D
  [...]
 ok</screen>

    <para>おおむね、 Open Firmware 対応のカードでは、
    ベンダー名に似た 4 文字のベンダー ID (ATI では <literal>ATY</literal>、 IMS では
    <literal>IMS</literal>、 Adaptec では <literal>ADPT</literal> というように) が表示され、
    また、文字列でカードの機種を表します。
    "@" 記号は、カード名とそのコンピューターでのアドレスを区切っています。</para>

    <para>ここで、 <literal>/ATY,mach64@D</literal> の項目が <literal>/bandit@F4000000</literal>
    よりも字下げされていることに注意してください。これは、 <literal>bandit</literal>
    デバイスが <literal>ATY</literal> デバイスを含んでいることを意味しています。
    この場合、 <literal>/bandit@F4000000</literal> は PCI バスの Open Firmware での名前で、
    ATI カードはその PCI バス上にあります。</para>
  </listitem>

  <listitem>
    <para>よって、このカードの Open Firmware デバイスツリー上のパスは
    <literal>/bandit@F4000000/ATY,mach64@D</literal> です。ここで、このカードが本当に
    Open Firmware に対応しているかどうか確認するため、以下のようにタイプしてください:</para>

    <screen><prompt>0 &gt; </prompt><userinput>dev /bandit@F4000000/ATY,mach64@D</userinput>
<prompt>0 &gt; </prompt><userinput>words</userinput></screen>

    <para>出力された中に <literal>open</literal> という単語があれば、そのカードが使える
    可能性はかなり高いです。</para>
  </listitem>

  <listitem>
    <para>さて、これで、 Mach64 カードを Open Firmware
    の出力デバイスにするためには、以下のとおりタイプすればよいでしょう:</para>

    <screen><prompt>0 &gt; </prompt><userinput>setenv output-device /bandit@F4000000/ATY,mach64@D</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>
  </listitem>
</orderedlist>

<para>ビデオカードに接続したモニターが、コンピューターのリセット後に真っ暗な
ままになる場合、問題があります (カードのパスを打ち間違えたか、
カードが実は Open Firmware に対応していないのかもしれません) 。</para>

</sect3>

<sect3 id="non-sync-monitor">
<title>Open Firmware に入った時に、モニターが同期しないことがあります</title>

<para>これは PowerMacintosh 7300 - 8600 の機種での問題で、
ビデオ信号が十分早く決定されないために起こります。
Open Firmware 1.0.5 用の
<ulink url="SystemDisk-tutorial/of105patch.html">パッチ</ulink>を当てるべきです。</para>

<para> Twentieth Anniversary Macintosh をお使いの場合、解決策はわかっていません。
この問題については、<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/04/26/0008.html">この
投稿記事</ulink>の説明を見てください。
現時点では、この機種へのインストールの成功例の報告はありませんが、
<ulink url="SystemDisk-tutorial/">System Disk</ulink> で input と output デバイスを
<literal>ttya</literal> に設定し、端末エミュレーターの動くマシンを
シリアルケーブルでつなげば、うまくいくはずです。</para>

</sect3>

<sect3 id="ofw-clear">
<title>Open Firmware の異常を直す方法は?</title>

<para>Open Firmware 3 の機種で設定を変えて、 Open Firmware プロンプトに入れず
MacOS のブートもできないようになった場合、 BootROM を破壊した (例えば、
<literal>load-base</literal> または <literal>real-base</literal> をまずい値に設定するなど。<xref
linkend="ofw-load-base" />および<xref linkend="ofw-real-base" />を参照)
可能性があります。 Apple に修理に出して BootROM
ファームウェアを書き換えさせる必要があるかもしれません。</para>

<para>初期の機種 (Open Firmware 1.0.5, 1.1.22, 2.0.x, 2.4) の場合は、
マシンの AC 主電源 (110 または 220 V) を切り、マザーボードから電池を
外す必要があります。電池が放電して NVRAM の内容が消えるまでに、
長くて数時間かかるでしょう。この時間を短くするには、電源ボタンを
押してみてください。さらに危険な方法 (つまり、やるなら自己責任で) としては、
ソケットに電池を逆向きに取り付けるか、両端子を抵抗を介して短絡させるという
方法もあります。</para>

<para>直ったら、日付を設定するのを忘れないようにしてください!</para>

</sect3>

<sect3 id="ofw-backslash">
<title>Open Firmware でバックスラッシュ (<literal>\</literal>)
キーを打てません!</title>

<para>困ったことに、お使いになっている非 US キーボードを MacOS や NetBSD が認識したとしても、
Open Firmware は認識しないのです。このため、アルファベット以外のキーの一部は、
キーに刻印されている文字とは一致しないことがあります。</para>

<para>簡単ですが美しくない解決法は、文字の十六進表現を使うことです。
コマンド全体を二重引用符 <literal>"</literal> で括ったうえで、
文字を十六進コードにして丸カッコで囲み、その前に二重引用符を置きます。
たとえば、バックスラッシュは <literal>"(5C)</literal> に置き換えます。
このようにして二重引用符で括ったコマンドの後には、そのコマンドの十六進表現を
普通の文字に変換したものを表示するか、実際に実行するかに応じた FORTH
コマンドが必要になります。表示するには <literal>cr&nbsp;type&nbsp;cr</literal>
を使います。実行するには <literal>evaluate</literal> を使います。
また、コマンド全体を括る二重引用符とコマンド冒頭の間には空白をひとつ入れるようにしてください。</para>

<screen><prompt>0 &gt; </prompt><userinput>" setenv boot-device hd:,"(5C)ofwboot.xcf" cr type cr</userinput>
setenv boot-device hd:,\ofwboot.xcf
 ok
<prompt>0 &gt; </prompt><userinput>" setenv boot-device hd:,"(5C)ofwboot.xcf" evaluate</userinput>
<prompt>0 &gt; </prompt></screen>

<para>その場限りではない方法としては、<ulink
url="http://members.aol.com/plforth/ofpong/macofx5c.html">PLForth</ulink>
にある説明に従い Open Firmware を再設定 (<ulink
url="nvedit.html"><literal>nvedit</literal></ulink> を使用)
することもできます。</para>

</sect3>

<sect3 id="ofw-use">
<title>Open Firmware プロンプトで何ができるか?</title>

<anchor id="ofw-misc" />

<para>コンピューターのブートに関するさまざまな状態を設定することができます。
この表は、あなたが使う可能性のある主なコマンドの単なる一覧とその文法です。</para>

<table>
<title>主なコマンド</title>
<tgroup cols="2">

<thead>
  <row>
    <entry>コマンド名</entry>
    <entry>注釈</entry>
  </row>
</thead>

<tbody>
  <row>
    <entry><literal>dev&nbsp;<emphasis>device</emphasis></literal></entry>
    <entry>Open Firmware デバイスツリー上でのカレント <emphasis>device</emphasis>
    の変更 (ファイルシステム上の <literal>cd</literal> に類似)</entry>
  </row>

  <row>
    <entry><literal>unselect-dev</literal></entry>
    <entry>どのデバイスも選択されていない初期状態に戻る
    (通常は必要なし)</entry>
  </row>

  <row>
    <entry><literal>ls</literal></entry>
    <entry>デバイスツリー上でのカレントノード以下のデバイスの列挙
    (ファイルシステム上の <literal>ls</literal> に類似)</entry>
  </row>

  <row>
    <entry><literal>pwd</literal></entry>
    <entry>デバイスツリー上でのカレントノードの場所の列挙
    (ファイルシステム上の <literal>pwd</literal> に類似)</entry>
  </row>

  <row>
    <entry><literal>words</literal></entry>
    <entry>デバイスツリー上でのカレントノードにおいて
    使用可能な FORTH コマンドの列挙。ブートするためには、
    デバイスが少なくとも "<literal>open</literal>" を含む必要あり</entry>
  </row>

  <row>
    <entry><literal>.properties</literal></entry>
    <entry>デバイスツリー上でのカレントノードの
    状態を列挙</entry>
  </row>

  <row>
    <entry><literal>printenv</literal></entry>
    <entry>Open Firmware 環境変数の現在および
    デフォルトの設定値を表示</entry>
  </row>

  <row>
    <entry><literal>setenv <emphasis>variable</emphasis>
    <emphasis>value</emphasis></literal></entry>
    <entry>Firmware の <emphasis>variable</emphasis> 変数に新たに値
    <emphasis>value</emphasis> を設定する。<xref
    linkend="ofw-variables" />参照。</entry>
  </row>

  <row>
    <entry><literal>set-default
    <emphasis>variable</emphasis></literal></entry>
    <entry>変数 <emphasis>variable</emphasis> の値をデフォルト値に設定する。
    <xref linkend="ofw-variables" />参照。</entry>
  </row>

  <row>
    <entry><literal>boot <emphasis>boot-device</emphasis>
    <emphasis>boot-file</emphasis></literal></entry>
    <entry>プログラム <emphasis>boot-file</emphasis> を
    <emphasis>boot-device</emphasis> からロード・実行する。
    これを使って <literal>ofwboot</literal> ("partition zero" ブートローダー) または
    <literal>ofwboot.xcf</literal> をロードし、それから NetBSD カーネルをロードします</entry>
  </row>

  <row>
    <entry><literal>dir <emphasis>device</emphasis></literal></entry>
    <entry><emphasis>device</emphasis>
    にあるファイルの列挙 (unix の
    <literal>ls</literal> と同じ); <xref linkend="ofw-dir-listing"
    />参照</entry>
  </row>

  <row>
    <entry><literal>eject fd</literal></entry>
    <entry>フロッピーディスクの排出</entry>
  </row>

  <row>
    <entry><literal>reset-all</literal></entry>
    <entry>Open Firmware 環境変数を永久に保持し
    コンピューターをリブートする</entry>
  </row>

  <row>
    <entry><literal>shut-down</literal></entry>
    <entry>Open Firmware 環境変数を永久に保持し
    コンピューターの電源を落とす</entry>
  </row>

  <row>
    <entry><literal>bye</literal></entry>
    <entry>Open Firmware 1.0.5、 2.0.x、 2.4
    のシステムで MacOS をブートする</entry>
  </row>

  <row>
    <entry><literal>mac-boot</literal></entry>
    <entry>Open Firmware 3 のシステムで MacOS をブートする</entry>
  </row>

  <row>
    <entry><literal>devalias <emphasis>alias</emphasis>
    <emphasis>device</emphasis></literal></entry>
    <entry>デバイス <emphasis>device</emphasis> の別名として
    <emphasis>alias</emphasis> を設定または修正
    (<literal>csh</literal> や眷族の <literal>alias</literal> に類似)。
    オプションがない場合は、現在のデバイスの別名をすべて列挙</entry>
  </row>

  <row>
    <entry><literal>nvalias <emphasis>alias</emphasis>
    <emphasis>device</emphasis></literal></entry>
    <entry> デバイス <emphasis>device</emphasis> の別名として
    <emphasis>alias</emphasis> を永久に保存されるよう設定または修正
    (<literal>csh</literal> や眷族の <literal>alias</literal> に類似)。
    オプションがない場合は、現在のデバイスの別名をすべて列挙</entry>
  </row>
</tbody>

</tgroup>
</table>

<para>また、 Open Firmware を使う上で便利なキーストロークを
いくつか掲げます:</para>

<table>
<title>Open Firmware のキーストローク</title>
<tgroup cols="2">

<thead>
  <row>
    <entry>キーストローク</entry>
    <entry>機能</entry>
  </row>
</thead>

<tbody>
  <row>
    <entry>Backspace</entry>
    <entry>後方の 1 文字を消去</entry>
  </row>

  <row>
    <entry>Delete</entry>
    <entry>後方の 1 文字を消去</entry>
  </row>

  <row>
    <entry>^h</entry>
    <entry>後方の 1 文字を消去</entry>
  </row>

  <row>
    <entry>^d</entry>
    <entry>前方の 1 文字を消去</entry>
  </row>

  <row>
    <entry>Enter</entry>
    <entry>FORTH パーサーに行を渡す</entry>
  </row>

  <row>
    <entry>^b</entry>
    <entry>1 文字戻る (左矢印キーと同じ)</entry>
  </row>

  <row>
    <entry>^f</entry>
    <entry>1 文字進む (右矢印キーと同じ)</entry>
  </row>

  <row>
    <entry>ESC b</entry>
    <entry>1 単語戻る</entry>
  </row>

  <row>
    <entry>ESC f</entry>
    <entry>1 単語進む</entry>
  </row>

  <row>
    <entry>^a</entry>
    <entry>行の先頭に戻る</entry>
  </row>

  <row>
    <entry>^e</entry>
    <entry>行の終端に進む</entry>
  </row>

  <row>
    <entry>ESC h</entry>
    <entry>単語の先頭までを消去・保持</entry>
  </row>

  <row>
    <entry>^w</entry>
    <entry>単語の先頭までを消去・保持</entry>
  </row>

  <row>
    <entry>ESC d</entry>
    <entry>単語の終端までを消去・保持</entry>
  </row>

  <row>
    <entry>^k</entry>
    <entry>行の終端までを消去・保持</entry>
  </row>

  <row>
    <entry>^u</entry>
    <entry>行をすべて消去・保持</entry>
  </row>

  <row>
    <entry>^r</entry>
    <entry>行を打ち直す</entry>
  </row>

  <row>
    <entry>^q</entry>
    <entry>次の文字を引用</entry>
  </row>

  <row>
    <entry>^y</entry>
    <entry>カーソルの前に保持されていた文字列を挿入</entry>
  </row>

  <row>
    <entry>^p</entry>
    <entry>履歴中の、前の行 (上矢印キーと同じ)</entry>
  </row>

  <row>
    <entry>^n</entry>
    <entry>履歴中の、次の行 (下矢印キーと同じ)</entry>
  </row>

  <row>
    <entry>^l</entry>
    <entry>履歴を表示</entry>
  </row>

  <row>
    <entry>^space</entry>
    <entry>単語が単一の補完候補を持つ場合は、そのように補完。
    単語が複数の補完候補を持つ場合は、補完可能なところまで補完。
    単語がまったく補完可能でない場合は、少なくともひとつの補完候補があるところまで
    文字を消去</entry>
  </row>

  <row>
    <entry>^/</entry>
    <entry>単語の補完候補 (ないこともある) を表示</entry>
  </row>

  <row>
    <entry>^?</entry>
    <entry>単語の補完候補 (ないこともある) を表示</entry>
  </row>


  <row>
    <entry>^@</entry>
    <entry>^space と同じ (Apple 特有)</entry>
  </row>

  <row>
    <entry>^o</entry>
    <entry>^/ と同じ (Apple 特有)</entry>
  </row>

  <row>
    <entry>^\</entry>
    <entry>^b と同じ (Apple 特有)</entry>
  </row>

  <row>
    <entry>^]</entry>
    <entry>^f と同じ (Apple 特有)</entry>
  </row>

  <row>
    <entry>^^</entry>
    <entry>^p と同じ (Apple 特有)</entry>
  </row>

  <row>
    <entry>^_</entry>
    <entry>^n と同じ (Apple 特有)</entry>
  </row>
</tbody>

</tgroup>
</table>

<para>このほか、 <ulink url="nvedit.html">NetBSD/macppc nvedit
HOW-TO</ulink>、<ulink
url="http://docs.info.apple.com/article.html?artnum=60285">Apple Network
Server 500,700: Open Firmware Read Me</ulink> technote、<ulink
url="http://bananajr6000.apple.com/">Apple Computer Open Firmware Home
Page</ulink> <ulink
url="http://developer.apple.com/technotes/tn/tn2001.html">"Technote 2001 -
Running files from a hard drive in Open Firmware</ulink> と、<ulink
url="http://playground.sun.com/1275/home.html">Open Firmware Working Group
home page</ulink> も併せて参照してください。</para>

</sect3>

<sect3 id="ofw-variables">
<title>関連する Open Firmware の変数</title>

<para>Open Firmware が利用したり保持したりしてブートに影響を与える変数が存在します。
これらの変数を変更するには、 <literal>printenv</literal>、 <literal>setenv</literal>、
<literal>set-default</literal> コマンドを使う (<xref linkend="ofw-use" />参照) か、
MacOS SystemDisk ユーティリティーを使います (<ulink
url="SystemDisk-tutorial/">チュートリアル</ulink>参照) 。
<literal>nvramrc</literal> 上の変数を変更するには、
<ulink url="nvedit.html">NetBSD/macppc nvedit HOW-TO</ulink>
で説明しているコマンドを使います。このほか、 ResEdit
を使って System Disk をいじくることもできます。 <literal>OFtc</literal> リソースを見て、
System Disk が使っているお使いの機種用の ID を調べてください。それから、
対応する <literal>OFpt</literal> リソースを編集します。</para>

<para>設定を変更した後は、その変更を保存するため、以下のようにタイプするよう
注意してください:</para>

<screen><prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>

<table>
<title>主なコマンド</title>
<tgroup cols="2">

<thead>
  <row>
    <entry>変数名</entry>
    <entry>通常の値</entry>
    <entry>機能</entry>
  </row>
</thead>

<tbody>
  <row>
    <entry><literal>auto-boot?</literal></entry>
    <entry>false</entry>
    <entry><literal>false</literal> の場合は、コンピューターのリセット時に Open Firmware
    プロンプトで停止。<literal>true</literal> の場合は、
    <literal><emphasis>boot-command boot-device
    boot-file</emphasis></literal> を実行</entry>
  </row>

  <row>
    <entry><literal>use-nvramrc?</literal></entry>
    <entry>true</entry>
    <entry><literal>true</literal> の場合は
    <literal>nvramrc</literal>で設定されたコマンドを実行</entry>
  </row>

  <row>
    <entry><literal>real-base</literal></entry>
    <entry><emphasis>Open Firmware バージョンによる</emphasis></entry>
    <entry>カーネルのメモリー番地。<xref linkend="ofw-real-base"
    />。</entry>
  </row>

  <row>
    <entry><literal>load-base</literal></entry>
    <entry><emphasis>Open Firmware バージョンによる</emphasis></entry>
    <entry>ブートローダーのメモリー番地。<xref linkend="ofw-load-base"
    /></entry>
  </row>

  <row>
    <entry><literal>boot-device</literal></entry>
    <entry><emphasis>設定による</emphasis>。設定方法は 
    <literal>ofwboot(8)</literal> 参照</entry>
    <entry>ここで設定したデバイスから最初の段階のブートローダーがロードされる</entry>
  </row>

  <row>
    <entry><literal>boot-file</literal></entry>
    <entry><emphasis>設定による</emphasis>。設定方法は
    <literal>ofwboot(8)</literal> 参照</entry>
    <entry>カーネルの場所</entry>
  </row>

  <row>
    <entry><literal>input-device</literal></entry>
    <entry><emphasis>ハードウェアによる</emphasis>。設定方法は<xref
    linkend="ofw-input-output-devices" />参照</entry>
    <entry>ADB キーボード、 USB キーボード、またはシリアルコンソール</entry>
  </row>

  <row>
    <entry><literal>output-device</literal></entry>
    <entry><emphasis>ハードウェアによる</emphasis>。設定方法は<xref
    linkend="ofw-input-output-devices" />参照</entry>
    <entry>オンボードビデオ、 PCI ビデオ、またはシリアルコンソール</entry>
  </row>

  <row>
    <entry><literal>nvramrc</literal></entry>
    <entry><emphasis>System Disk によって入力された値</emphasis></entry>
    <entry><literal>use-nvramrc?</literal> が
    <literal>true</literal> に設定されている場合は、ここで設定された
    FORTH コマンド群がコンピューターのリセット時に実行される</entry>
  </row>

  <row>
    <entry><literal>boot-command</literal></entry>
    <entry>boot</entry>
    <entry><literal>auto-boot?</literal> が <literal>true</literal> に設定されている場合は、
    このコマンドがコンピューターのリセット時に実行される</entry>
  </row>
</tbody>

</tgroup>
</table>

<note>
  <para><literal>Command-Option-P-R</literal> で PRAM をクリアすると、
  すでに設定した Open Firmware の変数はすべて消えます。</para>

  <para>Open Firmware 1.0.5 の機種で MacOS をブートすると、
  すでに設定した Open Firmware の変数はすべて消えます。</para>

  <para>極端な場合、 Open Firmware の設定によって
  マシンが起動しなくなることもあります。これは PRAM クリアでは直りません。
  この場合は、電源を抜き、 10 分間ほどマザーボードから電池を外します。
  PowerBook の場合は power manager をリセットします。</para>
</note>

</sect3>

<sect3 id="ofw-load-base">
<title>"load-base" の設定の問題</title>

<para>Open Firmware の環境変数 <literal>load-base</literal> は、 Open Firmware
がブートローダーを <literal>boot-device</literal> からロードするアドレスです。
XCOFF バイナリーがメモリー上にロードされるアドレスです。
これによる作用は、 Open Firmware のバージョンや <literal>boot-device</literal>
によってさまざまです。 <literal>load-base</literal> が不適切な値に設定された場合、症状として <literal>CLAIM
failed</literal> というメッセージ (<xref linkend="ofw-claim-failed" />参照) が出ます。</para>

<sect4 id="ofw-load-base-ofw3">
<title>Open Firmware 3</title>

<para><emphasis role="strong"><literal>load-base</literal>
の値を変えてはいけません</emphasis>。
Open Firmware 3 の機種は書き換え可能なファームウェアを持っていますが、
<literal>load-base</literal> を変更すると、フラッシュ BootROM を上書きして
マシンを壊してしまう (Apple での高価な修理が必要になる) ことがわかりました。<emphasis
role="strong">Open Firmware 3 な機種で <literal>load-base</literal>
を変更してはなりません。</emphasis>
Apple は Open Firmware 3 を、ブートのために <literal>load-base</literal>
の値を変更する必要はないようにしています。</para>

</sect4>

<sect4 id="ofw-load-base-ofwpre3">
<title>Open Firmware 1.0.5, 1.1.22, 2.0.x, and 2.4</title>

<para>これらのシステムでの <literal>load-base</literal> のデフォルト値は 4000 ですが、
これは私たちにとって都合がよくありません。 <ulink
url="SystemDisk-tutorial/">System Disk</ulink> は
<literal>load-base</literal> を 600000 に設定しますが、これがちょうどよい値です。
mkLinux はこれとは異なる値を使いますが、これでは NetBSD/macppc
のブートはできないかもしれません。なお、 NetBSD 1.5.2 またはそれより前のものを
使う場合は、 load-base に関する<ulink url="oldfaq.html#old-ofw-load-base">古い FAQ</ulink>
項目をお読みください。</para>

<para>お使いのマシンが、 Open Firmware 1.0.5、 1.1.22、 2.0.x または 2.4
であることが間違いないなら (<xref linkend="ofw-version" />参照)、
<literal>load-base</literal>
を適切に設定するために次のコマンドを実行します:</para>

<screen><prompt>0 &gt; </prompt><userinput>setenv load-base
600000</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>

<para>正しく設定されたか、 <literal>printenv</literal>
コマンドで再確認すべきです。</para>

</sect4>

</sect3>

<sect3 id="ofw-real-base">
<title>"real-base" の設定の問題</title>

<para>Open Firmware の環境変数 <literal>real-base</literal> は、
OpenFirmware が自分自身のために使用するアドレスです。
<literal>real-base</literal> のデフォルト値は -1 (0xffffffff) かもしれませんが、
OF 1.0.5 や 2.x の機種では 0x400000 を使うため、
<literal>real-base</literal> がこのデフォルト値になっていると問題を起こします。
カーネルは、デフォルトでは 0x100000 番地にロードされますので、
約 3 MB を超える大きさのカーネルをロードしようとすると問題が起こります。</para>

<para>Open Firmware 3 の機種は書き換え可能なファームウェアを持っていますが、
<literal>real-base</literal> を変更すると、ファームウェアを上書きして
マシンを壊してしまう (Apple での高価な修理が必要になる) ことがわかりました。
<emphasis role="strong"> Open Firmware 3 な機種で
<literal>real-base</literal> を変更してはなりません。</emphasis>
いずれにせよ、 Open Firmware 3 は、大きなカーネルに関してもうまく動作するので、
この件は問題にはなりません。</para>

<para>その機種の Open Firmware が 1.0.5 か 2.0.x か 2.4 であるかを確認してから
(<xref linkend="ofw-version" />参照)、下記のコマンドを実行して
<literal>real-base</literal> を適切に設定します (注意: System Disk はこの変数を
適切に設定<emphasis role="strong">しません</emphasis>
─ System Disk を使うたびに、 <literal>real-base</literal>
を設定しなおす必要があります):</para>

<screen><prompt>0 &gt; </prompt><userinput>setenv real-base
F00000</userinput> <prompt>0 &gt;
</prompt><userinput>reset-all</userinput></screen>

<para>正しく設定されたか、 <literal>printenv</literal> コマンドで再確認すべきです。
誤った値を設定した場合、マシンが起動しなくなることがあります
(復旧方法は
<xref linkend="ofw-clear" />を見てください)。</para>

<para>この問題への次善策は、カーネルを再構築して、サイズを 3 MB より
小さくすることです。 Open Firmware 1.0.5 や 2.0.x や 2.4 の機種には内蔵 USB
がないため、 USB ドライバーを含めずに<ulink
url="../../Documentation/kernel/#how_to_build_a_kernel">カーネルを作れます</ulink>
(PCI USB カードがない場合に限りますが)。</para>

</sect3>

<sect3 id="ofw-input-output-devices">
<title><literal>input-device</literal> と
<literal>output-device</literal> はどう決めたらいいか?</title>

<para>これは、 Open Firmware のバージョン、使っているハードウェアに加えて、
どのデバイスを使って Open Firmware と (したがって NetBSD/macppc とも)
対話したいかによります。</para>

<para>これを決めたら、これらの値の設定と保存を行う必要があります。
Open Firmware を使い始める上での手引については、
<xref linkend="ofw-access" />と
<xref linkend="ofw-use" />) を見てください。
手短に言えば、以下の 3 コマンドを実行する必要があります (ここで
<emphasis>in-device</emphasis> と <emphasis>out-device</emphasis>
は、この FAQ 項目をもとに決めた値です):</para>

<screen><prompt>0 &gt; </prompt><userinput>setenv input-device in-device</userinput>
<prompt>0 &gt; </prompt><userinput>setenv output-device out-device</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>

<para>入出力デバイスをその場で変更し、かつその変更をその場限りにして保存しないようにするには、
上述のコマンドのかわりに以下の 2 コマンドを実行します
(最初の引用符の後にスペースを入れることに注意):</para>

<screen><prompt>0 &gt; </prompt><userinput>" out-device" output</userinput>
<prompt>0 &gt; </prompt><userinput>" in-device" input</userinput></screen>

<sect4 id="ofw-input-output-devices-ofwpre3-monitor">
<title>Open Firmware 1.0.5、 2.0.x、 2.4 で、キーボードとモニター
(または一体型 LCD) を使う場合</title>

<para>デフォルトでは、ほとんどの機種がデフォルトでシリアルコンソールを使います
(多くの初心者ユーザーが、ブートして Open Firmware に入ろうとしたときに
モニターが真っ黒になることで気づくことです) 。さらに、これらの
<ulink url="models.html#no.ofw.fb">機種</ulink>の一部では、
Open Firmware での (また、 NetBSD/macppc でも) オンボードビデオデバイス
の使用に問題があります。これらの厄介なシステムでは、 PCI ビデオカードか
シリアルコンソールを使うしかありません。</para>

<para><ulink url="models.html">NetBSD/macppc 機種対応ページ</ulink>で、
あなたの機種の欄を見てください。そのシステム用の
<literal>output-device</literal> が載っているはずです。
<literal>output-device</literal> が載っていない場合は <literal>screen</literal>
を使ってください。</para>

<para><literal>output-device</literal> の決め方について
<xref linkend="ofw-boot-video" />も見てください。</para>

<para>すべてのシステムでは、 ADB または一体型キーボード用の
<literal>input-device</literal> は <literal>kbd</literal> です。</para>

</sect4>

<sect4 id="ofw-input-output-devices-ofw3-monitor">
<title>Open Firmware 3 で、キーボードとモニター (または一体型
LCD) を使う場合</title>

<para>デフォルトでは、すべての機種がデフォルトで USB または一体型キーボードと
オンボードビデオまたは一体型 LCD を使います。何もする必要はないはずです。</para>

<para><literal>output-device</literal> の決め方について
<xref linkend="ofw-boot-video" />も見てください。</para>

<para>デフォルト値は、 <literal>input-device</literal> は
<literal>keyboard</literal> (一体型または USB キーボードを使用)、
<literal>output-device</literal> は <literal>screen</literal>
(一体型 LCD、スクリーン、オンボードビデオインターフェースを使用) です。</para>

</sect4>

<sect4 id="ofw-input-output-devices-ofwpre3-serial">
<title>Open Firmware 1.0.5、 2.0.x、 2.4 で、シリアルコンソールを使う場合</title>

<anchor id="serial-console" />

<para>Open Firmware では、コンピューターの "modem" シリアルポートを <literal>ttya</literal>、
"printer" シリアルポートを <literal>ttyb</literal> と呼びます。システムによっては
(Performa 54xx, 6360, 6400, 6500) 内蔵モデムを持っており、これが
内蔵シリアルポートを遮っています。これらの機種では、シリアルポートとして
プリンターポート <literal>ttyb</literal> を使うよう設定する必要があります。</para>

<para>ほとんどすべての機種では、 <literal>input-device</literal> と <literal>output-device</literal>
のデフォルト値は <literal>ttya</literal> であり、これは多くの初心者ユーザーが、
ブートして Open Firmware に入ろうとしたときにモニターが真っ黒になることで
気づくことです。</para>

<para>シリアルコンソールの設定は、 38400 bps、 8 ビット、パリティーなし、
ストップビット 1、フロー制御なしにする必要があります。また、 2 台の Mac
(m68k ベースの Mac でも可) 同士をつなぐ場合には、標準的な Mac の
「プリンター」ケーブルを使うことができます。さらなる手引きについては、<ulink
url="../../Documentation/Hardware/Misc/serial.html">NetBSD
シリアルポート入門</ulink>を見てください。</para>

</sect4>

<sect4 id="ofw-input-output-devices-ofw3-serial">
<title>Open Firmware 3 で、シリアルコンソールを使う場合</title>

<para>Open Firmware 3 の機種はいずれもシリアルポートを持っていません。しかし、
ほとんどの機種は内蔵モデムを持っています。ほとんどのデスクトップ機種で、
内蔵モデムをシリアルポートに置き換えるためのサードパーティーデバイス
(Gee Three Stealth Serial Port や Griffin Technology gPort など)
を使うことができます。このようなものを使う場合、シリアルコンソールを使うよう
Open Firmware を設定することができます。 <literal>input-device</literal> と
<literal>output-device</literal> をいずれも <literal>scca</literal> に設定してください。</para>

<para>シリアルコンソールの設定は、 57600 bps、 8 ビット、パリティーなし、
ストップビット 1、フロー制御なしにする必要があります。また、 2 台の Mac
(m68k ベースの Mac でも可) 同士をつなぐ場合には、標準的な Mac の
「プリンター」ケーブルを使うことができます。さらなる手引きについては、<ulink
url="../../Documentation/Hardware/Misc/serial.html">NetBSD
シリアルポート入門</ulink>を見てください。</para>

</sect4>

</sect3>

<sect3 id="ofw-dir-listing">
<title>ディスク上のファイルのリストを (Open Firmware で)
出す方法は?</title>

<para>もちろん、 <literal>dir</literal> コマンドです!</para>

<para>文法は、単に、
<literal>dir
<emphasis>device</emphasis>:<emphasis>[partition]</emphasis>,\</literal>
です。
ここで、 <emphasis>device</emphasis> はリストを出そうとしているデバイスの <literal>devalias</literal>
またはフルパス、 <emphasis>[partition]</emphasis> はリストを出そうとしている
パーティション番号です。パーティション番号を明示しなかった場合は、
Open Firmware が扱えるパーティションのうち最初のものが使われます。カンマは、
デバイスおよびパーティションと、ディレクトリーまたはファイルとの間の区切りです。</para>

<para>残念ながら、パーティションマップを Open Firmware
上で列挙させる方法はありません。ただし、 NetBSD <ulink
url="partitioning.html#pdisk">pdisk</ulink> を各種 OS 上で使って
パーティションを列挙させることはできます。</para>

<para>Open Firmware は、ディレクトリーの区切りにバックスラッシュを使います。
このため、 "<literal>\</literal>" でデバイスの最上位を指定する必要があります。また、
ディレクトリーをバックスラッシュで区切ることで、個々のファイルやフォルダー内の
ファイルのディレクトリーリストを出すこともできます。</para>

<para>Open Firmware の <literal>dir</literal> コマンドは、 Open Firmware が扱える
ファイルシステムの内容のリストしか出せないことを承知しておいてください。
Open Firmware 1.0.5、 1.1.22、 2.0.x では ISO 9660 (<emphasis>ハイブリッドはダメ</emphasis>)
と MS-DOS のリストが出せます。 Open Firmware 3 ではハイブリッド ISO 9660/HFS (純粋な
ISO 9660 は<emphasis>ダメ</emphasis>) 、 HFS、 HFS+ と MS-DOS のリストが出せます。</para>

<para>公式 NetBSD インストール CD-R イメージおよびフロッピーイメージは、若干
しょぼいです (つまり、これらは "partition zero" ブートローダーを使っています)。
これらは、 Open Firmware でファイルのリストを出すことはできません。</para>

<para>たとえば、フロッピー上のファイルのリストを出すには、次のようにタイプします:</para>

<screen><prompt>0 &gt; </prompt><userinput>dir fd:,\</userinput></screen>

<para>CD-ROM 上のファイルのリストを出すには、次のようにタイプします (一例):</para>

<screen><prompt>0 &gt; </prompt><userinput>dir scsi-int/sd@3:,\</userinput></screen>

<para>HFS パーティション上の macppc というフォルダー内のファイルのリストを出すには、
次のようにタイプします:</para>

<screen><prompt>0 &gt; </prompt><userinput>dir hd:9,\macppc\</userinput></screen>

<para>イーサネット経由でクライアントの dhcp または bootp の情報を出すには、
次のようにタイプします:</para>

<screen><prompt>0 &gt; </prompt><userinput>dir enet:</userinput></screen>

</sect3>

</sect2>

<sect2 id="booting">
<title>ブート</title>

<sect3 id="boot-support">
<title>NetBSD/macppc をブートするにはどんな方法がありますか ?</title>

<para><ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">
NetBSD/macppc 2.0 インストールノート</ulink>を見て、 "Available Boot Media"
というタイトルの節を読んでください。</para>

</sect3>

<sect3 id="boot-disk">
<title>ディスクをブート可能にする方法と、それをブートさせるための
Open Firmware のコマンドは ?</title>

<para>これは Open Firmware のバージョン、および、どこからブートするかに
完全に依存します。<ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">
NetBSD/macppc 2.0 インストールノート</ulink>の "Preparing the Bootable
Media" と "Open Firmware boot syntax" の節を読んでください。</para>

<para><xref linkend="ofw-version" />、
<literal>ofwboot(8)</literal> マニュアルページ、
<literal>installboot(8)</literal> マニュアルページも併せて見てください。</para>

</sect3>

<sect3 id="boot-pci">
<title>PCI カードに接続されたデバイスからブートする方法は?</title>

<para>これには Open Firmware ドライバーを持った PCI カードが必要ですが、そういうカードはほとんどありません。
多くの Adaptec SCSI カードや、一部の IDE/ATA カードは Open Firmware ドライバーを持っています。
Asante 製の一部のイーサネットカードには Open Firmware ドライバーが附属しています
(ただし誰も試していませんが) 。 UltraSPARC システム用に製造されたカードは、
しばしば Open Firmware ドライバーを持っています。これら以外の多くはドライバーを持っていません。</para>

<para>カードが Open Firmware で動作することは、
必ずしも NetBSD がそのカードに対応していることを意味しません (逆もしかりです) 。
いくつかの MacOS IDE/ATA カードにそういう例があります。</para>

<para>まず最初に、 PCI カードの Open Firmware での名前を確認します。
Apple では、オンボードデバイス用に (scsi, hd, enet のように)
<literal>devalias</literal> を用意しています。 PCI カードのメーカーはそういうことが
できません。 Open Firmware が使うデバイスのパスは、カードの機種と
それが挿さっている PCI スロットの位置によって異なります。お使いの PCI
カードのパスを調べて、それを使うよう Open
Firmware に伝える必要があります。</para>

<orderedlist>
  <listitem>
    <para>Open Firmware プロンプト (the <literal>0 &gt;</literal>
    プロンプト) に入る; <xref linkend="ofw-access" />参照。</para>
  </listitem>

  <listitem>
    <para>Open Firmware に触るのはこれが初めてという方は、
    <xref linkend="ofw-use" />を読んでおくといいかもしれません。</para>
  </listitem>

  <listitem>
    <screen><prompt>0 &gt; </prompt><userinput>dev / ls</userinput></screen>

    <para>これで、お使いのシステムの全デバイスの一覧が表示されます。
    お使いの PCI カードに合致する項目を探します。たとえば、 
    Adaptec 2930 SCSI インターフェースを持つ PowerMacintosh G3 (Blue and White)
    での一覧を、以下に抜粋します:</para>

    <screen><prompt>0 &gt; </prompt><userinput>dev /</userinput>
<prompt>0 &gt; </prompt><userinput>ls</userinput>
  [...]
FF8313F0: /pci@F2000000
  [...]
FF83F8A0:   /pci-bridge@D
  [...]
FF83F90D:     /ADPT,2930@3
 ok</screen>

    <para>おおむね、 Open Firmware 対応のカードでは、
    ベンダー名に似た 4 文字のベンダー ID (ATI では <literal>ATY</literal>、 IMS では
    <literal>IMS</literal>、 Adaptec では <literal>ADPT</literal> というように) が表示され、
    また、文字列でカードの機種を表します。
    "@" 記号は、カード名とそのコンピューターでのアドレスを区切っています。</para>

    <para>ここで、 <literal>/ADPT,2930@3</literal> の項目が <literal>/pci-bridge@D</literal>
    よりも字下げされ、その <literal>/pci-bridge@D</literal> は <literal>/pci@F2000000</literal>
    よりも字下げされていることに注意してください。これは、 <literal>pci</literal>
    デバイスが <literal>pci-bridge</literal> デバイスを、また、 <literal>pci-bridge</literal>
    デバイスが <literal>ADPT,2930</literal> デバイスを含んでいることを意味しています。</para>
  </listitem>

  <listitem>
    <para>よって、このカードの Open Firmware デバイスツリー上のパスは
    <literal>/pci/pci-bridge@D/ADPT,2930@3</literal> です。ここで、このカードが本当に
    Open Firmware に対応しているかどうか確認するため、以下のようにタイプしてください:</para>

    <screen><prompt>0 &gt; </prompt><userinput>dev /pci/pci-bridge@D/ADPT,2930@3</userinput>
<prompt>0 &gt; </prompt><userinput>words</userinput></screen>

    <para>出力された中に "<literal>open</literal>" という単語があれば、
    そのカードが使える可能性はかなり高いです。</para>
  </listitem>

  <listitem>
    <para>さらに運がよいと、 <literal>show-children</literal> という単語が出ます。
    そうでない場合は、ブートしようとしているドライブの SCSI ID を調べる必要が
    あります。 SCSI ID は、 <literal>/@N</literal> (<literal>N</literal> は SCSI ID) という形で、
    デバイスのパスに付加されます。</para>
  </listitem>

  <listitem>
    <para>次に、パーティション番号とブートローダーのファイル名を指定することが
    できるように、どういうブート方法を使っているのか理解しておく必要があります。
    通常、 Open Firmware 1.0.5、 2.0.x、 2.4 のシステムでは "partition zero"
    ブートローダーを使います。よって <literal>:0</literal> がパスに付きます。 Open Firmware 3
    のシステムでは HFS パーティション (大抵は 9 かそれより上) から <literal>ofwboot.xcf</literal>
    をロードします。よって、パスには <literal>:9,\ofwboot.xcf</literal> のように付けます。 NetBSD
    の <ulink
    url="partitioning.html#pdisk">pdisk</ulink> を使って、
    パーティションマップのリストを出して見てください。</para>
  </listitem>

  <listitem>
    <para>さて、 <literal>ofwboot.xcf</literal> が Adaptec 2930 カードに接続された SCSI ID 5
    のドライブの 9 番目のパーティションにあるようなハードドライブを、
    PowerMacintosh G3 (Blue and White) で Open Firmware の <literal>boot-device</literal>
    として設定する場合には、次のようにすることになります:</para>

    <screen><prompt>0 &gt; </prompt><userinput>setenv boot-device /pci/pci-bridge@D/ADPT,2930@3/@5:9,\ofwboot.xcf</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>

    <para>一部の G3 モデルでは Apple 53c875 Ultra Wide SCSI ホストアダプター
    を持っています。 SCSI ID 0 のドライブからブートするには、 <literal>boot-device</literal>
    を以下のように設定します:</para>

    <screen><prompt>0 &gt; </prompt><userinput>setenv boot-device /pci/Apple53C875Card/sd@0:0</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>
  </listitem>
</orderedlist>

<note>
  <title>Adaptec 2940 シリーズの SCSI カードに関する注意</title>。

  <para>このシリーズの
  SCSI カードのファームウェアには三つのバージョンがあります。このカードを
  PowerMacintosh 7300 から 9600 で使う場合、このカードは Open Firmware からの
  ブートには使えません。より詳しい情報は、<ulink
  url="http://mail-index.NetBSD.org/port-macppc/2001/04/27/0000.html">この
  投稿記事</ulink>を参照してください。</para>
</note>

</sect3>

<sect3 id="boot-net">
<title>netboot の設定は ?</title>

<para><ulink url="../../Documentation/network/netboot/">Diskless
NetBSD HOW-TO</ulink> を見てください。</para>

<para>Mitchell Spector も、簡単な<ulink
url="http://www.enchantedlearning.com/tech/netbsd_imac.shtml">iMac 向け
netboot 情報</ulink>を含んだページを作っています。</para>

</sect3>

<sect3 id="cdr-image">
<title>NetBSD/macppc の公式 CD-R イメージはどこにありますか?</title>

<para>最寄りの <ulink url="../../mirrors/#iso">NetBSD
ダウンロードサイト</ulink>を探して、イメージをダウンロードし、
CD-R に焼いてください。</para>

<para><ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-2.0/macppc/INSTALL.html">
NetBSD/macppc 2.0 インストールノート</ulink>の
<ulink name="cdr151">"Boot off the
NetBSD/macppc CD-R image"</ulink> の節を見てください。</para>

</sect3>

<sect3 id="bootx">
<title>Linux の BootX ユーティリティーは NetBSD/macppc のブートに使えますか ?</title>

<para>いいえ。ですが、 BootX のメンテナーは、
誰かが NetBSD 用のパッチを書けば取り込むと言っています。 (<ulink
url="http://mail-index.NetBSD.org/port-macppc/1999/03/12/0002.html">port-macppc
メーリングリストのアーカイブ</ulink>を見てください。)</para>

<para>これは、
Darwin の BootX ブートローダーとは全くの別物ですので注意してください。</para>

</sect3>

<sect3 id="yaboot">
<title>Linux の yaboot ブートローダーは NetBSD/macppc のブートに使えますか ?</title>

<para>はい。ただし、すこしコツが必要です。Yaboot 自体は
BSD システムをブートする仕組みを持っていますが、残念ながら
(少なくとも NetBSD に対しては) 正しく動作しません。ただし、
わずかな手作業で動作するので、この機能を使ってブートさせることができます。</para>

<orderedlist>
  <listitem>
    <para>Linux システムに附属している Yaboot の設定ファイル
    <filename>/etc/yaboot.conf</filename> を編集し、
    NetBSD パーティションを指す <literal>bsd</literal> 行を追加します。
    たとえば <literal>bsd=/dev/hda4</literal> とします。</para>
  </listitem>

  <listitem>
    <para><command>ybin</command> を実行して、Yaboot のパーティションに
    Open Firmware のブートスクリプトを再生成します。</para>
  </listitem>

  <listitem>
    <para>Yaboot のパーティションをマウントします。たとえば以下のようにします。</para>

    <screen><prompt># </prompt><userinput>mount -t hfs /dev/hda2 /mnt</userinput></screen>
  </listitem>

  <listitem>
    <para>今マウントしたパーティション (たとえば 
    <filename>/mnt/ofboot.b</filename>) にある
    <filename>ofboot.b</filename> スクリプトを編集します。
    <literal>:bootybsd</literal> で始まる行を探します。
    この行には、インストールされている NetBSD を起動するために必要なコマンドを書くようになっており、
    これを動作させるために、このコマンドを修正する必要があります。
    つまり、この行を編集して、あなたが通常 Open Firmware から NetBSD
    をブートするときに使うコマンドを書くのです。一例を示します。</para>

    <programlisting>:bootybsd " Booting BSD..." .printf 100 ms load-base release-load-area " hd:2,ofwboot hd:5/netbsd" $boot ;</programlisting>
  </listitem>

  <listitem>
    <para>Yaboot パーティションをアンマウントします。これで終わりです。</para>
  </listitem>
</orderedlist>

<para>なお、<command>ybin</command> を再実行しないよう注意してください。
さもないと、変更が失われます。そうなった場合は、
スクリプトを設定しなおす必要があります。(もちろん、よりよい解決策は、
Yaboot が NetBSD を正しく動かせるようにすることですが……)</para>

</sect3>

<sect3 id="bootx-darwin">
<title>Darwin/MacOS X の BootX ブートローダーは NetBSD/macppc
のブートに使えますか ?</title>

<para>いいえ。ですが、 Darwin の BootX は Open Firmware を使うため、 NetBSD/macppc
への移植は linuxppc の BootX より簡単なはずです。</para>

<para>この作業に関心のある方は、 BootX のソースコードの入手について、
<ulink
url="http://mail-index.NetBSD.org/port-macppc/2000/12/12/0003.html">
この投稿</ulink>を参照してください。</para>

<para>このリポジトリーには、 System Disk に含まれるパッチをもとにした、
Open Firmware 2.4 以前なマシン用の nvram パッチも含まれています。</para>

</sect3>

<sect3 id="ofw-boot-keys">
<title>ほかに、ブートシーケンスを変更する特殊なキーはありますか ?</title>

<para>よく知られた、 PRAM をクリアするための Command-Option-P-R (これは
Open Firmware の設定も消します) や、
若干知名度が劣る、最初のブートデバイスからブートするための
Command-Option-Shift-Delete のほか、
いくつかの機種では次のようなキーが有効です。
内蔵 CD-ROM ドライブからブートする "C" 、
ネットブートする "N" 、内蔵 Zip ドライブからブートする "Z" 、
デフォルトのブートデバイスを無視して強制的に内蔵ディスクからブートする "D" 。
(これらは Apple の文献で "snag keys" として参照されています。)</para>

<para>実際には、これらはそれぞれ Open Firmware のデバイスの別名
"cd", "enet", "zip", "hd" を使っているので、デバイスの別名を変えると
これらのキーの効果も変わります。機種によっては使えないキーもあります。</para>

</sect3>

</sect2>

<sect2 id="booting-problems">
<title>ブートの問題</title>

<sect3 id="common-of-probs">
<title>Open Firmware のブートでのありがちな問題</title>

<para>Open Firmware プロンプトに入る方法 (<xref
linkend="ofw-access" />)、 <literal>CLAIM failed</literal> (<xref
linkend="ofw-claim-failed" />), <literal>DEFAULT CATCH!</literal> (<xref
linkend="default-catch" />), <literal>can't OPEN</literal> (<xref
linkend="cant-open" />), <literal>unrecognized Client Program</literal>
(<xref linkend="formatstate-not-valid" />), <literal>bad partition
number</literal> (<xref linkend="bad-partition" />),
ハードドライブが動き出すのが遅い (<xref linkend="drive-spinup" />)、
<literal>real-base</literal> (<xref linkend="ofw-real-base" />) の情報を見てください。</para>

</sect3>

<sect3 id="netboot-probs">
<title>netboot でありがちな問題</title>

<itemizedlist>
  <listitem>
    <screen><prompt>0 &gt; </prompt><userinput>boot enet:,ofwboot.xcf </userinput>BOOTP failed
 can't OPEN enet:
 ok</screen>

    <para>bootp または DHCP サーバーがクライアントの要求に反応していません。サーバーが
    動作しているか、サーバーが同じイーサネットサブネット上にあるか、また、クライアントが
    適切なイーサネットハードウェア (MAC) アドレスであるかどうか確認してみてください。
    下記の出力結果から <literal>local-mac-address</literal> を探してください:</para>

    <screen><prompt>0 &gt; </prompt><userinput>dev enet</userinput>
<prompt>0 &gt; </prompt><userinput>.properties</userinput></screen>
  </listitem>

  <listitem>
    <screen>TFTP timeout</screen>

    <para>サーバーの TFTP サーバーが動作していないか、または Open Firmware 1.0.5
    の機種でブートローダーの位置を指定しなかったかのいずれかです。
    残念ながら、初期の機種では、たとえ bootp または DHCP サーバーが適切な情報を
    提供してくれていても、明示的に <literal>boot-device</literal> からロードしない限り、
    <literal>ofwboot.xcf</literal> が混乱してしまい、正しく動作しません。
    以下のようなコマンドを使ってブートする必要があります:</para>

    <screen><prompt>0 &gt; </prompt><userinput>boot enet:,ofwboot.xcf</userinput></screen>
  </listitem>

  <listitem>
    <screen>enet:,/netbsd.ram.gz: Inappropriate file type or format</screen>

    <para>一部のシステムでは、イーサネット経由でブートする場合、圧縮された
    カーネルをロードできません。ネットブートしようとする前に <literal>gunzip(1)</literal>
    を使ってカーネルを伸長してください。</para>
  </listitem>
</itemizedlist>

</sect3>

<sect3 id="ofw-claim-failed">
<title><literal>CLAIM failed</literal></title>

<para>これは Open Firmware がメモリーの割り当てに失敗したか、
またはメモリーに問題があるときに出る一般的なメッセージです。</para>

<para>まずは、<literal>load-base</literal> が適切に設定されているか確認してください。
<xref linkend="ofw-load-base" /> を参照してください。</para>

<para>システムをリセットし、別のブートコマンドを使ってみてください
(これが、 Open Firmware 2.4 のシステムで動作させる唯一の方法だった、
という人もいます):</para>

<screen><prompt>0 &gt; </prompt><userinput>0 bootr boot-device boot-file</userinput></screen>

<para>一度 boot コマンドを試したがうまくいかず、再度おこなったときに
<literal>CLAIM failed</literal> メッセージが出たのであれば、これは一旦リブート
(Open Firmware コマンドは "reset-all") すべきであるとの指示です。</para>

<para>一方、 Open Firmware のバージョンが 1.0.5 か 2.0.x のマシンでは、このエラーは
ときどきランダムに現れます。かまわずに boot コマンドを試してみてもよいでしょう
(いくつかの機種では、これで動作することが知られています) 。</para>

<para>オンボードビデオとキーボードを使ってはブートできない
<ulink url="models.html#no.ofw.fb">機種</ulink>もあります。
シリアルコンソール (<xref
linkend="ofw-input-output-devices-ofwpre3-serial" />参照を使ってみてください。</para>

</sect3>

<sect3 id="default-catch">
<title><literal>DEFAULT CATCH!</literal></title>

<para>これは、 Open Firmware がファイルのロードに問題があったことを知らせる
一般的なメッセージです。</para>

<para>Open Firmware のバージョンが 1.0.5 か 2.X のマシンでは、このエラーは
ときどきランダムに現れます。かまわずに boot コマンドを試してみてもよいでしょう
(いくつかの機種では、これで動作することが知られています) 。
また、フロッピーディスクに問題があるか、フロッピードライブに問題があることを
表してもいます。フロッピーをローレベルフォーマットしてファイルをコピーし直し、
再度試してみてください。</para>

<para>オンボードビデオとキーボードを使ってはブートできない
<ulink url="models.html#no.ofw.fb">機種</ulink>もあります。
シリアルコンソール (<xref
linkend="ofw-input-output-devices-ofwpre3-serial" />参照) を使ってみてください。</para>

</sect3>

<sect3 id="cant-open">
<title><literal>can't OPEN</literal></title>

<para>Open Firmware は、指定されたデバイス (それがそもそも存在しなかったり、
デバイスのパスの打ち間違いなどによって) や指定されたファイルを
オープンできていません。
打鍵を確認し、また、指定したファイルがメディア上にあるか確認してください。</para>

<para>NetBSD の <ulink url="partitioning.html#pdisk">pdisk</ulink> を使って
パーティションマップの一覧を出し、 Open Firmware の
<literal>dir</literal> コマンド (<xref linkend="ofw-dir-listing" />参照) を使って
そのパーティションにあるファイルの一覧を出してみてください。</para>

</sect3>

<sect3 id="formatstate-not-valid">
<title><literal>unrecognized Client Program formatstate not
valid</literal></title>

<para>これは Open Firmware の一般的なエラーメッセージで、オープンしようとしている
ファイルが存在しないか、あるいはファイルが正しくないフォーマットであることを
表しています。
Open Firmware 1 や 2 の機種では、ファイルは (<literal>ofwboot.xcf</literal> のような)
XCOFF ファイルでなければなりませんし、
Open Firmware 3 の機種では、ファイルは XCOFF か (カーネルのような) ELF
でなければなりません。</para>

</sect3>

<sect3 id="bad-partition">
<title><literal>bad partition number, using 0no bootable HFS
partition</literal></title>

<para>これは、 Open Firmware 1.x や 2.0.x の機種で、 HFS ファイルシステムを持つ
デバイス (ハイブリッド CD-R や MacOS パーティションのあるハードドライブなど)
からブートしようとしているためです。</para>

</sect3>

<sect3 id="ofw-read-timeout">
<title><literal>READ TIMEOUT@</literal></title>

<para>Open Firmware がフロッピーディスクを読むところで問題が起きています。
以下を試してみてください:</para>

<itemizedlist>
  <listitem>
    <para>そのフロッピーで再度ブートを試みる。</para>
  </listitem>

  <listitem>
    <para>別のフロッピーディスクで試してみる。</para>
  </listitem>

  <listitem>
    <para>フロッピーへの書き込みを、
    ブートしようとしているのと同じマシンで行なってみる。</para>
  </listitem>

  <listitem>
    <para>フロッピードライブを掃除する。</para>
  </listitem>

  <listitem>
    <para>別のブート方法を使う。</para>
  </listitem>
</itemizedlist>

</sect3>

<sect3 id="drive-spinup">
<title>Open Firmware がブートを開始しようする段階で、
まだハードドライブが動いていません。</title>

<para>ブートする前に (ハードドライブが動くまで) 待つようにするためには、
以下の Open Firmware 変数をセットします:</para>

<screen><prompt>0 &gt; </prompt><userinput>setenv boot-command catch 5000 ms boot</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>

<para>ブートしようとするまでにドライブが回転していない場合は、
ドライブが自動で回転するようにハードドライブのジャンパーを変更する必要が
あるかもしれません。ほとんどのドライブ製造元は、ジャンパー設定の
オンラインマニュアルを用意しています。</para>

<para>これ以外の方法としては、 <literal>boot-command</literal>
変数と nvramrc パッチの二つがあります。</para>

<screen><prompt>0 &gt; </prompt>setenv <userinput>boot-command begin ['] boot catch 999 ms cr again</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>

<para>この 1 行コマンドによる方法は、いくつかの初期の Open Firmware 1.0.5
の機種には通用しないという報告があります。</para>

<para>このほか、<ulink
url="../../../Ports/macppc/SystemDisk-tutorial/of105patch2.txt">以下のパッチ</ulink>を
nvramrc に追加するという方法もあります:</para>

<screen>: wBoot
begin
 boot-device ['] $boot catch drop
 ." -Waiting for boot-device" cr
 d# 500 ms
key? until
;</screen>

<para>追加後、 <literal>nvstore</literal> を実行します。
nvramrc へのパッチ適用についてより詳しくは <ulink
url="nvedit.html">NetBSD/macppc nvedit HOW-TO</ulink>
を見てください。さらに、ブートコマンドの変更を
指示しなければなりません。 OF プロンプトで次のようにタイプします:</para>

<screen><prompt>0 &gt; </prompt><userinput>setenv boot-command wBoot</userinput>
<prompt>0 &gt; </prompt><userinput>reset-all</userinput></screen>

</sect3>

<sect3 id="grey-screen">
<title>ブートしようとすると、画面がグレーになって真中にアイコンがあるようになるのはなぜですか?</title>

<para>これは、システムが MacOS をブートしようとしていることを意味します。
このような状況は、適切に Open Firmware に入っていない (<xref
linkend="ofw-access" />参照) か、
Open Firmware の boot コマンドが正しくない場合に起こりえます。</para>

<para>間違った <literal>boot</literal> コマンドを打った場合、 Open Firmware は
<literal>boot-device</literal> 変数値をもとにブートしようとしますが、これのデフォルト値は
MacOS ROM です。これについての助言が必要なら、<xref linkend="ofw-variables"
/>の情報を見てください。</para>

<para>アイコン付きのグレーの画面は、 MacOS ROM によるものです。
点滅するクエスチョンマークまたは壊れたフォルダーは、マシンがブート可能な
MacOS のファイルシステムを探しているが見付からないことを意味します。
地球のアイコンは、マシンがネットブートサーバーを探していることを意味します。
ニコニコ顔は MacOS をブートしようとしていることを意味します。</para>

<para>ブートフロッピーはブート可能な MacOS ファイルシステムは持っておらず、
ブート可能な NetBSD のファイルシステムを持っています。</para>

<para>リブートして Open Firmware に入り直し、
コマンドをよく確認してください。</para>

</sect3>

<sect3 id="black-lcd">
<title>ブートの間、画面が真っ暗になってしまうのはなぜですか ?</title>

<para>バグです。 NetBSD カーネルはバックライトを消してしまいます。
回避するため、 PowerBook の画面の明るさを上げてください。</para>

<para>もし PowerBook を使っているのでなければ、<xref
linkend="ofw-boot-serial" />を見てください。</para>

</sect3>

<sect3 id="nodisk">
<title>ディスクはどこに行った? (あるいは、 sysinst が <literal>I can not find any
hard disk for use by NetBSD</literal> と言う)</title>

<para>うむ、よい質問です!</para>

<para>おおもとの原因は、 NetBSD がハードドライブを見つけなかったことです
(より内部的にいえば、ドライブコントローラーを見つけなかったということです) 。
これが起きる原因は、さまざまです。まず最初に、 NetBSD がIDE コントローラー
を見つけているか確認してください (スクロールしてゆくブートメッセージ中に、
<literal>wdc0</literal> (IDE の場合) または <literal>scsibus0</literal> (SCSI の場合)
を含む行があるはずです) 。もし、それも見つけていなければ、お使いのドライブバス
をサポートした別のカーネルを使う必要があるでしょう。<ulink
url="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</ulink>
に投稿して助言を求めてください。</para>

<para>ここで、ちょっとした問題を排除 (ドライブの接続、電源、ジャンパーが正しく
セットされているか確認) してください。 MacOS でドライブが動作するか確認してください。</para>

<para>それでも NetBSD がディスクを見つけられず、それが SCSI ディスクの場合、
終端抵抗を確認してください。たとえ MacOS では使えていても、 NetBSD は SCSI
バスのタイミングに関して MacOS より厳格かもしれません。</para>

<para>IDE ドライブの場合、あなたのシステムは PowerMacintosh G3 (青白) かそれ以前の
ものかもしれません。 B&amp;W システムまでは、 Apple は IDE に関する問題すべてを
完全に除去してはいませんでした。多くの人々が、 NetBSD のドライブを別の IDE
バスにつなぎ、かつ/または、そのドライブをマスターにする
(CD-ROM はスレーブにする) 必要があると報告しています。</para>

<para>残念ながら、お使いの OS すべてが動作する正しい構成を見つけるため、
いろいろ試す必要があるかもしれません。 Open Firmware 3 を持たない
システムはいずれも、スレーブデバイスからはブートできない (Open Firmware
の制限) ということを覚えておいてください。</para>

<para>Chris Tribo は初期の G3 モデルのよい分析と、その制限/特徴について
投稿しています。彼の<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/07/26/0019.html">記事</ulink>を見てください。
また、このトピックに関する Apple の <ulink
url="http://docs.info.apple.com/article.html?artnum=24342">Power Macintosh
G3 and G4: IDE Master and Slave Support and Configuration</ulink> の
記事も見てください。</para>

<para>このほか、初期の NetBSD リリース版には、ディスク関係の問題が若干あります。
<ulink url="oldfaq.html#old-nodisk">過去の
FAQ</ulink>をご覧ください。</para>

</sect3>

</sect2>

<sect2 id="misc">
<title>その他もろもろ</title>

<sect3 id="moved">
<title>この FAQ 項目は移転しました</title>

<anchor id="cannot-allocate-vm-panic" />
<anchor id="wdc-lost-interrupt" />
<anchor id="pciide-lost-interrupt" />
<anchor id="mesh-fifo" />
<anchor id="bm0-device-timeouts" />
<anchor id="usb-keyboard-problems" />
<anchor id="power-off" />
<anchor id="pb418" />

<para>1.6 リリースより前の NetBSD バージョンでの問題に関する FAQ 項目は、
<ulink url="oldfaq.html">過去の
FAQ</ulink> へ移転しました。</para>

</sect3>

<sect3 id="lang-kbd">
<title>別のキーボード配列を使う方法は?</title>

<para>キーボードを US 以外の言語や、 Dvorak 等の異なる配列に設定する方法の説明は、<ulink
url="../../Documentation/wscons/index.html#keyboard-maps">WSCONS
FAQ</ulink> を参照してください。 X の場合は、 Hauke Fath の
<ulink
url="http://mail-index.NetBSD.org/port-macppc/2001/12/05/0001.html">記事</ulink>を参照してください。
また、<xref linkend="no-swapctrlcaps" />も参照してください。</para>

</sect3>

<sect3 id="elf">
<title><literal>ldconfig</literal>/<literal>ld.so.conf</literal>
はどこにありますか ?</title>

<para>NetBSD/macppc は ELF を使っているので、
<literal>ldconfig</literal> や <literal>ld.so.conf</literal> はありません。
より詳しくは、<ulink url="../../../Documentation/elf.html">NetBSD ELF FAQ</ulink>
を見てください。</para>

</sect3>

<sect3 id="cross-compile">
<title>他のホストや OS でクロスコンパイルする方法は ?</title>

<para>NetBSD 1.6 およびそれ以降のシステムでは、ベースシステムのクロス構築を完全にサポートしています。
これは、構築するユーザーが root でなくても、また、 NetBSD 以外のホスト上ででも可能です。
詳細は、 <ulink url="../../Documentation/">NetBSD ドキュメンテーションのページ</ulink>
以下にある <ulink url="../../Documentation/cross/">NetBSD のクロス構築</ulink>
をご覧ください。</para>

</sect3>

<sect3 id="linux">
<title>NetBSD/macppc で MkLinux や LinuxPPC のバイナリーが動きますか ?</title>

<para>はい。 NetBSD 1.6 およびそれ以降には PowerPC ポート向け Linux バイナリー互換機能が
ありますが、デフォルトでは有効になっていません。
<literal>options COMPAT_LINUX</literal> のコメントを外して
<ulink url="../../Documentation/kernel/#how_to_build_a_kernel">カーネルを再構築</ulink>
する必要があります。<ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/www/communicator/README.html">
Netscape Communicator</ulink>, <ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/lang/blackdown-jdk13/README.html">Blackdown's
JDK-1.3.0</ulink>, や <ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/graphics/blender/README.html">Blender</ulink> といったアプリケーションの動作が報告されています。
これらのプログラムはすべて <ulink
url="http://www.NetBSD.org/Documentation/software/packages.html"> NetBSD
パッケージコレクション</ulink>に含まれています。</para>

<para>問題のあるバイナリーとしては: <ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/www/opera/README.html">Opera</ulink>
は初回の起動時にはクラッシュします。二回目の起動時に、 advanced settings
ダイアログに入って "asynchronous DNS" チェックを外せば、問題なく動作
するはずです。</para>

<para>JDK がしっかり動作することは、特筆に値するかもしれません。<ulink
url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/www/cocoon/README.html">Cocoon</ulink>
のような Java アプリケーションは問題なく動作すると
報告されています。</para>

</sect3>

<sect3 id="macos">
<title>NetBSD/macppc で MacOS のバイナリーが動きますか ?</title>

<para>いずれ誰かが <ulink
url="http://www.ibrium.se/linux/mac_on_linux.html">Mac-on-linux</ulink>
(LinuxPPC 用) を動かすかもしれません。それまでは、 68k Mac をエミュレートする
<filename role="pkg">emulators/BasiliskII</filename> や <ulink url="http://www.vmac.org">VMac</ulink>
を使ってみてください。</para>

</sect3>

<sect3 id="macosx">
<title>NetBSD/macppc で Darwin/MacOS X のバイナリーが動きますか ?</title>

<para>作業は進行中で、 Darwin バイナリーの実行サポートのいくつかは
NetBSD-current に入っています。このプロジェクトの最新情報については
COMPAT_MACH と COMPAT_DARWIN の
<ulink url="http://hcpnet.free.fr/applebsd.html">状況ページ</ulink> で確認してください。</para>

</sect3>

<sect3 id="keys">
<title>いくつかのキーボードアイコンについて</title>

<para>Apple はキーボードに特別なキーを用意しており、
(特に US キーボード以外では) 混乱する人がいるかもしれません。</para>

<para>
<inlinemediaobject>
  <imageobject>
    <imagedata fileref="../../../images/ports/macppc/icon-command.gif"
    format="GIF" />
  </imageobject>
</inlinemediaobject>
印の付いたキーは、普通、 "Command" キーとして参照されます。
キーボードによっては、コマンドキーに "open apple" (
<inlinemediaobject>
  <imageobject>
    <imagedata fileref="../../../images/ports/macppc/icon-open-apple.gif"
    format="GIF" />
  </imageobject>
</inlinemediaobject>) 印も付いています。</para>

<para>US キーボード以外では、 US キーボードで "option" キーとして印のあるキーに
<inlinemediaobject>
  <imageobject>
    <imagedata fileref="../../../images/ports/macppc/icon-option.gif"
    format="GIF" />
  </imageobject>
</inlinemediaobject>
印の付いたキーがあります。</para>

<para>しばしば、 Mac のドキュメントでは、 "C-O-p-r" などを押すよう指示しています。
これは、 command キーと option キーを "p" と "r" とともに押すことを
意味しています。</para>

</sect3>

<sect3 id="german-kbd-at">
<title>ドイツ語 ADB キーボード上で、アットマーク (@) はどこ?</title>

<para>MacOS では Shift-Alt-1、
Open Firmware では Shift-Alt-2 です。</para>

</sect3>

<sect3 id="adb-short">
<title>ADB キーボードを使わずにシステムをブートする方法は?</title>

<para>あなたがシリアルコンソールを使っていて、 ADB キーボードがなく、また、
電源スイッチ本体のある後部 (でなくてもどこでもいいですけど)
に手を伸ばしたくない場合、ハードウェアに細工して、コンピューターに
ADB キーボードの "power" キーを再現することができます。
すべての Mac には、本当の電源スイッチ (ソフトまたはハード電源) がありますが、
見えないようになっているかもしれません。
この細工をすると保証は無効になりますし、私たちも責任を持てません。
このトピックに関する Chris Tribo によるメーリングリストの
<ulink url="http://mail-index.NetBSD.org/port-macppc/2001/06/09/0002.html">記事</ulink>
を参照してください。</para>

</sect3>

<sect3 id="no-swapctrlcaps">
<title>なぜ wscons に ADB キーボード用のマッピング "us.swapctrlcaps"
がないんですか?</title>

<para>ADB キーボードは異常なキーコードを生成します &mdash; キーを解放時に押すと
(= caps lock セット) あるキーコードを生成し、
押して解放すると (= caps lock 解放) 別のキーコードを生成します。
カーネルコード <filename>sys/arch/macppc/dev/akbd.c</filename> で、異常なキーコードは
wscons キーコードへ変換されます。
この不具合があるため、私たちができる最善のことは、残念なことですが、
control キーを固定することなのです。</para>

<para>NetBSD-current (1.6A 以降) では、 <literal>options
CAPS_IS_CONTROL</literal> で、 capslock キーを control キーにハードコードします。
(LED の表示はおかしくなりますが、有用でしょう)</para>

</sect3>

<sect3 id="keyboard-ddb">
<title>コンソールから DDB に入る方法は?</title>

<para>ADB キーボードで <literal>command-option-power</literal> を同時に押します。</para>

</sect3>

</sect2>

<parentsec url="." text="NetBSD/macppc ポートのページ" />

</sect1>
</webpage>
