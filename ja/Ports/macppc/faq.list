<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<title>NetBSD/macppc Frequently Asked Questions</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h1>NetBSD/macppc Frequently Asked Questions</h1>

Here are some frequently asked questions about NetBSD/macppc.
<p>

This FAQ is very much a work in progress. If you have additional
information, questions, or answers, send mail to <a
href="mailto:port-macppc@NetBSD.org">port-macppc@NetBSD.org</a>.
<p>

See also the following related FAQ's:
<ul>
    <li><a href="../../Documentation/elf.html">The NetBSD ELF FAQ</a>.
    <li><a href="../../Documentation/wscons/">The wscons
	FAQ</a>, for NetBSD's platform-independent workstation console
	driver.
</ul>

<LIST>

<SECTION>General Questions


<ENTRY>boot-trouble Help, I can't boot NetBSD!
Unfortunately, there are several causes of this problem.  It's actually rather 
more common than we'd like, but is primarily due to the variety of machines
that we support and all the undocumented changes Apple made along the line.

<p>First, check to make sure your <a href="models.html">model</a> is supported.
Next, did you <i>really</i> read through the INSTALL notes and ignore
the instructions for Open Firmware versions other than your model? 
Next, read through this FAQ entry, and if you still can't make your machine
boot into NetBSD, post to 
<a href="mailto:port-macppc@netbsd.org">port-macppc@netbsd.org</a>.

<p>Look at the messages below to determine which problem you are encountering.

<p>
<pre>     Open Firmware, 1.0.5
     To continue booting the MacOS type:
     BYE&lt;return&gt;
     To continue booting from the default boot device type:
     BOOT&lt;return&gt;
      ok
     0 &gt; </pre>

If you don't see this message on screen (or serial console), then you haven't 
properly entered Open Firmware.  If your machine starts to boot MacOS (i.e. 
the screen turns grey and a happy mac or broken folder appears), then see 
the <a href="SystemDisk-tutorial/">System Disk Tutorial</a>.
Alternatively, see the instructions on 
<a href="#ofw-access">how to enter Open Firmware</a>.  If your screen stays 
black and you have an older mac, see instructions on 
<a href="#ofw-boot-serial"> how to get around using a serial console</a>.
If your screen is all weird, then see how to fix the 
<a href="#non-sync-monitor">monitor sync problems</a>.

<p>OK, now Open Firmware has started and is ready for user commands if you
set it to stop at the Open Firmware prompt, otherwise, it starts trying to
boot using the settings you previously supplied. 

<p>The next step is usually the trickiest -- getting Open Firmware to load
the bootloader from the correct location.  See what 
<a href="#boot-support">boot methods</a> are supported, Open Firmware 
<a href="#boot-disk">boot commands</a>, and some 
<a href="#common-of-probs">common Open Firmware booting problems</a>. 
Questions related to netbooting are covered in the 
<a href="../../Documentation/network/netboot/">Diskless HOW-TO</a>, 
particularly in the 
<a href="../../Documentation/network/netboot/intro.macppc.html">macppc-specific</a>
section.

<pre>     0 &gt; <b>boot enet</b> file: 192.168.0.11,/ofwboot.xcfloading XCOFF
     tsize=C280 dsize=14AC bsize=2620 entry=600000
     SECTIONS:
     .text    00600000 00600000 0000C280 000000E0
     .data    0060D000 0060D000 000014AC 0000C360
     .bss     0060E4B0 0060E4B0 00002620 00000000
     loading .text, done..
     loading .data, done..
     clearing .bss, done..
     
     &gt;&gt; NetBSD/macppc OpenFirmware Boot, Revision 1.3
     &gt;&gt; (tsubai@mint.iri.co.jp, Sun Nov 26 01:41:27 JST 2000) 
    1701508+177748 [100+68176+55886]=0x1e9468</pre>

If it hangs here, then you need to set the 
<a href="#ofw-real-base"><tt>real-base</tt></a> of your Open Firmware 1.0.5
or 2.0.x machine. If you get past this point, then your kernel has started
to load.  Now, if you have problems, it is most likely no longer an Open
Firmware problem, but a NetBSD problem. 

<p>If your screen turns black, and you have a laptop, the LCD brightness
may have been turned down all the way.  See 
<a href="#black-lcd">below</a>. 

<pre>      start=0x100000
     Copyright (c) 1996, 1997, 1998, 1999, 2000, 2001
         The NetBSD Foundation, Inc.  All rights reserved.
     Copyright (c) 1982, 1986, 1989, 1991, 1993
         The Regents of the University of California.  All rights reserved.
     
     NetBSD 1.5S (AL) #0: Thu Mar 15 00:52:56 PST 2001
         mw@al:/usr/src/sys/arch/macppc/compile/AL
     total memory = 192 MB
     avail memory = 172 MB
     using 2483 buffers containing 9932 KB of memory
     [...]
     boot device: sd0
     root on sd0a dumps on sd0b
     root file system type: ffs</pre>

Sometimes the kernel can't figure out where it was booting from.  You may
need to build a kernel with the boot device hard-wired in.  See 
<a href="#dash-a">below</a>. 

<p>If your system hangs here, and you're using an USB keyboard, then see
<a href="#usb-keyboard-problems">below</a>.

<pre>     swapctl: adding /dev/sd0b as swap device at priority 0
     Automatic boot in progress: starting file system checks.
     [...]</pre>

OK, now you've started in "multi-user mode" and the boot process is complete.
If your keyboard doesn't work, see the FAQ entries for 
<a href="#usb-keyboard-problems">USB keyboards</a> and for 
<a href="#powerbook">recent laptops</a>.

<ENTRY>usb-mouse-bug My USB mouse is not recognized.

Try plugging it into the back of the Mac instead of into the keyboard.


<ENTRY>mouse-buttons How can I emulate a 3-button mouse with a 1-button mouse in X?

At the moment, you can't.  Try finding a cheap 3 button mouse, most ADB and 
USB mice are supported.


<ENTRY>usb-keyboard-problems USB keyboard problems
There is a problem in some kernels that causes the first keypress
from a USB keyboard to be repeated over and over again. A symptom
of this would be the install system continually asking "<tt>(I)nstall,
(S)hell or (H)alt ?</tt>" To avoid this problem, press the
shift key before anything else.
<p>
On some newer machines, NetBSD will hang after configuring the devices but
before entering single-user mode.  The recommended solution is to unplug
all USB devices (especially hubs) and plug the mouse into the keyboard and
the keyboard directly into the back of the mac.

<ENTRY>cannot-allocate-vm-panic <tt>panic: startup: cannot allocate VM for buffers</tt>
This problem should have been fixed in NetBSD 1.5.  If you still have this
problem after upgrading, post to 
<a href="mailto:port-macppc@netbsd.org">port-macppc@netbsd.org</a>.

<p>
On some machines with large quantities of RAM the kernel will run out of
kernel VM when it tries to allocate the buffer cache.
You can avoid this by either of:
<ol>
<li>Removing some RAM
<li>Adding <tt>"options BUFPAGES=800"</tt> to the <a
    href="../../Documentation/kernel/#how_to_build_a_kernel">kernel
    configuration</a>
</ol>

<ENTRY>pciide-lost-interrupt <tt>pciide0:0:0: lost interrupt</tt>
This problem is fixed in NetBSD-current and NetBSD 1.5.1.  
If you still have this problem after upgrading, post to 
<a href="mailto:port-macppc@netbsd.org">port-macppc@netbsd.org</a>.

<p>
The NetBSD initialization code for the CMD 646 IDE controller doesn't
correctly undo some of the settings that Open Firmware sets.  What happens
is that Open Firmware sets the IDE controller up in 0646U2 mode and
changes some of the interrupt settings.  The MI pciide driver doesn't know
how to deal with this situation and you get a lot of "lost
interrupt" messages.
<p>
What this means is that if you use Open Firmware to load the bootloader
(i.e. <tt>ofwboot.elf</tt>) or the kernel from your hard drive, NetBSD
cannot use that drive.
<p>
A workaround is to place the kernel on another bootable
bus and then use that to mount the drive with your NetBSD filesystem 
on the drive connected to the CMD 646 IDE bus.  The
key phrase here is "another bootable bus".  On the G3 and G4 machines which
have this problem, they have more than one IDE bus (in addition to add-on
SCSI busses).  The hard drive is typically on the bus which we have
troubles with, but the CD-ROM and Zip drive are typically on a different
IDE bus which works just fine.
<p>
What you may want to do is move your hard drive to the bus the CD-ROM is
attached to (paying attention to the master/slave jumpers), and all your
problems will go away, although your drive is using a slower IDE bus
protocol.


<ENTRY>mesh-fifo <tt>Panic: mesh: FIFO != 0</tt>
This bug is not present in NetBSD 1.5 and later.
<p>
This is usually caused by bad SCSI cabling or devices.  Check your
internal and external termination.  Check the length and quality of your
cables.  Disconnect all devices that are not critical.
<p>
More often than not, this is caused by having a Zip drive on your MESH
SCSI bus, as these devices do not behave like good SCSI citizens.
<p>
One person
suggested that the MESH driver is more reliable if you don't reboot
from MacOS into NetBSD. (That is, if you're running MacOS, shut down
rather than rebooting, and then power it back on and boot to NetBSD.)
<p>
M L Riechers posted a very thorough 
<a href="http://mail-index.netbsd.org/port-macppc/2000/08/02/0029.html">
message</a> on this topic.
<p>
Good luck.


<ENTRY>bm0-device-timeouts I'm getting device timeouts on bm0
This problem has been fixed in NetBSD 1.5 and later.
<p>
Inserting a 10Mb Hub (forcing bm0 to 10Mb/s instead of 100Mb/s) seems
to prevent this problem.

<ENTRY>non-sync-monitor My monitor doesn't sync up sometimes
This is a problem with the PowerMacintosh 7300 - 8600 machines, 
wherein the video
signals do not settle quickly enough.  You should apply the <a
href="SystemDisk-tutorial/of105patch.html">patches</a> for OF 1.0.5.

<ENTRY>changing-resolution How do I change the resolution or the number of colors?
You can't do this from within NetBSD.  These settings need to be changed
in Open Firmware.  Also, NetBSD/macppc does not yet support color depths
of more than 8 bpp.
<p>
Older machines (7300 - 8600) cannot change resolutions from within
OF.  They are fixed to 640x480 at 67 Hz (after applying the <a
href="SystemDisk-tutorial/of105patch.html">patch</a>).  Without this
patch, the frequency is undetermined (usually 60 Hz or 120 Hz, but could
be just about anything).
<p>
<!-- On newer machines OF &gt;= 2.0, you can type (at the OF prompt):
(pre)0 &gt; (b)dev screen(/b)
0 &gt; (b)show-modes(/b)
0 &gt; (b)mode#(/b)
1 &gt; (b).(/b)(/pre)
(p)
This will list the resolutions available on your system.  If you set your
system to one of these resolutions from within MacOS, then Open FIrmware
should keep that setting. -->

On newer machines, you need to set the resolution you want from within
MacOS.  Open Firmware should then keep that setting.
<p>
Chris Tribo reports that his XClaimVR 64 card ignores the MacOS monitor
setting and always comes up at the same resolution.

<ENTRY>power-off Woah, my machine just powered off!

Well, that's probably because you're using a recent laptop (iBook,
PowerBook (FireWire), or PowerBook G4 (Titanium)) with an unsupported
keyboard patch and pressed one of the weird keys (like brightness or page
up). 

<p>No solution, just don't press those keys until a better keyboard patch
is made. 

<!-- ======================================== -->
<SECTION>Supported Hardware

<ENTRY>nubus Does NetBSD/macppc support NuBus-based Power Macs (7100, 8100, etc)?

No. NetBSD/macppc doesn't support NuBus. In addition,the NuBus-based
Power Macs don't have Open Firmware, which NetBSD/macppc depends on
heavily.

<p>
There are four groups of NuBus based Power Macintosh machines:
<ul>
<li><b>Apple PDM</b><br>
    Any x1xx machine, e.g. 6100, 6150, 7100, 8100
<li><b>Apple PERFORMA class</b><br>
    52xx, 53xx, 62xx, 63xx (except 6360)
<li><b>Apple POWERBOOK (or 'M2') class</b><br>
    1400, 2300, 5300
<li><b>Power Computing "Power" series</b><br>
    Such as the "Power 100" and "Power 120"
</ul>

<p> These systems won't work even if you upgrade the processor to a
G3, because the remaining hardware is still unsupported. (But if you
get a complete logic board upgrade, they will work, because they then
essentially become a new machine)

<p> At the current time, we don't know of anyone working on supporting
these systems. If you are interested in trying to get one of them
working, <a href="mailto:port-macppc@NetBSD.org">send mail</a>.


<ENTRY>68k-upgrade Does NetBSD/macppc support PowerPC processor upgrades for 68k-based Macs?

No, for the same reasons as above. (This applies only to
<em>processor</em> upgrades. If you upgrade the whole motherboard, it
essentially becomes a new machine, in which case it may be supported.)


<ENTRY>601 Does NetBSD/macppc support the Power Macintosh 7200 or 7500?

These machines have PCI and Open Firmware, but use the PowerPC 601
processor, which is not currently supported. However, the 7500's
processor is upgradable, so if you buy a 603/604/G3/G4 upgrade for it,
NetBSD will work.


<ENTRY>powerbook Does NetBSD/macppc support PowerPC-based PowerBooks?

Some of them.  See the <a href="models.html">NetBSD/macppc supported
models list</a>. 

<p>The PowerBook 2400 and the older G3 PowerBooks are known
to be supported. The PowerBook 1400, 2300, and 5300 are not supported,
because they are not PCI-based. Other models may work out of the box,
or may need a small additional amount of driver work before they work.

<p>Some of the newer models (iBook, PowerBook (FireWire), and PowerBook G4 
(Titanium)) require a special patch to use their
keyboards.  There is a recent snapshot of NetBSD with these patches on the
ftp mirrors.  It is in the <tt>arch/macppc/snapshot</tt> directory. 

<p> Note that power management is not yet supported, so it is not
possible to suspend and resume a PowerBook while running NetBSD.

<ENTRYLINK>models.html NetBSD/macppc supported models list

<ENTRY>peripherals What peripherals does NetBSD/macppc support?

<p>
(XXX Need more information about what chips are in which models)

<p>
<ul>
  <li> <strong>Ethernet</strong>
  <ul>
    <li> On-board 79C950 (MACE) ethernet
    <li> On-board bmac ethernet, 10Base-T only
    <li> On-board gmac ethernet
    <li> Tulip-compatible, 3Com, and NE2000-compatible PCI cards (de,
	ep, and ne drivers)
  </ul>

  <li> <strong>Disks</strong>

  <ul>
    <li> On-board 53c94 SCSI controller
    <li> On-board MESH SCSI controller
    <li> Advansys 1200[A,B] 9xx[U,UA] PCI SCSI (cannot use as boot device)
    <li> Adaptec / Future Domain PCI SCSI (can use as a boot device if
	it has Macintosh firmware)<br>
	<i>See <a href="#boot-pci">below</a></i>
    <li> BusLogic PCI SCSI (not quite supported in mainline yet)

    <li> On-board IDE hard drives and CD-ROM drives<br>
	<i>See <a href="#pciide-lost-interrupt">above</a></i>

    <li> USB mass-storage devices (such as Zip drives)
  </ul>

  <li> <strong>Serial</strong>
  <ul>
    <li> On-board RS-422 serial (modem/printer) port
    <li> On-board USB controller (iMac and Blue G3s)
    <li> USB-based serial and parallel ports
  </ul>

  <li> <strong>Video</strong> (see <a href="#ofw-boot-serial">below</a>)
  <ul>
    <li> On-board video on almost all models
    <li> PCI video cards with Open Firmware drivers
  </ul>

  <li> <strong>Input</strong>
  <ul>
    <li> ADB keyboards and mice
    <li> USB keyboards and mice
  </ul>

  <li> <strong>PCMCIA/CardBus</strong>

</ul>

<p>
For more information about specific add-on cards and devices that are
supported, see the <a href="../../Hardware/pci.html">Machine-independent
PCI drivers</a>, <a href="../../Hardware/usb.html">Machine-independent
USB drivers</a>, <a href="../../Hardware/pcmcia.html">Machine-independent
PCMCIA drivers</a>, and
<a href="../../Hardware/cardbus.html">Machine-independent Cardbus
drivers</a> pages. (There is not currently a list of specific ADB
devices which are known to work with NetBSD.)

<p>
NetBSD/macppc does not yet support

<ul>
  <li> Built-in Audio
  <li> Floppy drives (built-in or USB), other than for booting
  <li> FireWire (IEEE 1394)
  <li> Power management
  <li> Airport
  <li> Use of more than one processor (the extra CPUs sit idle)
</ul>


<!-- ======================================== -->
<SECTION>Open Firmware

<ENTRY>ofw What is Open Firmware?

Open Firmware, as specified by "IEEE Std 1275-1994: IEEE Standard
for Boot Firmware (Initialization Configuration) Firmware: Core
Requirements and Practices" and its supplements, is a
platform-independent boot firmware. It is based on Sun's OpenBoot
firmware, and uses ANS Forth as a processor-independent interface
language.

You can find more about Open Firmware at the <a
href="http://playground.sun.com/1275/home.html">Open Firmware Working
Group home page</a>.


<ENTRY>ofw-version Which version of Open Firmware is my machine?

Look at the <a href="models.html">Model Support</a> page.  If your machine
isn't listed, you can find out from within Open Firmware.  From the OF
prompt, type:
<pre>0 &gt; <b>dev /openprom</b>
0 &gt; <b>.properties</b>
name                    openprom
device_type             BootROM
model                   OpenFirmware 3
relative-addressing     
supports-bootinfo       

 ok</pre>
<p>
Alternatively, any machine which did not ship with a G3 or G4 processor is
either OF 1.0.5 or 2.0.x.  "Translucent" models all have OF 3.

<ENTRY>ofw-bugs Are there bugs in my machine's Open Firmware implementation?

Probably.  
<p>

If you have a mac with Open Firmware 3.0 or higher, you might be able to
download a new Firmware for your machine on the <a
href="http://asu.info.apple.com/">Apple Software Updates</a> web site.  
Search for <tt>firmware</tt> and download the most recent file appropriate
for your model. 
<p>

<i>Warning about Firmware update 4.1.7 and 4.1.8</i><br>
    Apple recently released a new version of firmware for recent
    models.  There are two reports of PowerBook G4 machines being
    unable to boot NetBSD after this upgrade.  Also, many people
    are having problems with their third-party RAM.  See this
    <a href="http://www.macfixit.com/archives/april.01.a.shtml#firm-04-07">
    discussion on www.macfixit.com</a> before deciding to upgrade.
    <p>

If you have an older model mac (i.e. one that does not have a flash
upgradable firmware), you can still patch your system.  Open Firmware
provides a small nvram to patch problems found after
the machine was built.  Apple has kindly published a MacOS utility which
will patch most known problems and will allow you to set various Open
Firmware variables.  People have found the patches from this utility will
allow them to use Open Firmware to boot from otherwise unbootable drives.
<p>

To patch your system, merely download 
<a href="ftp://ftp.apple.com/developer/macosxserver/utilities/SystemDisk2.3.1.smi.bin">
SystemDisk</a>, run the <tt>System Disk</tt> program from the disk
image, then click on <tt>Power User (Open Firmware)</tt>, and click on
<tt>Save</tt>.

<p>Note: <i>zapping your PRAM <tt>Command-Option-P-R</tt>
will erase these nvram patches.</i>
<p>Note 2: <i>Booting your OF 1.0.5 system into MacOS will erase these
nvram patches.</i>
<p>

If you have a system with OpenFirmware 1.0.5, there are a few additional 
<a href="SystemDisk-tutorial/of105patch.html">patches</a> that you may
wish to apply that are <i>not</i> included in the System Disk utility.  

<ENTRY>ofw-access How do I access Open Firmware?

You can use Apple's <tt>System Disk</tt> to set your machine to always
boot into Open Firmware.  See the brief 
<a href="SystemDisk-tutorial/">tutorial</a> on how to do this.
<p>
To manually access Open Firmware, 
hold down Command-Option-O-F while booting (on PowerBooks, you should hold
down these keys on the built-in keyboard). The firmware checks the
state of the keys some time after the startup chime--exactly when
varies from model to model. The G3 PowerBooks seem to be the pickiest
about timing. If you're having problems, try waiting until the startup
chime starts, then quickly press the keys before it finishes (and hold
them down until you see the Open Firmware screen). It's also been
reported that it's easier to get into Open Firmware from a powered-off
state than it is from a reboot.
<p>
To permanently boot into the Open Firmware prompt, type (at the OF
prompt):
<pre>setenv auto-boot? false</pre>
Now, each time you boot or reboot your PowerMacintosh, you will get an OF
prompt.


<ENTRY>ofw-boot-serial I tried to get into Open Firmware, but it just stopped booting, and my monitor isn't showing anything.

Older versions of Open Firmware default to communicating over the modem
port, not via the connected keyboard and monitor. If you have an old
PowerPC 601-based machine that you have upgraded to a supported processor
(such as some of the old PowerComputing clones or Performas), there might
not be anything you can do to change this. But most other machines can be
told to use the keyboard and video instead of a serial console.

<p>The easiest way to deal with this is to use Apple's System Disk
utility (see the <a href="SystemDisk-tutorial/">tutorial</a>).  
When you run this program, click on <tt>Power User (Open Firmware)</tt>, 
then click on the <tt>Save</tt> button, it will set
your Open Firmware to use the built-in display and keyboard if possible.

<p>Alternately, you can set up a serial console as follows: connect
another computer (or terminal) to the modem port, and set the baud
rate of its serial port to 38400, 8 bit bytes, 1 stop bit and no
parity. (If you're connecting a non-Mac, you will need a converter
from the MiniDIN8 connector on the Mac to a standard DB9/DB25 connector
that everyone else uses.) Use kermit or some other terminal program.

<p>Start your machine and press Command-Option-O-F on the Mac keyboard
immediately after you hear the startup sound. You should see the
prompt `<tt>0&nbsp;&gt;</tt>' on the (serial) console within a few
seconds.

<p>To switch the machine to using the monitor and keyboard instead of the
serial console, type:

<pre>0 &gt; <b>setenv input-device kbd</b>
0 &gt; <b>setenv output-device screen</b>
0 &gt; <b>reset-all</b></pre>

The last command reboots your machine with the new settings. 

<p>Not all machines have a "screen" device alias, in which case you
will need to figure out what the full Open Firmware path to the video
device is. Also note that Open Firmware will <i>not</i> complain if you
specify an output device that doesn't exist.
On the 7300 through 8600 models, this
is "<tt>/chaos/control</tt>". 
<p>
If <tt>screen</tt> or <tt>/chaos/control</tt> doesn't work on your
machine, look in the device tree for a PCI device that contains the
name of your video card (preceded by "ATY," for an ATI card, or "IMS,"
for a Twin Turbo card), for example
"<tt>/bandit/ATY,mach64</tt>" and
"<tt>/bandit@F4000000/IMS,tt128mb8A</tt>".  To get a list of the devices
available to Open Firmware, type:
<pre>0 &gt; <b>dev / ls</b></pre>


<ENTRY>systemdisk Configuring the Open Firmware boot variables and nvram

You can use a handy utility provided by <a href="http://www.apple.com">Apple</a>
to do this.  See the brief <a href="SystemDisk-tutorial/">tutorial</a>
for details.
<p>
Alternatively, you can change the parameters from the Open Firmware
prompt, using <tt>setenv</tt> commands.  Use <tt>printenv</tt> to see what
variables are available.
<p>
To edit the contents of the <tt>nvramrc</tt> startup script, you can
hack System Disk with ResEdit.  Look in the <tt>OFtc</tt> resource
to determine which ID System Disk uses for your model.  Then edit the
appropriate <tt>OFpt</tt> resource.
<p>
Alternatively (and more dangerously), you can hand-edit the
<tt>nvramrc</tt>.  This is dangerous, because the forth syntax is
<i>very</i> picky (particularly about white space presence or
absence).  If you're planning to edit your <tt>nvramrc</tt> you might want
to temporarily change to using a serial console so you can just paste in
whatever patches you want.  Look at the <a href="nvedit.html"><tt>nvedit</tt>
HOW-TO</a> for a list of commands available.
<p>
Note that some systems appear to be worse off with the System Disk patches
than without them.  If you think this is the case, then disable the
<tt>nvramrc</tt>:
<pre>0 &gt; <b>setenv use-nvramrc? false</b></pre>
<p>
Note: <i>zapping your PRAM <tt>Command-Option-P-R</tt> will erase any
settings you have made to Open Firmware.</i>
<p>
Note 2: <i>Booting your OF 1.0.5 system into MacOS will erase any settings
you have made to Open Firmware.</i>
<p>
Note 3: <i>In some extreme cases, you may have messed up your Open
Firmware settings such that your system won't boot anymore.  Zapping the
PRAM doesn't fix it.  In this case, you will need to unplug your system
and remove the battery from your motherboard for about 10 minutes.  On a
PowerBook, the equivalent is to reset your power manager.</i>

<ENTRY>ofw-claim-failed <tt>CLAIM failed</tt>

This is a general message from Open Firmware to the effect that it failed
to allocate some memory.  There are several known causes for this to
happen.
<p>
This often means that the memory is messed up.  If you tried something and
it failed, then you tried another and got a "CLAIM failed" message, then
this is an indication that you should reboot between attempts (the OF
command is "reset-all").

<p>If your machine is Open Firmware version 1.0.5 or 2.X, this error
does sometimes appear randomly.  You might try the boot command a second
time (this is
known to work on some models).  Otherwise, if you are not
using a serial console, there might be a conflict between the screen
driver and Open Firmware which prevents OF from loading
ofwboot.xcf.  There are several models that cannot be booted while
using the screen and keyboard.  The
only known workaround is to use a serial console (i.e. set your input and
output devices to ttya or ttyb).  You can use the System
Disk utility (see the <a href="SystemDisk-tutorial/">tutorial</a>)
to set the input and output to ttya, or in Open Firmware,
type: 
<pre>0 &gt; <b>setenv input-device ttya</b>
0 &gt; <b>setenv output-device ttya</b>
0 &gt; <b>reset-all</b></pre>
<p>
This will reset the machine and send console messages out the modem port
at 38400 bits per second, 8 bit bytes, 1 stop bit and no parity.

<ENTRY>default-catch <tt>DEFAULT CATCH!</tt>
If your machine is Open Firmware version 1.0.5 or 2.X, this error
does sometimes appear randomly.  You might try the boot command a second
time (this is
known to work on some models).  Otherwise, if you are not
using a serial console, there might be a conflict between the screen
driver and Open Firmware which prevents OF from loading
ofwboot.xcf.  There are several models that cannot be booted while
using the screen and keyboard.  The
only known workaround is to use a serial console (i.e. set your input and
output devices to ttya or ttyb).  You can use the System
Disk utility (see the <a href="SystemDisk-tutorial/">tutorial</a>)
to set the input and output to ttya, or in Open Firmware,
type: 
<pre>0 &gt; <b>setenv input-device ttya</b>
0 &gt; <b>setenv output-device ttya</b>
0 &gt; <b>reset-all</b></pre>
<p>
This will reset the machine and send console messages out the modem port
at 38400 bits per second, 8 bit bytes, 1 stop bit and no parity.

<ENTRY>ofw-load-base What's the deal with the "load-base" setting?
The Open Firmware environment variable <tt>load-base</tt> is the address
at which an XCOFF binary will be loaded into memory.  The default value in Open
Firmware 1.0.5 and 2.X is 4000.  If this address is used, then
<tt>ofwboot.xc</tt>f will overwrite Open Firmware and will not load
NetBSD.  We reccommend a <tt>load-base</tt> of 600000 for Open Firmware
1.0.5 and 2.X machines, which is in a safe address range.  Apple realized
they have the same problem with MacOS X, and running the <a
href="SystemDisk-tutorial/">System Disk</a> utility will automatically set
OF 1.0.5 and 2.X machines to use a <tt>load-base</tt> of 600000.  Note
that mkLinux uses a different <tt>load-base</tt>, don't try their setting.
<p>
Open Firmware 3 machines have re-writable firmware, and users have found
that setting the <tt>load-base</tt> to 600000 will overwrite their firmware,
rendering their machines dead (requiring an expensive trip back to
Apple).  <b>Do not change the <tt>load-base</tt> on an Open Firmware 3
machine.</b>  Apple has also chosen a more reasonable default value of
<tt>load-base</tt> in Open Firmware 3, so it's not necessary to change it
anyways.
<p>
You should only need to set the load-base when you are booting ofwboot.xcf
directly from Open Firmware.  Note that installboot and the NetBSD
installer do <i>not</i> set up filesystems to contain
<tt>ofwboot.xcf</tt>.  These filesystems have a fake Apple Partition Map
entry with <tt>ofwboot</tt> in the partition map.  This variant of the
bootloader does not have any of these problems associated with
<tt>ofwboot.xcf</tt>.  So, when you are using, for example,
<tt>scsi/sd@0:0</tt> or <tt>fd:0</tt> as a boot device, you are not using
<tt>ofwboot.xcf</tt> and do not need to set your <tt>load-base</tt>.
<p>
Once you are entirely positive that your machine has Open Firmware 1.0.5
or 2.X (see <a href="#ofw-version">above</a>), run the following command
to set your <tt>load-base</tt> properly
(remember, System Disk will do this automatically):

<pre>0 &gt; <b>setenv load-base 600000</b></pre>

You should double-check that this value has been set using the
<tt>printenv</tt> command.

<ENTRY>cant-open <tt>can't OPEN</tt>
Open Firmware either can't open the device you specified (because it is not
present or the device path is mistyped) or the file you specified. Check
your typing and check to make sure that the media has the files you think
it has. 

<ENTRY>formatstate-not-valid <tt>unrecognized Client Program formatstate not valid</tt>
This is a general Open Firmware error message indicating that the filename
you tried to open either doesn't exist or is in the wrong format. For
Open Firmware 1 and 2 machines, it must be an XCOFF file (such as
<tt>ofwboot.xcf</tt>)
and for Open Firmware 3 machines, it must be either XCOFF or ELF (such as
a kernel).

<ENTRY>bad-partition <tt>bad partition number, using 0no bootable HFS partition</tt>
You tried booting an Open Firmware 1.x or 2.0.x machine from a device
which has an HFS filesystem on it (such as a hybrid CD-R or a hard drive
with MacOS partitions). 

<ENTRY>ofw-real-base What's the deal with the "real-base" setting
The Open Firmware environment variable <tt>real-base</tt> is the address
at which <tt>ofwboot</tt> loads the kernel into memory.  Many users have
reported that the default value of <tt>real-base</tt> causes problems that
manifest themselves as strange SCSI problems, or <tt>ofwboot</tt> hanging
while loading a large kernel (typically over 3 MB in size).
Makoto Fujiwara
<a href="http://mail-index.netbsd.org/port-macppc/2000/08/13/0004.html">
reports</a> that changing the <tt>real-base</tt> will fix this problem.
<p>
Open Firmware 3 machines have re-writable firmware, and users have found
that changing the <tt>real-base</tt> will overwrite their firmware,
rendering their machines dead (requiring an expensive trip back to
Apple).  <b>Do not change the <tt>real-base</tt> on an Open Firmware 3
machine</b>.  In any case, OF 3 does a much better job of dealing with
large kernels, so this is not really an issue.
<p>
Once you are entirely positive that your machine has Open Firmware 1.0.5
or 2.X (see <a href="#ofw-version">above</a>), run the following commands
to set your <tt>real-base</tt> properly (note, System Disk will <b>not</b>
set this variable properly -- you will need to re-set your
<tt>real-base</tt> after each use of System Disk):
<pre>0 &gt; <b>setenv real-base F00000</b>
0 &gt; <b>reset-all</b></pre>
<p>
You should double-check that this value has been set using the
<tt>printenv</tt> command.
<p>
A workaround for this problem is that you can build a kernel that is less
than 3 MB in size.  Since none of the OF 1.0.5 or 2.X models have
built-in USB, and unless you have a PCI USB interface, you can 
build a kernel without any USB drivers.


<ENTRY>ofw-auto-boot How can I make my machine enter Open Firmware automatically at startup without having to type anything?

In Open Firmware, type:

<pre>0 &gt; <b>setenv auto-boot? false</b></pre>

<p>This will last until you change that variable back to "true", or
reset the machine's PRAM.


<ENTRY>ofw-boot-keys Are there any other magic keys to change the boot sequence?

Besides the familiar Command-Option-P-R to reset the PRAM (which will
erase your Open Firmware settings), and the
slightly-less-familiar Command-Option-Shift-Delete to boot from the
first bootable device other than the normal boot device, on some
machines you can also hold down "C" to boot off the internal CD-ROM
drive, "N" to net boot, "Z" to boot from an internal Zip drive, or "D"
for force booting from the internal disk if the default boot device
has been set to something else. (These are referred to as "snag keys"
in Apple's literature.)

<p>These actually use the "cd", "enet", "zip", and "hd" devaliases in
Open Firmware, respectively, so changing the aliases will change the
effects of these keys. Some models do not support all of the keys.


<ENTRY>ofw-misc What else can I do in Open Firmware?

A few useful commands are:

<table>
<tr><td><code>bye</code></td><td>Boot Mac OS (on OF &lt; 3.0)</td></tr>
<tr><td><code>mac-boot</code></td><td>Boot Mac OS (on OF &gt; 3.0)</td></tr>
<tr><td><code>boot</code></td><td>Boot the default OS</td></tr>
<tr><td><code>boot&nbsp;...</code></td><td>Specify what to boot</td></tr>
<tr><td><code>eject&nbsp;fd</code></td><td>Eject the floppy disk</td></tr>
<tr><td><code>reset-all</code></td><td>Reset, as though you'd pressed the reset button</td></tr>
<tr><td><code>shut-down</code></td><td>Power down the machine</td></tr>
</table>

<p>Also, you can use the up and down arrow keys to pick previous Open Firmware 
commands you've typed in, as well as emacs/tcsh-style control keys for editing
(such as <tt>^A ^E ^F ^B ^N ^P ^K ^U</tt>).

<p> For more details on basic Open Firmware commands, see

<a
href="http://developer.apple.com/technotes/tn/tn1061.html">"Technote
1061 - Fundamentals of Open Firmware, Part I: The User Interface"</a>
and <a
href="http://developer.apple.com/technotes/tn/tn1062.html">"Technote
1062 - Fundamentals of Open Firmware, Part II: The Device Tree"</a>


<SECTION>Booting

<ENTRY>boot-support What are the supported ways of booting NetBSD/macppc?

NetBSD/macppc uses Open Firmware to boot, so you can boot NetBSD
from any device that you can boot MacOS from. This includes all variety of
SCSI
and IDE drives (with supported controllers), internal floppies, and
CD-ROMs. (The <a href="../../Sites/cdroms.html#netbsdmissionrelease">NetBSD
Mission 1.5 Release CD-ROM</a> is macppc-bootable.)

<p>You can also boot NetBSD (or MacOS for that matter) off the network,
if your ethernet hardware supports Open Firmware booting. The built-in
ethernet on all supported models is capable of netbooting.
Asante makes an Open Firmware-compliant PCI
ethernet card (the 10NIC PCI), but it's not clear that this card is
supported by NetBSD after you boot it.  There are some Adaptec PCI SCSI
cards with which can boot NetBSD.  See 
<a href="#boot-pci">below</a> for info on booting from a PCI card.

<p>You cannot boot from SCSI drives attached to non-Macintosh SCSI
cards, or non-bootable Macintosh SCSI cards, even if the SCSI card is
supported by NetBSD. Open Firmware also does not support booting off
any USB devices on the earlier machines with built-in USB.  It should be
possible to boot from a USB hard drive on the newer machines, although no
one has tried.

<p>
To add to the confusion, the NetBSD kernel is loaded in anywhere from one
to three stages, each requiring additional setup.

<table border=1>
<tr><td>stage name</td><td>OF 1.0.5 and 2.0.X</td><td>OF 2.4</td><td>OF 3</td>
<td>function</td></tr>

<tr><td><tt>bootxx</tt></td>
<td>yes (optional)</td>
<td>yes (optional)</td>
<td>no</td>
<td>simple first stage bootloader placed in partition "zero" of a disk to
load <tt>ofwboot.xcf</tt><br>
In its current incarnation, this takes the place of the Apple
Partition Map, meaning you can't share a MacOS and NetBSD drive
using <tt>bootxx</tt></td></tr>

<tr><td><tt>ofwboot.xcf</tt></td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>necessary bootloader (loaded from filesystem OF understands,
<tt>bootxx</tt>, or over ethernet) that understands NetBSD filesystem and
disklabel and can load the ELF kernel (or a gzip'ed kernel)</td></tr>

<tr><td><tt>ofwboot.elf</tt></td>
<td>no</td>
<td>no</td>
<td>yes (optional)</td>
<td>optional bootloader (loaded from filesystem OF understands or
over ethernet) that understands NetBSD filesystem and disklabel and
can load the ELF kernel (or a gzip'ed kernel)</td></tr>

<tr><td><tt>netbsd</tt></td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>the kernel, needed to run NetBSD.  Loaded by
<tt>ofwboot.xcf</tt> or <tt>ofwboot.elf</tt>.  On OF 3 machines, OF can
load the kernel directly from any filesystem it understands or over
ethernet</td></tr>
</table>

<p>
What makes all this necessary is that no version of Open Firmware
understands the filesystem that NetBSD uses.  This means that you need to
have your system set up such that the necessary files are placed in
filesystems that Open Firmware understands.
<p>
<table border=1>
<tr><td>filesystem type</td><td>OF 1.0.5 and 2.0.X</td><td>OF 2.4</td><td>OF 3</td>
<td>comment</td></tr>

<tr><td>"partition zero"</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>This is where <tt>bootxx</tt> is placed.  Currently, <tt>bootxx</tt>
doesn't support OF 3 machines</td></tr>

<tr><td>ethernet</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>See <a href="../../Documentation/network/netboot/">The Diskless
HOW-TO</a> for more info</td></tr>

<tr><td>ISO 9660</td>
<td>yes</td>
<td>yes</td>
<td>no</td>
<td>Standard CD-ROM format.  See <a href="#boot-cd">below</a> for more
info</td></tr>

<tr><td>floppy</td>
<td>yes</td>
<td>maybe</td>
<td>no</td>
<td>OF 3 machines don't ship with floppy drives.  OF 2.4 machines
have been reported to have problems booting from floppies.
See <a href="#write-floppy">below</a> for tips on how to write a
floppy image.</td></tr>

<tr><td>MS-DOS</td>
<td>yes</td>
<td>yes</td>
<td>yes</td>
<td>Note, however, that the bootloaders <tt>ofwboot.xcf</tt> and
<tt>ofwboot.elf</tt> do not understand MS-DOS filesystems and can't load a
kernel on a MS-DOS filesystem.</td></tr>

<tr><td>HFS and HFS+</td>
<td>no</td>
<td>yes</td>
<td>yes</td>
<td>Note, however, that NetBSD doesn't understand HFS filesystems, and if
you place a bootloader or kernel there, you can't upgrade it without using
MacOS or <a
href="ftp://ftp.netbsd.org/pub/NetBSD/packages/pkgsrc/sysutils/hfsutils/README.html">
hfsutils</a></td></tr>
</table>
<p>


Hopefully this clarifies it for you.



<ENTRY>boot-disk How do I make a disk bootable, and what are the Open Firmware commands to boot from it?

This depends entirely on what version of Open Firmware your machine
has.  See <a href="#ofw-version">above</a> for info on determining which
version of OF your machine has.
<p>

<ul>
<li><h4>OF 1.0.5 and 2.0.X:</h4> These versions of OF only support booting
an XCOFF binary from the following:  ISO 9660 disks, MS-DOS disks,
network, and
"whole" disks (partition "0").  For the latter option, there is a very
simple <tt>bootxx</tt> program that will load the second stage bootloader 
(<tt>ofwboot.xcf</tt>).  The <tt>bootxx</tt> bootloader must be installed
in the same
location as the MacOS partition table.  This, of course, makes it
impossible to use share NetBSD "whole" disks with MacOS.
<p>
NetBSD/macppc has a special XCOFF bootloader to load the ELF kernel.  
You need to make sure that OF uses the same "load-base" as the XCOFF
bootloader is expecting.  This is set by typing (in OF)
"<tt>setenv&nbsp;load-base&nbsp;600000</tt>".
To get OF to load this XCOFF program, you need to do one of the following:
<p>

<ul>
<li>Follow the <a href="../../Documentation/network/netboot/">Diskless
HOW-TO</a> and load <tt>ofwboot.xcf</tt> over the network<br>
<tt>boot&nbsp;enet</tt>
<p>

<li>Install <tt>bootxx</tt> and <tt>ofwboot</tt> using the
<tt>installboot</tt> program (the
NetBSD/macppc installer will do this automatically).  To do this
manually from within NetBSD/macppc:<br>
<tt>cp /usr/mdec/ofwboot </tt><em>bootfile</em><br>
<tt>/usr/mdec/installboot </tt><em>bootfile</em><tt> /usr/mdec/bootxx
</tt><em>bootdev</em>
<p>

where <em>bootfile</em> is a path to the file "<tt>/boot</tt>" on
the root filesystem of the disk you want to make bootable, and
<em>bootdev</em> is the raw device node for the device containing that
file.
<p>

So if you have booted off floppy or network, and have the
filesystem (say it's sd0) mounted on /mnt, you would do:

<pre>
	cp /usr/mdec/ofwboot /mnt/boot
	/usr/mdec/installboot /mnt/boot /usr/mdec/bootxx /dev/rsd0a
</pre>
<p>

Note that since installboot needs access to both the raw device and
the mounted filesystem, it is only possible to run it in single-user
mode, or from an "options INSECURE" kernel.
<p>

<li>Copy <tt>ofwboot.xcf</tt> to the top level of an ISO 9660 format
CD-R.  To load it from an ISO 9660-formatted SCSI
CD-ROM drive, you might use something like:<br>
<tt>boot&nbsp;scsi/sd@3:0,ofwboot.xcf</tt>
<p>

See <a href="#boot-cd">below</a> for more detail.
<p>

<li>Have <tt>bootxx</tt> and <tt>ofwboot.xcf</tt> located on a floppy
disk (such as the NetBSD/macppc install floppy)<br>
<tt>boot fd:0</tt>

<li>Have <tt>ofwboot.xcf</tt> located on a DOS format floppy disk<br>
<tt>boot fd:1,ofwboot.xcf -a</tt><br>
Note that ofwboot does <i>not</i> know how to load files from a
DOS filesystem (such as the kernel).
</ul>
<p>
</li>

<li><h4>OF 2.4:</h4> This version of OF only supports booting and XCOFF
image from the following: HFS and HFS+ disks, ISO 9660 disks, MS-DOS
disks, and
network.  You cannot use the same <tt>installboot</tt> program that is
used for earlier versions of OF.
<p>NetBSD/macppc has a special XCOFF bootloader that will load the ELF
kernel.  
You need to make sure that OF uses the same "load-base" as the XCOFF
bootloader is expecting.  This is set by typing (in OF)
"<tt>setenv&nbsp;load-base&nbsp;600000</tt>".
To get OF to load this XCOFF program, you need to do one of the
following:
<p>

<ul>
<li>Follow the <a href="../../Documentation/network/netboot/">Diskless
HOW-TO</a> and load <tt>ofwboot.xcf</tt> over the network<br>
<tt>boot&nbsp;enet:0</tt>
<p>

<li>Copy <tt>ofwboot.xcf</tt> to the top level of a MacOS formatted
drive on a HFS or HFS+ format partition (make sure you transfer it in
binary mode).
<p>

<li>Copy <tt>ofwboot.xcf</tt> to the top level of an ISO 9660 format
CD-R.
<p>

See <a href="#boot-cd">below</a> for more detail.
<p>

<li>Have <tt>ofwboot.xcf</tt> located on a DOS format floppy disk<br>
<tt>boot fd:1,ofwboot.xcf -a</tt><br>
Note that ofwboot does <i>not</i> know how to load files from a
DOS filesystem (such as the kernel).
</ul>
<p>
</li>

<li><h4>OF 3.0 and later:</h4> This version of OF only supports
loading ELF binaries from the following: HFS and HFS+ disks,
MS-DOS disks, and network.  
<p>
NetBSD/macppc has a special ELF bootloader that will load the kernel.  
Also, these machines support support loading the ELF kernel directly, To
get OF to load this ELF program, you need to do one of the following:
<p>

<ul>
<li>Follow the <a href="../../Documentation/network/netboot/">Diskless
HOW-TO</a> and load <tt>ofwboot.elf</tt> or <tt>netbsd</tt> over the
network<br>
<tt>boot&nbsp;enet:0</tt>
<p>

<li>Copy <tt>ofwboot.elf</tt> or <tt>netbsd</tt> to the top level of a
MacOS formatted
drive on a HFS or HFS+ format partition (make sure you transfer it in
binary mode)<br>
<tt>boot hd:,ofwboot.elf</tt>
<p>

<li>Copy <tt>ofwboot.elf</tt> and <tt>netbsd</tt> to the top level of a
hybrid HFS/ISO 9660 format CD-R<br>
<tt>boot cdrom:ofwboot.elf</tt>
<p>
See <a href="#boot-cd">below</a> for more detail.
</ul>
</li>

</ul>

<ENTRY>autoboot How do I set up Open Firmware to always boot into NetBSD?
First, you need to figure out what Open Firmware commands you need to boot
NetBSD.  Next you need to set up the Open Firmware variables with those
commands.  Lastly, you need to test it.
<p>
See <a href="#boot-support">above</a> or the INSTALL notes to figure out
your OF commands.
<p>
You can set the OF variables either from the OF command line or from a
MacOS utility such as System Disk.  See the <a
href="SystemDisk-tutorial/">System Disk Tutorial</a> for info on setting
that up.  If you're manually setting up your variables from the OF command
line, you'll need to use the "<tt>setenv</tt>" command to set the
following variables with the appropriate values (not all of which you
will need):
<p>
<table border=1>
<tr><td><tt>auto-boot?</tt></td><td><tt>true</tt></td></tr>
<tr><td><tt>boot-device</tt></td><td>the device to boot from
  (e.g. <tt>enet:0</tt>)</td></tr>
<tr><td><tt>load-base</tt></td><td><tt>600000</tt> (see <a
  href="#ofw-load-base">above</a>, <strong>Do not set for OF
  3</strong>)</td></tr>
<tr><td><tt>real-base</tt></td><td><tt>F00000</tt> (see <a
  href="#ofw-real-base">above</a>, <strong>Do not set for OF
  3</strong>)</td></tr>
<tr><td><tt>boot-file</tt></td><td>file OF loads,
  such as <tt>ofwboot.xcf</tt><br>
  if using "whole disk" <tt>bootxx</tt> method, use <tt>netbsd</tt></td></tr>
<tr><td><tt>use-nvramrc?</tt></td><td><tt>true</tt>, if you have 
  created a nvram script</td></tr>
<tr><td><tt>boot-command</tt></td><td><tt>wBoot</tt>, if you
  have set up a delayed boot for your HD to spin up</td></tr>
<tr><td><tt>input-device</tt></td><td><tt>kbd</tt>, if you
  didn't set it up before</td></tr>
<tr><td><tt>output-device</tt></td><td><tt>screen</tt>, if you
  didn't set it up before</td></tr>
</table>
<p>
When you're done, you should check that your values are correct with the
"<tt>printenv</tt>" command.  Now type <tt>reset-all</tt>, and if
everything's right, it will reboot into NetBSD, otherwise it'll fail and
drop into Open Firmware.

<ENTRY>common-of-probs Common Open Firmware Booting Problems
See info on <a href="#ofw-boot-serial">black monitors</a>,
<a href="#ofw-claim-failed"><tt>CLAIM failed</tt></a>,
<a href="#default-catch"><tt>DEFAULT CATCH!</tt></a>,
<a href="#ofw-load-base"><tt>load-base</tt></a>,
<a href="#cant-open"><tt>can't OPEN</tt></a>,
<a href="#formatstate-not-valid"><tt>unrecognized Client Program</tt></a>,
<a href="#bad-partition"><tt>bad partition number</tt></a>,
and <a href="#ofw-real-base"><tt>real-base</tt></a>.


<ENTRY>write-floppy How do I write the floppy image?
There are a number of ways to write a raw image to floppy disk:
<ul>
<li>Use dd(1) under NetBSD or another unix.
<li>Use rawrite.exe (as supplied with <a href="../i386/">NetBSD/i386</a>) 
  on a DOS/Windows machine.
<li>Use <a href="ftp://ftp.netbsd.org/pub/NetBSD/arch/macppc/floppy/README.rawdisk">suntar</a> 
  under MacOS.
</ul>

<p>Note that you can't just boot off this floppy like you would boot
off a MacOS floppy: you must boot into Open Firmware and then type
"<tt>boot fd:0</tt>".

<ENTRY>boot-pci How do I boot from a PCI card?
Some PCI cards have Open Firmware drivers and you can boot from them.  In
particular, Asante makes some ethernet cards with OF drivers and
most of Adaptec's SCSI cards have OF drivers.  Note, that just because a
card works in Open Firmware does not mean it's supported by NetBSD (and
vice versa).
<p>
The first step is to figure out what the PCI card is called in terms of
Open Firmware names.  Apple created aliases for the common devices
built-into their machines (such as scsi, hd, and enet).  Third parties
(i.e. makers of PCI cards) cannot do this.  You can get a list of all of
the devices with Open Firmware drivers by typing at the OF prompt:<br>
<tt>0 &gt; <b>dev / ls</b></tt>
<p>Now, it's just a matter of figuring out what your device is
called.  Usually the vendor name is embedded in the name of the device,
such as <tt>/pci/pci-bridge@d/ADPT,2930@3</tt> (which has ADPT signifying
this is an Adaptec product, and the model number is 2930).
<p>
Next, you need to make sure your device is bootable.  It needs the
Open Firmware "word" <tt>open</tt>.  You can find this out by looking at
the OF "words" this device supports:<br>
<tt>0 &gt; <b>dev /pci/pci-bridge@d/ADPT,2930@3</b><br>
0 &gt; <b>words</b></tt>
<p>
If the "open" word is present in this list, then your device should be
bootable from Open Firmware.  You'd need to boot with something like the
following:<br>
<tt>0 &gt; <b>boot /pci/pci-bridge@d/ADPT,2930@3/@5:0</b></tt><br>
where the 5 is the SCSI ID of the drive you're attempting to boot from,
and 0 is the partition number.
<p>
Note, you can shorten the name <tt>/pci/pci-bridge@d/ADPT,2930@3</tt> to
<tt>/pci/@d/@3</tt> all that really matters is the address behind the at
sign.

<ENTRY>boot-net How do I set up netbooting?

See the <a
href="../../Documentation/network/netboot/">Diskless NetBSD
HOW-TO</a>.

<p>Mitchell Spector has also created a page containing a concise <a
href="http://www.enchantedlearning.com/tech/netbsd_imac.shtml">iMac-specific
netbooting information</a>.

<ENTRY>boot-cd How do I set up a bootable CD-ROM?
Create an ISO 9660 image with <tt>ofwboot.xcf</tt> and/or
<tt>ofwboot.elf</tt>
(depending on which version of Open Firmware your machine is) and a
<i>gunzip</i>ed kernel.  Be careful with some of the MacOS gunzip
programs, as they may extract the kernel as an ASCII file.  Place both the
ofwboot and kernel files are at the top level of the CD
(i.e. <tt>/</tt>).  You may also wish to place the other distribution
files on the CD for installation (such as base.tgz, etc.tgz, and so on).
<p>
Burn the CD.  Boot into Open Firmware.  From Open Firmware, boot your
machine from the CD.  Depending on which OF version, you may need a
different boot command.  For example:

<table cellpadding=5>
<tr><td><tt>boot scsi/sd@3:0,ofwboot.xcf -a</tt></td>
<td>for an OF 1.0.5 machine with CD on the "scsi" Open Firmware bus<br>
<i>Note: OF 1.0.5 cannot load <tt>ofwboot.xcf</tt> from a hybrid 
ISO/HFS CD, only pure ISO</i></td></tr>
<tr><td><tt>boot&nbsp;ata/atapi-disk:0,ofwboot.xcf&nbsp;-a</tt><br>
<tt>boot ide1/disk@0:0,ofwboot.xcf -a</tt></td>
<td> for an OF 2.0.X machine without a <tt>cd</tt> devailas</td></tr>
<tr><td><tt>boot cd:ofwboot.xcf -a</tt></td>
<td>for an OF 2.0.X or 2.4 machine</td></tr>
<tr><td><tt>boot cd:netbsd</tt><br>
<tt>boot cd:ofwboot.elf -a</tt></td>
<td>for an OF 3.0 machine<br>
<i>Note: OF 3 can only load from a hybrid HFS/ISO CD</i></td></tr>
</table>
<p>
When it prompts you for a kernel, type in <tt>netbsd</tt>
<p>
Alternatively, if this ends up being problematic, you can just burn the
boot floppy image directly to CD-ROM.  Note, this will only work with
machines that have Open Firmware 1.0.5 or 2.X (i.e. not OF 3.0 or
greater).  If you take this route, then do not specify
<tt>ofwboot.xcf</tt> as the filename.  Instead, you'll be using the zeroth
partition, as the bootxx bootloader has already been installed in this
filesystem image.  You'd use something like <tt>boot&nbsp;scsi/sd@3:0</tt>
or <tt>boot&nbsp;cd:0</tt>.
<p>



<ENTRY>grey-screen Why does the screen turn grey with a flashing question-mark when I try booting?
This means that your Open Firmware boot command is misformed and the
machine tries booting from the Open Firmware <tt>boot-device</tt>
environment variable.  The default value of this variable is to boot
MacOS.  The grey screen with the
flashing question-mark means that your machine is looking for a bootable
MacOS filesystem, but can't find one.
<p>
Reboot, re-enter Open Firmware and check your syntax carefully.


<ENTRY>black-lcd Why did my screen turn black during boot?
This is a bug.  The NetBSD kernel has turned off your backlight.  Turn up
the brightness on your PowerBook screen to fix this.
<p>
If you don't have a PowerBook, then your system has defaulted to using a
serial console.  See <a href="#ofw-boot-serial">above</a>.


<ENTRY>dash-a Why does the kernel always prompt me for the root device?
Various people have reported that they can't get their NetBSD/macppc
systems to boot unattended.  What happens is that Open Firmware loads the
kernel just fine, but the kernel can't seem to find the root device
(i.e. where the / filesystem is located).

<p>At the prompt, type in the device name for your root disk (usually
something like <tt>sd0a</tt> or <tt>wd0a</tt>), swap (usually something
like <tt>sd0b</tt> or <tt>wd0b</tt>), and filesystem type (usually
<tt>ffs</tt>, <tt>nfs</tt>, or <tt>cd9660</tt>). 

<p>
Until this situation is fixed, there is a workaround.  You need to 
<a href="../../Documentation/kernel/#how_to_build_a_kernel">
build a kernel</a> with the following setting:
<pre>#config		netbsd	root on ? type ? #to automatically detect root device
config		netbsd	root on sd0 type ffs #for SCSI disk
#config		netbsd	root on wd0 type ffs #for IDE disk
#config		netbsd	root on ? type nfs #for netboot
</pre>

where <tt>sd0</tt> is the name of the device with your root filesystem.


<ENTRY>bootx Can I use the Linux BootX utility to boot NetBSD/macppc?
No, although the BootX maintainer has said he will accept patches for
NetBSD support if someone else writes them. (See the <a
href="http://mail-index.netbsd.org/port-macppc/1999/03/12/0002.html">port-macppc
mail archives</a>.)
<p>
Note, this is entirely different than the Darwin BootX bootloader.

<ENTRY>bootx-darwin Can I use the Darwin/MacOS X BootX bootloader to boot NetBSD/macppc?
No, although it should be easier to port to NetBSD/macppc than the linuxppc
BootX, since the Darwin BootX uses Open Firmware.


<!-- ======================================== -->
<SECTION>Misc

<ENTRY>elf Where is <tt>ldconfig</tt>/<tt>ld.so.conf</tt>?

NetBSD/macppc uses ELF, so it does not have <tt>ldconfig</tt> or
<tt>ld.so.conf</tt>. See the <a
href="../../Documentation/elf.html">NetBSD ELF FAQ</a> for more
details.


<ENTRY>cross-compile How can I cross-compile from another NetBSD architecture?

First, build and install the cross/powerpc-netbsd package in the
packages collection.

To build a kernel, configure it as you normally would, and then build
it with:

<pre>
	make PATH=/usr/pkg/cross/powerpc-netbsd/bin:$PATH \ 
		MACHINE=macppc MACHINE_ARCH=powerpc depend all
</pre>

Cross-compiling userland is slightly more complicated. (XXX finish)

(XXX this should move to an MI FAQ)


<ENTRY>linux Can NetBSD/macppc run MkLinux or LinuxPPC binaries?
Almost! Work is in progress, and we already had some success with some 
binaries such as Netscape Navigator. Please check the Linux compatibility
for NetBSD/PowerPC
<a href="http://gizmo.minet.net:8080/emul_linux">status page</a> for
more information.


<ENTRY>macos Can NetBSD/macppc run MacOS binaries?
Well, some day someone might get <a
href="http://www.ibrium.se/linux/mac_on_linux.html">Mac-on-linux</a>
(for LinuxPPC) to work.  Meanwhile, try
<a href="http://www.uni-mainz.de/~bauec002/B2Main.html">Basilisk II</a>
or <a href="http://www.vmac.org">VMac</a>
both of which emulate a 68k Mac.


<ENTRY>macosx Can NetBSD/macppc run Darwin/MacOS X binaries?
No, although theoretically it should be possible.  The Darwin binaries are in
<tt>Mach-O</tt> format, which is a rarity, as most unix-like OSes use 
<tt>a.out</tt>, <tt>ELF</tt>, or <tt>XCOFF</tt> binaries. 

<ENTRY>keys What do the <img src="../../images/ports/macppc/icon-command.gif" width="13" height="13" alt="command key"> and <img src="../../images/ports/macppc/icon-option.gif" width="17" height="13" alt="option key"> icons mean (i.e. which are the "comma

nd" and "option" keys)?

Apple has some unusual keys on its keyboards that may confuse some people
(particularly with non-US keyboards).  The key with the
<img src="../../images/ports/macppc/icon-command.gif" width="13" height="13"
alt="command key"> symbol on it is commonly
referred to as the "Command" key.  Some keyboards also have an "open apple"
(<img src="../../images/ports/macppc/icon-open-apple.gif" width="13" height="15"
alt="open apple key">) on the
command key as well.  On non-US keyboards, the key with the
<img src="../../images/ports/macppc/icon-option.gif" width="17" height="13"
alt="option key"> symbol on
it is labeled as the "option" key on US keyboards.
<p>
Often, when you read Mac documentation, you'll see the instruction to hold
down "C-O-p-r" or some other variation.  This means you should hold down
the command and option keys in addition to the letters "p" and "r". 


<!-- ======================================== -->
</LIST>

<a href="">Up to <em>NetBSD/macppc Port Page</em></a>
<hr>

<DOCLINK>

<hr>
<address>
  <small>
  <a href="../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: faq.list,v 1.61 2001/04/10 07:13:14 mbw Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
