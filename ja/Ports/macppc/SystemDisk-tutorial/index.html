<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<title>NetBSD/macppc System Disk Tutorial</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h1>NetBSD System Disk Tutorial</h1>

<hr>
<p>

This is intended as a quick intro on how to use Apple's System Disk
utility to set up the Open Firmware on your PowerMacintosh computer for
use with NetBSD/macppc.  You can use this MacOS utility to do almost
everything you could from the Open Firmware command line, except with less
effort.  There is an older program called <a
href="ftp://ftp.netbsd.org/pub/NetBSD/arch/macppc/macos-utils/bootvars/">Boot
Variables</a> that has some additional options.  Boot Variables
does not, however, include any patches for buggy OF versions.  We
encourage you to use System Disk, unless your model 
<a href="../models.html#no.sysdisk">does not support System Disk</a>.
<p>

<ol>
  <li><big><b>Boot into MacOS</b></big>
      <p>
      You must be running MacOS 8.0 or higher.
      <p>
      If you don't have MacOS 8.0 or higher, you can simply download the 
      <a href="http://download.info.apple.com/Apple_Support_Area/Apple_Software_Updates/English-North_American/Macintosh/System/Mac_OS_8.1_Update/Disk_Tools_PPC.img.bin">Disk
      Tools PPC.img</a> from Apple's site.  This is a MacOS 8.1 boot
      floppy.  You can boot from this and swap floppies to get System Disk, or
      you can copy the files from this floppy onto a partition on your hard
      drive.
      <p>
      Note, for future reference, that any time you boot an older machine
      (i.e. OF 1.0.5) into MacOS, all of its Open Firmware settings (including
      the nvram) will be set to their default values. 
      <p>

  <li><big><b>Download</b></big>
      <p>
      <a href="ftp://ftp.apple.com/developer/macosxserver/utilities/SystemDisk2.3.1.smi.bin">ftp://ftp.apple.com/developer/macosxserver/utilities/SystemDisk2.3.1.smi.bin</a>
      <p>
      You may need to use StuffIt Expander (or some other utility) to
      convert that file from MacBinary format into the self-mounting disk image
      <p>

  <li><big><b>Mount the Self-Mounting Image and run System Disk</b></big>
      <p>
      Open the self-mounting image to mount it on your
      desktop, and locate the <tt>System Disk</tt> utility on the disk image.
      Run this program:
      <p>
      <img src="../../../images/ports/macppc/systemdisk1.gif"
       width="523" height="319" alt="screen shot of the System Disk utility">
      <p>

  <li><big><b>NVRAM Patches</b></big>
      <p>
      When you click the <tt>Save</tt> button, it installs any necessary nvram
      patches for your
      machine, except for a few minor fixes for PowerMacintosh 7300 -
      8600 machines related to
      video timing.  There are separate instructions for applying these 
      <a href="of105patch.html">OF 1.0.5 patches</a>.
      <p>

  <li><big><b>Advanced Options</b></big>
      <p>
      If it doesn't automatically select <tt>Power User (Open
      Firmware)</tt>, then manually select this.  Click on <tt>Advanced
      Options:</tt>
      <p>
      <img src="../../../images/ports/macppc/systemdisk2.gif"
       width="573" height="367" alt="screen shot of Advanced Options">
      <p>

  <li><big><b>Input Device/Output Device</b></big>
      <p>
      Note that if your built-in video supports Open Firmware, System Disk
      automatically determines which device names to use and
      selects those for display (even though your machine may otherwise
      default to using serial ports for Open Firmware).
      <p>
      These settings can manually be entered into Open Firmware by typing at
      the OF prompt:
      <p>
      <pre>        setenv input-device kbd
        setenv output-device screen</pre>
      <p>
      where <tt>kbd</tt> and <tt>screen</tt> are the appropriate device names
      or aliases for your particular <a href="../models.html">model</a>.  
      <p>
      If your machine has serial ports (<i>not USB serial adaptors</i>), 
      you can enter
      ttya for both <tt>input-device</tt> and <tt>output-device</tt> if you
      wish to use the modem port on your PowerMacintosh to interact with Open
      Firmware.
      <p>

  <li><big><b>Stop Boot at Open Firmware prompt</b></big>
      <p>
      Click on this button to directly interact with OF each time your
      machine is rebooted. This would mean
      you don't have to hold Command-Option-O-F every time you want to use
      Open Firmware.  This is equivalent to typing at the OF prompt:
      <p>
      <pre>        setenv auto-boot? false</pre>
      <p>

  <li><big><b>The Boot device entry</b></big>
      <p>
      This entry is, of course, to select which device to boot
      from.  This is equivalent to typing at the OF prompt, e.g.:
      <p>
      <pre>        setenv boot-device scsi/sd@0:0</pre>
      <p>
      Typical values to enter are:
      <p>

      <table border="2">
	<tr><th align="left"><tt>fd:0</tt></th>
	<td>floppy drive</td></tr>

	<tr><th align="left"><tt>enet:0</tt></th>
	<td>ethernet on &gt;OF 3.0 models</td></tr>

	<tr><th align="left"><tt>enet</tt></th>
	<td>ethernet on &lt;OF 3.0 models</td></tr>

	<tr><th align="left"><tt>scsi-int/sd@<font
	    color="#FF0000">3</font>:<font color="#00FF00">0</font></tt></th>
	<td>fast-narrow internal SCSI on early PCI
	    PowerMacs</td></tr>

	<tr><th align="left"><tt>scsi-ext/sd@<font
	    color="#FF0000">3</font>:<font color="#00FF00">0</font></tt></th>
	<td>external SCSI on later PowerMacs with more than one
	    SCSI bus</td></tr>

	<tr><th align="left"><tt>scsi/sd@<font color="#FF0000">3</font>:<font
	    color="#00FF00">0</font></tt></th>
	<td>SCSI (may be ambiguous on machines with more than one
	    SCSI bus)</td></tr>

	<tr><th align="left"><tt>ata/ata-disk@<font
	    color="#0000FF">0</font>:<font color="#00FF00">0</font><br>
	    ata/ATA-Disk@<font color="#0000FF">0</font>:<font
	    color="#00FF00">0</font><br>
	    ide0/disk@<font color="#0000FF">0</font>:<font
	    color="#00FF00">0</font><br>
	    ide1/disk@<font color="#0000FF">0</font>:<font
	    color="#00FF00">0</font><br>
	    hd:<font color="#00FF00">0</font><br>
	    cd:<font color="#00FF00">0</font><br>
	    zip:<font color="#00FF00">0</font></tt></th>
	<td>IDE drive.  It's unclear whether you can boot from
	    slave devices on earlier machines with built-in IDE</td></tr>
      </table>
      <p>

      The <font color="#FF0000">3</font> is for SCSI entries is the SCSI ID
      of the device you're going to boot from.  Traditionally, SCSI CD-ROMs
      are ID 3, internal hard drives are ID 0, and SCSI Zip disks are 5 or 6.
      <p>
      The <font color="#0000FF">0</font> is for IDE entries is the master or
      slave device (master is 0, slave is 1).  It is not clear whether you can
      boot from slave devices on earlier machines with built-in IDE.
      <p>
      The <font color="#00FF00">0</font> is the partition you're going to
      boot from.  For disks with NetBSD disklabels (such as one created by
      the 1.4.2 and earlier install tools or the distributed boot floppy), use
      0 as the "full disk".  For disks with an Apple partition map, use the
      partition number of your NetBSD partition (usually 5 or higher, as the
      first few are reserved for MacOS bootloaders).
      <p>
      Note that later machines will not boot from a "whole disk" partition,
      and need to find the bootloader or kernel on a HFS, MS-DOS, or ISO9660
      partition.
      <p>

  <li><big><b>Boot File</b></big>
      <p>
      This entry is for the name of the file you'll be booting.  You
      should almost always be using <tt>ofwboot.xcf</tt>, the
      NetBSD/macppc bootloader. This is used
      if you do not use the "whole disk" partition scheme (i.e. your kernel or
      bootloader is on a HFS, MS-DOS, or ISO9660 format partition).  This
      is equivalent to typing at the OF prompt:
      <p>
      <pre>        setenv boot-file ofwboot.xcf</pre>
      <p>
      
  <li><big><b>Save and reboot</b></big>
      <p>
      Click OK to accept your Advanced Options changes.  Click Save to write
      all your changes to the Open Firmware settings and to write the NVRAM
      patches.  Reboot.

</ol>
<p>

<hr>
<a href="../">Up to <em>NetBSD/macppc Port Page</em></a>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../../"><img
	src="../../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../../"><img
	src="../../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../../Ports/"><img
	src="../../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../../Ports/"><img
	src="../../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">Supported Architectures</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  www@NetBSD.ORG<br>
  $NetBSD: index.html,v 1.12 2001/05/21 01:43:17 mbw Exp $<br>
  <a href="../../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
