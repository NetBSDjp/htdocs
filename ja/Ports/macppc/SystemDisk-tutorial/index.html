<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<title>NetBSD/macppc System Disk Tutorial</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h1>NetBSD System Disk Tutorial</h1>

<hr>
<p>

This is intended as a quick intro on how to use Apple's System Disk
utility to set up the Open Firmware on your PowerMacintosh computer for
use with NetBSD/macppc.  You can use this MacOS utility to do almost
everything you could from the Open Firmware command line, except with less
effort.  There is an older program called <a
href="ftp://ftp.netbsd.org/pub/NetBSD/arch/macppc/macos-utils/bootvars/">Boot
Variables</a> that has some additional options.  Boot Variables
does not, however, include any patches for buggy Open Firmware versions.  We
encourage you to use System Disk, unless your model 
<a href="../models.html#no.sysdisk">does not support System Disk</a>.
<p>

<ol>
  <li><big><b>Boot into MacOS</b></big>
      <p>
      You must be running MacOS 8.0 or higher.
      <p>
      If you don't have MacOS 8.0 or higher, you can simply download the 
      <a href="http://download.info.apple.com/Apple_Support_Area/Apple_Software_Updates/English-North_American/Macintosh/System/Mac_OS_8.1_Update/Disk_Tools_PPC.img.bin">Disk
      Tools PPC.img</a> from Apple's site.  This is a MacOS 8.1 boot
      floppy.  You can boot from this and swap floppies to get System Disk, or
      you can copy the files from this floppy onto a partition on your hard
      drive.  You will need to use 
      <a href="http://til.info.apple.com/techinfo.nsf/artnum/n60353">Disk Copy 6.3.3</a>
      or later to write the Disk Tools image to a floppy (you can use 
      any MacOS 7.0.1 or later system, including pre-PowerPC (i.e. m68k) Macs).
      You cannot, however, simply dump the boot floppy image to a disk via 
      <tt>dd(8)</tt> or <tt>rawrite</tt>.
      <p>
      Note, for future reference, that any time you boot an older machine
      (i.e. Open Firmware 1.0.5) into MacOS, all of its Open Firmware settings 
      (including the nvram) will be set to their default values. 
      <p>

  <li><big><b>Download</b></big>
      <p>
      <a href="ftp://ftp.apple.com/developer/macosxserver/utilities/SystemDisk2.3.1.smi.bin">ftp://ftp.apple.com/developer/macosxserver/utilities/SystemDisk2.3.1.smi.bin</a>
      <p>
      You may need to use StuffIt Expander (or some other utility) to
      convert that file from MacBinary format into the self-mounting disk image.
      See <a href="http://www.stuffit.com/expander/notes.html">Aladdin Systems'
      help page</a>.
      <p>

  <li><big><b>Mount the Self-Mounting Image and run System Disk</b></big>
      <p>
      Open the self-mounting image to mount it on your
      desktop, and locate the <tt>System Disk</tt> utility on the disk image.
      Run this program:
      <p>
      <img src="../../../images/ports/macppc/systemdisk1.gif"
       width="523" height="319" alt="screen shot of the System Disk utility">
      <p>

  <li><big><b>NVRAM Patches</b></big>
      <p>
      When you click the <tt>Save</tt> button, it installs any necessary nvram
      patches for your machine, except for a few minor fixes for 
      PowerMacintosh 7300 - 8600 machines related to video timing and sync.  
      There are separate instructions for applying these 
      <a href="of105patch.html">Open Firmware 1.0.5 patches</a>.
      <p>

  <li><big><b>Advanced Options</b></big>
      <p>
      If it doesn't automatically select <tt>Power User (Open
      Firmware)</tt>, then manually select this.  Click on <tt>Advanced
      Options:</tt>
      <p>
      <img src="../../../images/ports/macppc/systemdisk2.gif"
       width="573" height="367" alt="screen shot of Advanced Options">
      <p>

  <li><big><b>Input Device/Output Device</b></big>
      <p>
      Note that if your on-board video supports Open Firmware, System Disk
      automatically determines which device names to use and
      selects those for display (even though your machine may otherwise
      default to using serial ports for Open Firmware).
      <p>
      These settings can manually be entered into Open Firmware by typing at
      the Open Firmware prompt:
      <p>
      <pre>        0 &gt; <b>setenv input-device kbd</b>
        0 &gt; <b>setenv output-device screen</b></pre>
      <p>
      where<tt>screen</tt> is the appropriate device name
      or aliase for your particular <a href="../models.html">model</a>'s
      on-board video or
      <a href="../faq.html#ofw-boot-video">video card</a>.
      <p>
      If your machine has serial ports (<i>not USB serial adaptors</i>), 
      you can enter <tt>ttya</tt> for both <tt>input-device</tt> and 
      <tt>output-device</tt> if you
      wish to use the modem port on your PowerMacintosh to interact with Open
      Firmware.  Some Performa models have an internal modem, so you'll need
      to use <tt>ttyb</tt> (the printer port).
      <p>

  <li><big><b>Stop Boot at Open Firmware prompt</b></big>
      <p>
      Click on this button to directly interact with Open Firmware each time 
      your machine is rebooted. This would mean
      you don't have to hold Command-Option-O-F every time you want to use
      Open Firmware.  This is equivalent to typing at the Open Firmware prompt:
      <p>
      <pre>        0 &gt; <b>setenv auto-boot? false</b></pre>
      <p>

  <li><big><b>The Boot device entry</b></big>
      <p>
      This entry is, of course, to select which device to boot
      from.  Basically, you're telling Open Firmware where to find the 
      initial bootloader (either the "partition zero" <tt>ofwboot</tt> or
      the XCOFF <tt>ofwboot.xcf</tt>).  This is equivalent to typing at the 
      Open Firmware prompt:
      <p>
      <pre>        0 &gt; <b>setenv boot-device scsi/sd@0:0</b></pre>
      <p>
      Typical values to enter are:
      <p>

      <table border="2">
	<tr><th align="left"><tt>fd:0</tt></th>
	<td>floppy drive with NetBSD install floppy</td></tr>

	<tr><th align="left"><tt>enet:0,\ofwboot.xcf</tt></th>
	<td>ethernet on &gt; Open Firmware 3.0 models</td></tr>

	<tr><th align="left"><tt>enet:,\ofwboot.xcf</tt></th>
	<td>ethernet on &lt; Open Firmware 3.0 models</td></tr>

	<tr><th align="left"><tt>scsi-int/sd@<font
	    color="#FF0000">3</font>:<font color="#00FF00">0</font></tt></th>
	<td>fast-narrow internal SCSI on early PCI
	    PowerMacs</td></tr>

	<tr><th align="left"><tt>scsi-ext/sd@<font
	    color="#FF0000">3</font>:<font color="#00FF00">0</font></tt></th>
	<td>external SCSI on later PowerMacs with more than one
	    SCSI bus</td></tr>

	<tr><th align="left"><tt>scsi/sd@<font color="#FF0000">3</font>:<font
	    color="#00FF00">0</font></tt></th>
	<td>SCSI (may be ambiguous on machines with more than one
	    SCSI bus)</td></tr>

	<tr><th align="left"><tt>ata/ata-disk@<font
	    color="#0000FF">0</font>:<font color="#00FF00">0</font><br>
	    ata/ATA-Disk@<font color="#0000FF">0</font>:<font
	    color="#00FF00">0</font><br>
	    ide0/disk@<font color="#0000FF">0</font>:<font
	    color="#00FF00">0</font><br>
	    ide1/disk@<font color="#0000FF">0</font>:<font
	    color="#00FF00">0</font><br>
	    hd:<font color="#00FF00">0</font><br>
	    cd:<font color="#00FF00">0</font><br>
	    zip:<font color="#00FF00">0</font></tt></th>
	<td>IDE drive with "partition zero" bootloader.  It's unclear whether 
            you can boot from
	    slave devices on earlier machines with on-board IDE</td></tr>

	<tr><th align="left"><tt>hd:,\ofwboot.xcf</tt></th>
	<td>Internal IDE hard drive on Open Firmware 3 system with 
            <tt>ofwboot.xcf</tt> located on an HFS partition.</td></tr>

      </table>
      <p>

      The <font color="#FF0000">3</font> is for SCSI entries is the SCSI ID
      of the device you're going to boot from.  Traditionally, SCSI CD-ROMs
      are ID 3, internal hard drives are ID 0, and SCSI Zip disks are 5 or 6.
      <p>
      The <font color="#0000FF">0</font> is for IDE entries is the master or
      slave device (master is 0, slave is 1).  It is not clear whether you can
      boot from slave devices on earlier machines with on-board IDE.
      <p>
      The <font color="#00FF00">0</font> is the partition you're going to
      boot from.  For disks with NetBSD disklabels (such as one created by
      the NetBSD install tools or the distributed boot floppy), use
      0 to load the "partition zero" bootloader.  For disks with an Apple 
      partition map, use the
      partition number of your NetBSD partition (usually 8 or higher, as the
      first few are reserved for MacOS bootloaders).
      <p>
      Note that machines with Open Firmware 3 will not boot from a "partition 
      zero" bootloader, and need to find the bootloader or kernel on an HFS, 
      MS-DOS, or ISO9660 partition or over ethernet.
      <p>

  <li><big><b>Boot File</b></big>
      <p>
      This entry is for the name of the kernel you'll be booting.  You
      should almost always be using <tt>netbsd</tt>, the NetBSD/macppc kernel.
      If you are installing NetBSD, you might be using the RAMdisk-based
      installation kernel <tt>netbsd.ram.gz</tt>.
      This is equivalent to typing at the Open Firmware prompt:
      <p>
      <pre>        0 &gt; <b>setenv boot-file netbsd.ram.gz</b></pre>
      <p>
      
  <li><big><b>Save and reboot</b></big>
      <p>
      Click OK to accept your Advanced Options changes.  Click Save to write
      all your changes to the Open Firmware settings and to write the NVRAM
      patches.  Reboot.

  <li><big><b>Fix some settings</b></big>
      <p>
      If your system has Open Firmware 1.0.5, 2.0.x, or 2.4, you need to run
      the following commands before you boot NetBSD:
      <p>
      <pre>        0 &gt; <b>setenv real-base F00000</b>
        0 &gt; <b>reset-all</b></pre>
      <p>
      These commands set the 
      <a href="../faq.html#ofw-real-base"><tt>real-base</tt></a>, then reboots
      the computer so the settings are permanently stored.

  <li><big><b>NVRAMRC causing problems</b></big>
      <p>There are some reports that the System Disk patches cause problems
      on a handful of models.  If this is the case, run the following commands
      from the Open Firmware prompt:
      <pre>        0 &gt; <b>set-default use-nvramrc?</b>
        0 &gt; <b>reset-all</b></pre>

</ol>
<p>

<hr>
<a href="../">Up to <em>NetBSD/macppc Port Page</em></a>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../../"><img
	src="../../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../../"><img
	src="../../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../../Ports/"><img
	src="../../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../../Ports/"><img
	src="../../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">Supported Architectures</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  www@NetBSD.ORG<br>
  $NetBSD: index.html,v 1.17 2001/12/26 22:09:01 mbw Exp $<br>
  <a href="../../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
