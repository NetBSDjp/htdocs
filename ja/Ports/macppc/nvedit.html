<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<meta http-equiv=content-type content="text/html; charset=iso-2022-jp">
<link rev="made" href="mailto:www@JP.NetBSD.ORG">
<title>NetBSD/macppc nvedit HOW-TO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h1>NetBSD/macppc nvedit HOW-TO</h1>

<hr>
<p>

このページは、 Open Firmware NVRAMRC の内容を編集するために必要なコマンド
についての、簡単な入門です。 NVRAMRC は、システムのリブートのたびに実行される、
永久に保持されるファイルです。通常、これは、ブート時のシステムの挙動を
修正するための FORTH コマンド群を含んでいます。 NVRAMRC
の内容の書き方について、さらなる情報は、
<a href="http://karchive.info.apple.com/article.html?artnum=60285">Apple
Network Server 500,700: Open Firmware Read Me</a> Technote
がよい出発点となります。
<p>
この NVRAMRC に影響を与えるコマンド群が Open Firmware に含まれます。
このコマンドは、 Open Firmware プロンプト (つまり、 <tt>0 &gt;</tt>
というプロンプト) から入力されます。 Open Firmware 設定すべてについて、
設定の変更後は、 <tt>reset-all</tt> コマンドを使ってマシンをリセット
することをおすすめします。
<p>

<table border=1 cellpadding=5>
<tr><td valign=top><tt>nvedit</tt></td>
<td>現在の nvramrc の内容の編集を開始します。一時的な
バッファーにファイルが残されている場合には、そのファイルの編集を
再開します。そうでなければ、 NVRAMRC の内容を一時的なバッファーに
コピーして、それの編集を開始します。</td></tr>

<tr><td valign=top><tt>nvstore</tt></td>
<td>一時的な nvram バッファーの内容を NVRAMRC に保存したうえで、
一時的なバッファーの内容を破棄します</td></tr>

<tr><td valign=top><tt>nvquit</tt></td>
<td>一時的な nvramrc バッファーの内容を、
NVRAMRC に書き込まずに破棄します</td></tr>

<tr><td valign=top><tt>nvrun</tt></td>
<td>一時的な nvram バッファーの内容を実行します</td></tr>

<tr><td valign=top nowrap><tt>nvalias
&lt;alias&gt; &lt;device-path-name&gt;</tt></td>
<td>指定したデバイスの別名を定義します (他の devaliases ではなく、
フルパスを使う必要があります) 、たとえば PowerMacintosh 7300 で<br>
  <tt>nvalias bsd-cd /bandit/gc/mesh/sd@3:0,\OFWBOOT.XCF</tt><br>
とすると、 `<tt>boot bsd-cd</tt>' とタイプすれば
<tt>ofwboot.xcf</tt> が CD-ROM ドライブからロードされるように
なります</td></tr>

<tr><td valign=top><tt>nvunalias &lt;alias&gt;</tt></td>
<td>デバイスの別名を NVRAMRC から削除します</td></tr>

<tr><td valign=top><tt>setenv use-nvramrc? &lt;value&gt;</tt></td>
<td>この &lt;value&gt; は、 <tt>true</tt> か <tt>false</tt> のいずれかです。
この環境変数は、マシンのリセットやリブートの都度
NVRAM の内容を実行するかどうかを定義します</td></tr>

</table>
<p>
<hr>
<p>
<i>注意: 一部の Open Firmware 1.0.5 のシステムでは、 <tt>nvalias</tt>
の設定に加えて System Disk のパッチを置けるだけの NVRAM 容量がありません。
<tt>nvalias</tt> は保存せずに
System Disk パッチを保存すべきかもしれません</i>。

<p>

Open Firmware の仕様として、 すべての Open Firmware の実装にはエディターが
組み込まれています。以下は、このエディターで使われるコマンドです。
いくつかのコマンドが emacs とよく似ていることに気づく方もいるでしょう。
ここでは、 <tt>C-x</tt> という表現を、
control キーと <tt>x</tt> キーを同時に押す意味に使います。
<p>

<table border=1 cellpadding=5>
<tr><td><tt>C-l</tt></td>
<td>ディスプレーを再描画します。</td></tr>

<tr><td><tt>C-k</tt></td>
<td>カーソル位置から行末までを消去します。</td></tr>

<tr><td><tt>C-n</tt></td>
<td>次の行に進みます。</td></tr>

<tr><td><tt>C-p</tt></td>
<td>前の行に戻ります。</td></tr>

<tr><td><tt>C-f</tt></td>
<td>一文字進みます。</td></tr>

<tr><td><tt>C-b</tt></td>
<td>一文字戻ります。</td></tr>

<tr><td valign=top><tt>C-c</tt></td>
<td>エディターを終了し、編集した内容を一時的なバッファーに保持します<br>
<i>注意: これは変更を NVRAMRC に保存<b>しません</b>、
<tt>nvstore</tt> を実行する必要があります</i></td></tr>

</table>
<p>

<b>汎用 nvramrc スクリプト</b>
<p>

ブートする前に (ハードドライブが動くまで) 待つようにするためには、
<a href="SystemDisk-tutorial/of105patch2.txt">下記のパッチ</a> を
nvramrc に追加します:

<pre>: wBoot
begin
 boot-device ['] $boot catch drop
 ." -Waiting for boot-device" cr
 d# 500 ms
key? until
;</pre>

それから <tt>nvstore</tt> を実行します。さらに、ブートコマンドの変更を
指示しなければなりません。 OF プロンプトで次のようにタイプします:<br>

<tt>0 &gt; <b>setenv boot-command wBoot</b></tt>
<p>

上記のかわりに、次のようにしてブートコマンドを変更することもできます:<br>

<tt>0 &gt; <b>boot-command begin ['] boot catch 999 ms cr again</b></tt>
<p>
初期の Open Firmware 1.0.5 の機種の一部では、この一行を使った方法では
動作しないとの報告があります。
<p>

<hr>
<a href="./">Up to <em>NetBSD/macppc Port Page</em></a>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
        src="/images/NetBSD-flag.gif" origlink="../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../"><img
        src="/images/empty.gif" origlink="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">ホームページ</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../Ports/"><img
        src="/images/NetBSD-flag.gif" origlink="../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td> 
    <a href="../../Ports/"><img
        src="/images/empty.gif" origlink="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">対応機種</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  www@JP.NetBSD.ORG<br>
  $NetBSD: nvedit.html,v 1.7 2001/08/15 19:02:17 dent Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
