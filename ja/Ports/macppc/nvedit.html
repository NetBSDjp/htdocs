<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.org">
<title>NetBSD/macppc nvedit HOW-TO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h1>NetBSD/macppc <tt>nvedit</tt> HOW-TO</h1>

<p>
<h3>Introduction</h3>
This page gives a quick introduction to the commands needed to edit the
contents of the Open Firmware NVRAMRC.  The NVRAMRC is a permanently
stored file that may be run at each reboot of your system.  Usually, it
holds a set of FORTH commands which modify the behavior of your system
during boot.  For more information on creating the contents of an NVRAMRC,
the <a href="http://docs.info.apple.com/article.html?artnum=60285">Apple
Network Server 500,700: Open Firmware Read Me</a> Technote is a good
place to start.
<p>
There is a set of commands within Open Firmware that deal with this
NVRAMRC.  These commands are entered from the Open Firmware prompt
(i.e. the <tt>0 &gt;</tt> prompt).  As with all Open Firmware settings, it
is best if you reset your machine after changing any settings using the
<tt>reset-all</tt> command.

<p>Modifying the NVRAMRC is pretty annoying, because the FORTH syntax is
<i>very</i> picky (particularly about white space presence or
absence) and the editor is very primitive.  You might want
to temporarily change to using a serial console so you can just paste in
whatever patches you want.

<h3>Commands</h3>
<p><table border=1 cellpadding=5>
<tr><td valign=top><tt>nvedit</tt></td>
<td>start the editor with the current nvramrc contents.  If
there is still a file in the temporary buffer, it resumes editing
that file.  Otherwise, it copies the NVRAMRC contents into the temporary
buffer and starts editing it. </td></tr>

<tr><td valign=top><tt>nvstore</tt></td>
<td>stores the temporary nvram buffer into NVRAMRC and discards
the contents of the temporary buffer</td></tr>

<tr><td valign=top><tt>nvquit</tt></td>
<td>discards the contents of the temporary nvramrc buffer
without writing to NVRAMRC</td></tr>

<tr><td valign=top><tt>nvrun</tt></td>
<td>executes the contents of the temporary nvram buffer</td></tr>

<tr><td valign=top nowrap><tt>nvalias
&lt;alias&gt; &lt;device-path-name&gt;</tt></td>
<td>defines an alias to the specified device (you must use the full path, 
not other devaliases), for example:<br>
  <tt>nvalias bsd-cd /bandit/gc/mesh/sd@3:0,\OFWBOOT.XCF</tt><br>
will let you type `<tt>boot bsd-cd</tt>' and it will load
<tt>ofwboot.xcf</tt> from the CD-ROM drive in a PowerMacintosh
7300</td></tr>

<tr><td valign=top><tt>nvunalias &lt;alias&gt;</tt></td>
<td>removes the device alias from the NVRAMRC</td></tr>

<tr><td valign=top><tt>setenv use-nvramrc? &lt;value&gt;</tt></td>
<td>where &lt;value&gt; is either <tt>true</tt> or <tt>false</tt>.  This
environment variable determines whether or not the contents of the NVRAM
are executed each time the machine is reset or rebooted</td></tr>

</table>
<p>
<i>Note: some Open Firmware 1.0.5 systems do not have enough NVRAM storage
for the System Disk patches in addition to a <tt>nvalias</tt> 
setting.  You should probably keep the System Disk patches instead of the
<tt>nvalias</tt></i>.

<p>
<h3><tt>nvedit</tt> Editor</h3>
As specified in the Open Firmware spec, there is an editor built into all
Open Firmware implementations.  These are the commands to use the
editor.  You may notice
that some of the commands are very similar to emacs.  We use <tt>C-x</tt>
to represent holding down the control key and the <tt>x</tt> key.
<p>

<table border=1 cellpadding=5>
<tr><td><tt>C-l</tt></td>
<td>refreshes the display</td></tr>

<tr><td><tt>C-k</tt></td>
<td>deletes from the cursor to the end of that line of text</td></tr>

<tr><td><tt>C-n</tt></td>
<td>moves to the next line of text</td></tr>

<tr><td><tt>C-p</tt></td>
<td>moves to the previous line of text</td></tr>

<tr><td><tt>C-f</tt></td>
<td>moves forward one character</td></tr>

<tr><td><tt>C-b</tt></td>
<td>moves back one character</td></tr>

<tr><td valign=top><tt>C-c</tt></td>
<td>exit the editor and store edited contents into a temporary buffer<br>
<i>note: this does <b>not</b> save the changes to the
NVRAMRC, you still need to run <tt>nvstore</tt></i></td></tr>

</table>
<p>

<H3>Example</h3>
Here is an example of an Open Firmware session entering a NVRAMRC patch (to
allow use of the Performa 5500 on-board video).
<tt><b>&lt;CR&gt;</b></tt> is the "return" or "enter" key and 
<tt><b>&lt;C-c&gt;</b></tt> is control-c.
<pre>0 &gt; <b>nvedit</b>
<b>cpoke 0a7 0f3000032
cpoke 093 0f3000033
cpoke 03e 0f300003a</b>
<b>&lt;C-c&gt;</b>
0 &gt; <b>nvstore</b>
0 &gt; <b>setenv use-nvramrc? true</b>
0 &gt; <b>reset-all</b>
</pre>


<hr>
<a href="./">Up to <em>NetBSD/macppc Port Page</em></a>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
        src="../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../Ports/"><img
        src="../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td> 
    <a href="../../Ports/"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Supported Architectures</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  www@NetBSD.org<br>
  $NetBSD: nvedit.html,v 1.13 2003/07/23 16:32:23 keihan Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1998-2003
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
