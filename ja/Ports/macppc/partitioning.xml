<?xml version="1.0" encoding="ISO-2022-JP"?>
<!DOCTYPE webpage
 PUBLIC "-//NetBSD//DTD Website-based NetBSD Extension//EN"
        "http://www.NetBSD.org/XML/htdocs/lang/share/xml/website-netbsd.dtd">

<webpage id="ja-Ports-macppc-partitioning">
<config param="desc" value="&os;/macppc パーティショニング howto"/>
<config param="cvstag" value="$NetBSD: partitioning.xml,v 1.1 2007/05/25 22:20:29 dsieger Exp $"/>
<!-- Based on english version: -->
<!-- NetBSD: partitioning.xml,v 1.1 2007/05/25 22:20:29 dsieger Exp   -->
<config param="rcsdate" value="$Date: 2007/05/25 22:20:29 $"/>
<head>

<!-- Copyright (c) 1998-2007
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->

<title>NetBSD/macppc パーティショニング HOW-TO</title>
</head>

<sect1 id="preface">
  <title>文書の概要</title>

  <para>
    この文書は、 4 個の部分に分かれています:
  </para>

  <orderedlist>
    <listitem><ulink url="#intro">はじめに (パーティションについて理解する)</ulink></listitem>
    <listitem>ディスクのパーティショニング
    <itemizedlist>
      <listitem><ulink url="#drive-setup">Drive Setup を使ったパーティショニング</ulink> (Mac OS 9)</listitem>
      <listitem><ulink url="#disk-utility">Disk Utility を使ったパーティショニング</ulink> (Mac OS X)</listitem>
      <listitem><ulink url="#pdisk"><code>pdisk</code> と <code>newfs</code>
      を使ったパーティショニング</ulink> (Mac OS 9, Mac OS X, Darwin, NetBSD,  Linux)</listitem>
    </itemizedlist>
    </listitem>
    <listitem><ulink url="#msdos">共有 MS-DOS ファイルシステムの作成</ulink></listitem>
    <listitem><ulink url="#nomenclature">パーティション命名規則</ulink></listitem>
  </orderedlist>

  <para>
    <emphasis>注意: Linux の <code>pdisk</code> コマンドは、 NetBSD/macppc 用のフラグを
    適切に設定しません。ディスクが Linux の <code>pdisk</code> を使って
    パーティション分割済みの場合は、 NetBSD の <code><ulink
    url="#pdisk">pdisk</ulink></code> を使い、パーティションを消してから
    NetBSD のルートおよびスワップパーティションを作り直す必要があります。</emphasis>
  </para>
</sect1>

<sect1 id="intro">
  <title>はじめに (パーティションについて理解する)</title>

  <para>
    この文書では、 NetBSD/macppc と Mac OS を使うためにディスクを分割する
    方法を詳しく説明します。お使いのマシンのあるディスクから
    あるオペレーティングシステムをブートできるかどうかは、そのマシンの
    <ulink url="faq.html#ofw-version">Open Firmware</ulink> のバージョンに依ります。
    全体としての目標は、 Open Firmware が理解することのでき (さらに、
    そこからブートでき) 、かつ、 NetBSD カーネルが理解することができて
    ルートパーティションとして使うことができるような Apple Partition Map を作成することです。
  </para>

  <para>
    4 個のディスク分割用のツールがあります: Apple の Drive Setup (Mac OS
    9)、 Apple の Disk Utility (Mac OS X)、 NetBSD の
    <ulink url="http://man.NetBSD.org/man/pdisk+8.macppc+NetBSD-current">
      <code>&man.pdisk.8;</code></ulink> (全 OS)、そして、 NetBSD の
      <ulink url="http://man.NetBSD.org/man/disklabel+8.macppc+NetBSD-current">
	<code>&man.disklabel.8;</code></ulink> (NetBSD/macppc のみ) です。最初の 2 個のツール
	(Drive Setup と Disk Utility) は Apple が Mac OS と共に配布しており、
	ブート可能な Mac OS インストール CD に含まれています。これらを使って、
	ディスクのパーティション分割、ファイルシステム作成、 Mac OS ブートローダー
	(Mac OS 用語ではディスクドライバー) のインストールをすることができます。
  </para>

  <para>
    <code>pdisk</code> プログラムはコマンドラインプログラムで、ほとんどの
    unix-like システム (特に、 PowerPC ベースの Macintosh や互換機で動くシステム)
    上でコンパイルおよび実行することができます。このプログラムでできることは、
    ディスクのパーティション分割だけです─ブートローダーのインストールや
    ファイルシステムの作成をすることはできません。
  </para>

  <para>
    NetBSD の <code>disklabel</code> は、 NetBSD 方式の
    <ulink url="http://man.NetBSD.org/man/disklabel+5.macppc+NetBSD-current">
      <code>&man.disklabel.5;</code></ulink> を作成します。上述の 3 種のツールとは異なり、
      これでできることは、疑似的な Apple Partition Map の作成だけです (それゆえ、
      この <code>disklabel</code> を使って Mac OS がブート可能なディスクを作ることはできません)。
      ですが、これで十分です。 Open Firmware の一部のバージョンでは、
      ブートローダーをインストールするのに <code>disklabel</code> を使う必要があります。
      なお、 <code>disklabel</code> は NetBSD インストーラーのパーティションツールとしても使われています。
  </para>

  <para>
    以下の表で、 "yes" はそのディスクがブート可能であることを、 "mount only" は OS
    がディスク上のパーティションのマウントは可能だがそこからのブートはできないことを、
    "no" は OS がパーティションのマウントもディスクからのブートもできないことを意味します。
  </para>

  <para>
    <emphasis role="bold">Open Firmware 1.0.5 または 2.0.x:</emphasis>
  </para>

  <informaltable>
  <tgroup cols="2">
    <tbody>
  <row><entry><emphasis role="bold">OS</emphasis></entry>
<entry><emphasis role="bold">Drive Setup</emphasis></entry>
<entry><emphasis role="bold">Disk Utility</emphasis></entry>
<entry><code><emphasis role="bold">pdisk</emphasis></code></entry>
<entry><code><emphasis role="bold">disklabel</emphasis></code></entry></row>

<row><entry><emphasis role="bold">NetBSD</emphasis></entry>
<entry>mount only</entry>
<entry>mount only</entry>
<entry>mount only</entry>
<entry>yes</entry></row>

<row><entry><emphasis role="bold">Mac OS 9</emphasis></entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>no</entry>
<entry>no</entry></row>

<row><entry><emphasis role="bold">Mac OS X および Darwin</emphasis></entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>no</entry></row>

<row><entry><emphasis role="bold">Linux</emphasis></entry>
<entry>yes</entry>
<entry>yes?</entry>
<entry>yes</entry>
<entry>no</entry></row>
    </tbody>
  </tgroup>
</informaltable>
<para><emphasis role="bold">Open Firmware 2.4 または 3:</emphasis></para>
<informaltable>
  <tgroup cols="2">
    <tbody>
<row><entry><emphasis role="bold">OS</emphasis></entry>
<entry><emphasis role="bold">Drive Setup</emphasis></entry>
<entry><emphasis role="bold">Disk Utility</emphasis></entry>
<entry><code><emphasis role="bold">pdisk</emphasis></code></entry>
<entry><code><emphasis role="bold">disklabel</emphasis></code></entry></row>

<row><entry><emphasis role="bold">NetBSD</emphasis></entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>no</entry></row>

<row><entry><emphasis role="bold">Mac OS 9</emphasis></entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>no</entry>
<entry>no</entry></row>

<row><entry><emphasis role="bold">Mac OS X および Darwin</emphasis></entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>yes</entry>
<entry>no</entry></row>

<row><entry><emphasis role="bold">Linux</emphasis></entry>
<entry>yes</entry>
<entry>yes?</entry>
<entry>yes</entry>
<entry>no</entry></row>
    </tbody>
  </tgroup>
</informaltable>

<para>
  Apple パーティションマップは、パーティション情報を、番号の付けられたリスト
  (通常はディスク上の場所の順序) の形で保持しています。最初のブートローダーが納まる
  パーティション "ゼロ" は Open Firmware 1.0.5 または 2.0.x の機種向けのものです。
  パーティションマップ自体はパーティション番号 1 です。 Mac OS 9 の入ったディスクでは、
  通常、パーティション 2 から 8 まではドライバー用に予約されています。
  ユーザーが定義したパーティション (HFS、 HFS+、 UFS、 NetBSD などなど) は、
  パーティション 9 (Mac OS 9 のディスク) または 2 (Mac OS 9 のないディスク) からになります。
</para>

<para>
  マシンを NetBSD/macppc でブートさせるためのコマンドを決める際に、
  Open Firmware は Apple パーティションマップの番号を使うことを留意しておいてください。
  <ulink url="#pdisk"><code>pdisk</code></ulink> を使うと、 Apple パーティションマップを、
  (どの方法で作られたパーティションマップであっても) プリントアウトできます。
</para>

<para>
  若干混乱を招いていますが、 NetBSD/macppc は、文字 'a' から 'h' という
  独自のパーティション命名規則を使っています。ルートパーティションは、
  (Apple パーティションマップの位置とは関係なく) パーティション 'a' になります。
  スワップパーティションはパーティション 'b' です。パーティション 'c' は、
  ディスク全体を表します。 '/usr' パーティションは (もしあれば) パーティション 'g' です。
  それ以外のパーティションは、残りの文字が充てられます。
</para>

<para>
  もっと筋道だった説明は、後述の
  <ulink url="#nomenclature">パーティション命名規則</ulink>の節を見てください。
</para>

<para>
  あなたが取り扱う可能性のあるファイルシステムは、実に多岐にわたります。
  簡単に説明しますと、 HFS は 80 年代から使われてきた Apple 旧来のファイルシステムです。
  HFS+ (「拡張」ファイルシステムともいう) は HFS の拡張版で、より大きな容量の
  ファイル (やファイルシステム) を使うことができ、 unix 的なファイル所有者や
  パーミッションを持つことができます。 HFS+ は、 Mac OS &gt;  8.1 (Mac OS X を含む)
  での推奨ファイルシステム型です。 UFS は、古き良き BSD FFS の、 NeXT 由来の
  Apple 版です。 MS-DOS (FAT ともいう) は、 MS-DOS/Windows プラットフォームで
  標準化されているファイルシステムです。 BSD FFS は、 80 年代からほとんどの
  BSD unix-like OS (NetBSD も含む) で使われてきた標準的なファイルシステムです。
  ext2fs は linux で最も一般的なファイルシステムです。
</para>

<para>
  他の OS と共有するパーティションを用意するかどうか、
  検討したい方もいるでしょう。もっとも互換性の高いフォーマットは MS-DOS FAT
  ですが、機能が足りません (パーミッションや、よい修復ツールなどです)。
  残念ながら NetBSD は Macintosh HFS および HFS+ システムをネイティブでは
  まだサポートしていません。 NetBSD-current では Apple の UFS を完全にサポートしています。
  以下に早見表を掲げます:
</para>

<informaltable>
  <tgroup cols="5">
    <tbody>
<row><entry>フォーマット</entry>
 <entry>Mac OS 8.1-9.x</entry>
 <entry>Mac OS X および Darwin</entry>
 <entry>NetBSD</entry>
 <entry>Linux</entry></row>
<row><entry>Apple HFS</entry>
 <entry>yes</entry>
 <entry>yes</entry>
 <entry>
<ulink url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/sysutils/hfsutils/README.html">hfstools</ulink>
 </entry>
 <entry>yes(1)</entry></row>
<row><entry>Apple HFS+</entry>
 <entry>yes</entry>
 <entry>yes</entry>
 <entry>no</entry>
 <entry>read-only(2)</entry></row>
<row><entry>Apple UFS</entry>
 <entry>no</entry>
 <entry>yes</entry>
 <entry>-current</entry>
 <entry>read-only</entry></row>
<row><entry>MS-DOS FAT</entry>
 <entry>File Exchange</entry>
 <entry>yes</entry>
 <entry>yes</entry>
 <entry>yes</entry></row>
<row><entry>BSD FFS</entry>
 <entry>no</entry>
 <entry>no</entry>
 <entry>yes</entry>
 <entry>read-only</entry></row>
<row><entry>Linux ext2fs</entry>
 <entry>no</entry>
 <entry>yes(3)</entry>
 <entry>yes</entry>
 <entry>yes</entry></row>
    </tbody>
  </tgroup>
</informaltable>

<para>1 - 安定している
<ulink url="http://www.mars.org/home/rob/proj/hfs/">hfsutils</ulink>、 または
実験的なカーネルサポートを使用します。
</para>
<para>2 - 実験的な
<ulink url="http://ftp.penguinppc.org/projects/hfsplus/">hfsplus</ulink> utils、
または実験的な
<ulink url="http://sourceforge.net/projects/linux-hfsplus">linux-hfsplus</ulink>
カーネルモジュールを使用します。</para>
<para>3 - 非常に実験的な
<ulink url="http://sourceforge.net/projects/ext2fsx/">Ext2 Filesystem</ulink>
カーネル拡張を使用します。</para>

<para>
  Mac OS 9 と共有可能なパーティションを作りたければ、 HFS
  パーティションを作り、あとで MS-DOS フォーマットへ変換するのがよいです。
  ディスクを分割してから<ulink url="#msdos">共有 MS-DOS ファイルシステムの作成</ulink>
  を見てください。
</para>

<para>
  Classic Mac OS のことは気にしないのであれば、おそらく UFS
  が最良の選択肢です。 Mac OS X か Darwin で UFS パーティションを作り、
  -current NetBSD を使うようにするだけです。 UFS は次の NetBSD
  メジャーリリースではサポートされる予定です (つまり 1.6.x 枝ではサポートされません)。
</para>

<para>
  パーティショニングは、ドライブの内容を消去しますので、
  分割しようとするディスクをすべてバックアップしてください。
  あなたが使おうとしているツールの説明に従ってください。
</para>

<itemizedlist>
<listitem><ulink url="#drive-setup">Drive Setup を使ったパーティショニング</ulink> (Mac OS 9)</listitem>
<listitem><ulink url="#disk-utility">Disk Utility を使ったパーティショニング</ulink> (Mac OS X)</listitem>
<listitem><ulink url="#pdisk"><code>pdisk</code> と <code>newfs</code>
 を使ったパーティショニング</ulink> (Mac OS 9, Mac OS X, Darwin, NetBSD,  Linux)</listitem>
<listitem><code>&man.disklabel.8;</code> は、 <ulink 
 url="ftp://ftp.NetBSD.org/pub/NetBSD/NetBSD-&release.latest;/macppc/INSTALL.html">
 NetBSD &release.latest; インストールノート</ulink>のやり方に従うと、 <code>sysinst</code>
 インストーラーが作成します。</listitem>
</itemizedlist>
</sect1>

<sect1 id="drive-setup">
  <title>Drive Setup を使ったパーティショニング (Mac OS 9)</title>

  <orderedlist>
    <listitem>
      <para>
	Drive Setup はバージョン 1.8.1 以降が必要です。このバージョンは
	Mac OS 9.0 に附属のバージョンです。バージョンがわからない場合は、
	(訳註: Finder で) Drive Setup を選び、 <code>File</code> メニューから
	<code>Get Info</code> します。
      </para>

      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/drive-setup.gif"
		     format="GIF" width="354" height="401" />
	</imageobject>
	<textobject><phrase>drive setup</phrase></textobject>
      </inlinemediaobject>

      <para>
	古いバージョンの Mac OS をお使いの場合、
	<ulink url="http://docs.info.apple.com/article.html?artnum=60791">Mac OS 
	9.0.4</ulink> (12.2 MB)、
	<ulink url="http://docs.info.apple.com/article.html?artnum=75103">Mac OS 9.1</ulink>
	 (71 MB)、
	<ulink url="http://docs.info.apple.com/article.html?artnum=120030">Mac OS
	9.2.1</ulink> (82 MB)、または
	<ulink url="http://docs.info.apple.com/article.html?artnum=75186">Mac OS 
	9.2.2</ulink> (21.3 MB) アップデートをダウンロードできます。
	これらには、使えるバージョンの Drive Setup が含まれています。
	これらは大きな Mac OS アップデートであり、 500 KB の Drive Setup
	アプリケーションの入手のために、メガバイト級のディスクイメージを
	ダウンロードする必要があることに注意してください。
	Apple は、最近のバージョンの Drive Setup を単体では提供していません。
      </para>

      <para>
	また、
	<ulink url="http://www.opensource.apple.com/projects/darwin/1.4/release.html">Darwin 
	インストーラー</ulink>にも、使えるバージョンの Drive Setup が含まれます。
	オペレーティングシステム一式を含んでいるため、 Darwin も巨大 (120.7 MB)
	です。
      </para>

      <para>
	ディスクイメージを開き、 Drive Setup をハードドライブ、 RAM ディスク、
	Zip ディスク、フロッピーディスク等にコピーします (Drive Setup
	はディスクイメージからは実行できません) 。
      </para>
    </listitem>
    <listitem>
      <para>
	Drive Setup を最初に走らせると、次のような画面が出ます。
	ここで、再分割しようとするドライブを選びます。
      </para>

      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/drive-selection.gif"
		     format="GIF" width="328" height="257" />
	</imageobject>
	<textobject><phrase>select a drive</phrase></textobject>
      </inlinemediaobject>

      <para>
	再分割するドライブを選び、 <code>Initialize...</code> ボタンをクリックします。
	すると別のダイアログが出ます。 <code>Custom Setup...</code>
	ボタンをクリックします。
      </para>

      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/initialize.gif"
		     format="GIF" width="330" height="244" />
	</imageobject>
	<textobject><phrase>initialize</phrase></textobject>
      </inlinemediaobject>
    </listitem>
    <listitem>
      <para>
	使う予定のパーティションの数を選びます。おそらく、少なくとも
	5 パーティションは必要でしょう。インストールノートの提示を参照してください。
      </para>

      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/custom-setup.gif"
		     format="GIF" width="480" height="355" />
	</imageobject>
	<textobject><phrase>custom setup</phrase></textobject>
      </inlinemediaobject>

      <para>
	パーティション数を変えると、 <code>Volumes</code> の情報はすべて消えるので、
	まず最初に <code>Partitioning Scheme</code> を選んでください。
      </para>
    </listitem>
    <listitem>
      <para>
	各 <code>Volumes</code> ごとに、 <code>Volume Info</code> にある <code>Type:</code>
	と <code>Size:</code> を、インストールノートに提示されているように設定します。
      </para>
      
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/custom-type.gif"
		     format="GIF" width="480" height="428" />
	</imageobject>
	<textobject><phrase>custom type</phrase></textobject>
      </inlinemediaobject>

      <para>
	<code>Volumes</code> の移動には <code>TAB</code> キーが使えます。
      </para>
    </listitem>
    <listitem>
      <para>
	設定が済むと、次のようになるはずです (Mac OS パーティション名は、
	後ほど Finder から設定します):
      </para>
      
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/suggested-layout.gif"
		     format="GIF" width="480" height="355" />
	</imageobject>
	<textobject><phrase>suggested layout</phrase></textobject>
      </inlinemediaobject>

    </listitem>
    <listitem>
      <para>
	<code>OK</code> ボタンをクリックします。すると、
	変更について確認を求めてきます。
      </para>
      <para>
	<emphasis>ここまでくると、やり直せません ! ここで、確認に同意すると、
	ドライブの内容はすべて消去されます</emphasis>
      </para>
    </listitem>
    <listitem>
      <para>
	パーティショニングと HFS(+) パーティションの作成が済むと、
	最初の画面に戻ります。
      </para>

      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/drivesetup-done.gif"
		     format="GIF" width="328" height="257" />
	</imageobject>
	<textobject><phrase>after partitioning</phrase></textobject>
      </inlinemediaobject>

      <para>
	注意: <code>A/UX</code> パーティションは Mac OS からはアクセスできません。
      </para>
    </listitem>
    <listitem>
      <para>
	Drive Setup での作業は完了し、 Drive Setup を終了できます。
	これで、 Finder から、 HFS(+) パーティションの名前を変更できます。
	Open Firmware 1.0.5 または 2.0.x の機種では、これで完了です─
	インストールノートに従い、作業を続けてください。
      </para>

      <para>
	Open Firmware 2.4 または 3 の機種では、ディスクを NetBSD ブート可能に
	するために、もう一段階必要です。
      </para>

      <para>
	<code>ofwboot.xcf</code> (ブートローダー) と、 <code>netbsd.GENERIC_MD.gz</code>
	または <code>netbsd.ram.gz</code> (インストーラー) を、 HFS(+) パーティションの
	ひとつにコピーする必要があります。これらのファイルは
	<code>バイナリー</code>モードでダウンロードしてあることを確認しておいてください。
      </para>
    </listitem>
  </orderedlist>
</sect1>

<sect1 id="disk-utility">
  <title>Disk Utility を使ったパーティショニング (Mac OS X)</title>

  <para>
    Mac OS X の Disk Utility プログラムは NetBSD パーティションを直接作ることは
    できませんが、最終的に NetBSD パーティションを作る方法はあります。
    Disk Utility の利点は、 Mac OS X インストール CD から利用可能なことです。
    Disk Utility が作成可能なのは、 "Mac OS Extended" (HFS+)、 "Mac OS Standard"
    (HFS)、 "UNIX File System" (UFS) および "Free Space" パーティションのみです。
  </para>

  <para>
    NetBSD/macppc -current カーネルは UFS パーティションを使うことができ、
    ルートパーティションであっても使うことができます。現状、通常の NetBSD
    A/UX-形式で利用可能なパーティションが存在しない場合に、 NetBSD/macppc
    は UFS パーティションがルートであるとの仮定をするようにはなっていません。
    NetBSD に、どのパーティション (たとえば "e") が UFS であるとみなすかを
    教えてやる必要や、<ulink url="faq.html#dash-a">ルートデバイス</ulink>が UFS
    であることを指定したカーネルを作る必要があるかもしれません。
  </para>

  <para>
    これでは足りないという場合、 Disk Utility で Mac OS HFS+ を作り、
    NetBSD 用に free space を残しておくという使い方ができます。
    あとは <ulink url="#pdisk"><code>pdisk</code></ulink> を使って NetBSD
    パーティションを作る必要があります。
  </para>

  <orderedlist>
    <listitem>
      <para>
	Disk Utility を起動します。インストール CD から使う場合は "Install" メニューにあります。
	Mac OS X から使う場合は /Applications/Utilities/Disk Utility を開きます。
      </para>
    </listitem>
    <listitem>
      <para>
	ここで認証が必要かもしれません。ウィンドウ左下で "Click the lock to make
	changes." といわれた場合は、錠前をクリックしてパスワードを入力します
	(管理者用のアカウントを使っていますよね?)。
      </para>
    </listitem>
    <listitem>
      <para>
	左側のパネルで、ディスクを選びます。 "Partition" タブを
	クリックします。 "Volume Scheme" (つまり、必要なパーティション数)
	を選びます。
      </para>
    </listitem>
    <listitem>
      <para>
	パーティションの名前、フォーマットとサイズを設定します。ヒント:
	推奨より小さいパーティションを作るには、サイズ欄に数字を入れ、それを
	パーティションサイズにするため enter キーを押します。 "Mac OS Extended"
	HFS+ パーティションの最小サイズは 4 MB です。例えば、筆者の 2 パーティションの
	ディスク (<code>ofwboot.xcf</code> 用の小さい HFS パーティションと NetBSD 用の大きな
	UFS パーティション) では、このようになります:
      </para>

      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/diskutil-hfs.gif"
		     format="GIF" width="705" height="519" />
	</imageobject>
	<textobject><phrase>small HFS partition</phrase></textobject>
      </inlinemediaobject>
      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/diskutil-ufs.gif"
		     format="GIF" width="705" height="519" />
	</imageobject>
	<textobject><phrase>large NetBSD UFS partition</phrase></textobject>
      </inlinemediaobject>
      
    </listitem>
    <listitem>
      <para>
	Mac OS 9 のディスクドライバーをどこにインストールするか選択します。
	今後  Mac OS 9 かそれより前から、このディスクのパーティションのどれかへ
	アクセスするつもりがある場合、これが唯一の機会です。ここでボタンをクリック
	しなかった場合、 Mac OS 9 からは HFS パーティションにすらアクセスできなくなります。
      </para>
    </listitem>
    <listitem>
      <para>
	OK をクリックして先へ進みます。
      </para>
    </listitem>
    <listitem>
      <para>
	これで Disk Utility 抜けて結構です。作業は終わりました。これで、
	Finder から HFS(+) や UFS パーティションの名前を変えられます。 Open Firmware
	1.0.5 または 2.0.x の機種の場合、これで完了です─ INSTALL ノートに従って
	作業を続けてください。
      </para>

      <para>
	Open Firmware 2.4 または 3 の機種で、このディスクを NetBSD のブートに
	使えるようにする場合は、さらに以下の手順を踏む必要があります。
      </para>

      <para>
	<code>ofwboot.xcf</code> (NetBSD 用のブートローダー) を、ドライブの HFS(+)
	パーティションのひとつにコピーする必要があります。 <code>netbsd.GENERIC_MD.gz</code>
	を UFS パーティションにコピーします (これは HFS(+)
	パーティションに置いておくこともできますが)。これらのファイルは
	<code>バイナリー</code>モードでダウンロードしてあることを確認しておいてください。
      </para>

      <para>
	UFS をルートパーティションに使うために -current カーネルが必要であること、
	NetBSD がこのパーティションをパーティション "a" であると認識しない可能性があることに注意してください。
      </para>
    </listitem>
  </orderedlist>
</sect1>

<sect1 id="pdisk">
  <title>
    <code>pdisk</code> と <code>newfs</code> を使ったパーティショニング
    (Mac OS 9, Mac OS X, Darwin, NetBSD, Linux)
  </title>

  <para>
    コマンドラインの <code>pdisk</code> ユーティリティーは、ディスク上の Apple
    パーティションマップの閲覧と修正に使われます。 NetBSD、 Mac OS X、 Darwin
    はいずれも、 <code>pdisk</code> でパーティション分割されたディスクをマウント可能です。
    Mac OS 9 およびそれ以前は、これをマウントするには特別なドライバーのインストールが
    必要です (<ulink url="#drive-setup">Drive Setup</ulink> と <ulink url="#disk-utility">Disk
    Utility</ulink> 参照)。 <code>pdisk</code> は、 Open Firmware 2.4 または 3 の機種で
    NetBSD、 Mac OS X、 Darwin のブート可能なパーティションマップを作成可能です。
  </para>

  <para>
    さらに、 <code>pdisk</code> は別のユーティリティーで作ったパーティションマップの修正や、
    単にディスクのパーティションマップのリストを見るためにも使えることがおわかりでしょう。
    ディスクのパーティションマップのリストを見たいだけの場合は、
    1 から 4 までの手順に従ってください。
  </para>

  <para>
    始める前に、パーティショニングに関していくらか警告しておきます:
  </para>

  <itemizedlist>
    <listitem>
      <para>
	(Mac OS ユーティリティーで作ったパーティションマップを単に修正するのではなく)
	パーティションマップを <code>pdisk</code> で一から作った場合、このディスク上の
	パーティションは Mac OS 9 およびそれ以前からはアクセスできなくなります。
      </para>
    </listitem>
    <listitem>
      <para>
	Mac OS X、 Darwin や Linux のネイティブな <code>pdisk</code> では、
	NetBSD A/UX-形式のパーティションを作ることはできません。
      </para>
    </listitem>
    <listitem>
      <para>
	Mac OS 9 の <code>pdisk</code> は、やや旧式のものであり、
	以下の説明とは若干異なる動作をすることがありますが、それでも使用可能です。
      </para>
    </listitem>
    <listitem>
      <para>
	Mac OS X および Darwin では、使用中のドライブに <code>pdisk</code>
	パーティションマップを書き込むことができません。つまり、ブートドライブの
	分割し直しはできないということです。別のディスクからブートして作業してください
	(または、 <ulink url="http://charlessoft.com/">BootCD</ulink> 等のツールでブート可能な CD を作ってください)。
      </para>
    </listitem>
  </itemizedlist>

  <para>
    <code>pdisk</code> によってリストされるパーティション番号は、 Open Firmware
    が使っているものと同じものです。 Open Firmware 2.4 または 3 の機種で
    ディスクをブート可能にしようとする場合は、 <code>Apple_HFS</code>
    パーティションに <code>ofwboot.xcf</code> を置くことと、 <code>Apple_UNIX_SVR2</code>
    または <code>Apple_UFS</code> パーティションを NetBSD
    ルートパーティションにすることを忘れないでください。
  </para>

  <orderedlist>
    <listitem><para><code>pdisk</code> を入手する。</para>
    <itemizedlist>
      <listitem>
	<para>NetBSD -current では、 <code>/sbin/pdisk</code></para>
      </listitem>
      <listitem>
	<para>
	  NetBSD 1.6.x では、 <ulink 
	  url="ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/netbsd-pdisk/netbsd-pdisk.macppc-1-6">
	  ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/netbsd-pdisk/netbsd-pdisk.macppc-1-6
	</ulink>
	</para>
	<screen># <emphasis role="bold">chmod 755 netbsd-pdisk.macppc-1-6</emphasis></screen>
      </listitem>
      <listitem>
	<para>
	  Mac OS X 10.2.5 (Mac OS X 10.1.5 でも動作することがわかっています) では、 <ulink
	  url="ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/netbsd-pdisk/netbsd-pdisk.macos-10-2">
	  ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/netbsd-pdisk/netbsd-pdisk.macos-10-2</ulink>
	</para>
	<screen># <emphasis role="bold">chmod 755 netbsd-pdisk.macos-10-2</emphasis></screen>
      </listitem>
      <listitem>
	<para>
	  Mac OS 9 では、 <ulink
	  url="ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/macos-utils/pdisk.sea.hqx">
	  ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/macos-utils/pdisk.sea.hqx</ulink>
	</para>
	<para>
	  アーカイブを伸長し、<code>pdisk ppc</code> を実行する
	</para>
      </listitem>
      <listitem>
	<para>
	  それ以外 (Mac OS X、 Darwin、 Linux) では、 <ulink
	  url="ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/netbsd-pdisk/netbsd-pdisk.src.20030424.tgz">
	  ftp://ftp.NetBSD.org/pub/NetBSD/arch/macppc/netbsd-pdisk/netbsd-pdisk.src.20030424.tgz</ulink>
	</para>
	<screen># <emphasis role="bold">tar xzf netbsd-pdisk.src.20030424.tgz</emphasis>
# <emphasis role="bold">make</emphasis></screen>
      </listitem>
    </itemizedlist>
    </listitem>
    <listitem>
      <para>
	閲覧またはパーティション再分割しようとしているディスクのデバイス名を
	調べます。パーティション再分割する場合は、そのディスクのマウントされている
	パーティションはすべてアンマウントします。
      </para>

      <itemizedlist>
	<listitem>
	  <para>NetBSD:</para>
 <screen># <emphasis role="bold">dmesg | grep \[sw\]d\[0-9\]</emphasis>
# <emphasis role="bold">umount /mountpoint</emphasis></screen>
	</listitem>
	<listitem>
	  <para>
	    Mac OS 9:
	  </para>
	  <para>
	    ディスクのアイコンをゴミ箱に捨てます。
	    <code>pdisk ppc</code> を開き、<code><emphasis
	    role="bold">L</emphasis></code> をタイプしてディスク、その偽名、
	    パーティションを列挙させます
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Mac OS X および Darwin:
	  </para>
 <screen># <emphasis role="bold">/usr/sbin/diskutil list</emphasis>
# <emphasis role="bold">/usr/sbin/disktool -u disk2</emphasis></screen>
	</listitem>
	<listitem>
	  <para>
	    Linux:
	  </para>
<screen># <emphasis role="bold">dmesg | grep \[hs\]d\[a-g\]</emphasis>
# <emphasis role="bold">umount /mountpoint</emphasis></screen>
	</listitem>
      </itemizedlist>
    </listitem>
    <listitem>
      <para>
	<code>pdisk /dev/<emphasis>disk-device</emphasis></code> を実行します。ここで
	<emphasis>disk-device</emphasis> は以下のようになります:
      </para>
      <itemizedlist>
	<listitem>NetBSD では <code>/dev/sd2c</code> ("<code>c</code>" パーティションを使用)</listitem>
	<listitem>Mac OS X および Darwin では <code>/dev/disk2</code> (パーティション名は指定しない)</listitem>
	<listitem>Linux では <code>/dev/hdc</code> (パーティション名は指定しない)</listitem>
      </itemizedlist>

<programlisting>  # <emphasis role="bold">./pdisk /dev/disk2</emphasis>
  Edit /dev/disk2 -
  Command (? for help): <emphasis role="bold">?</emphasis>
  Notes:
    Base and length fields are blocks, which vary in size between media.
    The base field can be &lt;nth&gt;p; i.e. use the base of the nth partition.
    The length field can be a length followed by k, m, g or t to indicate
    kilo, mega, giga, or tera bytes; also the length can be &lt;nth&gt;p; i.e. use
    the length of the nth partition.
    The name of a partition is descriptive text.
  
  Commands are:
    C    (create with type also specified)
    c    create new partition (standard unix root)
    d    delete a partition
    h    help
    i    initialize partition map
    n    (re)name a partition
    P    (print ordered by base address)
    p    print the partition table
    q    quit editing
    r    reorder partition entry in map
    s    change size of partition map
    t    change a partition's type
    w    write the partition table</programlisting>
    </listitem>
    <listitem>
      <para>
	作業対象のディスクが正しいか、再確認します。 Apple
	パーティションマップがすでにあれば、大丈夫なはずです。
      </para>

<programlisting>  Command (? for help): <emphasis role="bold">P</emphasis>

  Partition map (with 512 byte blocks) on '/dev/disk0'
   #:                type name             length   base    ( size )
   1: Apple_partition_map Apple                63 @ 1      
   2:      Apple_Driver43*Macintosh            56 @ 64     
   3:      Apple_Driver43*Macintosh            56 @ 120    
   4:    Apple_Driver_ATA*Macintosh            56 @ 176    
   5:    Apple_Driver_ATA*Macintosh            56 @ 232    
   6:      Apple_FWDriver Macintosh           512 @ 288    
   7:  Apple_Driver_IOKit Macintosh           512 @ 800    
   8:       Apple_Patches Patch Partition     512 @ 1312   
   9:          Apple_Free                     192 @ 1824   
  10:           Apple_UFS shared          1700000 @ 2016    (830.1M)
  11:           Apple_HFS macos            408788 @ 1702016 (199.6M)
  12:          Apple_Free                       8 @ 2110804

  Device block size=512, Number of Blocks=2110812 (1.0G)
  DeviceType=0x0, DeviceId=0x0
  Drivers-
  1:  23 @ 64, type=0x1
  2:  36 @ 120, type=0xffff
  3:  21 @ 176, type=0x701
  4:  34 @ 232, type=0xf8ff</programlisting>

      <para>
	もし Apple パーティションマップ (APM) がなければ、エラーが出ますし、
	新しいパーティションを作る前に APM の初期化が必要です。
      </para>

<screen>  Command (? for help): <emphasis role="bold">P</emphasis>
  No partition map exists
  Command (? for help): <emphasis role="bold">i</emphasis>
  read failed
  Command (? for help): <emphasis role="bold">P</emphasis>

  Partition map (with 512 byte blocks) on '/dev/rdisk2'
   #:                type name    length   base    ( size )
   1: Apple_partition_map Apple       63 @ 1      
   2:          Apple_Free Extra  2110749 @ 64      (1.0G)

  Device block size=512, Number of Blocks=2110812 (1.0G)
  DeviceType=0x0, DeviceId=0x0</screen>
    </listitem>
    <listitem>
      <para>
	未使用パーティションを削除し、新しいパーティションを作ります。
	<code>Apple_Free</code> パーティションは、自動的に未使用領域に計上されますので、
	削除する必要はありません。
      </para>

      <para>
	<code>P</code> コマンドでパーティションの一覧を表示し、
	正しくパーティションを削除したか確認します。
      </para>
<screen>  Command (? for help): <emphasis role="bold">d</emphasis>
  Partition number: <emphasis role="bold">9</emphasis></screen>

      <para>
	作成される有用なパーティション型には、以下のようなものがあります:
      </para>
      
      <informaltable>
	<tgroup cols="2">
	  <tbody>
	    <row><entry><code>Apple_HFS</code></entry>
	    <entry>HFS および HFS+ パーティション (<ulink url="#msdos">共有
	    MS-DOS</ulink> パーティションもこれ)</entry></row>
	    <row><entry><code>Apple_UFS</code></entry>
	    <entry>UFS パーティション</entry></row>
	    <row><entry><code>Apple_UNIX_SVR2</code></entry>
	    <entry>NetBSD および Linux 用の A/UX-形式パーティション</entry></row>
	  </tbody>
	</tgroup>
      </informaltable>

<screen>  Command (? for help): <emphasis role="bold">C</emphasis>
  First block: <emphasis role="bold">2p</emphasis>
  Length in blocks: <emphasis role="bold">100m</emphasis>
  Name of partition: <emphasis role="bold">Zathras</emphasis>
  Type of partition: <emphasis role="bold">Apple_HFS</emphasis>
  Command (? for help): <emphasis role="bold">C</emphasis>
  First block: <emphasis role="bold">3p</emphasis>
  Length in blocks: <emphasis role="bold">800m</emphasis>
  Name of partition: <emphasis role="bold">netbsd</emphasis>
  Type of partition: <emphasis role="bold">Apple_UNIX_SVR2</emphasis>
  Available partition slices for Apple_UNIX_SVR2:
    a   root partition
    b   swap partition
    c   do not set any bzb bits
    g   user partition
  Other lettered values will create user partitions
  Select a slice for default bzb values: <emphasis role="bold">a</emphasis>
  Command (? for help): <emphasis role="bold">C</emphasis>
  First block: <emphasis role="bold">4p</emphasis>
  Length in blocks: <emphasis role="bold">4p</emphasis>
  Name of partition: <emphasis role="bold">swap</emphasis>
  Type of partition: <emphasis role="bold">Apple_UNIX_SVR2</emphasis>
  Available partition slices for Apple_UNIX_SVR2:
    a   root partition
    b   swap partition
    c   do not set any bzb bits
    g   user partition
  Other lettered values will create user partitions
  Select a slice for default bzb values: <emphasis role="bold">b</emphasis>
  Command (? for help): <emphasis role="bold">P</emphasis>

  Partition map (with 512 byte blocks) on '/dev/rdisk0'
   #:                type name     length   base    ( size )
   1: Apple_partition_map Apple        63 @ 1      
   2:           Apple_HFS Zathras  204800 @ 64      (100.0M)
   3:     Apple_UNIX_SVR2 netbsd  1638400 @ 204864  (900.0M) S0 RUFS k0  /
   4:     Apple_UNIX_SVR2 swap     267548 @ 1843264 (130.6M) S1  SFS k0  (swap)

  Device block size=512, Number of Blocks=2110812 (1.0G)
  DeviceType=0x0, DeviceId=0x0</screen>
    </listitem>
    <listitem>
      <para>
	新しいパーティションを書き出し、 pdisk を終了します。
      </para>

<screen>  Command (? for help): <emphasis role="bold">w</emphasis>
  Writing the map destroys what was there before. Is that okay? [n/y]: <emphasis role="bold">y</emphasis>
  Command (? for help): <emphasis role="bold">q</emphasis></screen>
    </listitem>
    <listitem>
      <para>
	新しいファイルシステムを作ります。
      </para>
      <itemizedlist>
	<listitem>
	  <para>
	    NetBSD は、ルートおよびユーザーパーティションとして固有のファイルシステム
	    (FFS) しか作ることができません。 UFS、 HFS、 HFS+ や、フロッピーサイズ以外の MS-DOS
	    ファイルシステムを直接作ることはできません。 HFS ファイルシステムの作成には <ulink
	    url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/sysutils/hfsutils/README.html">
	    hfstools</ulink> を使うことができます。
	  </para>

	  <screen># <emphasis role="bold">newfs /dev/sd2a</emphasis>
# <emphasis role="bold">hformat /dev/sd2e</emphasis></screen>
	</listitem>
	
	<listitem>
	  <para>
	    Mac OS 9 は、リブートすると HFS と HFS+ ファイルシステムの作成を要求してきます。
	    リブート後、 OS は新しいパーティションマップを認知し、このパーティションに
	    ファイルシステムがないことを警告して、ファイルシステムを作るよう求めてきます。
	    共有 MS-DOS パーティションのフォーマット方法は、
	    <ulink url="#msdos">共有 MS-DOS ファイルシステムの作成</ulink> を見てください。
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Mac OS X および Darwin は、 UFS、 HFS+ および HFS パーティションを作ることができます。
	    NetBSD FFS やフロッピーサイズ以外の MS-DOS ファイルシステムをコマンドラインユーティリティーを使って
	    作ることはできません。 Mac OS 8.0 やそれ以前を使うことを考えない限り、
	    (拡張ではない通常の) HFS パーティションは必要ないはずです。
	  </para>
	  <screen># <emphasis role="bold">newfs_hfs /dev/disk2s2</emphasis></screen>
	  <para>
	    (for HFS+)
	  </para>
	  <screen># <emphasis role="bold">newfs /dev/disk2s5</emphasis></screen>
	  <para>
	    (for UFS)
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Linux は、ルート用の Linux 固有のファイルシステム (ext2fs)、スワップ、
	    ユーザーパーティションおよび MS-DOS ファイルシステムを作ることしかできません。
	    UFS、 HFS および HFS+ を直接作ることはできません。 HFS ファイルシステムは、 <ulink
	    url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/sysutils/hfsutils/README.html">
	    hfstools</ulink> を使って作ることができます。
	  </para>
<screen># <emphasis role="bold">mkfs -t ext2 /dev/hdc2</emphasis>
# <emphasis role="bold">mkdosfs /dev/hdc3</emphasis>
# <emphasis role="bold">hformat /dev/hdc5</emphasis></screen>
	</listitem>
      </itemizedlist>
    </listitem>
    <listitem>
      <para>
	新しいファイルシステムをマウントします。
      </para>
      <itemizedlist>
	<listitem>
	  <para>
	    NetBSD (FFS でも UFS でも同じコマンドを使います):
	  </para>
<screen># <emphasis role="bold">mount /dev/sd2a /mnt</emphasis>
# <emphasis role="bold">hmount /dev/sd2e</emphasis></screen>
          <para>
	    (virtual mount)
	  </para>
	</listitem>
	<listitem>
	  <para>
	    Mac OS X および Darwin:
	  </para>
<screen>  # <emphasis role="bold">/sbin/autodiskmount -v</emphasis>
  ** /dev/rdisk2s2
  FILESYSTEM CLEAN; SKIPPING CHECKS
  ** /dev/rdisk2s5
  QUICKCHECK ONLY; FILESYSTEM CLEAN
  Mounted ufs /dev/disk0s5 on /Volumes/untitled
  DiskDev    Type   FileSys  Fixed Write Volume Name      Mounted On      
  disk2s2    ???    hfs      yes   yes   untitled         /Volumes/untitled
  disk2s5    ???    ufs      yes   yes   untitled         /Volumes/untitled 1
  disk0s10   ???    hfs      yes   yes   OSX              /</screen>
	</listitem>
	<listitem>
	  <para>
	    Linux:
	  </para>
	  <screen># <emphasis role="bold">mount -t ufs -o ufstype=44bsd,ro /dev/hdc1 /mnt/netbsd</emphasis></screen>
	  <para>(BSD FFS)</para>
<screen># <emphasis role="bold">mount -t ufs -o ufstype=openstep,ro /dev/hdc2 /mnt/macosx</emphasis></screen>
<para>
 (OSX UFS)
</para>
<screen># <emphasis role="bold">hmount /dev/hdc3</emphasis></screen><para>(hfsutils の仮想的な mount)</para>
<screen># <emphasis role="bold">mount -t hfs /dev/hdc3 /mnt/macos</emphasis></screen>
<para>(実験的なカーネル内 HFS)</para>
<screen># <emphasis role="bold">hpmount /dev/hdc4</emphasis></screen>
<para>(hfsplus utils の仮想的な mount)</para>
<screen># <emphasis role="bold">mount -t hfsplus -o ro /dev/hdc4 /mnt/macosx</emphasis></screen>
<para>(実験的なカーネル内 HFS+)</para>
<screen># <emphasis role="bold">mount -t ext2 /dev/hdc5 /mnt/linux</emphasis></screen>
<para>(linux ext2fs)</para>
	</listitem>
      </itemizedlist>
    </listitem>
    <listitem>
      <para>
	Open Firmware 1.0.5 または 2.0.x の機種では、
	<code>netbsd.GENERIC_MD.gz</code> (インストーラー) を FFS または UFS
	パーティションにコピーしておくとよいでしょう。このファイルのダウンロードは
	<code>バイナリー</code>モードでダウンロードしてあることを確認しておいてください。
	ブートするためにはさらに <code>ofwboot.xcf</code> を別のところからロードする必要があります。
      </para>

      <para>
	Open Firmware 2.4 または 3 の機種で、このディスクから NetBSD
	がブート可能なようにするためには、 <code>ofwboot.xcf</code> (ブートローダー)
	をHFS(+) パーティションのひとつにコピーする必要があります。 NetBSD から行なうには
	<code>hcopy</code> コマンドを使います。 <code>netbsd.GENERIC_MD.gz</code> (インストーラー)
	を FFS または UFS パーティションにコピーします (これは HFS(+)
	パーティションに置いておくこともできますが)。これらのファイルは
	<code>バイナリー</code>モードでダウンロードしてあることを確認しておいてください。
      </para>

      <para>
	UFS をルートパーティションに使うために -current カーネルが必要であること、
	NetBSD がこのパーティションをパーティション "a" であると認識しない可能性があることに注意してください。
      </para>
    </listitem>
  </orderedlist>
</sect1>
<sect1 id="msdos">
  <title>共有 MS-DOS ファイルシステムの作成</title>

  <para>
    すべての OS で利用可能な、 MS-DOS フォーマットのパーティションを作ることができます。
    古い Mac OS ではこれを自動的にマウントしますし、 
    unix-like OS (NetBSD、 Linux、 Darwin、 Mac OS X) では
    <code>mount_msdos</code> コマンドを使ってマウントできます。
    以下に、最も素直な方法の手順を概説します。
  </para>

  <orderedlist>
    <listitem>
      <para>
	ハードドライブのパーティションを切り、 MS-DOS 用に HFS
	パーティション (type <code>Apple_HFS</code>) を確保しておきます。
      </para>
    </listitem>
    <listitem>
      <para>
	次に、 Mac OS 8.1-9.x をブートし、
	<ulink url="http://hyperarchive.lcs.mit.edu/cgi-bin/NewSearch?key=disk+charmer&amp;search=&amp;sp=sp">
	  Disk Charmer</ulink> または
	  <ulink url="http://www.versiontracker.com/moreinfo.fcgi?id=1253">DiskCharmer</ulink>
	  を入手し、 MS-DOS ファイルシステムを作るよう設定します。
	  設定画面は次のようになるはずです:
      </para>

      <inlinemediaobject>
	<imageobject>
	  <imagedata fileref="../../../images/ports/macppc/diskcharmer.gif"
		     format="GIF" width="405" height="251" />
	</imageobject>
	<textobject><phrase>screenshot of DiskCharmer</phrase></textobject>
      </inlinemediaobject>
    
    </listitem>
    <listitem>
      <para>
	パーティションを DiskCharmer のウィンドウ上にドラッグします。すると、
	最初に作った HFS パーティションを消去し、そこに MS-DOS ファイルシステムを
	作る前に、プロンプトが出ます。
      </para>
    </listitem>
    <listitem>
      <para>
	これで、古い Mac OS をブートしたら、このパーティションが PC Exchange
	または File Exchange (これの呼び名は Mac OS のバージョンによります)
	によって自動的にマウントされるようになりました。
      </para>

      <para>Mac OS X、 Linux や NetBSD をブートしたときは、次のコマンドを実行します:</para>

      <screen>mkdir -p /msdos.filesystem;/sbin/mount_msdos -m 777 /dev/disk0s11 /msdos.filesystem</screen>

      <para>
	ここで <code>/msdos.filesystem</code> はあなたが決めたマウントポイント、
	<code>/dev/disk0s11</code> はそのパーティションのデバイス名です。あるいは、
	NetBSD や Linux では、 <code>/etc/fstab</code> に項目を追加して、
	このファイルシステムがいつもマウントされるようにもできます。
      </para>
    </listitem>
    <listitem>
      <para>
	Mac OS X や Darwin で MS-DOS ファイルシステムを自動的にマウントする
	ためには、 System Startup ファイル群を作成する必要があります。
	<ulink url="http://www.darwinfo.org/howto/SystemStarter_HOWTO.shtml">SystemStarter
	HOWTO</ulink> が、スタートアップファイル群の作成方法を学ぶうえでのよい参考資料と
	なるでしょう。 <code>autodiskmount</code> を使った方法もおそらくあるのでしょうが、
	ここで説明する方法でうまくいきます。唯一の欠点は、 MS-DOS ファイルシステムが
	Classic 環境では扱えないことです。
	以下に例を示します:
      </para>

      <orderedlist>
	<listitem>
	  <screen># <emphasis role="bold">mkdir -p /Library/StartupItems/MountMSDOS</emphasis></screen>
	</listitem>
	<listitem>
	  <para>
	    以下の内容を持つファイル
	    <code>/Library/StartupItems/MountMSDOS/StartupParameters.plist</code>
	    を作成します:
	  </para>
<programlisting>{
  Description     = "Mount MSDOS partitions";
  Provides        = ("Manual MSDOS partitions");
  Requires        = ("Disks");
  OrderPreference = "None";
  Messages =
  {
    start = "Mounting MSDOS partitions";
    stop  = "Unmounting MSDOS partitions";
  };
}</programlisting>
	</listitem>
	<listitem>
	  <para>
	    以下の内容を持つファイル
	    <code>/Library/StartupItems/MountMSDOS/MountMSDOS</code>
	    を作成します:
	  </para>
	  <programlisting>#!/bin/sh

. /etc/rc.common

##
# Manually mount HFS partition with MS-DOS filesystem
##

ConsoleMessage "Mount MS-DOS partitions"

##
# Mount your filesystems manually.
##
mount_msdos /dev/disk0s11 /Volumes/Thingies</programlisting>
	</listitem>
	<listitem>
  <screen># <emphasis role="bold">chown -R root /Library/StartupItems/MountMSDOS</emphasis>
# <emphasis role="bold">chmod a+rx /Library/StartupItems/MountMSDOS/MountMSDOS</emphasis></screen>
	</listitem>
      </orderedlist>
    </listitem>
  </orderedlist>
</sect1>

<sect1 id="nomenclature">
  <title>パーティション命名規則</title>

  <para>
    NetBSD/macppc を使うときに、あなたが関わるであろうパーティション特定方式は
    三種類あります。各方式は、ディスク上のパーティション位置は変わらないにもかかわらず、
    異なるやり方でパーティションの順序を変えます。
    方式によっては、一部のパーティションを隠します。
  </para>

  <orderedlist>
    <listitem>
      <para>
	<emphasis role="bold">ディスク上の実際の順序 (0
	から最大のパーティション番号まで):</emphasis>
      </para>
      <para>
	これは、 Open Firmware や、 Mac OS X と Darwin の <code>/dev/diskXsY</code>
	デバイスファイルが使っている方式です。パーティションの順序は、
	Drive Setup や pdisk や NetBSD のパーティショニングツールにおける順序
	そのままです。この方式によるパーティション一覧は、各 OS で <ulink
	url="partitioning.html#pdisk">pdisk</ulink> を使ってプリントアウトできます。
      </para>

      <informaltable>
	<tgroup cols="2">
	  <tbody>
	    <row><entry>0</entry>
	    <entry>最初の段階のブートローダーのために予約された、特別な "パーティション"。</entry></row>
	    <row><entry>1</entry>
	    <entry>Apple パーティションマップ。</entry></row>
	    <row><entry>2 から ~8</entry>
	    <entry>Mac OS のツールでフォーマットされたドライブでは、 Mac OS 9 ドライバー
	    のために予約されている。そうでない場合は、ユーザーが作ったパーティション。</entry></row>
	    <row><entry>~9 から ~15</entry>
	    <entry>ユーザーが作ったパーティション、
	    配置はディスクの物理的な位置の順。</entry></row>
	  </tbody>
	</tgroup>
      </informaltable>
    </listitem>
    <listitem>
      <para>
	<emphasis role="bold">Mac OS で見えるパーティション (Finder
	上のパーティション名による):</emphasis>
      </para>
      <para>
	Drive Setup でパーティションの群を作ったかもしれませんが、
	この Mac OS で見えるパーティションだけが Finder で表示されます。
      </para>

      <para>
	Mac OS 9 以前で見えるパーティションは、 HFS、 HFS+ または MS-DOS フォーマット
	でフォーマットされたものだけです。 Mac OS X 以降で見えるパーティションは、
	HFS、 HFS+、 UFS および MS-DOS (NetBSD の 4.2BSD FFS では <emphasis>ありません</emphasis>)
	でフォーマットされたものだけです。
      </para>
    </listitem>
    <listitem>
      <para>
	<emphasis role="bold">NetBSD で見えるパーティション (<code>disklabel</code> で見られるとおりの
	a から h までの文字):</emphasis>
      </para>
      <para>
	NetBSD は、自分が処理しやすいような形にパーティションを並べ替えます。
	<code>&man.disklabel.8;</code> で得られる <code>fstype</code> は、
	Apple パーティションマップのフラグによっており、パーティション上の実際の
	ファイルシステム (NetBSD FFS、 Apple HFS や MS-DOS) によってはいません。
	特に、 MS-DOS フォーマットのパーティションは、それが<ulink url="#msdos">
	共有 MS-DOS ファイルシステムの作成</ulink>の方法で作られた場合、
	<code>HFS</code> パーティションに見えます。
      </para>

      <informaltable>
	<tgroup cols="2">
	  <tbody>
	    <row><entry>a</entry>
	    <entry>"A/UX Root" パーティション、ディスク上の順序とは無関係</entry></row>
	    <row><entry>b</entry>
	    <entry>"A/UX Swap" パーティション、ディスク上の順序とは無関係</entry></row>
	    <row><entry>c</entry>
	    <entry>ディスク全体 (最初のセクターから最後のセクターまで)</entry></row>
	    <row><entry>d-f</entry>
	    <entry>最初のほうにある A/UX 以外のパーティション (普通はユーザー HFS(+) パーティション)</entry></row>
	    <row><entry>g</entry>
	    <entry>(作ってあれば) "A/UX User" パーティション、ディスク上の順序とは無関係</entry></row>
	    <row><entry>h</entry>
	    <entry>さらにある A/UX 以外のパーティション (普通はユーザー HFS(+) パーティション)</entry></row>
	  </tbody>
	</tgroup>
      </informaltable>
    </listitem>
  </orderedlist>

  <para>
    そして、たとえば以下は PowerBook (FireWire) に Drive Setup
    で作成したものです:
  </para>

  <informaltable>
    <tgroup cols="6">
      <tbody>
	<row><entry><emphasis role="bold">Mac OS</emphasis></entry><entry><emphasis role="bold">OF/OSX</emphasis></entry><entry><emphasis role="bold">NetBSD</emphasis></entry> 
	<entry><emphasis role="bold">Comment</emphasis></entry><entry><emphasis role="bold">Apple Partition Map type</emphasis></entry>
	<entry><emphasis role="bold">disklabel fstype</emphasis></entry></row>

	<row><entry></entry>        <entry>0</entry>  <entry></entry>    
	<entry>bootloader</entry>               <entry></entry>
	<entry></entry></row>

	<row><entry></entry>        <entry>1</entry>  <entry></entry>    
	<entry>Partition map</entry>             <entry>Apple_partition_map Apple</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry>2</entry>  <entry></entry>    
	<entry>Mac OS driver</entry>             <entry>Apple_Driver43*Macintosh</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry>3</entry>  <entry></entry>    
	<entry>Mac OS driver</entry>             <entry>Apple_Driver43*Macintosh</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry>4</entry>  <entry></entry>    
	<entry>Mac OS driver</entry>             <entry>Apple_Driver_ATA*Macintosh</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry>5</entry>  <entry></entry>    
	<entry>Mac OS driver</entry>             <entry>Apple_Driver_ATA*Macintosh</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry>6</entry>  <entry></entry>    
	<entry>Mac OS driver</entry>             <entry>Apple_FWDriver Macintosh</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry>7</entry>  <entry></entry>    
	<entry>Mac OS driver</entry>             <entry>Apple_Driver_IOKit Macintosh</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry>8</entry>  <entry></entry>    
	<entry>Mac OS driver</entry>             <entry>Apple_Patches Patch Partition</entry>
	<entry>unknown</entry></row>

	<row><entry>Untitled</entry>   <entry>9</entry>  <entry>d</entry>    
	<entry>Mac OS 9 boot partition</entry>   <entry>Apple_HFS untitled</entry>
	<entry>HFS</entry></row>

	<row><entry>Untitled 2</entry> <entry>10</entry> <entry>e</entry>    
	<entry>Mac OS X boot partition</entry>   <entry>Apple_HFS untitled 2</entry>
	<entry>HFS</entry></row>

	<row><entry>Untitled 3</entry> <entry>11</entry> <entry>f</entry>    
	<entry>MS-DOS <ulink url="#msdos">shared partition</ulink></entry>  
	<entry>Apple_HFS untitled 3</entry>
	<entry>HFS</entry></row>

	<row><entry></entry>        <entry>12</entry> <entry>a</entry>      
	<entry>NetBSD boot partition</entry>    <entry>Apple_UNIX_SVR2 A/UX Root</entry>
	<entry>4.2BSD</entry></row>

	<row><entry></entry>        <entry>13</entry> <entry>b</entry>      
	<entry>NetBSD swap</entry>              <entry>Apple_UNIX_SVR2 Swap</entry>
	<entry>swap</entry></row>

	<row><entry></entry>        <entry>14</entry> <entry>g</entry>      
	<entry>unused disk space</entry>        <entry>Apple_Free Extra</entry>
	<entry>unknown</entry></row>

	<row><entry></entry>        <entry></entry> <entry>c</entry>      
	<entry>NetBSD whole disk</entry>         <entry></entry>
	<entry>unused</entry></row>
      </tbody>
    </tgroup>
  </informaltable>

  <para>
    インストール後、 HFS パーティションのひとつである "Untitled" (
    Open Firmware のパーティションは 9、 NetBSD のパーティションは d) に
    <code>ofwboot.xcf</code> が、 A/UX パーティションのひとつ (Open Firmware
    のパーティションは 12、 NetBSD のパーティションは a) には NetBSD
    カーネルがあり、ブートのためのコマンドは次のようになります:
  </para>

  <screen>boot hd:9,ofwboot.xcf hd:12</screen>
</sect1>
<parentsec url="./" text="&os;/macppc ポートのページ"/>
</webpage>
