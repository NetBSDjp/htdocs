<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1994-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<title>NetBSD/amiga year 2000 compliance</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<h1>NetBSD/amiga year 2000 compliance</h1>

<hr>

<h2>Hardware clock support</h2>
<big><b>... on Amiga machines</b></big><br>

<dl><dd>
Amiga 500+, 2000, 3000 and 4000 machines (and some others with add-on boards)
use clock chips from OKI or RICOH, which both have a BCD-encoded two-digit year.
<p>

Unfortunately, this isn't handled correctly by NetBSD, as discovered by
Adam Ciarcinsky.<p>

<dl>

<dt>Analysis
<dd>The Ricoh RP5C01 clock chips used on A3000 and A4000, and the OKI
MSM6242RS  chips used on A500+ and A2000 machines, have BCD counters
for the ones and tens of the year, and no hundreds or above. In effect,
the hardware clock will jump to 00 at the end of (19)99. NetBSD does
not take this into account.  However, at least the Ricoh chip is fine
if you set the tens manually to 10 or above (up to 15, encoding the
years 2000..2059).

<dt>Workaround:
<dd>You will not notice the problem if you boot NetBSD before 1999 December 31
midnight (in the timezone of you clock chip), let it run until at least a
few seconds into the year 2000, and do not boot
AmigaOS until you have a fixed kernel.

<dt>Kernel fix:
<dd>For 1.4.x and 1.3.x kernel sources: apply
<a href="ftp://ftp.netbsd.org/pub/NetBSD/arch/amiga/misc/amiga-bbc-combi-patch">
the patch</a>
on the ftp servers
<a href="ftp://ftp.netbsd.org/pub/NetBSD/arch/amiga/misc/">
/pub/NetBSD/arch/amiga/misc/ directory</a>.

Or use the NetBSD-1.4.2_ALPHA version of
<a href="http://cvsweb.netbsd.org/cgi-bin/cvsweb.cgi/syssrc/sys/arch/amiga/dev/rtc.h?only_with_tag=netbsd-1-4">rtc.h</a>, 
<a href="http://cvsweb.netbsd.org/cgi-bin/cvsweb.cgi/syssrc/sys/arch/amiga/dev/a2kbbc.c?only_with_tag=netbsd-1-4">a2kbbc.c</a>, and
<a href="http://cvsweb.netbsd.org/cgi-bin/cvsweb.cgi/syssrc/sys/arch/amiga/dev/a34kbbc.c?only_with_tag=netbsd-1-4">a34kbbc.c</a>
<em>(only for 1.4.1!)</em>.

<p> The 1.4.2 release and NetBSD-current have been fixed already.

</dl>

</dd></dl>

<big><b>... on DraCo machines</b></big><br>

<dl><dd>
DraCo machines are using a 40 bit hardware clock counting 1/256 seconds
from January 1, 1978. This will overflow in January 2114.
We plan to recommend recalibrating the base date of the clock when this
date comes near without any solution from the manufacturer.
Note that NetBSD, like virtually all other Unix-like systems, would need to
switch to a time_t with a higher range to work after 2036.
</dd></dl>

<h2>See also:</h2>
<ul>
<li><a href="../../Misc/y2k.html">NetBSD Year 2000 Compliance</a>
</ul>

<hr>
<a href="./">Up to <em>NetBSD/amiga Port Page</em></a>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
        src="../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../Ports/"><img
        src="../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td> 
    <a href="../../Ports/"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Supported Architectures</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="http://www.netbsd.org/cgi-bin/feedback.cgi">(Contact us)</a>
  $NetBSD: y2000.html,v 1.16 2003/03/08 19:41:26 grant Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
  The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
