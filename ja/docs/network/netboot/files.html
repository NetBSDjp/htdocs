<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>
<head>
<!-- Copyright (c) 1998-2004
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.org">
<title>Setting up the filesystem, Diskless NetBSD HOW-TO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<a href="nfs.html">Previous</a> |
<a href="finish.html">Next</a> | 
<a href="./">Table of Contents</a>

<hr>

<h1>Setting up the filesystem, Diskless NetBSD HOW-TO</h1>

The procedure outlined here is independent of the server's operating system.
These are files to extract or modify on the nfs server:
<p>

<ol>
<li><tt># <b>cd /export/client/root</b></tt>
<p>

<li>If you're not running NetBSD or OpenBSD on your nfs server, then you may
    want to check to see if you have GNU tar, version 1.12 or later installed
    (some distributions of Linux ship with an older GNU tar that doesn't 
    support the necessary features):
   <p><tt># <b>tar --version</b></tt><br>
   <tt>tar (GNU tar) 1.12</tt><br>
   <p>If not, you need to get GNU 
   <tt><a href="ftp://ftp.gnu.org/pub/gnu/tar/tar-1.12.tar.gz">tar</a></tt>,
   as it provides the option to preserve uid and gid properly.  If you
   proceed in untarring the distribution sets, they will have ownerships
   set incorrectly, which will cause problems.
   <p>If you use the GNU tar on non-Net/OpenBSD, use the 
   <tt>[--numeric-owner]</tt> option.
<p>

<li>Extract essential distribution sets:<br>
<tt>#&nbsp;<b>tar&nbsp;[--numeric-owner]&nbsp;-xvpzf&nbsp;/export/client/NetBSD-release/binary/sets/base.tgz</b></tt><br>
<tt>#&nbsp;<b>tar&nbsp;[--numeric-owner]&nbsp;-xvpzf&nbsp;/export/client/NetBSD-release/binary/sets/etc.tgz</b></tt><br>
<p>

<li>Extract any additional distribution sets using the same procedure
<p>

<li><tt># <b>mkdir /export/client/root/kern</b></tt>
<p>

<li>Set up swap:<br>
   <tt># <b>mkdir /export/client/root/swap</b></tt><br>
   <tt>#&nbsp;<b>dd&nbsp;if=/dev/zero&nbsp;of=/export/client/swap&nbsp;bs=4k&nbsp;count=4k</b></tt>
   <p>This creates a 16 MB swap file.  If your operating system doesn't have a
   <tt>/dev/zero</tt> (HP-UX doesn't), then you can download this 16 MB 
   <a href="swap.tar.gz">swap</a> file (16 KB gzipped).
   <p>SunOS, use the following command to create a 16 MB swap file:<br>
   <tt># <b>mkfile 16m /export/client/swap</b></tt>
<p>

<li>Set up <tt>/etc/ifconfig.le0</tt>, where <tt>le0</tt> is the NetBSD 
device name for your ethernet card.  Create a file called 
   <tt>/export/client/root/etc/ifconfig.le0</tt>, which has the following
   line:
<pre><b>inet client netmask 255.255.255.0 broadcast 192.168.1.255</b></pre>
   replacing <tt>255.255.255.0</tt> with the netmask your 
   network administrator wants you to use, and replacing <tt>192.168.1.255</tt>
   with the broadcast address your network administrator specifies.
<p>

<li>Set up <tt>/etc/fstab</tt>.  Create a file called
   <tt>/export/client/root/etc/fstab</tt>, which has the following lines:<br>
<pre><b>#/etc/fstab
nfsserver:/export/client/swap   none  swap  sw,nfsmntpt=/swap
nfsserver:/export/client/root   /     nfs   rw 0 0
nfsserver:/export/client/usr    /usr  nfs   rw 0 0
nfsserver:/export/client/home   /home nfs   rw 0 0</b></pre>
<p>

<li>Edit <tt>/etc/rc.conf</tt>.  Open in your editor
   <tt>/export/client/root/etc/rc.conf</tt>.  Some important things to set up
   are (replace <tt>192.168.1.1</tt> with the router your network administrator
   specifies):
<pre>hostname="<b>client</b>"
defaultroute="<b>192.168.1.1</b>"
nfs_client=<b>YES</b>
auto_ifconfig=<b>NO</b>
net_interfaces=""</pre>
<p>
You should <i>not</i> have rc reconfigure your network device since it will
lose its connection to the NFS server with your root filesystem.
<p>

<li>Add your machines to <tt>/etc/hosts</tt>.  Add the following lines to
   <tt>/export/client/root/etc/hosts</tt>:<br>
<pre><b>#/etc/hosts
192.168.1.10 client.test.net client
192.168.1.5  nfsserver.test.net nfsserver</b></pre>
<p>

<li><tt>#&nbsp;<b>mv&nbsp;/export/client/root/usr/*&nbsp;/export/client/usr/</b></tt>
</ol>
<p>

<h2>Some space-saving techniques</h2>
<a href="mailto:SALEM@statoil.com">Lazaro Daniel Salem</a> has sent in 
some suggestions on creating a pseudo-clustered environment (wherein all 
clients and the server share almost all configuration files).  This will only
work if your client(s) and server are running on the same NetBSD port (merely
running on the same architecture (i.e. microprocessor) will not suffice).
<p>
If you are curious, <a href="cluster.txt">read his suggestions</a>.
<p>

<h2>It's time to boot up your diskless machine!</h2>
<ol>
<li>Here is an <a href="diskless.txt">example</a> of what the 
   diskless boot messages on a NetBSD/hp300 machine look like.<br>
   <i>If your screen goes black or appears to hang, make sure that NetBSD
   supports a local console on your particular machine, you may need to
   hook up a serial terminal.</i>
   <p>
   <i>If your serial terminal doesn't show anything (or your machine
   doesn't even have serial ports), then you need to read additional
   directions on <a href="files.nocons.html">setting up remote access</a>
   without any console</i>
<p>

<li>Your client will boot into single-user mode, giving you this prompt:<br>
   <tt>Enter pathname of shell or RETURN for sh:</tt><br>
   Hit return.
<p>

<li>It'll ask you your terminal type.<br>
   On a NetBSD/hp300 machine, the local console, is
   <tt>hp300h</tt>, and for serial console, you should probably use
   <tt>vt100</tt>
<p>

<li><tt># <b>mount /usr</b></tt>
<p>

<li>Create the <tt>/dev</tt> files.<br>
   <tt># <b>cd /dev<br>
       # /bin/sh MAKEDEV all</b></tt><br>
   This takes a while (at least two minutes), be patient.
   <p>
   Note, this won't work using the HP-UX 9 or earlier NFS server,
   since it doesn't allow client creation of device files.  You'll have to
   download this tarball of <a href="hp300.dev.tar.gz">device files</a> 
   (5 KB) for NetBSD/hp300 and run, on the nfs server:<br>
   <tt># <b>cd /export/client/root</b></tt><br>
   <tt># <b>tar [--numeric-owner] -xpvzf dev.tar.gz</b></tt>
<p>

<li>Check to make sure swap will work:
<pre># <b>swapctl -A</b>
swapctl: adding nfsserver:/export/client/swap as swap device at priority 0
# <b>swapctl -l</b>
Device      512-blocks     Used    Avail Capacity  Priority
/dev/??          32768        0    32768     0%    0</pre>
<p>

<li>Continue to multi-user mode.  Edit <tt>/etc/rc.conf</tt> either
   on the nfs server (in <tt>/export/client/root/etc/rc.conf</tt>) or on 
   the client, and change the line to read:<br>
   <tt>rc_configured=<b>YES</b></tt>
<p>

<li>Exit out of the single-user shell, by typing <tt><b>exit</b></tt>.
<p>

<li>Log in as <tt>root</tt> and have fun using your new NetBSD
   diskless workstation!
</ol>
<p>

Now, you should continue on and <a href="finish.html">finish</a> up the
diskless procedure by making sure your server(s) start all of the necessary
daemons the next time they reboot.
<p>

<hr>

<a href="nfs.html">Previous</a> |
<a href="finish.html">Next</a> |
<a href="./">Table of Contents</a>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../../"><img
        src="../../../images/NetBSD-flag.png" border="0"
        width="90" height="90" alt=""></a> 
  </td><td>
    <a href="../../../"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td> 
    <a href="../../../docs/"><img
        src="../../../images/NetBSD-flag.png" border="0"
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../../docs/"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">(Contact us)</a>
  $NetBSD: files.html,v 1.3 2007/08/01 15:36:01 kano Exp $<br>
  <a href="../../../about/disclaimer.html">Copyright &copy; 1998-2004
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
