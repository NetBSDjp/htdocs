<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998-2004
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.org">
<title>Introduction (macppc-specific), Diskless NetBSD HOW-TO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<a href="intro.html">Previous</a> |
<a href="bootpd.html">Next</a> |
<a href="./">Table of Contents</a>

<hr>

<h1>Introduction (macppc-specific), Diskless NetBSD HOW-TO</h1>

For a concise iMac-specific netboot page, look at Mitchell Spector's 
<a href="http://www.enchantedlearning.com/tech/netbsd_imac.shtml">
How to Run NetBSD on an iMac</a>

<h2>Power Macintosh Open Firmware procedures</h2>
<dl><dt><dd>
<big><b>Which Power Macintosh machines can netboot</b></big>
<p>

All NetBSD-supported Power Macs can boot over their built-in network
interface.  There are no reported cases of people being able to netboot
over PCI, Cardbus, SCSI, or Airport network interfaces.
<p>

There are three major revisions of Open Firmware on the supported macppc
machines.  Each handles booting in a different manner.  Open Firmware
versions 1.0.5, 1.1.22, 2.0.x, and 2.4 support BOOTP (or a DHCP server in 
BOOTP compatible
mode) and expect to load a XCOFF bootloader.  Open Firmware version 3
supports DHCP (and will fall back to BOOTP) and expects to load an XCOFF or 
ELF bootloader, or the ELF kernel directly.
<p>

Since all versions of Open Firmware can load the XCOFF bootloader, and since
it provides the most flexibility, all Open Firmware versions should
use <tt>ofwboot.xcf</tt>, which is in the NetBSD/macppc distribution. 
<p>

The version of OpenFirmware is printed when you first enter Open Firmware. 
See the macppc <a href="../../../ports/macppc/models.html">model support
page</a> for a listing of all supported models and their Open Firmware
versions. <p>

<big><b>Quirks/problems you may run into</b></big>
<p>

There have been some reports of some Open Firmware 1.0.5 machines not being able to
netboot.  The symptom is that <tt>ofwboot.xcf</tt> fails to mount
the nfs server with the kernel and attempts to tftp something with no
filename (it keeps printing the message "TFTP timeout").  The solution is to
specify the bootloader name (even though the DHCP or bootp server sends
that information):
<pre>0 &gt; <b>boot enet:,ofwboot.xcf </b></pre>
<p>

Additionally, older PowerMacintosh systems with Open Firmware 1.0.5 using
<tt>ofwboot.xcf</tt> version 1.2 (included in NetBSD 1.5.3 and earlier)
can't load compressed kernels.  Use <tt>gunzip</tt> to uncompress the kernel.
<p>
There have also reports of some Open Firmware 2.0.x machines which don't get all
of the information properly from the BOOTP server, but a DHCP server
serving BOOTP requests works.  Keep this in mind later.
<p>

The first generation of iMacs (Bondi Blue) have a known problem with DHCP
with their
original firmware.  You should download the latest firmware for these
iMacs.  Other early Open Firmware 3 models may have similar problems.  See
<a href="../../../ports/macppc/faq.html#ofw-bugs">Are there bugs in my 
machine's Open Firmware implementation?</a>
<p>

<big><b>Obtaining an IP address and downloading the boot loader</b></big>
<p>

Power Macintosh workstations first try to acquire an IP address using
either the Internet Bootstrap Protocol (BOOTP), or the Dynamic Host
Configuration protocol (DHCP) depending on which version of Open Firmware
they have.  The bootpd and dhcpd servers use the ethernet address (MAC) of the
client machine to determine its IP address and a bootloader filename. If
this request is successful, Open Firmware expects to be able to download a
second-stage boot program via the Trivial File Transfer Protocol (TFTP).
It will do this by setting up a TFTP connection to the server that
answered the earlier BOOTP or DHCP request, and asking for the file name
returned by the server. The second-stage boot program then loads the
kernel using NFS from the server and path specified by the BOOTP or DHCP
request. <p>

Note, the very early PCI PowerMacintoshes (i.e. early Open Firmware 1.0.5
machines) had a motherboard error which manifests as the ethernet address
being reversed (e.g. <tt>00:a0:40:0b:77:2c</tt> when corrected
becomes <tt>00:05:02:d0:ee:34</tt>).  Running certain Mac OS utilities will
correct this.  If
you find that netbooting suddenly fails to work, double-check your
ethernet address and see if it has been fixed, or if you zapped the PRAM
and erased the fix.
<p>
To determine the MAC address Open Firmware will use for its BOOTP/DHCP request, type the following command:
<pre>0 &gt <b> dev enet</b>
0 &gt; <b>.properties</b>
[...]
    local-mac-address CCCCCCCC CCCC
[...]</pre>
</dd></dl>

<h2>Open Firmware commands</h2>
<dl><dt><dd>
On Open Firmware 3 machines,
you can make it boot over ethernet by holding down the "N" key during startup
without even entering Open Firmware.
<p>

On earlier machines (or if you want to configure your Open Firmware 3 machine 
to always netboot), you must first 
<a href="../../../ports/macppc/faq.html#ofw-access">get to the Open Firmware 
prompt</a> and enter a boot command at the prompt.
<p>

The syntax used for netbooting varies depending on Open Firmware
version. In Open Firmware 1.0.5, 1.1.22, 2.0.x, and 2.4 you will need to type 
one of:
<pre>0 &gt; <b>boot enet:,ofwboot.xcf</b>
0 &gt; <b>boot enet:,ofwboot.xcf netbsd.ram.gz</b>   #to specify a kernel other than "netbsd"
0 &gt; <b>boot enet:192.168.1.5,ofwboot.xcf netbsd</b>  #if having trouble getting all info from bootpd</pre>
<p>

In Open Firmware 3 you will need to type one of:
<pre>0 &gt; <b>boot enet:0,ofwboot.xcf</b>
0 &gt; <b>boot enet:0,ofwboot.xcf netbsd.ram.gz</b>           #to specify a kernel other than "netbsd"
0 &gt; <b>boot enet:192.168.1.5,ofwboot.xcf netbsd</b>           #if having trouble getting all info from dhcpd</pre>
<p>

Some users have reported trouble with DHCP sending the proper
information.  The find that it is necessary to specify the kernel name on
the command line.
<p>

Other arguments can be passed to the
boot loader or kernel by specifying them on the end of the command
line (e.g. <tt>boot&nbsp;enet:,ofwboot.xcf&nbsp;-a</tt>).  See the
<a href="http://man.NetBSD.org/man/ofwboot+8.macppc+NetBSD-current"><tt>ofwboot(8)</tt></a>
man page.
<p>

To make booting over the network the default, set the Open Firmware variables
(where the presence or absence of the <tt>0</tt> depends on Open Firmware 
version):
<pre>0 &gt; <b>setenv boot-device enet:[0],ofwboot.xcf</b>
0 &gt; <b>setenv auto-boot? true</b>
0 &gt; <b>reset-all</b></pre>
</dd></dl>

See also <a href="../../../ports/macppc/faq.html#ofw-use">What can I do at 
the Open Firmware prompt?</a> and 
<a href="../../../ports/macppc/faq.html#ofw-variables">The Open Firmware 
variables of interest</a>.

<h2>Begin setting things up (suggested order):</h2>
<dl><dt><dd>
<ol>
<li><a href="bootpd.html"><tt>bootpd</tt></a> (Open Firmware 1 and 2) or 
    <a href="dhcpd.html"><tt>dhcpd</tt></a> (Open Firmware 3)
<li><a href="tftpd.html"><tt>tftpd</tt></a>
<li><a href="nfs.html"><tt>nfs</tt></a>
<li><a href="files.html">client filesystem</a>
<li><a href="finish.html">finishing up</a>
</ol>
</dd></dl>

<hr>

<a href="intro.html">Previous</a> |
<a href="bootpd.html">Next</a> |
<a href="./">Table of Contents</a>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../../"><img
        src="../../../images/NetBSD-flag.png" border="0"
        width="90" height="90" alt=""></a> 
  </td><td>
    <a href="../../../"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td> 
    <a href="../../../Documentation/"><img
        src="../../../images/NetBSD-flag.png" border="0"
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../../Documentation/"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">(Contact us)</a>
  $NetBSD: intro.macppc.html,v 1.2 2007/07/29 02:41:24 kano Exp $<br>
  <a href="../../../Misc/disclaimer.html">Copyright &copy; 1998-2004
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
