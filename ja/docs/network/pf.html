<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Website XSL Stylesheet V2.6.0">
<link rel="home" href="../../../." title="Welcome to The NetBSD Project: Of course it runs NetBSD.">
<link rel="up" href="../../../ja/docs/network/." title="The NetBSD Network FAQ">
<link rel="previous" href="../../../ja/docs/network/gprs.html" title="GPRS, CDPD HowTo">
<link rel="next" href="../../../ja/docs/network/netboot/." title="Diskless NetBSD HOW-TO">
<link rel="first" href="../../../ja/docs/network/dhcp.html" title="NetBSD DHCP HOWTO">
<link rel="last" href="../../../ja/docs/network/pppoe/." title="NetBSD ドキュメンテーション: PPPoE (DSL) 経由の接続手順">
<link rel="stylesheet" href="../../../global.css" type="text/css">

<title>NetBSD Packet Filter 情報</title>
</head>
<body class="website"><div class="webpage">
<a name="ja-docs-network-pf"></a><div id="top"><a href="#mainContent" class="doNotDisplay doNotPrint">本文へ飛ぶ。</a></div>
<div id="header">
<div class="topNavigation">
<span>» </span><a href="../../../docs/guide/en/">
	  ガイド</a> |
	<a href="http://man.NetBSD.org/">マニュアルページ</a> |
	<a href="../../../ja/mailinglists/">
	  メーリングリスト</a>と
	<a href="http://mail-index.NetBSD.org/">記事</a> |
	<a href="http://cvsweb.NetBSD.org/">CVS リポジトリー</a> |
	バグの<a href="http://www.NetBSD.org/cgi-bin/sendpr.cgi?gndb=netbsd">報告</a>
	と
	<a href="../../../ja/support/query-pr.html">
	 照会</a> |
	<a href="../../../ja/docs/software/packages.html">
	  ソフトウェアパッケージ
	</a>
</div>
<div class="centralHeader">
<a href="../../../ja/"><img alt='NetBSD プロジェクト "Of course it runs NetBSD"' width="506" height="90" src="../../../images/NetBSD-headerlogo.png"></a><div class="headerTools"><div id="headerSearch">
<div id="header-cse-search-form" style="width: 24%;">Google custom search</div>
<script src="http://www.google.com/jsapi" type="text/javascript"></script><script type="text/javascript"> 
		  google.load('search', '1', {language : 'ja'});
		  google.setOnLoadCallback(function() {
		  var header_customSearchControl = new google.search.CustomSearchControl(
		  '016685087845965994609:5539h4dkepg');

		  header_customSearchControl.setResultSetSize(google.search.Search.FILTERED_CSE_RESULTSET);
		  var header_options = new google.search.DrawOptions();
		  header_options.enableSearchboxOnly("http://google.com/cse?cx=016685087845965994609:5539h4dkepg");
		  header_customSearchControl.draw('header-cse-search-form', header_options);
		  }, true);
		</script><link rel="stylesheet" href="http://www.google.com/cse/style/look/default.css" type="text/css">
</div></div>
</div>
<div class="navBar">
<span class="doNotDisplay">
	  案内:
	</span><a href="../../../ja/">
	  ホーム</a> | 
	<a href="../../../ja/about/">
	  概要</a> | 
	<a href="../../../ja/gallery/">
	  展示室</a> | 
	<a href="../../../ja/releases/">
	  ダウンロード</a> | 
	<a href="../../../ja/docs/">
	  ドキュメンテーション</a> | 
	<a href="../../../ja/support/">
	  サポート</a> | 
	<a href="../../../ja/community/">
	  コミュニティー</a> | 
	<a href="../../../ja/ports/">
	  機種</a>
</div>
</div>
<div id="content"><div class="fullWidth"><div class="rowOfBoxes">
<h1>NetBSD Packet Filter 情報</h1>
<p>
<a class="ulink" href="http://www.benzedrine.cx/pf.html" target="_top">OpenBSD Packet Filter</a> (PF)
は、 2004 年 7 月以来 NetBSD に統合されており、リリース版としては
<a class="ulink" href="../../releases/formal-3/NetBSD-3.0.html" target="_top">NetBSD 3.0</a>
で初めて対応しました。
NetBSD での PF の使い方は、基本的に OpenBSD と同じですが、若干の違いがあります。
このページでは、その違いについて説明するとともに、
PF の NetBSD への移植と統合に関する追加情報を提供します。
</p>
<h3 class="title"><a name="overview">情報</a></h3>
<ul>
<li><a href="#availability">可用性</a></li>
<li><a href="#kernel">カーネルオプション</a></li>
<li><a href="#enable">PF を有効化する</a></li>
<li><a href="#configuration">設定</a></li>
<li><a href="#bridge">ブリッジにおける PF の設定</a></li>
<li><a href="#altq">ALTQ</a></li>
<li><a href="#differences">OpenBSD との差異</a></li>
</ul>
<h3 class="title"><a name="links">リンク</a></h3>
<ul>
<li><a href="#misclinks">雑多なリンク</a></li>
<li><a href="#manpages">マニュアルページ</a></li>
</ul>
<hr>
<h3 class="title">情報</h3>
<h4 class="title">
<a name="availability"></a>可用性 (<a href="#overview">top</a>)
  </h4>

<p>
NetBSD 4.0 には、 OpenBSD 3.7 由来の PF に 3.7 枝由来の修正がおこなわれたものが附属します。
</p>

<p>
NetBSD 3.0 は PF に公式に対応した最初のリリース版です。
NetBSD 3.0 には、 OpenBSD 3.6 由来の PF に 3.6 枝由来の修正がおこなわれたものが附属します。
</p>


<h4 class="title">
<a name="kernel"></a>カーネルオプション (<a href="#overview">top</a>)
  </h4>
<p>
PF を使うためにカーネルのコンパイルは必要ありません。 LKM <code class="filename">/usr/lkm/pf.o</code>
を使うことができます。 <a href="http://netbsd.gw.com/cgi-bin/man-cgi?modload+8+NetBSD-5.1+i386">modload(8)</a> を使ってこの LKM をロードします。
</p>
<pre class="programlisting">
# modload /usr/lkm/pf.o
</pre>
<p>
しかし、 PF をカーネル内に組み込んでおきたい場合は、
少なくとも以下のオプションを有効にする必要があります。
</p>
<pre class="programlisting">
options 	PFIL_HOOKS	# <a href="http://netbsd.gw.com/cgi-bin/man-cgi?pfil+9+NetBSD-5.1+i386">pfil(9)</a> packet filter hooks
</pre>
<p>
このオプションは、GENERIC カーネルでデフォルトで有効になっているはずです。
カーネル内で PF を有効にするためには、
以下の擬似デバイスをカーネルコンフィギュレーションに追加しておきます。
</p>
<pre class="programlisting">
pseudo-device	pf		# PF packet filter
pseudo-device	pflog		# PF log interface
</pre>
<p>
PF を使ったパケットのロギングに興味がなければ、
pflog デバイスは外してもよいでしょう。
</p>

<p>
以上の設定を有効にするため、カーネルを再コンパイルしてインストールする必要があります。
</p>

<h4 class="title">
<a name="enable"></a>PF を有効化する (<a href="#overview">top</a>)
  </h4>
<p>
ブート時に PF を有効化するには、<code class="filename">/etc/rc.conf</code> で
<strong class="userinput"><code>pf=YES</code></strong> を設定します。

なお、 PF の設定ファイルが存在しない場合、
ブート手続きは中断します。
(<a class="ulink" href="#configuration" target="_top">設定</a>もご覧ください)。

PF の手動での起動、停止、再起動、再読み込みには、rc.d スクリプト
<code class="filename">/etc/rc.d/pf</code> を使えます。
</p>

<p>
ブート時に <a href="http://netbsd.gw.com/cgi-bin/man-cgi?pflogd+8+NetBSD-5.1+i386">pflogd(8)</a> (pf ロギングデーモン) を有効化するには、
<code class="filename">/etc/rc.conf</code> で <strong class="userinput"><code>pflogd=YES</code></strong> を設定します。
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pflogd+8+NetBSD-5.1+i386">pflogd(8)</a> の手動での起動、停止、再起動には、rc.d スクリプト
<code class="filename">/etc/rc.d/pflogd</code> を使えます。
</p>

<p>
ブート時に LKM をロードするには、 <code class="filename">/etc/rc.conf</code> で
<strong class="userinput"><code>lkm=YES</code></strong> を設定し、以下の行を
<code class="filename">/etc/lkm.conf</code> に追加する必要があります。
</p>
<pre class="programlisting">
/usr/lkm/pf.o - - - - BEFORENET
</pre>
<p>
</p>

<p>
/usr がルートパーティションとは別のパーティションにある場合は、
以下の内容を <code class="filename">/etc/rc.conf</code> に追加することも必要です。
</p>
<pre class="programlisting">
critical_filesystems_local="${critical_filesystems_local} /usr"
</pre>
<p>
</p>


<h4 class="title">
<a name="configuration"></a>設定 (<a href="#overview">top</a>)
  </h4>
<p>
デフォルトの設定ファイルは <code class="filename">/etc/pf.conf</code> です。
これは、 <code class="filename">/etc/rc.conf</code> で変数 <strong class="userinput"><code>pf_rules</code></strong>
を設定して変えることができます。
</p>

<p>
初期設定ファイルは
<code class="filename">/etc/defaults/pf.boot.conf</code> です。この設定は、
ネットワーク設定をしている最中にマシンを攻撃から防御するためだけのものです。
このデフォルト設定は、 <code class="filename">/etc/pf.boot.conf</code> というファイルを作ることで
上書きすることができますが、ほとんどの場合は必要ないはずです。
このファイルに関するさらなる情報は、 <a href="http://netbsd.gw.com/cgi-bin/man-cgi?pf.boot.conf+5+NetBSD-5.1+i386">pf.boot.conf(5)</a> をご覧ください。
</p>

<p>
両設定ファイルの書式は、
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pf.conf+5+NetBSD-5.1+i386">pf.conf(5)</a> マニュアルページで説明されています。
</p>

<h4 class="title">
<a name="bridge"></a>ブリッジにおける PF の設定 (<a href="#overview">top</a>)
  </h4>
<p>
PF はブリッジングモードに対応していますが、ブリッジ上でのパケットフィルタリングを有効化するには、
カーネルを再コンパイルする必要があります。
以下の行をカーネルコンフィギュレーションに追加します。
</p>
<pre class="programlisting">
options         BRIDGE_IPF	# bridge uses IP/IPv6 pfil hooks too
</pre>
<p>
<a class="ulink" href="../../../docs/guide/en/chap-net-misc.html#chap-net-misc-bridge" target="_top">NetBSD Guide</a> で説明されているとおり、
ブリッジを設定します。
次に、 <a href="http://netbsd.gw.com/cgi-bin/man-cgi?brconfig+8+NetBSD-5.1+i386">brconfig(8)</a> コマンドを使ってブリッジ上でパケットフィルタリングを有効化します。
</p>
<pre class="programlisting">
# brconfig bridgeN ipf
</pre>
<p>
"ipf" オプションは PF に対しても適用されます。このオプションは実際には
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pfil+9+NetBSD-5.1+i386">pfil(9)</a> インターフェースを有効にするものだからです。
これで、ブリッジとして設定されたインターフェース上のパケットを
PF がフィルターできるようになったはずです。なお、
同じデータが両インターフェースを通過するので、
フィルターする必要があるのは片方のインターフェース上だけです。
</p>

<h4 class="title">
<a name="altq"></a>ALTQ (<a href="#overview">top</a>)
  </h4>
<p>
PF での ALTQ の使用は、NetBSD 4.0 から対応しています。
以下のカーネルオプションが関係します。
</p>
<pre class="programlisting">
options         ALTQ            # Manipulate network interfaces' output queues
options         ALTQ_CBQ        # Class-Based Queueing
options         ALTQ_HFSC       # Hierarchical Fair Service Curve
options         ALTQ_PRIQ       # Priority Queueing
options         ALTQ_RED        # Random Early Detection
</pre>
<p>
なお、pf を組み込んだカーネルをコンパイルする必要があることに注意してください。
PF LKM とカーネル内の ALTQ の組合せは動作しません。
</p>

<p>
ALTQ の設定については、特別なことは何ら必要ありません。ドキュメンテーションに従ってルールを設定するだけです。
ルールの設定例がいくつか <code class="filename">/usr/share/examples/pf</code> にあります。
</p>

<h4 class="title">
<a name="differences"></a>OpenBSD との差異 (<a href="#overview">top</a>)
  </h4>
<p>
NetBSD 用の PF は、OpenBSD のものとくらべ若干の違いがあります。
違いのほとんどは、機能の欠如です。

</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<a class="ulink" href="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync" target="_top">pfsync(4)</a>
には対応していません (プロトコル番号の割り当ての問題のため)。
うまくいけば将来のリリースで解決するでしょう。
</li>
<li class="listitem">
ALTQ には NetBSD 4.0 から対応しています。
</li>
<li class="listitem">
<a class="ulink" href="http://www.openbsd.org/cgi-bin/man.cgi?query=carp" target="_top">carp(4)</a>
には NetBSD 4.0 から対応しています。
</li>
<li class="listitem">
'group' キーワードは何もしません。
NetBSD は GID を uidinfo 構造体に保持しないからです。
おそらく、将来のリリースでは解決するでしょう。
</li>
<li class="listitem">
ルートラベルにもとづくフィルタリングは機能しません。 NetBSD は
経路用のラベルを持ちません。将来のリリースで対応するかどうかは、
わかりません。
</li>
<li class="listitem">
初期設定ファイル <a href="http://netbsd.gw.com/cgi-bin/man-cgi?pf.boot.conf+5+NetBSD-5.1+i386">pf.boot.conf(5)</a> は NetBSD 特有のファイルです。
OpenBSD は  PF の初期設定を /etc/rc から読み込みますが、
このファイルは変更が必要なときの扱いが面倒です。
このため、 NetBSD では PF の初期設定用に新しいファイルを追加しています。
</li>
<li class="listitem">
<a class="ulink" href="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd" target="_top">spamd</a>
は最初は NetBSD に導入されましたが、 3.0 のリリース前に削除されました。
これは PF の一部とはされず、 pkgsrc で利用可能になっています
(<a class="ulink" href="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/mail/spamd/README.html" target="_top">mail/spamd</a>)。
</li>
</ul></div>
<p>
</p>
<hr>
<h3 class="title">リンク</h3>
<h4 class="title">
<a name="misclinks"></a>雑多なリンク (<a href="#links">top</a>)
  </h4>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<a class="ulink" href="http://www.openbsd.org/faq/pf/index.html" target="_top">OpenBSD PF User's Guide</a>
</li>
<li class="listitem">
<a class="ulink" href="http://home.nuug.no/~peter/pf/" target="_top">Peter N. M. Hansteen's Firewalling with PF</a>
</li>
<li class="listitem">
<a class="ulink" href="http://nedbsd.nl/~ppostma/pf/" target="_top">PF loadable kernel module for NetBSD 2</a>
</li>
</ul></div>

<h4 class="title">
<a name="manpages"></a>マニュアルページ (<a href="#links">top</a>)
  </h4>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pf+4+NetBSD-5.1+i386">pf(4)</a> - パケットフィルター</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pflog+4+NetBSD-5.1+i386">pflog(4)</a> - パケットフィルターロギングインターフェース</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pf.boot.conf+5+NetBSD-5.1+i386">pf.boot.conf(5)</a> - パケットフィルターの初期設定</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pf.conf+5+NetBSD-5.1+i386">pf.conf(5)</a> - パケットフィルターの設定ファイル</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pf.os+5+NetBSD-5.1+i386">pf.os(5)</a> - オペレーティングシステムの指紋ファイルの形式</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?authpf+8+NetBSD-5.1+i386">authpf(8)</a> - 認証ゲートウェイユーザーシェル</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?ftp-proxy+8+NetBSD-5.1+i386">ftp-proxy(8)</a> - インターネットファイル転送プロトコルのプロキシーサーバー</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pfctl+8+NetBSD-5.1+i386">pfctl(8)</a> - パケットフィルター (PF) およびネットワークアドレス変換 (NAT) デバイスの制御</li>
<li class="listitem">
<a href="http://netbsd.gw.com/cgi-bin/man-cgi?pflogd+8+NetBSD-5.1+i386">pflogd(8)</a> - パケットフィルターロギングデーモン</li>
</ul></div>
<hr>
<em><a href="./">ネットワーキングドキュメンテーション</a></em> に戻る</div></div></div>
<div class="navfoot"></div>
<div id="footer"><center>
<span class="footfeed"><a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">
	  連絡</a> |
      </span><span class="footcopy"><a href="../../../ja/about/disclaimer.html">
      免責事項</a> |

      <span class="copyright">Copyright © 1994-2012 The NetBSD Foundation, Inc. </span>ALL RIGHTS RESERVED.<br>NetBSD<sup>®</sup> は The NetBSD
	Foundation, Inc. の登録商標です。</span>
</center></div>
</div></body>
</html>
