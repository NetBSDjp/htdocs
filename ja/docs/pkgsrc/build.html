<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 17. 構築の手順</title>
<link rel="stylesheet" type="text/css" href="/global.css">
<meta name="generator" content="DocBook XSL Stylesheets VX.X.X">
<link rel="home" href="index.html" title="The pkgsrc guide">
<link rel="up" href="developers-guide.html" title="Part II. pkgsrc 開発者向けの手引き">
<link rel="prev" href="options.html" title="Chapter 16. オプションの扱い">
<link rel="next" href="tools.html" title="Chapter 18. 構築や実行のために必要なツール">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 17. 構築の手順</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="options.html">Prev</a> </td>
<th width="60%" align="center">Part II. pkgsrc 開発者向けの手引き</th>
<td width="20%" align="right"> <a accesskey="n" href="tools.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" title="Chapter 17. 構築の手順">
<div class="titlepage"><div><div><h2 class="title">
<a name="build"></a>Chapter 17. 構築の手順</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="build.html#build.intro">17.1. 序</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.prefix">17.2. プログラムの場所</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.builddirs">17.3. 構築の過程で使われるディレクトリー</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.running">17.4. 相の実行</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.fetch">17.5. <span class="emphasis"><em>fetch</em></span> 相</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="build.html#build.fetch.what">17.5.1. 何を、どこから取得するか</a></span></dt>
<dt><span class="sect2"><a href="build.html#build.fetch.how">17.5.2. ファイルの取得はどのようにおこなわれるか?</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="build.html#build.checksum">17.6. <span class="emphasis"><em>checksum</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.extract">17.7. <span class="emphasis"><em>extract</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.patch">17.8. <span class="emphasis"><em>patch</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.tools">17.9. <span class="emphasis"><em>tools</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.wrapper">17.10. <span class="emphasis"><em>wrapper</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.configure">17.11. <span class="emphasis"><em>configure</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.build">17.12. <span class="emphasis"><em>build</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.test">17.13. <span class="emphasis"><em>test</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.install">17.14. <span class="emphasis"><em>install</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.package">17.15. <span class="emphasis"><em>package</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.clean">17.16. 掃除をする</a></span></dt>
<dt><span class="sect1"><a href="build.html#build.helpful-targets">17.17. 他の役に立つターゲット</a></span></dt>
</dl>
</div>
<div class="sect1" title="17.1. 序">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.intro"></a>17.1. 序</h2></div></div></div>
<p>本章では、パッケージがどのように構築されるかについて、詳しく説明します。
    パッケージの構築は、複数の<span class="emphasis"><em>相 (phase)</em></span> (たとえば、<code class="varname">fetch</code>,
    <code class="varname">build</code>, <code class="varname">install</code>) にわかれており、
    そのすべてを以下の各節で説明します。それぞれの段階は、<code class="varname">pre-</code>,
    <code class="varname">do-</code>, <code class="varname">post-</code>
    のいずれかが相名の前についた、いわゆる<span class="emphasis"><em>期 (stage)</em></span>
    にわかれます。(たとえば、
    <code class="varname">pre-configure</code>, <code class="varname">post-build</code> などです。)
    実際に何かがおこなわれるのは、ほとんどが <code class="varname">do-*</code> 期においてです。</p>
<p>標準的なターゲット (<code class="varname">fetch</code>
    など) は、決して上書きしないでください。変更する必要がある場合は、
    対応する <code class="varname">do-*</code> ターゲットを上書きしてください。</p>
<p>プログラムを構築するための基本的な手順は常に同じです。最初に、プログラムの
    ソースファイル(<span class="emphasis"><em>distfile</em></span>)をローカルシステムへ持ってきて展開します。
    コンパイルするための pkgsrc 独自のパッチを適用した後に、ソフトウェアを設定
    し、構築(通常、コンパイルすることによって)します。最後に作成されたバイナリー
    等を、システムにインストールします。</p>
<p>それぞれの段階で何が起きているかを、もっと詳しく把握するために、
    <code class="varname">PKG_VERBOSE</code> 変数を設定することができます。
    または、<span class="emphasis"><em>patch</em></span> の段階における詳細に関心があるだけなら、
    <code class="varname">PATCH_DEBUG</code> 変数を設定することもできます。</p>
</div>
<div class="sect1" title="17.2. プログラムの場所">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.prefix"></a>17.2. プログラムの場所</h2></div></div></div>
<p>次のセクションでNetBSDパッケージシステムによって実行される手順の概略を述
    べる前に、プログラムがインストールされる場所、その場所に影響をおよぼす変数
    について簡単に記述します。</p>
<p>自動変数<code class="varname">PREFIX</code>は、最終的にプログラムのすべてのファイルがインストールされる
    場所をしめします。通常、<code class="varname">LOCALBASE</code> (<code class="filename">/usr/pkg</code>)、または<code class="filename">cross</code>カテゴリーの
    パッケージのための<code class="varname">CROSSBASE</code>と同じ場所になっています。
    <code class="varname">PREFIX</code>の値は、プログラムのソース中でこれらのファイルが符号化されるさまざ
    まな場所に使用されるべきです。
    詳細に関しては、<a class="xref" href="components.html#components.patches" title="11.3. patches/*">Section 11.3, “patches/*”</a>および<a class="xref" href="fixes.html#fixes.libtool" title="19.3.1. 共有ライブラリー - libtool">Section 19.3.1, “共有ライブラリー - libtool”</a>を参照して下さい。</p>
<p>これらの変数のどれかを選択し使用する場合には、
    以下のルールに従ってください。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PREFIX</code>は常に現在のパッケージがインストールされる場所を指します。パッ
	ケージ自身のインストール先のパスを参照する時に、<span class="quote">“<span class="quote">${PREFIX}</span>”</span>を使用してくだ
	さい。</p></li>
<li class="listitem"><p><code class="varname">LOCALBASE</code>は、すべての非X11パッケージがインストールされる場所です。他
	の非X11パッケージによってインストールされたインクルードファイルやライブ
	ラリーの場所をさがすためのコンパイラーの-Iや-Lオプションを指定する場合に、
	<span class="quote">“<span class="quote">${LOCALBASE}</span>”</span>を使用してください。
	<code class="varname">LOCALBASE</code> という変数名は、FreeBSD でパッケージをすべて
	<code class="filename">/usr/local</code> にインストールしていたことに由来します。
	pkgsrc では <code class="filename">/usr/local</code> をシステム管理者のために使わないようにしているので、
	この変数名は間違った名前です。</p></li>
<li class="listitem"><p><code class="varname">X11BASE</code>は、実際に(xsrcなどに由来する)X11ディストリビューションがイン
	ストールされる場所です。
	<span class="emphasis"><em>通常の</em></span>X11のインクルードファイル(パッケージとして
	インストールされていない)をさがす場合、<span class="quote">“<span class="quote">${X11BASE}</span>”</span>を使用してください。</p></li>
<li class="listitem">
<p>X11 ベースのパッケージは特別です。インストールされる場所は、
	<code class="varname">X11BASE</code> と <code class="varname">LOCALBASE</code> のどちらに依存することもありえます。</p>
<p>通常、X11 のパッケージは、できるかぎり <code class="varname">LOCALBASE</code>
	にインストールするものです。X11 のパッケージでは、X11 が必要なことを要求し、
	適切な編集フラグを持つようにするために、
	<code class="filename">../../mk/x11.buildlink3.mk</code>
	をインクルードする必要があります。</p>
<p>しかし、<code class="varname">LOCALBASE</code> 以下にはインストールできないパッケージもあります。
	app-defaults ファイルが附属するようなパッケージが該当します。
	このようなパッケージは例外であり、<code class="varname">X11BASE</code>
	以下にインストールする必要があります。そうするためには、
	パッケージ側で <code class="varname">USE_X11BASE</code> または <code class="varname">USE_IMAKE</code>
	のいずれかを設定します。</p>
<p>註:
	<code class="filename">Makefile</code> で <code class="varname">USE_IMAKE</code> や <code class="varname">USE_X11BASE</code>
	を定義したパッケージによってインストールされたインクルードファイルやライブラリーをさがす場合、
	<code class="filename">${X11BASE}</code> と
	<code class="filename">${LOCALBASE}</code> を<span class="emphasis"><em>両方</em></span>調べる必要があります。
	X11 パッケージをすべて強制的に <code class="varname">LOCALBASE</code> にインストールさせるために、
	<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/xpkgwedge/README.html" target="_top"><code class="filename">pkgtools/xpkgwedge</code></a> パッケージが標準で有効になっています。</p>
</li>
<li class="listitem"><p>X11パッケージのインストール場所を参照する用途には、<code class="varname">X11PREFIX</code>を使って
	ください。<code class="varname">X11PREFIX</code>は、xpkgwedgeがインストールされていない場合は
	<code class="varname">X11BASE</code>となり、xpkgwedgeがインストールされている場合は<code class="varname">LOCALBASE</code>と
	なります。</p></li>
<li class="listitem">
<p>xpkgwedgeがインストールされている場合、パッケージによってインストール先
	が<code class="varname">X11BASE</code>になっていたり<code class="varname">LOCALBASE</code>になっていたりすることがあります。インス
	トールされているパッケージのprefixを決めるために、<code class="varname">EVAL_PREFIX</code>定義を使う
	ことができます。この定義に<span class="quote">“<span class="quote">DIRNAME=&lt;package&gt;</span>”</span>の形式の組を書くと、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>変
	数<code class="varname">DIRNAME</code>が、インストールされているパッケージ &lt;package&gt;のprefixに設定され
	ます。そのパッケージがインストールされていない場合は<span class="quote">“<span class="quote">${X11PREFIX}</span>”</span>に設定さ
	れます。</p>
<p>例を使って説明するのが一番いいでしょう。</p>
<p>以下は、
	<code class="filename">pkgsrc/wm/scwm/Makefile</code>からの抜粋です。</p>
<pre class="programlisting">
EVAL_PREFIX+=           GTKDIR=gtk+
CONFIGURE_ARGS+=        --with-guile-prefix=${LOCALBASE:Q}
CONFIGURE_ARGS+=        --with-gtk-prefix=${GTKDIR:Q}
CONFIGURE_ARGS+=        --enable-multibyte
</pre>
<p><code class="varname">EVAL_PREFIX</code>を使って評価するパッケージに対して、以下のような定義を使って
	デフォルトを定義することができます。</p>
<pre class="programlisting">
GTKDIR_DEFAULT= ${LOCALBASE}
</pre>
<p>ここで<code class="varname">GTKDIR</code>は、
	<code class="varname">EVAL_PREFIX</code>
	での最初の定義の組に対応します。</p>
</li>
<li class="listitem"><p>パッケージは <code class="filename">${PREFIX}</code> 以下に、
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?hier+7+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a> に準じてファイルをインストールするようにします。
	ただしマニュアルページは例外で、<code class="filename">${PREFIX}/share/man</code>
	ではなく <code class="filename">${PREFIX}/man</code> にインストールします。</p></li>
</ul></div>
</div>
<div class="sect1" title="17.3. 構築の過程で使われるディレクトリー">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.builddirs"></a>17.3. 構築の過程で使われるディレクトリー</h2></div></div></div>
<p>パッケージの構築時には、ソースファイル、一時ファイル、
    pkgsrc 内部ファイルなどを置いておくために、さまざまなディレクトリーが使われます。
    そのようなディレクトリーについて説明します。</p>
<p>ディレクトリーを指す変数のなかには、相対パス名を値に持つものがあります。
    このような相対パス名の基点となるディレクトリーは、おもに二つあります。
    一つは <code class="varname">PKGSRCDIR/PKGPATH</code> で、pkgsrc 特有のディレクトリー用です。
    もう一つは  <code class="varname">WRKSRC</code> で、パッケージそのものの内部にあるディレクトリー用です。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">PKGSRCDIR</code></span></dt>
<dd><p>絶対パス名で、
      pkgsrc のルートディレクトリーを指します。
      通常は、この変数を使う必要はありません。</p></dd>
<dt><span class="term"><code class="varname">PKGDIR</code></span></dt>
<dd><p>当該パッケージを指す
      絶対パス名です。</p></dd>
<dt><span class="term"><code class="varname">PKGPATH</code></span></dt>
<dd><p><code class="varname">PKGSRCDIR</code>
      を基点とした相対パス名で、
      当該パッケージを指します。</p></dd>
<dt><span class="term"><code class="varname">WRKDIR</code></span></dt>
<dd><p>絶対パス名で、全作業がおこなわれるディレクトリーを指します。
      distfile はこのディレクトリーに展開されます。
      一般的に、このディレクトリーには、
      <span class="emphasis"><em>buildlink</em></span> や
      <span class="emphasis"><em>wrappers</em></span> など、
      pkgsrc の各種基盤が使う一時ディレクトリーも含まれます。</p></dd>
<dt><span class="term"><code class="varname">WRKSRC</code></span></dt>
<dd><p>絶対パス名で、distfile が展開されるディレクトリーを指します。
      普通は、<code class="varname">WRKDIR</code> 直下のサブディレクトリーであり、
      多くの場合は、このディレクトリーにおける、
      唯一の隠されていないディレクトリーエントリーです。この変数は、パッケージの
      <code class="filename">Makefile</code> で変更することができます。</p></dd>
</dl></div>
<p><code class="varname">CREATE_WRKDIR_SYMLINK</code> 定義は、
    <span class="emphasis"><em>yes</em></span> または <span class="emphasis"><em>no</em></span> のいずれかの値をとり、
    標準状態では <span class="emphasis"><em>no</em></span> になります。これは、
    pkgsrc の個々のパッケージのディレクトリー内に、
    <code class="varname">WRKDIR</code> へのシンボリックリンクを作成するか否かを示します。
    pkgsrc ツリーを読み取り専用として使いたい場合は、
    <code class="varname">CREATE_WRKDIR_SYMLINK</code> の値を
    <span class="emphasis"><em>no</em></span> にしてください。</p>
</div>
<div class="sect1" title="17.4. 相の実行">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.running"></a>17.4. 相の実行</h2></div></div></div>
<p><span class="command"><strong>make phase</strong></span> (<span class="emphasis"><em>phase</em></span> は相の名前) と打てば、
    その相を実行することができます。
    こうすると、その相のために必要な相をすべて自動的に実行します。
    相を指定しない場合は <code class="varname">build</code> 相になります。つまり、
    あるパッケージのディレクトリーで、引数なしで <span class="command"><strong>make</strong></span>
    を実行すると、パッケージが構築されますが、インストールはされません。</p>
</div>
<div class="sect1" title="17.5. fetch 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.fetch"></a>17.5. <span class="emphasis"><em>fetch</em></span> 相</h2></div></div></div>
<p>パッケージの構築の最初の段階は、配布ファイル (distfiles)
    を、そのファイルを配布しているサイトから取得することです。
    これは <span class="emphasis"><em>fetch</em></span> 相がおこなう仕事です。</p>
<div class="sect2" title="17.5.1. 何を、どこから取得するか">
<div class="titlepage"><div><div><h3 class="title">
<a name="build.fetch.what"></a>17.5.1. 何を、どこから取得するか</h3></div></div></div>
<p>単純な場合では、<code class="varname">MASTER_SITES</code> で
      distfile (distfile のファイル名は <code class="varname">DISTNAME</code> が使われます)
      を取得する URL をすべて定義します。
      これより複雑な場合については、以下で説明します。</p>
<p>変数 <code class="varname">DISTFILES</code> は、取得する必要のある
      distfile を並べたリストを指定します。この値は、標準では
      <code class="literal">${DISTNAME}${EXTRACT_SUFX}</code> になり、
      ほとんどのパッケージではあえて定義する必要がありません。
      <code class="varname">EXTRACT_SUFX</code> は、標準では <code class="literal">.tar.gz</code>
      になりますが、自由に変更することができます。なお、標準で定義される
      distfile に加えて別の distfile が必要な場合は、
      それを <code class="literal">+=</code> 演算子を使って追加することはできません。
      たとえば以下のように書く必要があります。</p>
<pre class="programlisting">
DISTFILES=      ${DISTNAME}${EXTRACT_SUFX} additional-files.tar.gz
</pre>
<p>各 distfile は、通常は <code class="varname">MASTER_SITES</code>
      に並べられたサイトから取得されます。パッケージに複数の
      <code class="varname">DISTFILES</code> または複数の
      <code class="varname">PATCHFILES</code> があり、それらが異なるサイトで配布されている場合は、
      <code class="filename"><em class="replaceable"><code>distfile</code></em></code>
      ファイル (サフィックスを含む) の配布場所の URL を並べたリストを
      <code class="varname">SITES.<em class="replaceable"><code>distfile</code></em></code>
      に設定することができます。</p>
<pre class="programlisting">
DISTFILES=      ${DISTNAME}${EXTRACT_SUFX}
DISTFILES+=     foo-file.tar.gz
SITES.foo-file.tar.gz= \
http://www.somewhere.com/somehow/ \
http://www.somewhereelse.com/mirror/somehow/
</pre>
<p>distfile を実際に取得する際、それらは、
      <code class="varname">MASTER_SITES</code> または
      <code class="varname">SITES.*</code>
      に各 distfile のファイル名をそのまま (間にスラッシュを入れずに)
      つなげた形の URL から取得されます。このため、サイトを定義する変数の値は、
      スラッシュその他の分離記号で終わる必要があります。このため、たとえば
      <code class="varname">MASTER_SITES</code> を、distfile 名を引数としてとる
      CGI スクリプトの URL にすることができます。そうした場合、
      以下のような形で定義することになります。</p>
<pre class="programlisting">
MASTER_SITES=   http://www.example.com/download.cgi?file=
</pre>
<p> 例外は、URL の前にダッシュ (-) がついている場合です。
      この場合、その URL を (distfile とつなげずに) そのまま使って distfile を取得し、
      取得したファイルを distfile の名前で保存します。</p>
<p>パッケージで使うため、<code class="varname">MASTER_SITES</code>
      用にあらかじめ定義された値がいくつか用意されています。
      各変数の意味は、名前から明らかでしょう。</p>
<pre class="programlisting">
${MASTER_SITE_APACHE}
${MASTER_SITE_BACKUP}
${MASTER_SITE_CYGWIN}
${MASTER_SITE_DEBIAN}
${MASTER_SITE_FREEBSD}
${MASTER_SITE_FREEBSD_LOCAL}
${MASTER_SITE_GENTOO}
${MASTER_SITE_GNOME}
${MASTER_SITE_GNU}
${MASTER_SITE_GNUSTEP}
${MASTER_SITE_IFARCHIVE}
${MASTER_SITE_KDE}
${MASTER_SITE_MOZILLA}
${MASTER_SITE_MYSQL}
${MASTER_SITE_OPENOFFICE}
${MASTER_SITE_PERL_CPAN}
${MASTER_SITE_PGSQL}
${MASTER_SITE_R_CRAN}
${MASTER_SITE_SOURCEFORGE}
${MASTER_SITE_SOURCEFORGE_JP}
${MASTER_SITE_SUNSITE}
${MASTER_SITE_SUSE}
${MASTER_SITE_TEX_CTAN}
${MASTER_SITE_XCONTRIB}
${MASTER_SITE_XEMACS}
</pre>
<p>名前から意味がわかりにくいものについて、説明しておきます。
      <code class="varname">MASTER_SITE_BACKUP</code> には、<a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/%24%7BDIST_SUBDIR%7D" target="_top">ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/${DIST_SUBDIR}</a> で保守されている、パッケージのバックアップサイトが含まれます。
      <code class="varname">MASTER_SITE_LOCAL</code> には、<a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/LOCAL_PORTS/" target="_top">ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/LOCAL_PORTS/</a> で保守されている、パッケージのローカルなソース配布物が含まれます。</p>
<p>もしこれらの予め定義されたサイトの1つを選んだ場合、そのサイトのサブディレク
      トリーを指定することが必要となるかもしれません。これらのマクロは複数の実際
      のサイトに展開されるかもしれませんので、サブディレクトリーを指定する場合は、
      以下の表記を<span class="emphasis"><em>使わなければなりません</em></span>:</p>
<pre class="programlisting">
MASTER_SITES=   ${MASTER_SITE_GNU:=subdirectory/name/}
MASTER_SITES=   ${MASTER_SITE_SOURCEFORGE:=project_name/}
</pre>
<p>サブディレクトリー名の後のスラッシュ/に注意してください。</p>
</div>
<div class="sect2" title="17.5.2. ファイルの取得はどのようにおこなわれるか?">
<div class="titlepage"><div><div><h3 class="title">
<a name="build.fetch.how"></a>17.5.2. ファイルの取得はどのようにおこなわれるか?</h3></div></div></div>
<p><span class="emphasis"><em>fetch</em></span> 相では、distfile
      がすべてローカルディレクトリー (<code class="varname">DISTDIR</code>,
      pkgsrc 利用者が設定可能) に存在する状態にします。
      distfile は以下の形式のコマンドを使って取得されます。</p>
<pre class="programlisting">
${FETCH_CMD} ${FETCH_BEFORE_ARGS} ${site}${file} ${FETCH_AFTER_ARGS}
</pre>
<p>この <code class="literal">${site}</code> には、複数の候補が決まった順序で使われます: 最初に
      <code class="varname">MASTER_SITE_OVERRIDE</code>を試み、次に、<code class="varname">SITES.file</code>が定義されていればそれ
      を、定義されていなければ、<code class="varname">MASTER_SITES</code>か<code class="varname">PATCH_SITES</code>のどちらかを試
      みます。そして、最後に<code class="varname">MASTER_SITE_BACKUP</code>の値を試みます。
      これらのうち最初のものと最後のもの以外の順序は、
      <code class="varname">MASTER_SORT_RANDOM</code> を設定し、かつ
      <code class="varname">MASTER_SORT_AWK</code>か
      <code class="varname">MASTER_SORT_REGEX</code>を設定して、ユーザー
      が入れ換えることができます。</p>
<p> この取得用のコマンドと引数は、
      <code class="varname">FETCH_USING</code> 変数に応じたものが使われます。
      上述の例は、<code class="literal">FETCH_USING=custom</code> とした場合のものです。</p>
<p>the NetBSD Foundation が運営している distfile
      のミラーサイトでは、自由に配布可能な distfile
      をミラーするために <span class="emphasis"><em>mirror-distfiles</em></span>
      ターゲットを使っています。<code class="varname">NO_SRC_ON_FTP</code>
      を (たいていは <span class="quote">“<span class="quote">${RESTRICTED}</span>”</span> に)
      設定しているパッケージの distfile はミラーされません。</p>
</div>
</div>
<div class="sect1" title="17.6. checksum 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.checksum"></a>17.6. <span class="emphasis"><em>checksum</em></span> 相</h2></div></div></div>
<p>distfileを取得した後に、チェックサムを生成し、distinfoファイルに保存され
    たチェックサムと比較します。もし、チェックサムが一致しなければ、構築は中
    断されます。これはパッケージ作成時と同じdistfileが、構築に使用されている
    こと、つまり、悪意や一次配布サイトでの意図的な差し替えやネットワークの損
    失によってdistfileが変更されていないことを保証するためです。</p>
</div>
<div class="sect1" title="17.7. extract 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.extract"></a>17.7. <span class="emphasis"><em>extract</em></span> 相</h2></div></div></div>
<p>distfileがローカルシステム上に存在している場合、
    通常、それらは圧縮アーカイブフォーマットで保存されているので、
    展開する必要があります。</p>
<p>標準では、<code class="varname">DISTFILES</code> はすべて展開されます。
    一部だけを展開する必要がある場合は、
    <code class="varname">EXTRACT_ONLY</code> 変数を、
    展開する必要のあるファイルを並べたリストに設定することができます。</p>
<p>通常、ファイルの展開は <code class="filename">mk/extract/extract</code>
    という小さなプログラムを使っておこなわれます。このプログラムは、
    各種アーカイブ形式の展開方法を知っているので、
    何も変更する必要はないでしょう。それでも変更が必要な場合は、
    以下の変数を使うとよいでしょう。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">EXTRACT_OPTS_{BIN,LHA,PAX,RAR,TAR,ZIP,ZOO}</code></span></dt>
<dd><p>この各変数を使って、展開用のコマンドのオプションを、
      標準のもの (<code class="filename">mk/extract/extract</code>
      で定義されています) から上書きします。</p></dd>
<dt><span class="term"><code class="varname">EXTRACT_USING</code></span></dt>
<dd><p>この変数は、tar アーカイブ展開用のコマンドを設定するもので、
      <code class="literal">bsdtar</code>, <code class="literal">gtar</code>, <code class="literal">nbtar</code>
      (標準状態での値), <code class="literal">pax</code> または、
      コマンドの絶対パス名に設定することができます。
      NetBSD の (tar として使われる) pax でうまく展開できない場合は、
      なるべく gtar より bsdtar を選ぶようにします。</p></dd>
</dl></div>
<p>必要なことが <code class="filename">extract</code>
    プログラムではできない場合は、ファイル展開用のコマンドを保持する
    <code class="varname">EXTRACT_CMD</code> 変数を上書きすることもできます。
    この変数で指定された展開用コマンドは、
    <code class="filename">${WRKSRC}</code> ディレクトリー内で実行されます。
    このコマンドの実行中は、シェル変数 <code class="varname">extract_file</code>
    に、展開中のアーカイブファイルの絶対パス名が保持されます。</p>
<p>これでもなお不十分な場合は、パッケージの Makefile で、
    <code class="varname">do-extract</code>
    ターゲットを上書きすることができます。</p>
</div>
<div class="sect1" title="17.8. patch 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.patch"></a>17.8. <span class="emphasis"><em>patch</em></span> 相</h2></div></div></div>
<p>展開の後で、<code class="varname">PATCHFILES</code>で指定されたパッチとパッケージのpatchesサブディレ
    クトリーに存在するパッチ、さらに、$LOCALPATCHES/$PKGPATH (たとえば
    <code class="filename">/usr/local/patches/graphics/png</code>)に存在するパッチのすべてが適用されます。
    <code class="filename">.Z</code>、あるいは<code class="filename">.gz</code>で終る名前のパッチファイルは、適用する前に伸張されます。
    <code class="filename">.orig</code>、<code class="filename">.rej</code>で終るものは無視されます。<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?patch+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">patch</span>(1)</span></a>のためのいくつかのオプショ
    ンは、<code class="varname">PATCH_DIST_ARGS</code>で指定する事ができます。
    詳細に関しては<a class="xref" href="components.html#components.patches" title="11.3. patches/*">Section 11.3, “patches/*”</a>を参照して下さい。</p>
<p>デフォルトでは、パッチに曖昧さがあった場合には<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?patch+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">patch</span>(1)</span></a>が異常終了するような
    特別な引数が渡されます。パッチを修正(再作成)して、きれいに適用できるよう
    にしてください。そうする理由は、曖昧さがあるパッチが一見うまく適用できても、実は誤った場
    所に適用されていて、深刻な問題を起こす可能性があるからです。</p>
</div>
<div class="sect1" title="17.9. tools 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.tools"></a>17.9. <span class="emphasis"><em>tools</em></span> 相</h2></div></div></div>
<p>この相については<a class="xref" href="tools.html" title="Chapter 18. 構築や実行のために必要なツール">Chapter 18, <i>構築や実行のために必要なツール</i></a> で説明しています。
    </p>
</div>
<div class="sect1" title="17.10. wrapper 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.wrapper"></a>17.10. <span class="emphasis"><em>wrapper</em></span> 相</h2></div></div></div>
<p>この相では、コンパイラーとリンカー用のラッパープログラムが作成されます。
    以下の変数を使って、ラッパーに手を加えることができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">ECHO_WRAPPER_MSG</code></span></dt>
<dd><p>経過を表示するためのコマンドです。
      標準状態では何もしません。
      経過を見るには、この変数を <code class="literal">${ECHO}</code>
      に設定します。</p></dd>
<dt><span class="term"><code class="varname">WRAPPER_DEBUG</code></span></dt>
<dd><p>この変数は、
      ラッパーのログファイルにより詳しい情報が必要かどうかに応じて、
      <code class="literal">yes</code> (標準状態の値) または
      <code class="literal">no</code> に設定することができます。</p></dd>
<dt><span class="term"><code class="varname">WRAPPER_UPDATE_CACHE</code></span></dt>
<dd><p>この変数は、
      ラッパーの速度を改善するためキャッシュを使わせるかどうかに応じて、
      <code class="literal">yes</code> または <code class="literal">no</code>
      に設定することができます。標準状態の値は
      <code class="literal">yes</code> ですが、キャッシュに対応していないプラットフォームでは
      強制的に <code class="literal">no</code>
      になります。</p></dd>
<dt><span class="term"><code class="varname">WRAPPER_REORDER_CMDS</code></span></dt>
<dd><p>順序の並び替え用のコマンドを並べたリストです。
      並び替え用のコマンドは、
      <code class="literal">reorder:l:<em class="replaceable"><code>lib1</code></em>:<em class="replaceable"><code>lib2</code></em></code>
      のような形式をしています。これを使うと
      <code class="literal">-l<em class="replaceable"><code>lib1</code></em></code>
      が常に
      <code class="literal">-l<em class="replaceable"><code>lib2</code></em></code> より先に現れるようになります。
      </p></dd>
<dt><span class="term"><code class="varname">WRAPPER_TRANSFORM_CMDS</code></span></dt>
<dd><p>変換用のコマンドを並べたリストです。 [TODO:
      investigate further]</p></dd>
</dl></div>
</div>
<div class="sect1" title="17.11. configure 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.configure"></a>17.11. <span class="emphasis"><em>configure</em></span> 相</h2></div></div></div>
<p>ほとんどのソフトウェアは、実行対象のプラットフォームで利用できるヘッダーファイル、
    システムコール、およびライブラリールーチンについての情報を必要とします。
    この情報の判断はコンフィギュレーションとして知られているプロセスであり、
    通常、自動化されています。
    大抵の場合、スクリプトが配布物と一緒に提供され、
    それを実行することによりヘッダーファイルやMakefile等が生成されます。</p>
<p>パッケージが configure スクリプトを含んでいる場合、<code class="varname">HAS_CONFIGURE</code>
    を <span class="quote">“<span class="quote">yes</span>”</span> に設定することにより、実行することができます。
    もし、その configure スクリプトが GNU の autoconf スクリプトである場合は、
    かわりに、<code class="varname">GNU_CONFIGURE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に指定してください。
    大雑把にいうと、<span class="emphasis"><em>configure</em></span> 相では以下のようなことをしています。</p>
<pre class="programlisting">
.for d in ${CONFIGURE_DIRS}
        cd ${WRKSRC} \
        &amp;&amp; cd ${d} \
        &amp;&amp; env ${CONFIGURE_ENV} ${CONFIGURE_SCRIPT} ${CONFIGURE_ARGS}
.endfor
</pre>
<p><code class="varname">CONFIGURE_DIRS</code> (標準では <span class="quote">“<span class="quote">.</span>”</span>) は、
    <code class="varname">WRKSRC</code> からの相対位置でのパス名を並べたリストです。
    この各ディレクトリー内で、環境変数 <code class="varname">CONFIGURE_ENV</code> および
    引数 <code class="varname">CONFIGURE_ARGS</code> を使って
    configure スクリプトが実行されます。
    <code class="varname">CONFIGURE_ENV</code>, <code class="varname">CONFIGURE_SCRIPT</code>
    (標準では <span class="quote">“<span class="quote">./configure</span>”</span>),
    <code class="varname">CONFIGURE_ARGS</code>
    の各変数は、いずれもパッケージ側で変更することができます。</p>
<p>もし、プログラムがコンフィギュレーションのために <code class="filename">Imakefile</code> を使用するので
    あれば、<code class="varname">USE_IMAKE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定することにより、適切な手順が実行されます。
    (もし、<code class="varname">${X11PREFIX}</code> にインストールされるパッケージが欲しいだけで、xmkmfを実
    行したくない場合、かわりに<code class="varname">USE_X11BASE</code>を使用してください。)
    <code class="varname">SCRIPTS_ENV</code> に変数を設定すると、
    その変数を xmkmf の環境変数に追加することができます。</p>
<p>プログラムがコンフィギュレーションのために <code class="filename">cmake</code>
    を使用するのであれば、
    <code class="varname">USE_CMAKE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定することにより、適切な手順が実行されます。
    <code class="varname">CONFIGURE_ENV</code> に変数を追加すると、
    その変数を cmake の環境変数に追加することができます。
    また、<code class="varname">CMAKE_ARGS</code> 変数に引数を追加すると、
    cmake の引数に追加することができます。
    最上層ディレクトリーを指定する引数は
    <code class="varname">CMAKE_ARG_PATH</code> 変数で与えられるようになっており、
    この変数の標準の値は
    <span class="quote">“<span class="quote">.</span>”</span> (<code class="varname">CONFIGURE_DIRS</code> からの相対位置) です。</p>
<p>configure の段階ですることが何もない場合は、
    <code class="varname">NO_CONFIGURE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定します。</p>
</div>
<div class="sect1" title="17.12. build 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.build"></a>17.12. <span class="emphasis"><em>build</em></span> 相</h2></div></div></div>
<p>パッケージの構築は、大雑把にいえば、
    以下のコードを実行するのと同じことです。</p>
<pre class="programlisting">
.for d in ${BUILD_DIRS}
        cd ${WRKSRC} \
        &amp;&amp; cd ${d} \
        &amp;&amp; env ${MAKE_ENV} \
            ${MAKE_PROGRAM} ${BUILD_MAKE_FLAGS} \
                -f ${MAKE_FILE} \
                ${BUILD_TARGET}
.endfor
</pre>
<p><code class="varname">BUILD_DIRS</code> (標準では
    <span class="quote">“<span class="quote">.</span>”</span>) は、
    <code class="varname">WRKSRC</code> からの相対位置でのパス名を並べたリストです。
    この各ディレクトリー内で、環境変数
    <code class="varname">MAKE_ENV</code> および引数
    <code class="varname">BUILD_MAKE_FLAGS</code> を使って
    <code class="varname">MAKE_PROGRAM</code> が実行されます。
    <code class="varname">MAKE_ENV</code>,
    <code class="varname">BUILD_MAKE_FLAGS</code>,
    <code class="varname">MAKE_FILE</code>,
    <code class="varname">BUILD_TARGET</code>
    の各変数は、いずれもパッケージ側で変更することができます。</p>
<p><code class="varname">MAKE_PROGRAM</code> の標準の値は、
    <code class="varname">USE_TOOLS</code> に <span class="quote">“<span class="quote">gmake</span>”</span> が含まれている場合は
    <span class="quote">“<span class="quote">gmake</span>”</span>、含まれていない場合は <span class="quote">“<span class="quote">make</span>”</span> です。
    <code class="varname">MAKE_FILE</code> の標準の値は <span class="quote">“<span class="quote">Makefile</span>”</span> であり、
    <code class="varname">BUILD_TARGET</code> の標準の値は <span class="quote">“<span class="quote">all</span>”</span> です。</p>
<p>build の段階ですることが何もない場合は、
    <code class="varname">NO_BUILD</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定します。</p>
</div>
<div class="sect1" title="17.13. test 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.test"></a>17.13. <span class="emphasis"><em>test</em></span> 相</h2></div></div></div>
<p>[TODO]</p>
</div>
<div class="sect1" title="17.14. install 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.install"></a>17.14. <span class="emphasis"><em>install</em></span> 相</h2></div></div></div>
<p>構築の段階が完了すると、ユーザーが構築されたプログラムやファイルを使えるようにするため、ソフトウェアをパブリックなディレ
    クトリーにインストールする必要があります。</p>
<p><span class="emphasis"><em>install</em></span> 相は、大雑把にいえば、
    以下のコードを実行するのと同じことです。これに加えて、
    このコードの前後では、整合性の検査やパッケージの登録などをするため、
    多くの操作がおこなわれます。</p>
<pre class="programlisting">
.for d in ${INSTALL_DIRS}
        cd ${WRKSRC} \
        &amp;&amp; cd ${d} \
        &amp;&amp; env ${MAKE_ENV} \
            ${MAKE_PROGRAM} ${INSTALL_MAKE_FLAGS} \
                -f ${MAKE_FILE} \
                ${INSTALL_TARGET}
.endfor
</pre>
<p>各変数の意味は、<span class="emphasis"><em>build</em></span>
    相のものと同様です。
    <code class="varname">INSTALL_DIRS</code> は標準では
    <code class="varname">BUILD_DIRS</code> です。<code class="varname">INSTALL_TARGET</code>
    は標準では <span class="quote">“<span class="quote">install</span>”</span> ですが、
    <code class="varname">USE_IMAKE</code> が定義されており、かつ
    <code class="varname">NO_INSTALL_MANPAGES</code> が定義されていない場合は、
    <span class="quote">“<span class="quote">install.man</span>”</span>
    が追加されます。</p>
<p><span class="emphasis"><em>install</em></span> 相では、以下の変数が有用です。
    これらはいずれも <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?install+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a> コマンドの変種であり、
    所有者、所有グループ、パーミッションをあらかじめ決めてあるものです。
    <code class="varname">INSTALL</code> は、オプションを何も指定しない install コマンドです。
    用途別に特化した変種には、以下のものがあります。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">INSTALL_PROGRAM_DIR</code></span></dt>
<dd><p>バイナリーを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_SCRIPT_DIR</code></span></dt>
<dd><p>スクリプトを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_LIB_DIR</code></span></dt>
<dd><p>共有静的ライブラリーを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_DATA_DIR</code></span></dt>
<dd><p>データファイルを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_MAN_DIR</code></span></dt>
<dd><p>マニュアルページを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_PROGRAM</code></span></dt>
<dd><p>デバッグ用シンボルを取り除くことのできるバイナリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_SCRIPT</code></span></dt>
<dd><p>シンボルを取り除くことのできないバイナリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_GAME</code></span></dt>
<dd><p>ゲームのバイナリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_LIB</code></span></dt>
<dd><p>共有静的ライブラリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_DATA</code></span></dt>
<dd><p>データファイル</p></dd>
<dt><span class="term"><code class="varname">INSTALL_GAME_DATA</code></span></dt>
<dd><p>ゲーム用のデータファイル</p></dd>
<dt><span class="term"><code class="varname">INSTALL_MAN</code></span></dt>
<dd><p>マニュアルページ</p></dd>
</dl></div>
<p>これらのほか、以下の変数があります。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">INSTALLATION_DIRS</code></span></dt>
<dd><p>pkgsrc が <span class="emphasis"><em>install</em></span>
      相の最初に作成するディレクトリーを
      <code class="varname">PREFIX</code> からの相対位置表記で並べたリストです。
      パッケージは、ファイルをインストールする前に、
      必要なディレクトリーをすべて自力で作成することになるので、
      その他のディレクトリーをすべてここに列挙します。
      </p></dd>
</dl></div>
<p>稀な場合として、パッケージが何もインストールしないような場合は、
    <code class="varname">NO_INSTALL</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定します。
    これはほとんどの場合、<code class="filename">regress</code>
    カテゴリーのパッケージに関するものです。</p>
</div>
<div class="sect1" title="17.15. package 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.package"></a>17.15. <span class="emphasis"><em>package</em></span> 相</h2></div></div></div>
<p>install 期が完了すると、
    インストールされたファイルからなるバイナリーパッケージを作ることができます。
    このようなバイナリーパッケージは、たとえば
    <span class="command"><strong>make bin-install</strong></span> するか、
    <span class="command"><strong>pkg_add</strong></span> を使って、それまでのコンパイルの過程を踏まずに、
    迅速にインストールすることができます。</p>
<p>標準では、バイナリーパッケージは
    <code class="filename">${PACKAGES}/All</code> に作られ、また、
    <code class="varname">CATEGORIES</code> 変数に設定されたカテゴリーごとに
    <code class="filename">${PACKAGES}/<em class="replaceable"><code>category</code></em></code>
    にシンボリックリンクが作られます。<code class="varname">PACKAGES</code>
    は標準では <code class="filename">pkgsrc/packages</code> になります。</p>
</div>
<div class="sect1" title="17.16. 掃除をする">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.clean"></a>17.16. 掃除をする</h2></div></div></div>
<p>パッケージの作業が終わったら、<span class="command"><strong>make clean</strong></span>
    を実行して作業ディレクトリーを掃除することができます。
    依存パッケージの作業ディレクトリーもすべて掃除したい場合は、
    <span class="command"><strong>make clean-depends</strong></span> を使います。</p>
</div>
<div class="sect1" title="17.17. 他の役に立つターゲット">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.helpful-targets"></a>17.17. 他の役に立つターゲット</h2></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term">pre/post-*</span></dt>
<dd><p>前のセクションで述べた主ターゲットのために、二つの補助ターゲットが存在し
	  ます。これは主ターゲットに<span class="quote">“<span class="quote">pre-</span>”</span>や<span class="quote">“<span class="quote">post-</span>”</span>というプレフィックスをつけ
	  たものです。これらのターゲットは、特別な設定やインストール手順のために、
	  主ターゲットが実行される前や後に、パッケージの Makefile から実行されます。例えば、プログラムのコンフィ
	  ギュレーションスクリプトやインストールターゲットが省略された場合に有用で
	  す。</p></dd>
<dt><span class="term">do-*</span></dt>
<dd><p>主なターゲットがおかしな動作をし、それを修正するための変数が存在しない場
	  合、do-*ターゲットを使用することにより、それらを再定義することができます
	  (do-*ターゲットのかわりに、ターゲット自体を再定義してはいけません。pre-*
	  やpost-*ターゲットが実行されなくなってしまいます)。通常、再定義する必要
	  はありません。</p></dd>
<dt><span class="term">reinstall</span></dt>
<dd>
<p>もし、<span class="command"><strong>make install</strong></span>実行後に、いくつかのファイルがきちんとインストール
	  されなかった事に気がついた場合、このターゲットを使い、再びインストールす
	  る事ができます。この場合、<span class="quote">“<span class="quote">インストール済み</span>”</span>フラグは無視されます。</p>
<p>これは、<code class="varname">DEPENDS_TARGET</code>
	  の標準の値です。ただし <span class="command"><strong>make update</strong></span> および <span class="command"><strong>make
	  package</strong></span> の場合は例外であり、これらについてはそれぞれ
	  <span class="quote">“<span class="quote">package</span>”</span> および <span class="quote">“<span class="quote">update</span>”</span>
	  が標準の値になります。</p>
</dd>
<dt><span class="term">deinstall</span></dt>
<dd>
<p>このターゲットは、パッケージをアンインストールするためにカレントディレク
	  トリーで<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>を実行します。動作を制御するために、以下の変数を
	  使用することができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">PKG_VERBOSE</code></span></dt>
<dd><p><a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>コマンドに「-v」オプションを渡します。</p></dd>
<dt><span class="term"><code class="varname">DEINSTALLDEPENDS</code></span></dt>
<dd><p>指定されたパッケージに必要な(依存する)すべてのパッケージを削除します。
		このターゲットは、指定されたパッケージによってインストールされたパッ
		ケージを削除するために使用されます。例えば、<span class="command"><strong>make deinstall
		DEINSTALLDEPENDS=1</strong></span>が<code class="filename">pkgsrc/x11/kde</code>で実行された場合、KDE全体を削除し
		ます。<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>のコマンドラインに<span class="quote">“<span class="quote">-R</span>”</span>を指定すると設定されます。</p></dd>
</dl></div>
</dd>
<dt><span class="term">bin-install</span></dt>
<dd><p>バイナリーパッケージを、
	  ローカルディスクまたは列挙された FTP サイト
	  (<code class="varname">BINPKG_SITES</code> 変数を参照)
	  からインストールし、
	  利用可能なバイナリーパッケージがどこにもない場合には
	  <span class="command"><strong>make package</strong></span> をおこないます。
	  <span class="command"><strong>pkg_add</strong></span> 用の引数、たとえば饒舌な操作などを
	  <code class="varname">BIN_INSTALL_FLAGS</code>
	  に設定することができます。</p></dd>
<dt><span class="term">update</span></dt>
<dd>
<p>このターゲットは、現在のパッケージを最新のものに更新します。最初にパッケー
	  ジと、それに依存するすべてのパッケージをアンインストールします。それから
	  最新のバージョンのパッケージをコンパイル、インストールします。これは、現
	  在どのパッケージがインストールされているかを調べ、<span class="command"><strong>make deinstall</strong></span>、
	  <span class="command"><strong>make install</strong></span>(または、<code class="varname">UPDATE_TARGET</code>で設定されたターゲット)を続けて実
	  行するのと同じです。</p>
<p>以前に実行した<span class="command"><strong>make
	  update</strong></span>がさまざまな理由で中断された場合、パッケー
	  ジの更新のために、このターゲットを使用することができます。
	  ただし、この場
	  合は、<span class="command"><strong>make clean</strong></span>を実行していない事、あるいは<code class="varname">WRKDIR</code>の依存パッケー
	  ジのリストを削除していない事を確認してください。そうでなければ、インストー
	  ル済みの依存パッケージを使用し、現在のパッケージを自動更新することができ
	  ません。</p>
<p>中断された<span class="command"><strong>make
	  update</strong></span>の再開は、パッケージツリーの他の部分が変更され
	  ていない場合に限って動作します。更新対象のパッケージのソースコードが変更
	  されていた場合は、<span class="command"><strong>make update</strong></span>の再開はきっと失敗するでしょう。</p>
<p><span class="command"><strong>make
	  update</strong></span>の動作を変更するために、以下の変数をコマンドライン、また
	  は<a class="link" href="configuring.html#mk.conf"><code class="filename">mk.conf</code></a>で使うことができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">UPDATE_TARGET</code></span></dt>
<dd><p>更新されたパッケージや依存パッケージのために再帰的に使用されるインス
		トールターゲット。
		<span class="command"><strong>make update</strong></span>用のデフォルトは、<code class="varname">DEPENDS_TARGET</code>が
		設定されている場合はその値、それ以外の場合は<span class="quote">“<span class="quote">install</span>”</span>です。
		これら以外のターゲットのよい例としては <span class="quote">“<span class="quote">package</span>”</span> や
		<span class="quote">“<span class="quote">bin-install</span>”</span> があります。
		ここで <span class="quote">“<span class="quote">update</span>”</span> を設定してはいけません
		(無限ループに陥ってしまいます)。</p></dd>
<dt><span class="term"><code class="varname">NOCLEAN</code></span></dt>
<dd><p>更新した後、きれいに掃除をしません。調査やその他の目的のために、更新
		されたパッケージの作業用ソース等をそのままにしておきたい場合に役に立
		ちます。最終的にはソースツリーを掃除してください(以下の
		<span class="quote">“<span class="quote">clean-update</span>”</span>ターゲットを見てください)。そうしなければ、次回の
		<span class="command"><strong>make</strong></span>や<span class="command"><strong>make
		update</strong></span>の時に古いソースコードが残っていることで
		トラブルがおこるかもしれません。</p></dd>
<dt><span class="term"><code class="varname">REINSTALL</code></span></dt>
<dd><p>インストール(make <code class="varname">DEPENDS_TARGET</code>)の前に各パッケージをアンインストー
		ルします。これは、<span class="command"><strong>make
		update</strong></span>の実行中断後に<span class="quote">“<span class="quote">clean-update</span>”</span>ターゲット
		(以下参照)が呼ばれた場合に必要となることがあります。</p></dd>
<dt><span class="term"><code class="varname">DEPENDS_TARGET</code></span></dt>
<dd><p>再帰を無効化し、パッケージのターゲットをハードコードすることができま
		す。updateターゲット用のデフォルトは<span class="quote">“<span class="quote">update</span>”</span>であり、事前に必要なパッ
		ケージを再帰的に更新するようになっています。<code class="varname">DEPENDS_TARGET</code>を設定する
		のは、再帰的な更新を無効化したいときだけにしてください。<span class="command"><strong>make update</strong></span>
		(後述します)の最中にインストールされる各パッケージに対して、特定のター
		ゲットを指定するだけの場合は、これのかわりに<code class="varname">UPDATE_TARGET</code>を使ってく
		ださい。</p></dd>
</dl></div>
</dd>
<dt><span class="term">clean-update</span></dt>
<dd>
<p>カレントディレクトリーで<span class="command"><strong>make update</strong></span>が実行された時に更新されるすべて
	  のパッケージのソースツリーを掃除します。カレントパッケージ(あるいは、依
	  存パッケージ)がすでにアンインストールされている(例えば<span class="command"><strong>make update</strong></span>を実行
	  した後)場合には、このターゲットを使ってはいけません。もし使用すると、更
	  新するつもりのパッケージのいくつかを失う可能性があります。経験的には、初
	  めて<span class="command"><strong>make update</strong></span>を実行する<span class="emphasis"><em>前</em></span>、あるいは汚れたパッケージツリーがある場
	  合(例えば<code class="varname">NOCLEAN</code>を使用した場合)にのみ使用するとよいでしょう。</p>
<p>パッケージのツリーが掃除されているかどうかわからない場合は、ツリーの最上
	  層で<span class="command"><strong>make
	  clean</strong></span>を実行するか、更新しようとしているパッケージのディレクト
	  リーで以下のコマンドをこの順に使うか、どちらかをおこなうことができます。
	  (<span class="command"><strong>make update</strong></span>を初めて実行するより<span class="emphasis"><em>前</em></span>におこなってください。それ以外の場
	  合、更新しようとしているパッケージをすべて失ってしまいます)</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>make clean-update</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make clean CLEANDEPENDS=YES</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make update</code></strong>
	  </pre>
<p><span class="command"><strong>make
	  clean-update</strong></span>の動作を変更するために、以下の変数をコマンドライン、
	  または<a class="link" href="configuring.html#mk.conf"><code class="filename">mk.conf</code></a>で使うことができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">CLEAR_DIRLIST</code></span></dt>
<dd><p><span class="command"><strong>make clean</strong></span>の後で、パッケージのためのディレクトリーのリストを再構
		築しません。<span class="command"><strong>make update</strong></span>で、更新したいすべてのパッケージがインストー
		ルされた場合にのみ使用してください。通常、これは<span class="command"><strong>make update</strong></span>で自動
		的に実行されます。ただし、<code class="varname">NOCLEAN</code>変数の設定によって実行されない事もあ
		ります(上を参照してください)。</p></dd>
</dl></div>
</dd>
<dt><span class="term">replace</span></dt>
<dd>
<p>当該パッケージのインストールを更新します。
	  依存するパッケージの置き換えをおこなわないという点で
	  update と異なります。
	  このターゲットを動作させるためには、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_tarup/README.html" target="_top"><code class="filename">pkgtools/pkg_tarup</code></a>
	  をインストールする必要があります。</p>
<p><span class="emphasis"><em>このターゲットは注意して使ってください。
	  </em></span> このターゲットを使って更新した後に、
	  依存するパッケージが動作するという保証はありません。
	  特に、ライブラリーのパッケージで、
	  共有ライブラリーのメジャーバージョンが変わるようなものを
	  <span class="command"><strong>make replace</strong></span>
	  した場合は、ほぼ確実に壊れます。
	  このため、このターゲットは公式にはサポートされておらず、
	  熟練した利用者だけが使うことを推奨します。</p>
</dd>
<dt><span class="term">info</span></dt>
<dd><p>このターゲットは、現在のパッケージに対して<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_info+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_info</span>(1)</span></a>をおこないます。これ
	  を使って、インストールされているパッケージのバージョンを調べる
	  ことができます。</p></dd>
<dt><span class="term">index</span></dt>
<dd>
<p>これは最上層用のコマンド、つまり <code class="filename">pkgsrc</code>
	  ディレクトリーで使うコマンドです。
	  ローカルの pkgsrc ツリー内の全パッケージのデータベースを作成します。
	  このデータベースには、依存性、コメント、メンテナー、
	  その他の有用な情報が含まれます。
	  個々のパッケージのエントリーは、当該パッケージのディレクトリーで
	  <span class="command"><strong>make describe</strong></span> を実行して作成されます。
	  作成された索引ファイルは
	  <code class="filename">pkgsrc/INDEX</code> に保存されます。
	  この索引は、<span class="command"><strong>make
	  print-index</strong></span> を実行すると、饒舌な形式で表示することができます。
	  <span class="command"><strong>make search
	  key=<em class="replaceable"><code>something</code></em></strong></span>
	  を使って、索引を検索することができます。
	  <span class="command"><strong>make show-deps
	  PKG=<em class="replaceable"><code>somepackage</code></em></strong></span>
	  を実行して、特定のパッケージに依存するパッケージをすべて調べることができます。</p>
<p>このコマンドの実行には、非常に長い時間がかかります。
	  速いマシンでも数時間かかるでしょう。</p>
</dd>
<dt><span class="term">readme</span></dt>
<dd>
<p>このターゲットは、
	  <code class="filename">README.html</code>ファイルを作成します。このファイルは <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/firefox/README.html" target="_top"><code class="filename">www/firefox</code></a>や <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/links/README.html" target="_top"><code class="filename">www/links</code></a>のようなブラウザー
	  で閲覧することができます。作成されたファイルは、ローカルホストの
	  <code class="varname">PACKAGES</code>ディレクトリーにあるパッケージへの参照を含んでいます。また、
	  <code class="varname">FTP_PKG_URL_HOST</code>と<code class="varname">FTP_PKG_URL_DIR</code>を元にしたURLを参照させることもできます。
	  例えば、ローカルマシン上の<code class="filename">/usr/packages</code>ディレクトリーのバイナリーパッ
	  ケージを参照する<code class="filename">README.html</code>ファイルを作成したい場合、
	  <code class="varname">FTP_PKG_URL_HOST=file://localhost</code>と<code class="varname">FTP_PKG_URL_DIR=/usr/packages</code>をセット
	  してください。<code class="varname">${PACKAGES}</code>ディレクトリーと、そのサブディレクトリーはすべ
	  てのバイナリーパッケージで検索されます。</p>
<p>このターゲットは、最上層またはカテゴリーのディレクトリーで実行することもできます。
	  そうした場合は、配下のパッケージに対して再帰的に実行されます。</p>
</dd>
<dt><span class="term">readme-all</span></dt>
<dd><p>これは最上層用のコマンドであり、<code class="filename">pkgsrc</code> で実行します。
	  このターゲットを使い、<code class="filename">README-all.html</code>を作成することができます。このファ
	  イルはNetBSDパッケージコレクションの中の、現在利用可能なすべてのパッケー
	  ジのリスト、また、それらが属するカテゴリーと簡単な説明を含んでいます。こ
	  のファイルは<code class="filename">pkgsrc/*/README.html</code>から作りだされます。したがって、<span class="command"><strong>make
	  readme</strong></span>
	  の<span class="emphasis"><em>後</em></span>に、このターゲットを実行してください。</p></dd>
<dt><span class="term">cdrom-readme</span></dt>
<dd><p>これは<span class="quote">“<span class="quote">readme</span>”</span>ターゲット(上を見てください)とほとんど同じですが、CD-ROMに焼
	  かれるpkgsrcツリーを作る時に使われます。また、このターゲットは
	  <code class="filename">README.html</code>ファイルを作成し、<code class="varname">CDROM_PKG_URL_HOST</code>と<code class="varname">CDROM_PKG_URL_DIR</code>に基づ
	  くURLへの参照を作ります。</p></dd>
<dt><span class="term">show-distfiles</span></dt>
<dd><p>このターゲットは、パッケージを構築するために、どのdistfileやパッチファイ
	  ルが必要か (<code class="varname">ALLFILES</code>:
	  <code class="varname">DISTFILES</code>および<code class="varname">PATCHFILES</code>をすべて含みますが、
	  <code class="filename">patches/*</code>は含みません) を表示します。</p></dd>
<dt><span class="term">show-downlevel</span></dt>
<dd><p>このターゲットは、パッケージがインストールされていない場合は何も表示しま
	  せん。もし、あるバージョンのパッケージがインストールされているが、現在の
	  pkgsrcのバージョンでインストールされたものでない場合、警告メッセージを表
	  示します。このターゲットは、インストール済みのパッケージが古いバージョン
	  であり、そのバージョンが削除可能で、最新の物が追加されることを表示するた
	  めに使用されます。</p></dd>
<dt><span class="term">show-pkgsrc-dir</span></dt>
<dd><p>当該パッケージの構築とインストールが可能な、パッケージ階層におけるディレ
	  クトリーを表示します。このディレクトリーは、そのパッケージがインストール
	  された際のディレクトリーと同じとは限りません。このターゲットは、単一ホス
	  ト上で多数のパッケージの更新をしたい場合に使うためのもので、pkgsrc の最
	  上層のMakefileから<span class="quote">“<span class="quote">show-host-specific-pkgs</span>”</span>ターゲットで呼び出すことがで
	  きます。</p></dd>
<dt><span class="term">show-installed-depends</span></dt>
<dd><p>このターゲットは、インストールされているパッケージのうち、どれが当該パッ
	  ケージの<code class="varname">DEPENDS</code>と合致するかを表示します。依存関係が古いせいで構築に問題が
	  起きる場合に便利です。</p></dd>
<dt><span class="term">check-shlibs</span></dt>
<dd><p>パッケージのインストール後に、すべてのバイナリーおよび(ELFプラットフォー
	  ムでは) 共有ライブラリーが必要な共有ライブラリーを見つけられるかどうか確
	  認します。<a class="link" href="configuring.html#mk.conf"><code class="filename">mk.conf</code></a>で<code class="varname">PKG_DEVELOPER</code>が設定されている場合はデフォルトで
	  実行します。</p></dd>
<dt><span class="term">print-PLIST</span></dt>
<dd>
<p>パッケージを新規に、または更新のために<span class="quote">“<span class="quote">make install</span>”</span>した後、
	  <span class="command"><strong>find -newer
	  work/.extract_done</strong></span>をもとに新しい<code class="filename">PLIST</code>を生成して表示します。PLIST生成は、
	  共有ライブラリーなどに配慮して行われますが、生成した結果を<code class="filename">PLIST</code>に置く前
	  に再確認するよう<span class="emphasis"><em>強く</em></span>おすすめします。パッケージ更新時には、このコマンド
	  の出力と、更新前の<code class="filename">PLIST</code>ファイルとを比較すると便利でしょう。</p>
<p>パッケージが、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?tar+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>その他のファイルのアクセス時刻を更新しない方法を使っ
	  てファイルをインストールする場合は、それらのファイルはこのターゲットで使われる <span class="quote">“<span class="quote">find
	  -newer</span>”</span> コマンドで検
	  出されないので、手で<code class="filename">PLIST</code>に書き足すよう注意してください!</p>
<p>このターゲットに関するさらなる情報は、
	  <a class="xref" href="plist.html#print-PLIST" title="13.3. make print-PLIST の出力を細工する">Section 13.3, “<span class="command"><strong>make print-PLIST</strong></span> の出力を細工する”</a>を参照してください。</p>
</dd>
<dt><span class="term">bulk-package</span></dt>
<dd>
<p>バルクビルドの実行に使われます。適切なバイナリーパッケージがすでに存在す
	  る場合は、何もしません。そうでない場合は、コンパイル、インストール、パッ
	  ケージ作成をおこないます
	  (<code class="varname">PKG_DEPENDS</code>が適切に設定されている場合は、依存するパッケージも。<a class="xref" href="bulk.html#binary.configuration" title="7.3.1. 設定">Section 7.3.1, “設定”</a>参照)。
	  バイナリーパッケージ作成後、ディスクの空き領域
	  を確保するために、ソース、インストールしたばかりのパッケージと依存パッケー
	  ジは削除されます。</p>
<p><span class="emphasis"><em>このターゲットを使うと、
	  システムにインストールされているパッケージをすべてアンインストールすることもあるので、
	  注意してください。</em></span></p>
</dd>
<dt><span class="term">bulk-install</span></dt>
<dd>
<p>依存パッケージ群をインストールするためのバルクインストールで使われます。
	  最新のバイナリーパッケージが利用可能な場合、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>でそれをインストール
	  します。そうでない場合は、<span class="command"><strong>make bulk-package</strong></span>が実行されますが、インストー
	  ルされたバイナリーは削除されません。</p>
<p>バイナリーパッケージが<span class="quote">“<span class="quote">最新</span>”</span>であるとみなされる (<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> でインストールされる)
	  条件は、以下のとおりです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>パッケージファイル
	      (<code class="filename">Makefile</code>, ...)が、いずれも構築時から変更されていな
	      いこと。</p></li>
<li class="listitem"><p>そのパッケージが依存している(バイナリー)
	      パッケージが、いずれも構築時から変更されていないこと。</p></li>
</ul></div>
<p><span class="emphasis"><em>このターゲットを使うと、
	  システムにインストールされているパッケージをすべてアンインストールすることもあるので、
	  注意してください。</em></span></p>
</dd>
</dl></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="options.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="developers-guide.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="tools.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 16. オプションの扱い </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 18. 構築や実行のために必要なツール</td>
</tr>
</table>
</div>
</body>
</html>
