<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Chapter 20. Debugging</title>
<link rel="stylesheet" type="text/css" href="/global.css">
<meta name="generator" content="DocBook XSL Stylesheets VX.X.X">
<link rel="home" href="index.html" title="The pkgsrc guide">
<link rel="up" href="developers-guide.html" title="Part II. The pkgsrc developer's guide">
<link rel="prev" href="fixes.html" title="Chapter 19. Making your package work">
<link rel="next" href="submit.html" title="Chapter 21. Submitting and Committing">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 20. Debugging</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="fixes.html">Prev</a> </td>
<th width="60%" align="center">Part II. The pkgsrc developer's guide</th>
<td width="20%" align="right"> <a accesskey="n" href="submit.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" title="Chapter 20. Debugging">
<div class="titlepage"><div><div><h2 class="title">
<a name="debug"></a>Chapter 20. Debugging</h2></div></div></div>
<p>To check out all the gotchas when building a package, here are
  the steps that I do in order to get a package working.  Please note
  this is basically the same as what was explained in the previous
  sections, only with some debugging aids.</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>Be sure to set <code class="varname">PKG_DEVELOPER=yes</code> in <a class="link" href="configuring.html#mk.conf"><code class="filename">mk.conf</code></a>.</p></li>
<li class="listitem">
<p>Install <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/url2pkg/README.html" target="_top"><code class="filename">pkgtools/url2pkg</code></a>,
      create a directory for a new package, change into it, then run
      <span class="command"><strong>url2pkg</strong></span>:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mkdir /usr/pkgsrc/<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>examplepkg</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd /usr/pkgsrc/<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>examplepkg</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>url2pkg http://www.example.com/path/to/distfile.tar.gz</code></strong></pre>
</li>
<li class="listitem"><p>Edit the <code class="filename">Makefile</code> as requested.</p></li>
<li class="listitem"><p>Fill in the <code class="filename">DESCR</code> file</p></li>
<li class="listitem"><p>Run <span class="command"><strong>make configure</strong></span></p></li>
<li class="listitem"><p>Add any dependencies glimpsed from documentation and the
      configure step to the package's
      <code class="filename">Makefile</code>.</p></li>
<li class="listitem">
<p>Make the package compile, doing multiple rounds of</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>pkgvi ${WRKSRC}/some/file/that/does/not/compile</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>mkpatches</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>patchdiff</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>mv ${WRKDIR}/.newpatches/* patches</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make mps</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make clean</code></strong></pre>
<p>Doing this step as non-root user will ensure that no files
      are modified that shouldn't be, especially during the build
      phase.  <span class="command"><strong>mkpatches</strong></span>,
      <span class="command"><strong>patchdiff</strong></span> and <span class="command"><strong>pkgvi</strong></span> are
      from the <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdiff/README.html" target="_top"><code class="filename">pkgtools/pkgdiff</code></a>
      package.</p>
</li>
<li class="listitem"><p>Look at the <code class="filename">Makefile</code>, fix if
      necessary; see <a class="xref" href="components.html#components.Makefile" title="11.1. Makefile">Section 11.1, &#8220;<code class="filename">Makefile</code>&#8221;</a>.</p></li>
<li class="listitem">
<p>Generate a <code class="filename">PLIST</code>:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make print-PLIST &gt;PLIST</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make deinstall</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make deinstall</code></strong></pre>
<p>You usually need to be <code class="username">root</code> to do
      this.  Look if there are any files left:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make print-PLIST</code></strong></pre>
<p>If this reveals any files that are missing in
      <code class="filename">PLIST</code>, add them.</p>
</li>
<li class="listitem">
<p>Now that the <code class="filename">PLIST</code> is OK, install the
      package again and make a binary package:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make reinstall</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make package</code></strong></pre>
</li>
<li class="listitem">
<p>Delete the installed package:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_delete <em class="replaceable"><code>examplepkg</code></em></code></strong></pre>
</li>
<li class="listitem">
<p>Repeat the above <span class="command"><strong>make print-PLIST</strong></span>
      command, which shouldn't find anything now:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make print-PLIST</code></strong></pre>
</li>
<li class="listitem">
<p>Reinstall the binary package:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_add .../<em class="replaceable"><code>examplepkg</code></em>.tgz</code></strong></pre>
</li>
<li class="listitem"><p>Play with it.  Make sure everything works.</p></li>
<li class="listitem">
<p>Run <span class="command"><strong>pkglint</strong></span> from <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkglint/README.html" target="_top"><code class="filename">pkgtools/pkglint</code></a>, and fix the problems it
      reports:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkglint</code></strong></pre>
</li>
<li class="listitem"><p>Submit (or commit, if you have cvs access); see <a class="xref" href="submit.html" title="Chapter 21. Submitting and Committing">Chapter 21, <i>Submitting and Committing</i></a>.</p></li>
</ul></div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="fixes.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="developers-guide.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="submit.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 19. Making your package work </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 21. Submitting and Committing</td>
</tr>
</table>
</div>
</body>
</html>
