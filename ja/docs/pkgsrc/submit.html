<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 21. 提出およびコミット</title>
<link rel="stylesheet" type="text/css" href="/global.css">
<meta name="generator" content="DocBook XSL Stylesheets VX.X.X">
<link rel="home" href="index.html" title="The pkgsrc guide">
<link rel="up" href="developers-guide.html" title="Part II. pkgsrc 開発者向けの手引き">
<link rel="prev" href="debug.html" title="Chapter 20. デバッグ">
<link rel="next" href="devfaq.html" title="Chapter 22. よくある質問">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 21. 提出およびコミット</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="debug.html">Prev</a> </td>
<th width="60%" align="center">Part II. pkgsrc 開発者向けの手引き</th>
<td width="20%" align="right"> <a accesskey="n" href="devfaq.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" title="Chapter 21. 提出およびコミット">
<div class="titlepage"><div><div><h2 class="title">
<a name="submit"></a>Chapter 21. 提出およびコミット</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="submit.html#submitting-binary-packages">21.1. バイナリーパッケージの提出</a></span></dt>
<dt><span class="sect1"><a href="submit.html#submitting-your-package">21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)</a></span></dt>
<dt><span class="sect1"><a href="submit.html#general-notes-for-changes">21.3. パッケージを追加・更新・削除する際の一般的な覚書</a></span></dt>
<dt><span class="sect1"><a href="submit.html#committing-importing">21.4. コミット: パッケージのCVSへのインポート</a></span></dt>
<dt><span class="sect1"><a href="submit.html#updating-package">21.5. パッケージを新しいバージョンに更新する</a></span></dt>
<dt><span class="sect1"><a href="submit.html#renaming-package">21.6. pkgsrc のパッケージの名前を変更する</a></span></dt>
<dt><span class="sect1"><a href="submit.html#moving-package">21.7. pkgsrcのパッケージを移動する</a></span></dt>
</dl>
</div>
<div class="sect1" title="21.1. バイナリーパッケージの提出">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="submitting-binary-packages"></a>21.1. バイナリーパッケージの提出</h2></div></div></div>
<p>  我々は、トロイの木馬等を含まないことを保証するために、pkgsrc 開発者からし
	かバイナリーを受け取りません。これは、誰かを排斥するものではなく、
	むしろユーザーを保護するための方針です。しかしながら、あなたの作ったバイ
	ナリーパッケージをどこかに置き、配布することは自由に行なってもかまいま
	せん。NetBSD 開発者がバルクビルドを実行してパッケージをアップロードしたい場合は、
	<a class="xref" href="bulk.html#bulk-upload" title="7.3.8. バルクビルドの成果をアップロードする">Section 7.3.8, “バルクビルドの成果をアップロードする”</a>を参照してください。</p>
</div>
<div class="sect1" title="21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="submitting-your-package"></a>21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)</h2></div></div></div>
<p>最初にパッケージが完全かどうか、コンパイル、実行できるかどうかを確認して
	ください。
	このドキュメントの<a class="xref" href="debug.html" title="Chapter 20. デバッグ">Chapter 20, <i>デバッグ</i></a>、その他が参考になるでしょう。次に、
	パッケージを構成するファイルすべてからなる <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?tar+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>
	アーカイブを作り、gzip して uuencode してください。
	最後に、このパッケージを pkgsrc のバグ追跡システムに送信してください。
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?send-pr+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> コマンドを使って送信するか、このコマンドがない場合は web ページ
	<a class="ulink" href="http://www.NetBSD.org/support/send-pr.html" target="_top">http://www.NetBSD.org/support/send-pr.html</a>
	をご覧ください。この web ページには、説明と、
	パッケージを提出できるフォームへのリンクがあります。
	これらのかわりに、
	<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/sysutils/gtk-send-pr/README.html" target="_top"><code class="filename">sysutils/gtk-send-pr</code></a>
	パッケージを使って提出することもできます。
	</p>
<p>問題報告においては、カテゴリー (category) は
	<span class="quote">“<span class="quote">pkg</span>”</span> とし、問題の概要 (synopsis) にパッケージ名とバージョン番号を含めます。
	また、説明 (description) のフィールドに、パッケージの簡単な説明
	(COMMENT 変数または DESCR ファイルの内容でもOKです)
	を書きます。uuencode したパッケージのデータは
	<span class="quote">“<span class="quote">fix</span>”</span> フィールドに含めます。</p>
<p>複数のパッケージを提出したい場合は、一つのパッケージにつき一つのPRにわけ
	て送ってください。そうすることで、私たちが追跡しやすくなります。</p>
<p>以上のようにするほか、新しいパッケージは pkgsrc-wip
	(<span class="quote">“<span class="quote">pkgsrc work-in-progress</span>”</span>) に入れることもできます。
	詳細は、ホームページ <a class="ulink" href="http://pkgsrc-wip.sourceforge.net/" target="_top">http://pkgsrc-wip.sourceforge.net/</a>
	をご覧ください。</p>
</div>
<div class="sect1" title="21.3. パッケージを追加・更新・削除する際の一般的な覚書">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="general-notes-for-changes"></a>21.3. パッケージを追加・更新・削除する際の一般的な覚書</h2></div></div></div>
<p>パッケージの追加、更新、移動、および削除は、すべて
	<code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code> に書いてください。
	このファイルを、これまでと同じ形式のまま最新の状態に保つことは非常に重要なことです。
	なぜなら、このファイルはスクリプトにより <a class="ulink" href="http://www.NetBSD.org/" target="_top">www.NetBSD.org</a>
	や他のサイトのページを自動的に更新するために使用されているからです。
	また、<code class="filename">pkgsrc/doc/TODO</code> ファイルを確認し、
	今回更新あるいは削除したパッケージのことが書かれている場合は、
	その部分を削除してください。</p>
<p>パッケージの <code class="varname">PKGREVISION</code> を引き上げた時に、
	その変更がセキュリティーに関するものやその他関連のあるものである場合は、
	<code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code> に載せるようにします。
	依存性の更新にともなう大量の引き上げについては、ここには書かないでください。
	これら以外の場合は、書くべきかどうかは開発者が自分で決めることです。</p>
<p>正しい <code class="filename">CHANGES-<em class="replaceable"><code>YYYY</code></em></code>
  の項目を作るのを手伝ってくれる make ターゲット、 <span class="command"><strong>make
  changes-entry</strong></span> があります。このターゲットは <code class="varname">CTYPE</code>
  および <code class="varname">NETBSD_LOGIN_NAME</code> というオプションの変数を使います。
  一般的な使い方は、まず <code class="filename">CHANGES-<em class="replaceable"><code>YYYY</code></em></code>
  ファイルを (あとで衝突して修正する必要が起こらないように)
  最新の状態にした上で、パッケージのディレクトリーに <span class="command"><strong>cd</strong></span>
  します。パッケージを更新した場合は <span class="command"><strong>make changes-entry</strong></span>
  だけで十分です。新規パッケージの追加や、パッケージの移動または削除の場合は、
  コマンドラインで <code class="varname">CTYPE</code> 変数を "Added",
  "Moved" または "Removed" に設定します。ローカルのログイン名が
  NetBSD のログイン名と異なる場合は、<a class="link" href="configuring.html#mk.conf"><code class="filename">mk.conf</code></a> で
  <code class="varname">NETBSD_LOGIN_NAME</code> を設定することができます。
  また、このターゲットは、<code class="filename">TODO</code> ファイルから、
  当該パッケージの項目を自動的に削除してくれます。最後に、
  <span class="command"><strong>make changes-entry-commit</strong></span> などとして
  <code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code> の変更を
  commit するのを忘れないでください。
  なお、cvs.NetBSD.org から直接チェックアウトせずに、
  ローカルにコピーしたリポジトリーを使って作業している場合などは、
  USE_NETBSD_REPO=yes を設定するとよいでしょう。こうすると、
  cvs コマンドでは本家リポジトリーを使うようになります。
  </p>
</div>
<div class="sect1" title="21.4. コミット: パッケージのCVSへのインポート">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="committing-importing"></a>21.4. コミット: パッケージのCVSへのインポート</h2></div></div></div>
<p>このセクションは、pkgsrcリポジトリーへの書き込みアクセス権限を持っ
  ている pkgsrc 開発者にのみ意味があるものです。cvsはカレントディレクトリーから
  の相対位置にファイルをインポートすることと、<span class="command"><strong>cvs import</strong></span>コマンドに渡したパ
  ス名からリポジトリー中のファイルの位置が決まることを忘れないでください。新
  しく作ったパッケージは、<span class="quote">“<span class="quote">TNF</span>”</span>のベンダータグと<span class="quote">“<span class="quote">pkgsrc-base</span>”</span>のリリースタ
  グでインポートしてください。例えば:</p>
<pre class="programlisting">
<code class="prompt">$</code> cd .../pkgsrc/category/pkgname
<code class="prompt">$</code> cvs import pkgsrc/category/pkgname TNF pkgsrc-base
</pre>
<p>また、インポートに使ったディレクトリーは、忘れずに邪魔にならないところに移
  しておいてください。そうしておかないと、ソースツリーを次に<span class="quote">“<span class="quote">cvs
  update</span>”</span>した
  ときにcvsが文句を言います。さらに、この新しいパッケージを、categoryの
  <code class="filename">Makefile</code>に忘れずに追加してください。</p>
<p>初回のインポートでは、コミットメッセージに<code class="filename">DESCR</code>ファイルの内容を含めておき、
  どういうパッケージなのかがメーリングリストの読者にわかるようにしてください。</p>
<p>新しいパッケージを追加する場合は、<span class="quote">“<span class="quote">cvs
  add</span>”</span>ではなく<span class="quote">“<span class="quote">cvs import</span>”</span>を使うように
  してください。"cvs import"なら、単一のコマンドですべて記述することができ、
  また、一貫したタグを打つことができるからです。</p>
</div>
<div class="sect1" title="21.5. パッケージを新しいバージョンに更新する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="updating-package"></a>21.5. パッケージを新しいバージョンに更新する</h2></div></div></div>
<p>パッケージを更新するときは、新旧バージョン間の変更点の簡潔で適切で意味のあ
  る要約を、コミットログに必ず書いてください。そうすべき理由はいろいろありま
  す:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>URLは不安定なものであり、時間がたつと変わることがあります。完全になくなる
  かもしれませんし、新しい情報に書き換わるかもしれません。</p></li>
<li class="listitem"><p>新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、cvsやanoncvsの
  利用者にとって、非常に便利です。</p></li>
<li class="listitem"><p>新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、pkgsrc-changes
  メーリングリストの読者が、パッケージをいつ更新するかの戦術を立てられるよう
  になり、非常に便利です。</p></li>
</ul></div>
<p>また、あるパッケージに新しいバージョンがリリースされたというだけの理由で、
  CVSリポジトリー上のパッケージを更新しないほうがいいことを認識してください。
  私たちは、pkgsrcに含まれるパッケージに関して保守的であることを好みます。と
  いうのも、開発版やベータ版のパッケージは、pkgsrcが使われる場面のほとんどに
  対して、まったくふさわしくないからです。どのバージョンをpkgsrcに入れるのが
  よいか、分別をもって判断してください。新機能(テストされていない機能があるか
  もしれません)よりも安定性のほうが好ましいことを念頭に置いてください。</p>
</div>
<div class="sect1" title="21.6. pkgsrc のパッケージの名前を変更する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="renaming-package"></a>21.6. pkgsrc のパッケージの名前を変更する</h2></div></div></div>
<p>パッケージ名の変更は、なるべくしないようにしてください。</p>
<p>パッケージ名を変更する際には、かならず、
  他の Makefile やオプションや buildlink などで古い名前を参照している箇所をすべて修正します。</p>
<p>パッケージ名を変更する際には、さらに、
  <code class="varname">SUPERSEDES</code> を旧パッケージのパッケージ名と
  dewey 式のバージョン番号に設定します。
  名前が複数回変わっている場合は、複数並べて設定することができます。
  これで、新しいパッケージで旧名のパッケージを置き換える作業は完了です。
</p>
<p>なお、CHANGES-<em class="replaceable"><code>YYYY</code></em> ファイルにおける
  <span class="quote">“<span class="quote">successor</span>”</span> の記述は、必ずしも、<span class="emphasis"><em>supersedes</em></span>
  の意味ではありません。successor は、厳密な同等品でなくても、
  代替として使えるものを助言するものでもいいからです。</p>
</div>
<div class="sect1" title="21.7. pkgsrcのパッケージを移動する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="moving-package"></a>21.7. pkgsrcのパッケージを移動する</h2></div></div></div>
<p>パッケージの名前の変更や移動は、しないほうがよいのですが、
  それでも必要な場合は、以下の手順でおこないます。
</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>パッケージのディレクトリーをどこかにコピーします。</p></li>
<li class="listitem">
<p>コピーしたものからCVSディレクトリーをすべて削除します。</p>
<p>手順1,2は、以下のようにすることもできますので、今後の作業にはこちらを使ってください:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs -d user@cvs.NetBSD.org:/cvsroot export -D today pkgsrc/category/package</code></strong></pre>
</li>
<li class="listitem"><p><code class="varname">CATEGORIES</code>を修正します。また、<span class="quote">“<span class="quote">../../category/package</span>”</span>のかわりに単に
<span class="quote">“<span class="quote">../package</span>”</span>とすることができる<code class="varname">DEPENDS</code>のパスをすべて修正します。</p></li>
<li class="listitem"><p>修正後のパッケージの Makefile で、
<code class="varname">PREV_PKGPATH</code> を、移動前のカテゴリー/パッケージのパス名に設定します。
この <code class="varname">PREV_PKGPATH</code> は、
パッケージの更新を pkgsrc の構築によっておこなうツールが使います。
たとえば、そういったツールは <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_summary+5+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_summary</span>(5)</span></a> データベースから
(<code class="varname">SUPERSEDES</code> がない場合)
<code class="varname">PREV_PKGPATH</code> を検索して、これをもとにパッケージの移動後の
<code class="varname">PKGPATH</code> を調べることができます。
なお、この検索で複数のパスが見つかることもありえるので、
ツールの側では <code class="varname">PKGBASE</code> もあわせて検査します。
この <code class="varname">PREV_PKGPATH</code> の値を設定するのは、
<code class="varname">SUPERSEDES</code> が設定されない場合
(つまり、<code class="varname">PKGBASE</code> が変わらない場合) です。  </p></li>
<li class="listitem"><p>新しい場所で、修正後のパッケージを<span class="command"><strong>cvs import</strong></span>
します。</p></li>
<li class="listitem">
<p>このパッケージに依存しているパッケージを調べます:
</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/pkgsrc</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>grep /package */*/Makefile* */*/buildlink*</code></strong></pre>
</li>
<li class="listitem"><p>手順5で見つかったものに対して、このパッケージへのパスを、新しい場所を指すように修正します。</p></li>
<li class="listitem"><p>古い場所で、移動前のパッケージを<span class="command"><strong>cvs rm (-f)</strong></span>します。</p></li>
<li class="listitem"><p><code class="filename">oldcategory/Makefile</code> からこのパッケージを削除します。</p></li>
<li class="listitem"><p><code class="filename">newcategory/Makefile</code> にこのパッケージを追加します。</p></li>
<li class="listitem">
<p>変更および削除されたファイルを commit します:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs commit oldcategory/package oldcategory/Makefile newcategory/Makefile</code></strong></pre>
<p>(もちろん、手順5の各パッケージもです)。</p>
</li>
</ol></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="debug.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="developers-guide.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="devfaq.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 20. デバッグ </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 22. よくある質問</td>
</tr>
</table>
</div>
</body>
</html>
