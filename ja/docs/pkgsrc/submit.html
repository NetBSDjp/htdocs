<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Chapter 21. Submitting and Committing</title>
<link rel="stylesheet" type="text/css" href="/global.css">
<meta name="generator" content="DocBook XSL Stylesheets VX.X.X">
<link rel="home" href="index.html" title="The pkgsrc guide">
<link rel="up" href="developers-guide.html" title="Part II. The pkgsrc developer's guide">
<link rel="prev" href="debug.html" title="Chapter 20. Debugging">
<link rel="next" href="devfaq.html" title="Chapter 22. Frequently Asked Questions">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 21. Submitting and Committing</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="debug.html">Prev</a> </td>
<th width="60%" align="center">Part II. The pkgsrc developer's guide</th>
<td width="20%" align="right"> <a accesskey="n" href="devfaq.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" title="Chapter 21. Submitting and Committing">
<div class="titlepage"><div><div><h2 class="title">
<a name="submit"></a>Chapter 21. Submitting and Committing</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="submit.html#submitting-binary-packages">21.1. Submitting binary packages</a></span></dt>
<dt><span class="sect1"><a href="submit.html#submitting-your-package">21.2. Submitting source packages (for non-NetBSD-developers)</a></span></dt>
<dt><span class="sect1"><a href="submit.html#general-notes-for-changes">21.3. General notes when adding, updating, or removing packages</a></span></dt>
<dt><span class="sect1"><a href="submit.html#committing-importing">21.4. Committing: Importing a package into CVS</a></span></dt>
<dt><span class="sect1"><a href="submit.html#updating-package">21.5. Updating a package to a newer version</a></span></dt>
<dt><span class="sect1"><a href="submit.html#renaming-package">21.6. Renaming a package in pkgsrc</a></span></dt>
<dt><span class="sect1"><a href="submit.html#moving-package">21.7. Moving a package in pkgsrc</a></span></dt>
</dl>
</div>
<div class="sect1" title="21.1. Submitting binary packages">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="submitting-binary-packages"></a>21.1. Submitting binary packages</h2></div></div></div>
<p>Our policy is that we accept binaries only from pkgsrc
	developers to guarantee that the packages don't contain any
	trojan horses etc. This is not to annoy anyone but rather to
	protect our users! You're still free to put up your home-made
	binary packages and tell the world where to get them. NetBSD
	developers doing bulk builds and wanting to upload them please
	see <a class="xref" href="bulk.html#bulk-upload" title="7.3.8. Uploading results of a bulk build">Section 7.3.8, &#8220;Uploading results of a bulk build&#8221;</a>.</p>
</div>
<div class="sect1" title="21.2. Submitting source packages (for non-NetBSD-developers)">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="submitting-your-package"></a>21.2. Submitting source packages (for non-NetBSD-developers)</h2></div></div></div>
<p>First, check that your package is complete, compiles and
	runs well; see <a class="xref" href="debug.html" title="Chapter 20. Debugging">Chapter 20, <i>Debugging</i></a> and the rest of this
	document. Next, generate an uuencoded gzipped <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?tar+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>
	archive that contains all files that make up the package.
	Finally, send this package to the pkgsrc bug tracking system,
	either with the <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?send-pr+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> command, or if you don't have
	that, go to the web page
	<a class="ulink" href="http://www.NetBSD.org/support/send-pr.html" target="_top">http://www.NetBSD.org/support/send-pr.html</a>,
	which contains some instructions and a link to a form where you
	can submit packages.  The
	<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/sysutils/gtk-send-pr/README.html" target="_top"><code class="filename">sysutils/gtk-send-pr</code></a> package is
	also available as a substitute for either of the above two tools.
	</p>
<p>In the form of the problem report, the category should be
	<span class="quote">&#8220;<span class="quote">pkg</span>&#8221;</span>, the synopsis should include the package name
	and version number, and the description field should contain a
	short description of your package (contents of the COMMENT
	variable or DESCR file are OK). The uuencoded package data should
	go into the <span class="quote">&#8220;<span class="quote">fix</span>&#8221;</span> field.</p>
<p>If you want to submit several packages, please send a
	separate PR for each one, it's easier for us to track things
	that way.</p>
<p>Alternatively, you can also import new packages into
	pkgsrc-wip (<span class="quote">&#8220;<span class="quote">pkgsrc work-in-progress</span>&#8221;</span>); see the
	homepage at <a class="ulink" href="http://pkgsrc-wip.sourceforge.net/" target="_top">http://pkgsrc-wip.sourceforge.net/</a>
	for details.</p>
</div>
<div class="sect1" title="21.3. General notes when adding, updating, or removing packages">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="general-notes-for-changes"></a>21.3. General notes when adding, updating, or removing packages</h2></div></div></div>
<p>Please note all package additions, updates, moves, and
	removals in <code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code>. It's very
	important to keep this file up to date and conforming to the
	existing format, because it will be used by scripts to
	automatically update pages on <a class="ulink" href="http://www.NetBSD.org/" target="_top">www.NetBSD.org</a> and other
	sites. Additionally, check the
	<code class="filename">pkgsrc/doc/TODO</code> file and remove the entry
	for the package you updated or removed, in case it was mentioned
	there.</p>
<p>When the <code class="varname">PKGREVISION</code> of a package is
	bumped, the change should appear in
	<code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code> if it is security
	related or otherwise relevant. Mass bumps that result from a
	dependency being updated should not be mentioned. In all other
	cases it's the developer's decision.</p>
<p>There is a make target that helps in creating proper
  <code class="filename">CHANGES-<em class="replaceable"><code>YYYY</code></em></code> entries:  <span class="command"><strong>make
  changes-entry</strong></span>. It uses the optional <code class="varname">CTYPE</code>
  and <code class="varname">NETBSD_LOGIN_NAME</code> variables. The general
  usage is to first make sure that your <code class="filename">CHANGES-<em class="replaceable"><code>YYYY</code></em></code>
  file is up-to-date (to avoid having to resolve conflicts later-on)
  and then to <span class="command"><strong>cd</strong></span> to the package directory.  For
  package updates, <span class="command"><strong>make changes-entry</strong></span> is enough.
  For new packages, or package moves or removals, set the
  <code class="varname">CTYPE</code> variable on the command line to "Added",
  "Moved", or "Removed".  You can set <code class="varname">NETBSD_LOGIN_NAME</code>
  in <a class="link" href="configuring.html#mk.conf"><code class="filename">mk.conf</code></a> if your local login name is
  not the same as your NetBSD login name. The target also automatically
  removes possibly existing entries for the package in the
  <code class="filename">TODO</code> file. Don't forget to commit
  the changes, e.g. by using <span class="command"><strong>make changes-entry-commit</strong></span>!
  If you are not using a checkout directly from cvs.NetBSD.org, but e.g.
  a local copy of the repository, you can set USE_NETBSD_REPO=yes. This
  makes the cvs commands use the main repository.
  </p>
</div>
<div class="sect1" title="21.4. Committing: Importing a package into CVS">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="committing-importing"></a>21.4. Committing: Importing a package into CVS</h2></div></div></div>
<p>This section is only of interest for pkgsrc developers with write
  access to the pkgsrc repository. Please remember that cvs
  imports files relative to the current working directory, and that
  the pathname that you
  give the <span class="command"><strong>cvs import</strong></span> command is so that it knows where
  to place the files in the repository.  Newly created packages should be
  imported with a vendor tag of <span class="quote">&#8220;<span class="quote">TNF</span>&#8221;</span> and a release tag of
  <span class="quote">&#8220;<span class="quote">pkgsrc-base</span>&#8221;</span>, e.g:</p>
<pre class="programlisting">
<code class="prompt">$</code> cd .../pkgsrc/category/pkgname
<code class="prompt">$</code> cvs import pkgsrc/category/pkgname TNF pkgsrc-base
</pre>
<p>Remember to move the directory from which you imported out of
  the way, or cvs will complain the next time you <span class="quote">&#8220;<span class="quote">cvs
  update</span>&#8221;</span> your source tree.  Also don't forget to add the new
  package to the category's <code class="filename">Makefile</code>.</p>
<p>The commit message of the initial import should include part of the
  <code class="filename">DESCR</code> file, so people reading the mailing lists know
  what the package is/does.</p>
<p>For new packages, <span class="quote">&#8220;<span class="quote">cvs import</span>&#8221;</span> is preferred to <span class="quote">&#8220;<span class="quote">cvs
  add</span>&#8221;</span> because the former gets everything with a single command,
  and provides a consistent tag.</p>
</div>
<div class="sect1" title="21.5. Updating a package to a newer version">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="updating-package"></a>21.5. Updating a package to a newer version</h2></div></div></div>
<p>Please always put a concise, appropriate and relevant summary of the
  changes between old and new versions into the commit log when updating
  a package. There are various reasons for this:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>A URL is volatile, and can change over time. It may go away completely
  or its information may be overwritten by newer information.</p></li>
<li class="listitem"><p>Having the change information between old and new versions in our CVS
  repository is very useful for people who use either cvs or anoncvs.</p></li>
<li class="listitem"><p>Having the change information between old and new versions in our CVS
  repository is very useful for people who read the pkgsrc-changes mailing
  list, so that they can make tactical decisions about when to upgrade
  the package.</p></li>
</ul></div>
<p>Please also recognize that, just because a new version of a package
  has been released, it should not automatically be upgraded in the CVS
  repository.  We prefer to be conservative in the packages that are
  included in pkgsrc - development or beta packages are not really the
  best thing for most places in which pkgsrc is used. Please use your
  judgement about what should go into pkgsrc, and bear in mind that
  stability is to be preferred above new and possibly untested features.</p>
</div>
<div class="sect1" title="21.6. Renaming a package in pkgsrc">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="renaming-package"></a>21.6. Renaming a package in pkgsrc</h2></div></div></div>
<p>Renaming packages is not recommended.</p>
<p>When renaming packages, be sure to fix any references to old name
  in other Makefiles, options, buildlink files, etc.</p>
<p>Also When renaming a package, please define
  <code class="varname">SUPERSEDES</code> to the package name and dewey version
  pattern(s) of the previous package name.
  This may be repeated for multiple renames.
  The new package would be an exact replacement.
</p>
<p>Note that <span class="quote">&#8220;<span class="quote">successor</span>&#8221;</span> in the
  CHANGES-<em class="replaceable"><code>YYYY</code></em> file doesn't necessarily
  mean that it <span class="emphasis"><em>supersedes</em></span>, as that successor may
  not be an exact replacement but is a suggestion for the replaced
  functionality.</p>
</div>
<div class="sect1" title="21.7. Moving a package in pkgsrc">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="moving-package"></a>21.7. Moving a package in pkgsrc</h2></div></div></div>
<p>It is preferred that packages are not renamed or moved, but if needed
  please follow these steps.
</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>Make a copy of the directory somewhere else.</p></li>
<li class="listitem">
<p>Remove all CVS dirs.</p>
<p>Alternatively to the first two steps you can also do:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs -d user@cvs.NetBSD.org:/cvsroot export -D today pkgsrc/category/package</code></strong></pre>
<p>and use that for further work.</p>
</li>
<li class="listitem"><p>Fix <code class="varname">CATEGORIES</code> and any
<code class="varname">DEPENDS</code> paths that just did <span class="quote">&#8220;<span class="quote">../package</span>&#8221;</span>
instead of <span class="quote">&#8220;<span class="quote">../../category/package</span>&#8221;</span>.</p></li>
<li class="listitem"><p>In the modified package's Makefile, consider setting
<code class="varname">PREV_PKGPATH</code> to the previous category/package
pathname.  The <code class="varname">PREV_PKGPATH</code> can be used by tools
for doing an update using pkgsrc building; for example, it can
search the <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_summary+5+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">pkg_summary</span>(5)</span></a> database for <code class="varname">PREV_PKGPATH</code>
(if no <code class="varname">SUPERSEDES</code>) and then use the corresponding
new <code class="varname">PKGPATH</code> for that moved package.  Note that
it may have multiple matches, so the tool should also check on the
<code class="varname">PKGBASE</code> too.  The <code class="varname">PREV_PKGPATH</code>
probably has no value unless <code class="varname">SUPERSEDES</code> is not
set, i.e.  <code class="varname">PKGBASE</code> stays the same.  </p></li>
<li class="listitem"><p><span class="command"><strong>cvs import</strong></span> the modified package in the new
place.</p></li>
<li class="listitem">
<p>Check if any package depends on it:
</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/pkgsrc</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>grep /package */*/Makefile* */*/buildlink*</code></strong></pre>
</li>
<li class="listitem"><p>Fix paths in packages from step 5 to point to new location.</p></li>
<li class="listitem"><p><span class="command"><strong>cvs rm (-f)</strong></span> the package at the old location.</p></li>
<li class="listitem"><p>Remove from <code class="filename">oldcategory/Makefile</code>.</p></li>
<li class="listitem"><p>Add to <code class="filename">newcategory/Makefile</code>.</p></li>
<li class="listitem">
<p>Commit the changed and removed files:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs commit oldcategory/package oldcategory/Makefile newcategory/Makefile</code></strong></pre>
<p>(and any packages from step 5, of course).</p>
</li>
</ol></div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="debug.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="developers-guide.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="devfaq.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 20. Debugging </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 22. Frequently Asked Questions</td>
</tr>
</table>
</div>
</body>
</html>
