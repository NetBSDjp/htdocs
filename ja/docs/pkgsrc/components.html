<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Chapter 11. Package components - files, directories and contents</title>
<link rel="stylesheet" type="text/css" href="/global.css">
<meta name="generator" content="DocBook XSL Stylesheets VX.X.X">
<link rel="home" href="index.html" title="The pkgsrc guide">
<link rel="up" href="developers-guide.html" title="Part II. The pkgsrc developer's guide">
<link rel="prev" href="creating.html" title="Chapter 10. Creating a new pkgsrc package from scratch">
<link rel="next" href="makefile.html" title="Chapter 12. Programming in Makefiles">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 11. Package components - files, directories and contents</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="creating.html">Prev</a> </td>
<th width="60%" align="center">Part II. The pkgsrc developer's guide</th>
<td width="20%" align="right"> <a accesskey="n" href="makefile.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" title="Chapter 11. Package components - files, directories and contents">
<div class="titlepage"><div><div><h2 class="title">
<a name="components"></a>Chapter 11. Package components - files, directories and contents</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="components.html#components.Makefile">11.1. <code class="filename">Makefile</code></a></span></dt>
<dt><span class="sect1"><a href="components.html#components.distinfo">11.2. <code class="filename">distinfo</code></a></span></dt>
<dt><span class="sect1"><a href="components.html#components.patches">11.3. patches/*</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="components.html#components.patch.structure">11.3.1. Structure of a single patch file</a></span></dt>
<dt><span class="sect2"><a href="components.html#components.patches.caveats">11.3.2. Creating patch files</a></span></dt>
<dt><span class="sect2"><a href="components.html#components.patches.sources">11.3.3. Sources where the patch files come from</a></span></dt>
<dt><span class="sect2"><a href="components.html#components.patches.guidelines">11.3.4. Patching guidelines</a></span></dt>
<dt><span class="sect2"><a href="components.html#components.patches.feedback">11.3.5. Feedback to the author</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="components.html#other-mandatory-files">11.4. Other mandatory files</a></span></dt>
<dt><span class="sect1"><a href="components.html#components.optional">11.5. Optional files</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="components.html#components.optional.bin">11.5.1. Files affecting the binary package</a></span></dt>
<dt><span class="sect2"><a href="components.html#components.optional.build">11.5.2. Files affecting the build process</a></span></dt>
<dt><span class="sect2"><a href="components.html#components.optional.none">11.5.3. Files affecting nothing at all</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="components.html#work-dir">11.6. <code class="filename">work*</code></a></span></dt>
<dt><span class="sect1"><a href="components.html#files-dir">11.7. <code class="filename">files/*</code></a></span></dt>
</dl>
</div>
<p>Whenever you're preparing a package, there are a number of
files involved which are described in the following
sections.</p>
<div class="sect1" title="11.1. Makefile">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.Makefile"></a>11.1. <code class="filename">Makefile</code>
</h2></div></div></div>
<p>Building, installation and creation of a binary package are all
  controlled by the package's <code class="filename">Makefile</code>.
  The <code class="filename">Makefile</code> describes various things about
  a package, for example from where to get it, how to configure,
  build, and install it.</p>
<p>A package <code class="filename">Makefile</code> contains several
  sections that describe the package.</p>
<p>In the first section there are the following variables, which
  should appear exactly in the order given here.  The order and
  grouping of the variables is mostly historical and has no further
  meaning.</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">DISTNAME</code> is the basename of the
    distribution file to be downloaded from the package's
    website.</p></li>
<li class="listitem"><p><code class="varname">PKGNAME</code> is the name of the
    package, as used by pkgsrc. You only need to provide it if
    <code class="varname">DISTNAME</code> (which is the default) is not a good
    name for the package in pkgsrc.  Usually it is the pkgsrc
    directory name together with the version number. It must match the
    regular expression
    <code class="varname">^[A-Za-z0-9][A-Za-z0-9-_.+]*$</code>, that is, it
    starts with a letter or digit, and contains only letters, digits,
    dashes, underscores, dots and plus signs.</p></li>
<li class="listitem"><p><code class="varname">SVR4_PKGNAME</code> is the name of
    the package file to create if the <code class="varname">PKGNAME</code>
    isn't unique on a SVR4 system. The default is
    <code class="varname">PKGNAME</code>, which may be shortened when you use
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/gensolpkg/README.html" target="_top"><code class="filename">pkgtools/gensolpkg</code></a>. Only add
    <code class="varname">SVR4_PKGNAME</code> if <code class="varname">PKGNAME</code>
    does not produce an unique package name on a SVR4 system.
    The length of <code class="varname">SVR4_PKGNAME</code> is limited to 5
    characters.</p></li>
<li class="listitem">
<p><code class="varname">CATEGORIES</code> is a list of categories
    which the package fits in. You can choose any of the top-level
    directories of pkgsrc for it.</p>
<p>Currently the following values are available for
    <code class="varname">CATEGORIES</code>. If more than
    one is used, they need to be separated by spaces:</p>
<pre class="programlisting">
archivers     cross         geography     meta-pkgs     security
audio         databases     graphics      misc          shells
benchmarks    devel         ham           multimedia    sysutils
biology       editors       inputmethod   net           textproc
cad           emulators     lang          news          time
chat          finance       mail          parallel      wm
comms         fonts         math          pkgtools      www
converters    games         mbone         print         x11
</pre>
</li>
<li class="listitem"><p><code class="varname">MASTER_SITES</code>,
    <code class="varname">DYNAMIC_MASTER_SITES</code>,
    <code class="varname">DIST_SUBDIR</code>, <code class="varname">EXTRACT_SUFX</code>
    and <code class="varname">DISTFILES</code> are discussed in detail in
    <a class="xref" href="build.html#build.fetch" title="17.5. The fetch phase">Section 17.5, &#8220;The <span class="emphasis"><em>fetch</em></span> phase&#8221;</a>.</p></li>
</ul></div>
<p>The second section contains information about separately
  downloaded patches, if any.
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PATCHFILES:</code>
    Name(s) of additional files that contain distribution patches.
    There is no default. pkgsrc will look for them at
    <code class="varname">PATCH_SITES</code>.
    They will automatically be uncompressed before patching if
    the names end with <code class="filename">.gz</code> or
    <code class="filename">.Z</code>.</p></li>
<li class="listitem"><p><code class="varname">PATCH_SITES</code>:
    Primary location(s) for distribution patch files (see
    <code class="varname">PATCHFILES</code> below) if not found locally.</p></li>
</ul></div>
<p>The third section contains the following variables.
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">MAINTAINER</code> is the email
    address of the person who feels responsible for this package,
    and who is most likely to look at problems or questions regarding
    this package which have been reported with <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?send-pr+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a>.
    Other developers may contact the <code class="varname">MAINTAINER</code>
    before making changes to the package, but are not required to
    do so. When packaging a new program, set <code class="varname">MAINTAINER</code>
    to yourself. If you really can't maintain the package for future
    updates, set it to
    <code class="email">&lt;<a class="email" href="mailto:pkgsrc-users@NetBSD.org">pkgsrc-users@NetBSD.org</a>&gt;</code>.</p></li>
<li class="listitem"><p><code class="varname">OWNER</code> should be used instead
    of <code class="varname">MAINTAINER</code> when you do not want other
    developers to update or change the package without contacting
    you first. A package Makefile should contain one of
    <code class="varname">MAINTAINER</code> or <code class="varname">OWNER</code>, but
    not both.  </p></li>
<li class="listitem"><p><code class="varname">HOMEPAGE</code> is a URL where users can
    find more information about the package.</p></li>
<li class="listitem"><p><code class="varname">COMMENT</code> is a one-line
    description of the package (should not include the package
    name).</p></li>
</ul></div>
<p>Other variables that affect the build:
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<p><code class="varname">WRKSRC</code>: The directory where the
      interesting distribution files of the package are found. The
      default is <code class="filename">${WRKDIR}/${DISTNAME}</code>, which
      works for most packages.</p>
<p>If a package doesn't create a subdirectory for itself
      (most GNU software does, for instance), but extracts itself in
      the current directory, you should set
      <code class="varname">WRKSRC=${WRKDIR}</code>.</p>
<p>If a package doesn't create a subdirectory with the
      name of <code class="varname">DISTNAME</code> but some different name,
      set <code class="varname">WRKSRC</code> to point to the proper name in
      <code class="filename">${WRKDIR}</code>, for example
      <code class="varname">WRKSRC=${WRKDIR}/${DISTNAME}/unix</code>. See
      <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/lang/tcl/README.html" target="_top"><code class="filename">lang/tcl</code></a> and <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/x11/tk/README.html" target="_top"><code class="filename">x11/tk</code></a> for other examples.</p>
<p>The name of the working directory created by pkgsrc is
      taken from the <code class="varname">WRKDIR_BASENAME</code>
      variable. By default, its value is
      <code class="filename">work</code>. If you want to use the same
      pkgsrc tree for building different kinds of binary packages,
      you can change the variable according to your needs. Two
      other variables handle common cases of setting
      <code class="varname">WRKDIR_BASENAME</code> individually. If
      <code class="varname">OBJHOSTNAME</code> is defined in
      <a class="link" href="configuring.html#mk.conf"><code class="filename">mk.conf</code></a>, the first component of
      the host's name is attached to the directory name. If
      <code class="varname">OBJMACHINE</code> is defined, the platform name
      is attached, which might look like
      <code class="filename">work.i386</code> or
      <code class="filename">work.sparc</code>.</p>
</li></ul></div>
<p>Please pay attention to the following gotchas:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>Add <code class="varname">MANCOMPRESSED</code> if man pages are
      installed in compressed form by the package.  For packages using
      BSD-style makefiles which honor MANZ, there is
      <code class="varname">MANCOMPRESSED_IF_MANZ</code>.</p></li>
<li class="listitem"><p>Replace <code class="filename">/usr/local</code> with
      <span class="quote">&#8220;<span class="quote">${PREFIX}</span>&#8221;</span> in all files (see patches,
      below).</p></li>
<li class="listitem"><p>If the package installs any info files, see <a class="xref" href="fixes.html#faq.info-files" title="19.6.7. Packages installing info files">Section 19.6.7, &#8220;Packages installing info files&#8221;</a>.</p></li>
</ul></div>
</div>
<div class="sect1" title="11.2. distinfo">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.distinfo"></a>11.2. <code class="filename">distinfo</code>
</h2></div></div></div>
<p>The <code class="filename">distinfo</code> file contains the message
  digest, or checksum, of each distfile needed for the package. This
  ensures that the distfiles retrieved from the Internet have not been
  corrupted during transfer or altered by a malign force to introduce
  a security hole. Due to recent rumor about weaknesses of digest
  algorithms, all distfiles are protected using both SHA1 and RMD160
  message digests, as well as the file size.</p>
<p>The <code class="filename">distinfo</code> file also contains the
  checksums for all the patches found in the
  <code class="filename">patches</code> directory (see <a class="xref" href="components.html#components.patches" title="11.3. patches/*">Section 11.3, &#8220;patches/*&#8221;</a>).</p>
<p>To regenerate the <code class="filename">distinfo</code> file, use the
  <span class="command"><strong>make makedistinfo</strong></span> or <span class="command"><strong>make mdi</strong></span>
  command.</p>
<p>Some packages have different sets of distfiles depending on
  the platform, for example <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/lang/openjdk7/README.html" target="_top"><code class="filename">lang/openjdk7</code></a>. These are kept in the same
  <code class="filename">distinfo</code> file and care should be taken when
  upgrading such a package to ensure distfile information is not
  lost.</p>
</div>
<div class="sect1" title="11.3. patches/*">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.patches"></a>11.3. patches/*</h2></div></div></div>
<p>Many packages still don't work out-of-the box on the various
  platforms that are supported by pkgsrc. Therefore, a number of custom
  patch files are needed to make the package work. These patch files are
  found in the <code class="filename">patches/</code> directory.</p>
<p>In the <span class="emphasis"><em>patch</em></span> phase, these patches are
  applied to the files in <code class="varname">WRKSRC</code> directory after
  extracting them, in <a class="ulink" href="http://www.opengroup.org/onlinepubs/009695399/utilities/xcu_chap02.html#tag_02_13_03" target="_top">alphabetic
  order</a>.</p>
<div class="sect2" title="11.3.1. Structure of a single patch file">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patch.structure"></a>11.3.1. Structure of a single patch file</h3></div></div></div>
<p>The <code class="filename">patch-*</code> files should be in
  <span class="command"><strong>diff -bu</strong></span> format, and apply without a fuzz to avoid
  problems. (To force patches to apply with fuzz you can set
  <code class="varname">PATCH_FUZZ_FACTOR=-F2</code>). Furthermore, each patch
  should contain only changes for a single file, and no file should be
  patched by more than one patch file. This helps to keep future
  modifications simple.</p>
<p>Each patch file is structured as follows: In the first line,
  there is the RCS Id of the patch itself. The second line should be
  empty for aesthetic reasons. After that, there should be a comment for
  each change that the patch does. There are a number of standard
  cases:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>Patches for commonly known vulnerabilities should
  mention the vulnerability ID (CAN, CVE).</p></li>
<li class="listitem"><p>Patches that change source code should mention the
  platform and other environment (for example, the compiler) that the
  patch is needed for.</p></li>
</ul></div>
<p>In all, the patch should be commented so that any
  developer who knows the code of the application can make some use of
  the patch. Special care should be taken for the upstream developers,
  since we generally want that they accept our patches, so we have less
  work in the future.</p>
</div>
<div class="sect2" title="11.3.2. Creating patch files">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.caveats"></a>11.3.2. Creating patch files</h3></div></div></div>
<p>One important thing to mention is to pay attention that no RCS
  IDs get stored in the patch files, as these will cause problems when
  later checked into the NetBSD CVS tree. Use the
  <span class="command"><strong>pkgdiff</strong></span> command from the <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdiff/README.html" target="_top"><code class="filename">pkgtools/pkgdiff</code></a> package to avoid these
  problems.</p>
<p>For even more automation, we recommend using
  <span class="command"><strong>mkpatches</strong></span> from the same package to make a
  whole set of patches. You just have to backup files before you
  edit them to <code class="filename">filename.orig</code>, e.g. with
  <span class="command"><strong>cp -p filename filename.orig</strong></span> or, easier, by
  using <span class="command"><strong>pkgvi</strong></span> again from the same package. If
  you upgrade a package this way, you can easily compare the new
  set of patches with the previously existing one with
  <span class="command"><strong>patchdiff</strong></span>. The files in <code class="filename">patches</code>
  are replaced by new files, so carefully check if you want to take all
  the changes.</p>
<p>When you have finished a package, remember to generate
  the checksums for the patch files by using the <span class="command"><strong>make
  makepatchsum</strong></span> command, see <a class="xref" href="components.html#components.distinfo" title="11.2. distinfo">Section 11.2, &#8220;<code class="filename">distinfo</code>&#8221;</a>.</p>
<p>When adding a patch that corrects a problem in the
  distfile (rather than e.g. enforcing pkgsrc's view of where
  man pages should go), send the patch as a bug report to the
  maintainer.  This benefits non-pkgsrc users of the package,
  and usually makes it possible to remove the patch in future
  version.</p>
<p>The file names of the patch files are usually of the form
  <code class="filename">patch-<em class="replaceable"><code>path_to_file__with__underscores.c</code></em></code>.
  Many packages still use the previous convention
  <code class="filename">patch-<em class="replaceable"><code>[a-z][a-z]</code></em></code>,
  but new patches should be of the form containing the filename.
  <span class="command"><strong>mkpatches</strong></span> included in <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdiff/README.html" target="_top"><code class="filename">pkgtools/pkgdiff</code></a> takes care of the name
  automatically.</p>
</div>
<div class="sect2" title="11.3.3. Sources where the patch files come from">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.sources"></a>11.3.3. Sources where the patch files come from</h3></div></div></div>
<p>If you want to share patches between multiple packages
  in pkgsrc, e.g. because they use the same distfiles, set
  <code class="varname">PATCHDIR</code> to the path where the patch files
  can be found, e.g.:</p>
<pre class="programlisting">
PATCHDIR= ${.CURDIR}/../xemacs/patches
</pre>
<p>Patch files that are distributed by the author or other
    maintainers can be listed in
    <code class="varname">PATCHFILES</code>.</p>
<p>If it is desired to store any patches that should not be
    committed into pkgsrc, they can be kept outside the pkgsrc
    tree in the <code class="filename">$LOCALPATCHES</code> directory. The
    directory tree there is expected to have the same
    <span class="quote">&#8220;<span class="quote">category/package</span>&#8221;</span> structure as pkgsrc, and
    patches are expected to be stored inside these dirs (also
    known as <code class="filename">$LOCALPATCHES/$PKGPATH</code>). For
    example, if you want to keep a private patch for
    <code class="filename">pkgsrc/graphics/png</code>, keep it in
    <code class="filename">$LOCALPATCHES/graphics/png/mypatch</code>. All
    files in the named directory are expected to be patch files,
    and <span class="emphasis"><em>they are applied after pkgsrc patches are
    applied</em></span>.</p>
</div>
<div class="sect2" title="11.3.4. Patching guidelines">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.guidelines"></a>11.3.4. Patching guidelines</h3></div></div></div>
<p>When fixing a portability issue in the code do not use
      preprocessor magic to check for the current operating system nor
      platform.  Doing so hurts portability to other platforms because
      the OS-specific details are not abstracted appropriately.</p>
<p>The general rule to follow is: instead of checking for the
      operating system the application is being built on, check for the
      specific <span class="emphasis"><em>features</em></span> you need.  For example,
      instead of assuming that kqueue is available under NetBSD and
      using the <code class="varname">__NetBSD__</code> macro to conditionalize
      kqueue support, add a check that detects kqueue itself &mdash;
      yes, this generally involves patching the
      <span class="command"><strong>configure</strong></span> script.  There is absolutely nothing
      that prevents some OSes from adopting interfaces from other OSes
      (e.g. Linux implementing kqueue), something that the above checks
      cannot take into account.</p>
<p>Of course, checking for features generally involves more
      work on the developer's side, but the resulting changes are
      cleaner and there are chances they will work on many other
      platforms.  Not to mention that there are higher chances of being
      later integrated into the mainstream sources.  Remember:
      <span class="emphasis"><em>It doesn't work unless it is right!</em></span></p>
<p>Some typical examples:</p>
<div class="table">
<a name="patch-examples"></a><p class="title"><b>Table 11.1. Patching examples</b></p>
<div class="table-contents"><table summary="Patching examples" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>Where</th>
<th>Incorrect</th>
<th>Correct</th>
</tr></thead>
<tbody>
<tr>
<td>configure script</td>
<td>
<pre class="programlisting">
case ${target_os} in
netbsd*) have_kvm=yes ;;
*)       have_kvm=no  ;;
esac
</pre>
	      </td>
<td>
<pre class="programlisting">
AC_CHECK_LIB(kvm, kvm_open, have_kvm=yes, have_kvm=no)
</pre>
	      </td>
</tr>
<tr>
<td>C source file</td>
<td>
<pre class="programlisting">
#if defined(__NetBSD__)
#  include &lt;sys/event.h&gt;
#endif
</pre>
	      </td>
<td>
<pre class="programlisting">
#if defined(HAVE_SYS_EVENT_H)
#  include &lt;sys/event.h&gt;
#endif
</pre>
	      </td>
</tr>
<tr>
<td>C source file</td>
<td>
<pre class="programlisting">
int
monitor_file(...)
{
#if defined(__NetBSD__)
        int fd = kqueue();
        ...
#else
        ...
#endif
}
</pre>
	      </td>
<td>
<pre class="programlisting">
int
monitor_file(...)
{
#if defined(HAVE_KQUEUE)
        int fd = kqueue();
        ...
#else
	...
#endif
}
</pre>
	      </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>For more information, please read the <span class="emphasis"><em>Making
      packager-friendly software</em></span> article (<a class="ulink" href="http://www.onlamp.com/pub/a/onlamp/2005/03/31/packaging.html" target="_top">part
      1</a>, <a class="ulink" href="http://www.oreillynet.com/pub/a/onlamp/2005/04/28/packaging2.html" target="_top">part
      2</a>).  It summarizes multiple details on how to make
      software easier to package; all the suggestions in it were
      collected from our experience in pkgsrc work, so they are possibly
      helpful when creating patches too.</p>
</div>
<div class="sect2" title="11.3.5. Feedback to the author">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.feedback"></a>11.3.5. Feedback to the author</h3></div></div></div>
<p>Always, always, <span class="strong"><strong>always</strong></span>
      feed back any <span class="emphasis"><em>portability fixes</em></span> or
      improvements you do to a package to the mainstream developers.
      This is the only way to get their attention on portability issues
      and to ensure that future versions can be built out-of-the box on
      NetBSD.  Furthermore, any user that gets newer distfiles will get
      the fixes straight from the packaged code.</p>
<p>This generally involves cleaning up the patches
      (because sometimes the patches that are
      added to pkgsrc are quick hacks), filling bug reports in the
      appropriate trackers for the projects and working with the
      mainstream authors to accept your changes.  It is
      <span class="emphasis"><em>extremely important</em></span> that you do it so that
      the packages in pkgsrc are kept simple and thus further changes
      can be done without much hassle.</p>
<p>When you have done this, please add a URL to the upstream
      bug report to the patch comment.</p>
<p>Support the idea of free software!</p>
</div>
</div>
<div class="sect1" title="11.4. Other mandatory files">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="other-mandatory-files"></a>11.4. Other mandatory files</h2></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">DESCR</code></span></dt>
<dd><p>A multi-line description of the piece of software.  This should include
	  any credits where they are due.  Please bear in mind that others do not
	  share your sense of humour (or spelling idiosyncrasies), and that others
	  will read everything that you write here.</p></dd>
<dt><span class="term"><code class="filename">PLIST</code></span></dt>
<dd><p>This file governs the files that are installed on your
	  system: all the binaries, manual pages, etc. There are other
	  directives which may be entered in this file, to control the
	  creation and deletion of directories, and the location of
	  inserted files.  See <a class="xref" href="plist.html" title="Chapter 13. PLIST issues">Chapter 13, <i>PLIST issues</i></a> for more
	  information.</p></dd>
</dl></div>
</div>
<div class="sect1" title="11.5. Optional files">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.optional"></a>11.5. Optional files</h2></div></div></div>
<div class="sect2" title="11.5.1. Files affecting the binary package">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.optional.bin"></a>11.5.1. Files affecting the binary package</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">INSTALL</code></span></dt>
<dd>
<p>This shell script is invoked twice by <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>.
	    First time after package extraction and before files are
	    moved in place, the second time after the files to install
	    are moved in place. This can be used to do any custom
	    procedures not possible with @exec commands in
	    <code class="filename">PLIST</code>. See <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> and
	    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_create+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">pkg_create</span>(1)</span></a> for more information.  See also <a class="xref" href="pkginstall.html#files-and-dirs-outside-prefix" title="15.1. Files and directories outside the installation prefix">Section 15.1, &#8220;Files and directories outside the installation prefix&#8221;</a>.
	    Please note that you can modify variables in it easily by using
	    <code class="varname">FILES_SUBST</code> in the package's
	    <code class="filename">Makefile</code>:</p>
<pre class="programlisting">
FILES_SUBST+=  SOMEVAR="somevalue"
</pre>
<p>replaces "@SOMEVAR@" with <span class="quote">&#8220;<span class="quote">somevalue</span>&#8221;</span> in the
	    <code class="filename">INSTALL</code>.  By default, substitution is
	    performed for <code class="varname">PREFIX</code>,
	    <code class="varname">LOCALBASE</code>, <code class="varname">X11BASE</code>,
	    <code class="varname">VARBASE</code>, and a few others, type
	    <span class="command"><strong>make help topic=FILES_SUBST</strong></span> for a
	    complete list.</p>
</dd>
<dt><span class="term"><code class="filename">DEINSTALL</code></span></dt>
<dd><p>This script is executed before and after any files are removed.  It is
	    this script's responsibility to clean up any additional messy details
	    around the package's installation, since all pkg_delete knows is how to
	    delete the files created in the original distribution.
	    See <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>
	    and <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_create+1+NetBSD-current"><span class="citerefentry"><span class="refentrytitle">pkg_create</span>(1)</span></a> for more information.
	    The same methods to replace variables can be used as for
	    the <code class="filename">INSTALL</code> file.</p></dd>
<dt><span class="term"><code class="filename">MESSAGE</code></span></dt>
<dd>
<p>This file is displayed after installation of the package.
	    Useful for things like legal notices on almost-free
	    software and hints for updating config files after
	    installing modules for apache, PHP etc.
	    Please note that you can modify variables in it easily by using
	    <code class="varname">MESSAGE_SUBST</code> in the package's
	    <code class="filename">Makefile</code>:</p>
<pre class="programlisting">
MESSAGE_SUBST+=  SOMEVAR="somevalue"
</pre>
<p>replaces "${SOMEVAR}" with <span class="quote">&#8220;<span class="quote">somevalue</span>&#8221;</span> in
	    <code class="filename">MESSAGE</code>.  By default, substitution is
	    performed for <code class="varname">PKGNAME</code>,
	    <code class="varname">PKGBASE</code>, <code class="varname">PREFIX</code>,
	    <code class="varname">LOCALBASE</code>, <code class="varname">X11PREFIX</code>,
	    <code class="varname">X11BASE</code>,
	    <code class="varname">PKG_SYSCONFDIR</code>,
	    <code class="varname">ROOT_GROUP</code>, and
	    <code class="varname">ROOT_USER</code>.</p>
<p>You can display a different or additional files by
	    setting the <code class="varname">MESSAGE_SRC</code> variable.  Its
	    default is <code class="filename">MESSAGE</code>, if the file
	    exists.</p>
</dd>
<dt><span class="term"><code class="filename">ALTERNATIVES</code></span></dt>
<dd><p>FIXME: There is no documentation on the
	alternatives framework.</p></dd>
</dl></div>
</div>
<div class="sect2" title="11.5.2. Files affecting the build process">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.optional.build"></a>11.5.2. Files affecting the build process</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">Makefile.common</code></span></dt>
<dd><p>This file contains arbitrary things that could
	also go into a <code class="filename">Makefile</code>, but its purpose is
	to be used by more than one package. This file should only be
	used when the packages that will use the file are known in
	advance. For other purposes it is often better to write a
	<code class="filename">*.mk</code> file and give it a good name that
	describes what it does.</p></dd>
<dt><span class="term"><code class="filename">buildlink3.mk</code></span></dt>
<dd><p>This file contains the dependency information
	for the buildlink3 framework (see <a class="xref" href="buildlink.html" title="Chapter 14. Buildlink methodology">Chapter 14, <i>Buildlink methodology</i></a>).</p></dd>
<dt><span class="term"><code class="filename">hacks.mk</code></span></dt>
<dd><p>This file contains workarounds for compiler bugs
	and similar things. It is included automatically by the pkgsrc
	infrastructure, so you don't need an extra
	<code class="literal">.include</code> line for
	it.</p></dd>
<dt><span class="term"><code class="filename">options.mk</code></span></dt>
<dd><p>This file contains the code for the
	package-specific options (see <a class="xref" href="options.html" title="Chapter 16. Options handling">Chapter 16, <i>Options handling</i></a>) that can be
	selected by the user. If a package has only one or two options,
	it is equally acceptable to put the code directly into the
	<code class="filename">Makefile</code>.</p></dd>
</dl></div>
</div>
<div class="sect2" title="11.5.3. Files affecting nothing at all">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.optional.none"></a>11.5.3. Files affecting nothing at all</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">README*</code></span></dt>
<dd><p>These files do not take place in the creation of
	a package and thus are purely informative to the package
	developer.</p></dd>
<dt><span class="term"><code class="filename">TODO</code></span></dt>
<dd><p>This file contains things that need to be done
	to make the package even
	better.</p></dd>
</dl></div>
</div>
</div>
<div class="sect1" title="11.6. work*">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="work-dir"></a>11.6. <code class="filename">work*</code>
</h2></div></div></div>
<p>When you type <span class="command"><strong>make</strong></span>, the distribution files are
    unpacked into the directory denoted by
    <code class="varname">WRKDIR</code>. It can be removed by running
    <span class="command"><strong>make clean</strong></span>. Besides the sources, this
    directory is also used to keep various timestamp files.
    The directory gets <span class="emphasis"><em>removed completely</em></span> on clean.
    The default is <code class="filename">${.CURDIR}/work</code>
    or <code class="filename">${.CURDIR}/work.${MACHINE_ARCH}</code>
    if <code class="varname">OBJMACHINE</code> is set.</p>
</div>
<div class="sect1" title="11.7. files/*">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="files-dir"></a>11.7. <code class="filename">files/*</code>
</h2></div></div></div>
<p>If you have any files that you wish to be placed in the package prior
    to configuration or building, you could place these files here and use
    a <span class="command"><strong>${CP}</strong></span> command in the
    <span class="quote">&#8220;<span class="quote">pre-configure</span>&#8221;</span> target to achieve
    this. Alternatively, you could simply diff the file against
    <code class="filename">/dev/null</code> and use the patch mechanism to manage
    the creation of this file.</p>
<p>If you want to share files in this way with other
    packages, set the <code class="varname">FILESDIR</code> variable to point
    to the other package's <code class="filename">files</code> directory,
    e.g.:</p>
<pre class="programlisting">
FILESDIR=${.CURDIR}/../xemacs/files
</pre>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="creating.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="developers-guide.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="makefile.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Chapter 10. Creating a new pkgsrc package from scratch </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 12. Programming in <code class="filename">Makefile</code>s</td>
</tr>
</table>
</div>
</body>
</html>
