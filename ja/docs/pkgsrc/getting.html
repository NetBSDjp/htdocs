<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Chapter 2. どこからpkgsrcを得て、どうやって最新に保つか</title>
<link rel="stylesheet" type="text/css" href="/global.css">
<meta name="generator" content="DocBook XSL Stylesheets VX.X.X">
<link rel="home" href="index.html" title="The pkgsrc guide">
<link rel="up" href="users-guide.html" title="Part I. pkgsrc 利用者向けの手引き">
<link rel="prev" href="users-guide.html" title="Part I. pkgsrc 利用者向けの手引き">
<link rel="next" href="platforms.html" title="Chapter 3. NetBSD 以外のシステムで pkgsrc を使う">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF">
<div class="navheader">
<table width="100%" summary="Navigation header">
<tr><th colspan="3" align="center">Chapter 2. どこからpkgsrcを得て、どうやって最新に保つか</th></tr>
<tr>
<td width="20%" align="left">
<a accesskey="p" href="users-guide.html">Prev</a> </td>
<th width="60%" align="center">Part I. pkgsrc 利用者向けの手引き</th>
<td width="20%" align="right"> <a accesskey="n" href="platforms.html">Next</a>
</td>
</tr>
</table>
<hr>
</div>
<div class="chapter" title="Chapter 2. どこからpkgsrcを得て、どうやって最新に保つか">
<div class="titlepage"><div><div><h2 class="title">
<a name="getting"></a>Chapter 2. どこからpkgsrcを得て、どうやって最新に保つか</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="getting.html#getting-first">2.1. pkgsrc を初めて入手する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="getting.html#getting-via-tar">2.1.1. tar ファイル</a></span></dt>
<dt><span class="sect2"><a href="getting.html#getting-via-cvs">2.1.2. anonymous CVS 経由</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="getting.html#uptodate">2.2. pkgsrc を最新の状態に保つ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="getting.html#uptodate-tar">2.2.1. tar ファイルを使用</a></span></dt>
<dt><span class="sect2"><a href="getting.html#uptodate-cvs">2.2.2. CVS 経由</a></span></dt>
</dl></dd>
</dl>
</div>
<p>ファイルをダウンロードして展開する前に、
ファイルを展開する場所を決めておく必要があります。
pkgsrc を root ユーザーとして使う場合、pkgsrc は通常は
<code class="filename">/usr/pkgsrc</code> にインストールされます。
ソースおよびバイナリーパッケージは、
ファイルシステム中のどこでも好きな場所にインストールしてかまいませんが、
シェルその他のプログラムにとって特別な意味を持つスペースなどの文字は、
パス名に含めてはいけません。
アルファベット、数字、下線とダッシュだけを使うのが安全な方法です。</p>
<div class="sect1" title="2.1. pkgsrc を初めて入手する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="getting-first"></a>2.1. pkgsrc を初めて入手する</h2></div></div></div>
<p>pkgsrc のファイルをダウンロードする前に、
	<span class="emphasis"><em>current</em></span> 枝と <span class="emphasis"><em>stable</em></span>
	(安定版) 枝のどちらを使うのかを決めます。
	後者は、current 枝から四半期ごとに分岐するもので、
	セキュリティー上の更新に限って修正されます。
	stable 枝の名前は、年と四半期を組み合わせたもので、たとえば
	<code class="literal">2009Q1</code> となります。</p>
<p>次に、pkgsrc を<span class="emphasis"><em>どの方法で</em></span>
	ダウンロードするかを決めます。方法としては、tarファイル、
	CVS経由があります。ここでは両方とも説明します。</p>
<div class="sect2" title="2.1.1. tar ファイル">
<div class="titlepage"><div><div><h3 class="title">
<a name="getting-via-tar"></a>2.1.1. tar ファイル</h3></div></div></div>
<p>pkgsrc のあらゆるファイルの一次配布元は
	<a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/" target="_top">ftp://ftp.NetBSD.org/pub/pkgsrc/</a> です。
	目的別に多数のサブディレクトリーがありますが、
	それについては <a class="xref" href="ftp-layout.html" title="Appendix C. pkgsrc FTP サーバーのディレクトリー配置">Appendix C, <i>pkgsrc FTP サーバーのディレクトリー配置</i></a> で詳しく説明しています。</p>
<p>current 枝の tar ファイルは、
	<code class="filename">current</code> ディレクトリー内にあり、ファイル名は <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz" target="_top"><code class="filename">pkgsrc.tar.gz</code></a> です。
	このファイルは、毎日、自動生成されます。</p>
<p>安定版の 2009Q1 枝の tar ファイルは、
	<code class="filename">pkgsrc-2009Q1</code> ディレクトリー内にあり、ファイル名は同じく <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/pkgsrc-2009Q1/pkgsrc-2009Q1.tar.gz" target="_top"><code class="filename">pkgsrc-2009Q1.tar.gz</code></a> です。</p>
<p>安定版 pkgsrc の tarball をダウンロードするには、以下のコマンドを実行します。</p>
<pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>ftp ftp://ftp.NetBSD.org/pub/pkgsrc/<em class="replaceable"><code>pkgsrc-20xxQy</code></em>/<em class="replaceable"><code>pkgsrc-20xxQy</code></em>.tar.gz</code></strong></pre>
<p>ここで、<em class="replaceable"><code>pkgsrc-20xxQy</code></em> は、
	ダウンロードする安定版の枝名にします。たとえば、
	<span class="quote">“<span class="quote">pkgsrc-2009Q1</span>”</span> になります。</p>
<p>ダウンロードしたら、以下のようにして展開します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>tar -xzf <em class="replaceable"><code>pkgsrc-20xxQy</code></em>.tar.gz -C /usr</code></strong></pre>
<p>こうすると、<code class="filename">/usr/</code> に
	<code class="filename">pkgsrc/</code> ディレクトリーが作られ、
	<code class="filename">/usr/pkgsrc/</code> 以下に全パッケージのソースが置かれます。</p>
<p>pkgsrc-current をダウンロードするには、以下のコマンドを実行します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>ftp ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz</code></strong></pre>
</div>
<div class="sect2" title="2.1.2. anonymous CVS 経由">
<div class="titlepage"><div><div><h3 class="title">
<a name="getting-via-cvs"></a>2.1.2. anonymous CVS 経由</h3></div></div></div>
<p>pkgsrc の stable 枝名を指定して取得するためには、以下のコマンドを実行します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr &amp;&amp; cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -r <em class="replaceable"><code>pkgsrc-20xxQy</code></em> -P pkgsrc</code></strong>
</pre>
<p>ここで、<em class="replaceable"><code>pkgsrc-20xxQy</code></em> は、
	チェックアウトする stable 枝名にします。たとえば <span class="quote">“<span class="quote">pkgsrc-2009Q1</span>”</span> になります。</p>
<p>こうすると、<code class="filename">/usr/</code> ディレクトリーに
	<code class="filename">pkgsrc/</code> ディレクトリーが作られ、
	<code class="filename">/usr/pkgsrc/</code> 以下に全パッケージのソースが置かれます。</p>
<p>pkgsrc current を取得するには、以下のコマンドを実行します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr &amp;&amp; cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc</code></strong>
</pre>
<p><a class="ulink" href="http://NetBSD.org/FIXME" target="_top">利用可能な CVS ミラーサイト一覧</a>から、もっとも速いものを選んで使ってください。</p>
<p><code class="literal">rsh</code> のエラーメッセージが出た場合は、たとえば以下のようにして、環境変数 CVS_RSH を設定する必要があります。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr &amp;&amp; env CVS_RSH=ssh cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc</code></strong>
</pre>
<p>CVS_RSH=ssh の設定を今後も有効なままにする方法は、お使いのコマンドシェルのドキュメンテーションをご覧ください。
	Bourne シェルの場合は、この設定を以下のとおりユーザーの <code class="filename">.profile</code> に、
	またはより大域的に <code class="filename">/etc/profile</code> に書くことができます。</p>
<pre class="programlisting">
# set CVS remote shell command
CVS_RSH=ssh
export CVS_RSH
</pre>
<p>CVS は、標準状態では、多くの人の望む挙動をしてくれません。
	しかし、
	以下の内容の <code class="filename">.cvsrc</code>
	というファイルをホームディレクトリーに置いておけば、
	標準での挙動を変えることができます。このファイルを置いておけば、
	あなたの悩みや、余計なバグ報告もなくなるでしょうから、
	そうすることを強くおすすめします。
	このファイルに関する説明は、
	CVS のドキュメンテーションにあります。</p>
<pre class="programlisting">
# recommended CVS configuration file from the pkgsrc guide
cvs -q -z3
checkout -P
update -dP
diff -upN
rdiff -u
release -d
</pre>
</div>
</div>
<div class="sect1" title="2.2. pkgsrc を最新の状態に保つ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="uptodate"></a>2.2. pkgsrc を最新の状態に保つ</h2></div></div></div>
<p>pkgsrc を最新の状態に保つ方法としては、CVS をおすすめします
	(最初に tar ファイルを使ってインストールした場合でも、更新には
	CVS を使えます)。 CVS を使えば、tar ファイルをあらためてダウンロードした場合にくらべ、
	帯域やハードディスクの負荷を減らすことができます。</p>
<div class="sect2" title="2.2.1. tar ファイルを使用">
<div class="titlepage"><div><div><h3 class="title">
<a name="uptodate-tar"></a>2.2.1. tar ファイルを使用</h3></div></div></div>
<div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Warning</h3>
<p>tar ファイルを使って更新する場合は、まず、
	これまで使っていた pkgsrc ディレクトリーを完全に削除する必要があります。
	さもないと、それまでの間に pkgsrc から削除されたファイルがローカルディスクに残ったままになり、
	不整合が生じてしまいます。
	これまで使っていたファイルを消す場合、pkgsrc のファイルに独自に施した変更が、
	更新後にすべて失われてしまいます。
	このため、CVS を使った更新を強くおすすめします。</p>
</div>
<p>なお、distfile とバイナリーパッケージは、標準ではいずれも
	pkgsrc ツリー内に置かれますので、pkgsrc ツリーを更新する前に退避させておくことを忘れないでください。
	<code class="varname">DISTDIR</code> と <code class="varname">PACKAGES</code>
	を設定して、標準のディレクトリーとは別の場所を
	pkgsrc が使うような構成にすることもできます。
	詳細は<a class="xref" href="configuring.html" title="Chapter 5. pkgsrc を設定する">Chapter 5, <i>pkgsrc を設定する</i></a>をご覧ください。</p>
<p>tar ファイルを使って pkgsrc を更新するためには、
	初回の入手時と同様に、tar ファイルをダウンロードします。
	次に、pkgsrc ディレクトリーに独自の変更を何も加えていないことを確認します。
	pkgsrc ディレクトリーを削除してから、新しい tar ファイルを展開します。これで完了です。</p>
</div>
<div class="sect2" title="2.2.2. CVS 経由">
<div class="titlepage"><div><div><h3 class="title">
<a name="uptodate-cvs"></a>2.2.2. CVS 経由</h3></div></div></div>
<p>CVS を使って pkgsrc を更新するためには、<code class="filename">pkgsrc</code> ディレクトリーへ移動して cvs を実行します:</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr/pkgsrc &amp;&amp; cvs update -dP</code></strong>
</pre>
<p><code class="literal">rsh</code> がエラーメッセージを出す場合は、前述の新規取得時と同様に、環境変数 CVS_RSH を設定する必要があります。たとえば以下のようにします。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr/pkgsrc &amp;&amp; env CVS_RSH=ssh cvs up -dP</code></strong>
</pre>
<div class="sect3" title="2.2.2.1. pkgsrc の別の枝に移る">
<div class="titlepage"><div><div><h4 class="title">
<a name="uptodate-cvs-switch"></a>2.2.2.1. pkgsrc の別の枝に移る</h4></div></div></div>
<p>pkgsrc の更新時、CVS プログラムはそれまで使っていた枝をそのまま追いつづけます。
	しかし、何らかの理由で stable 枝から current 枝に移りたい場合は、
	<span class="quote">“<span class="quote">update</span>”</span> キーワードの後に <span class="quote">“<span class="quote">-A</span>”</span>
	オプションを追加して current に移ることができます。
	current 枝から stable 枝に戻るには、
	<span class="quote">“<span class="quote">-rpkgsrc-2009Q3</span>”</span> オプションを追加します。</p>
</div>
<div class="sect3" title="2.2.2.2. 私がおこなった変更は、更新時にどうなるか?">
<div class="titlepage"><div><div><h4 class="title">
<a name="uptodate-cvs-changes"></a>2.2.2.2. 私がおこなった変更は、更新時にどうなるか?</h4></div></div></div>
<p>pkgsrc の更新時、CVS プログラムは
	CVS リポジトリーに登録されたファイルだけに手を加えます。
	このため、あなたが独自に作成したパッケージは、変更されずに残ります。
	あなたが CVS の管理下にあるファイルを独自に修正している場合、
	CVS による更新時には、あなた独自の変更と他の人による
	(CVS リポジトリーに反映されている) 変更を統合しようとします。
	詳細は、CVS のマニュアルの <span class="quote">“<span class="quote">update</span>”</span> の章をご覧ください。</p>
</div>
</div>
</div>
</div>
<div class="navfooter">
<hr>
<table width="100%" summary="Navigation footer">
<tr>
<td width="40%" align="left">
<a accesskey="p" href="users-guide.html">Prev</a> </td>
<td width="20%" align="center"><a accesskey="u" href="users-guide.html">Up</a></td>
<td width="40%" align="right"> <a accesskey="n" href="platforms.html">Next</a>
</td>
</tr>
<tr>
<td width="40%" align="left" valign="top">Part I. pkgsrc 利用者向けの手引き </td>
<td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td>
<td width="40%" align="right" valign="top"> Chapter 3. NetBSD 以外のシステムで pkgsrc を使う</td>
</tr>
</table>
</div>
</body>
</html>
