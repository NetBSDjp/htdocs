<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>The pkgsrc guide</title>
<link rel="stylesheet" type="text/css" href="/global.css">
<meta name="generator" content="DocBook XSL Stylesheets VX.X.X">
<meta name="description" content="pkgsrc は、Unix 風のオペレーティングシステム向けの、 集中管理型パッケージ管理システムです。この手引きでは、 pkgsrc の利用者向けと開発者向けの情報を掲載しています。 バイナリーおよびソースパッケージのインストール、 バイナリーおよびソースパッケージの作成から、 基盤についての高度な概観までを網羅しています。">
</head>
<body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="book" title="The pkgsrc guide">
<div class="titlepage">
<div>
<div><h1 class="title">
<a name="the-pkgsrc-guide"></a>The pkgsrc guide</h1></div>
<div><h2 class="subtitle">NetBSD パッケージシステムに関するドキュメンテーション</h2></div>
<div><div class="authorgroup">
<div class="author">
<h3 class="author">
<span class="firstname">Alistair</span> <span class="surname">Crooks</span>
</h3>
<div class="affiliation"><div class="address"><p><code class="email">&lt;<a class="email" href="mailto:agc@NetBSD.org">agc@NetBSD.org</a>&gt;</code></p></div></div>
</div>
<div class="author">
<h3 class="author">
<span class="firstname">Hubert</span> <span class="surname">Feyrer</span>
</h3>
<div class="affiliation"><div class="address"><p><code class="email">&lt;<a class="email" href="mailto:hubertf@NetBSD.org">hubertf@NetBSD.org</a>&gt;</code></p></div></div>
</div>
<h3 class="corpauthor">
        The pkgsrc Developers
      </h3>
</div></div>
<div><p class="copyright">Copyright © 1994-2007 The NetBSD Foundation, Inc</p></div>
<div><p class="pubdate">$NetBSD: pkgsrc.xml,v 1.26 2007/09/18 08:17:21 rillig Exp $</p></div>
<div><div class="abstract" title="Abstract">
<p class="title"><b>Abstract</b></p>
<p>pkgsrc は、Unix 風のオペレーティングシステム向けの、
	集中管理型パッケージ管理システムです。この手引きでは、
	pkgsrc の利用者向けと開発者向けの情報を掲載しています。
	バイナリーおよびソースパッケージのインストール、
	バイナリーおよびソースパッケージの作成から、
	基盤についての高度な概観までを網羅しています。</p>
</div></div>
</div>
<hr>
</div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="chapter"><a href="#introduction">1. pkgsrc とは何か</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#introduction-section">1.1. イントロダクション</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#why-pkgsrc">1.1.1. なぜ pkgsrc なのか?</a></span></dt>
<dt><span class="sect2"><a href="#intro.platforms">1.1.2. 対応プラットフォーム</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#overview">1.2. 概要</a></span></dt>
<dt><span class="sect1"><a href="#terminology">1.3. 専門用語</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#term.roles">1.3.1. pkgsrc に関わる人たち</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#typography">1.4. 体裁</a></span></dt>
</dl></dd>
<dt><span class="part"><a href="#users-guide">I. pkgsrc 利用者向けの手引き</a></span></dt>
<dd><dl>
<dt><span class="chapter"><a href="#getting">2. どこからpkgsrcを得て、どうやって最新に保つか</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#getting-first">2.1. pkgsrc を初めて入手する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#getting-via-tar">2.1.1. tar ファイル</a></span></dt>
<dt><span class="sect2"><a href="#getting-via-cvs">2.1.2. anonymous CVS 経由</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#uptodate">2.2. pkgsrc を最新の状態に保つ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#uptodate-tar">2.2.1. tar ファイルを使用</a></span></dt>
<dt><span class="sect2"><a href="#uptodate-cvs">2.2.2. CVS 経由</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#platforms">3. NetBSD 以外のシステムで pkgsrc を使う</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#binarydist">3.1. バイナリー配布</a></span></dt>
<dt><span class="sect1"><a href="#bootstrapping-pkgsrc">3.2. pkgsrc を使う準備をする</a></span></dt>
<dt><span class="sect1"><a href="#platform-specific-notes">3.3. プラットフォーム別の覚書</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#darwin">3.3.1. Darwin (Mac OS X)</a></span></dt>
<dt><span class="sect2"><a href="#freebsd">3.3.2. FreeBSD</a></span></dt>
<dt><span class="sect2"><a href="#interix">3.3.3. Interix</a></span></dt>
<dt><span class="sect2"><a href="#irix">3.3.4. IRIX</a></span></dt>
<dt><span class="sect2"><a href="#linux">3.3.5. Linux</a></span></dt>
<dt><span class="sect2"><a href="#openbsd">3.3.6. OpenBSD</a></span></dt>
<dt><span class="sect2"><a href="#solaris">3.3.7. Solaris</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#using">4. pkgsrc を使う</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#using-pkg">4.1. バイナリーパッケージを使う</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#finding-binary-packages">4.1.1. バイナリーパッケージの配布場所</a></span></dt>
<dt><span class="sect2"><a href="#installing-binary-packages">4.1.2. バイナリーパッケージをインストールする</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_delete">4.1.3. パッケージをアンインストールする</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_info">4.1.4. インストールされているパッケージの情報を得る</a></span></dt>
<dt><span class="sect2"><a href="#vulnerabilities">4.1.5. インストール済パッケージの脆弱性チェック</a></span></dt>
<dt><span class="sect2"><a href="#pkg_versions">4.1.6. インストール済パッケージのより新しいバージョンが pkgsrc にあるかどうか調べる</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_admin">4.1.7. その他の管理用機能</a></span></dt>
<dt><span class="sect2"><a href="#a-word-of-warning">4.1.8. 警告</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#building-packages-from-source">4.2. ソースからパッケージを構築する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#requirements">4.2.1. 必要なもの</a></span></dt>
<dt><span class="sect2"><a href="#fetching-distfiles">4.2.2. 配布ファイルの取得</a></span></dt>
<dt><span class="sect2"><a href="#how-to-build-and-install">4.2.3. 構築とインストール方法</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#configuring">5. pkgsrc を設定する</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#general-configuration">5.1. 全般的な設定</a></span></dt>
<dt><span class="sect1"><a href="#variables-affecting-build">5.2. 構築の過程に影響を及ぼす変数</a></span></dt>
<dt><span class="sect1"><a href="#variables-affecting-installation">5.3. インストール過程に影響をおよぼす変数</a></span></dt>
<dt><span class="sect1"><a href="#conf.compiler">5.4. コンパイラーの選択と設定</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#selecting-the-compiler">5.4.1. コンパイラーを選ぶ</a></span></dt>
<dt><span class="sect2"><a href="#conf.cflags">5.4.2. コンパイラーへのフラグの追加 (<code class="varname">CFLAGS</code>)</a></span></dt>
<dt><span class="sect2"><a href="#conf.ldflags">5.4.3. リンカーへのフラグの追加 (<code class="varname">LDFLAGS</code>)</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#developer-advanced-settings">5.5. 開発者および上級者向けの設定</a></span></dt>
<dt><span class="sect1"><a href="#selecting-build-options">5.6. 構築オプションの選択</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#binary">6. バイナリーパッケージを作る</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#building-a-single-binary-package">6.1. 単数のバイナリーパッケージを構築する</a></span></dt>
<dt><span class="sect1"><a href="#settings-for-creationg-of-binary-packages">6.2. バイナリーパッケージ作成用の設定</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#bulk">7. pkgsrc のバイナリーパッケージを全部作成する
(バルクビルド)</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#bulk.pre">7.1. まず考察、構築はその後</a></span></dt>
<dt><span class="sect1"><a href="#bulk.req">7.2. バルクビルドに必要なもの</a></span></dt>
<dt><span class="sect1"><a href="#bulk.old">7.3. 旧方式のバルクビルドを実行する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#binary.configuration">7.3.1. 設定</a></span></dt>
<dt><span class="sect2"><a href="#other-environmental-considerations">7.3.2. ほか、環境に関する考察</a></span></dt>
<dt><span class="sect2"><a href="#operation">7.3.3. 操作</a></span></dt>
<dt><span class="sect2"><a href="#what-it-does">7.3.4. 何を実行するのか</a></span></dt>
<dt><span class="sect2"><a href="#disk-space-requirements">7.3.5. 必要なディスク容量</a></span></dt>
<dt><span class="sect2"><a href="#setting-up-a-sandbox">7.3.6. chroot構築用の砂場を用意する</a></span></dt>
<dt><span class="sect2"><a href="#building-a-partial-set">7.3.7. パッケージを部分的に構築する</a></span></dt>
<dt><span class="sect2"><a href="#bulk-upload">7.3.8. バルクビルドの成果をアップロードする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#bulk.pbulk">7.4. pbulk 方式のバルクビルドを実行する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#bulk.pbulk.prepare">7.4.1. 事前準備</a></span></dt>
<dt><span class="sect2"><a href="#bulk.pbulk.conf">7.4.2. 設定</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#creating-cdroms">7.5. CD-ROM複数枚に収めたパッケージコレクションの作成</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#cdpack-example">7.5.1. cdpackの使用例</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#files">8. インストールされたファイルのディレクトリー配置</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#files.localbase">8.1. <code class="literal">${LOCALBASE}</code> 以下のファイルシステム配置</a></span></dt>
<dt><span class="sect1"><a href="#files.varbase">8.2. <code class="literal">${VARBASE}</code> 以下のファイルシステム配置</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#faq">9. よくある質問</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#mailing-list-pointers">9.1. pkgについて話しあうためのメーリングリストはありますか?</a></span></dt>
<dt><span class="sect1"><a href="#pkgviews-docs">9.2. pkgviews のドキュメンテーションはどこにあるか?</a></span></dt>
<dt><span class="sect1"><a href="#faq-pkgtools">9.3. パッケージ管理用ユーティリティー (pkgtools)</a></span></dt>
<dt><span class="sect1"><a href="#non-root-pkgsrc">9.4. pkgsrc を root 以外で使う方法</a></span></dt>
<dt><span class="sect1"><a href="#resume-transfers">9.5. distfile 取得時に、転送を再開する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#x.org-from-pkgsrc">9.6. pkgsrc の modular X.org をインストールあるいは使用する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#fetch-behind-firewall">9.7. 防火壁の内側からファイルを取得する方法</a></span></dt>
<dt><span class="sect1"><a href="#passive-ftp">9.8. どうすれば<span class="command"><strong>make fetch</strong></span>でpassive FTPを使用することができますか?</a></span></dt>
<dt><span class="sect1"><a href="#fetching-all-distfiles">9.9. 一度にすべてのdistfileを取得する方法</a></span></dt>
<dt><span class="sect1"><a href="#tmac.andoc-missing">9.10. <span class="quote">“<span class="quote">Don't know how to make
/usr/share/tmac/tmac.andoc</span>”</span> ってどういうこと?</a></span></dt>
<dt><span class="sect1"><a href="#bsd.own.mk-missing">9.11. <span class="quote">“<span class="quote">Could not find bsd.own.mk</span>”</span> ってどういうこと?</a></span></dt>
<dt><span class="sect1"><a href="#using-sudo-with-pkgsrc">9.12. pkgsrcで'sudo'を使う</a></span></dt>
<dt><span class="sect1"><a href="#faq.conf">9.13. 設定ファイルの置き場所を変更する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#audit-packages">9.14. 自動セキュリティーチェック</a></span></dt>
<dt><span class="sect1"><a href="#ufaq-cflags">9.15. <code class="varname">CFLAGS</code> を無視するパッケージがあるのはなぜ?</a></span></dt>
<dt><span class="sect1"><a href="#ufaq-fail">9.16. パッケージが構築できません。どうすればいい?</a></span></dt>
<dt><span class="sect1"><a href="#faq.rcs-conflicts">9.17. <span class="quote">“<span class="quote">Makefile appears to contain unresolved cvs/rcs/??? merge conflicts</span>”</span> ってどういうこと?</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="part"><a href="#developers-guide">II. pkgsrc 開発者向けの手引き</a></span></dt>
<dd><dl>
<dt><span class="chapter"><a href="#creating">10. 新しいパッケージを一から作る</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#creating.common">10.1. ありがちな種類のパッケージ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#creating.perl-module">10.1.1. Perl モジュール</a></span></dt>
<dt><span class="sect2"><a href="#creating.kde-app">10.1.2. KDE アプリケーション</a></span></dt>
<dt><span class="sect2"><a href="#creating.python-module">10.1.3. Python モジュールおよびプログラム</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#creating.examples">10.2. 例</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#creating.nvu">10.2.1. www/nvu パッケージはいかに pkgsrc に追加されたか</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#components">11. パッケージコンポーネント - ファイル、ディレクトリー、およびコンテンツ</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#components.Makefile">11.1. <code class="filename">Makefile</code></a></span></dt>
<dt><span class="sect1"><a href="#components.distinfo">11.2. <code class="filename">distinfo</code></a></span></dt>
<dt><span class="sect1"><a href="#components.patches">11.3. patches/*</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#components.patch.structure">11.3.1. 個々のパッチファイルの構造</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.caveats">11.3.2. パッチファイルを作成する</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.sources">11.3.3. パッチファイルの出どころ</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.guidelines">11.3.4. パッチ作成の指針</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.feedback">11.3.5. 作者へのフィードバック</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#other-mandatory-files">11.4. その他の必須のファイル</a></span></dt>
<dt><span class="sect1"><a href="#components.optional">11.5. オプションのファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#components.optional.bin">11.5.1. バイナリーパッケージに影響をおよぼすファイル</a></span></dt>
<dt><span class="sect2"><a href="#components.optional.build">11.5.2. 構築の過程に影響をおよぼすファイル</a></span></dt>
<dt><span class="sect2"><a href="#components.optional.none">11.5.3. 何の影響もおよぼさないファイル</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#work-dir">11.6. <code class="filename">work*</code></a></span></dt>
<dt><span class="sect1"><a href="#files-dir">11.7. <code class="filename">files/*</code></a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#makefile">12. <code class="filename">Makefile</code> におけるプログラミング</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#makefile.style">12.1. 警告</a></span></dt>
<dt><span class="sect1"><a href="#makefile.variables">12.2. <code class="filename">Makefile</code> 変数</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#makefile.variables.names">12.2.1. 命名規約</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#makefile.code">12.3. コードの断片</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#adding-to-list">12.3.1. リストに要素を追加する</a></span></dt>
<dt><span class="sect2"><a href="#converting-internal-to-external">12.3.2. 内部リストを外部リストに変換する</a></span></dt>
<dt><span class="sect2"><a href="#passing-variable-to-shell">12.3.3. シェルコマンドに値を渡す</a></span></dt>
<dt><span class="sect2"><a href="#quoting-guideline">12.3.4. クォートの指針</a></span></dt>
<dt><span class="sect2"><a href="#bsd-make-bug-workaround">12.3.5. BSD Make のバグの回避方法</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#plist">13. PLIST 問題</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#rcs-id">13.1. RCS ID</a></span></dt>
<dt><span class="sect1"><a href="#automatic-plist-generation">13.2. <code class="filename">PLIST</code> の半自動生成</a></span></dt>
<dt><span class="sect1"><a href="#print-PLIST">13.3. <span class="command"><strong>make print-PLIST</strong></span> の出力を細工する</a></span></dt>
<dt><span class="sect1"><a href="#plist.misc">13.4. PLIST における各種の置換</a></span></dt>
<dt><span class="sect1"><a href="#manpage-compression">13.5. マニュアルページの圧縮</a></span></dt>
<dt><span class="sect1"><a href="#using-PLIST_SRC">13.6. <code class="varname">PLIST_SRC</code> を使って PLIST のソースを変更する</a></span></dt>
<dt><span class="sect1"><a href="#platform-specific-plist">13.7. プラットフォーム別に異なるPLIST</a></span></dt>
<dt><span class="sect1"><a href="#faq.common-dirs">13.8. 複数のパッケージでディレクトリーを共有する</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#buildlink">14. buildlink 方法論</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#converting-to-buildlink3">14.1. パッケージを変換して buildlink3 を使うようにする</a></span></dt>
<dt><span class="sect1"><a href="#creating-buildlink3.mk">14.2. <code class="filename">buildlink3.mk</code> ファイルを書く</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#anatomy-of-bl3">14.2.1. buildlink3.mk ファイルの分析</a></span></dt>
<dt><span class="sect2"><a href="#updating-buildlink-depends">14.2.2. <code class="filename">buildlink3.mk</code> ファイルの <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code> を更新する</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#writing-builtin.mk">14.3. <code class="filename">builtin.mk</code> ファイルを書く</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#anatomy-of-builtin.mk">14.3.1. <code class="filename">builtin.mk</code> ファイルの分析</a></span></dt>
<dt><span class="sect2"><a href="#native-or-pkgsrc-preference">14.3.2. ネイティブおよび pkgsrc のソフトウェアの選択に関する、大域的な設定</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#pkginstall">15. pkginstall の枠組</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#files-and-dirs-outside-prefix">15.1. インストール用のプレフィックス以外の場所にあるファイルとディレクトリー</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#dirs-outside-prefix">15.1.1. ディレクトリーの操作</a></span></dt>
<dt><span class="sect2"><a href="#files-outside-prefix">15.1.2. ファイルの操作</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#conf-files">15.2. 設定ファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#conf-files-sysconfdir">15.2.1. <code class="varname">PKG_SYSCONFDIR</code> はどのように設定されるか</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-configure">15.2.2. ソフトウェアに設定ファイルの置き場所を教える</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-patching">15.2.3. インストールの過程を修正する</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-disable">15.2.4. 設定ファイルの処理をしないようにする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#rcd-scripts">15.3. システム起動スクリプト</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#rcd-scripts-disable">15.3.1. システム起動スクリプトの処理をしないようにする</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#users-and-groups">15.4. システムユーザーとグループ</a></span></dt>
<dt><span class="sect1"><a href="#shells">15.5. システムシェル</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#shells-disable">15.5.1. シェルの登録をしないようにする</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#fonts">15.6. フォント</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#fonts-disable">15.6.1. フォントデータベースの自動更新をしないようにする</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#options">16. オプションの扱い</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#global-default-options">16.1. 標準の大域的なオプション</a></span></dt>
<dt><span class="sect1"><a href="#converting-to-options">16.2. パッケージを変換して <code class="filename">bsd.options.mk</code> を使うようにする</a></span></dt>
<dt><span class="sect1"><a href="#option-names">16.3. オプション名</a></span></dt>
<dt><span class="sect1"><a href="#option-build">16.4. 依存パッケージのオプションを判別する</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#build">17. 構築の手順</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#build.intro">17.1. 序</a></span></dt>
<dt><span class="sect1"><a href="#build.prefix">17.2. プログラムの場所</a></span></dt>
<dt><span class="sect1"><a href="#build.builddirs">17.3. 構築の過程で使われるディレクトリー</a></span></dt>
<dt><span class="sect1"><a href="#build.running">17.4. 相の実行</a></span></dt>
<dt><span class="sect1"><a href="#build.fetch">17.5. <span class="emphasis"><em>fetch</em></span> 相</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#build.fetch.what">17.5.1. 何を、どこから取得するか</a></span></dt>
<dt><span class="sect2"><a href="#build.fetch.how">17.5.2. ファイルの取得はどのようにおこなわれるか?</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#build.checksum">17.6. <span class="emphasis"><em>checksum</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.extract">17.7. <span class="emphasis"><em>extract</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.patch">17.8. <span class="emphasis"><em>patch</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.tools">17.9. <span class="emphasis"><em>tools</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.wrapper">17.10. <span class="emphasis"><em>wrapper</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.configure">17.11. <span class="emphasis"><em>configure</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.build">17.12. <span class="emphasis"><em>build</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.test">17.13. <span class="emphasis"><em>test</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.install">17.14. <span class="emphasis"><em>install</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.package">17.15. <span class="emphasis"><em>package</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.clean">17.16. 掃除をする</a></span></dt>
<dt><span class="sect1"><a href="#build.helpful-targets">17.17. 他の役に立つターゲット</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#tools">18. 構築や実行のために必要なツール</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#pkgsrc-tools">18.1. pkgsrc 構築用のツール</a></span></dt>
<dt><span class="sect1"><a href="#package-tools">18.2. パッケージが必要とするツール</a></span></dt>
<dt><span class="sect1"><a href="#platform-tools">18.3. プラットフォーム附属のツール</a></span></dt>
<dt><span class="sect1"><a href="#tools.questions">18.4. ツールに関する質問</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#fixes">19. パッケージを動くようにする</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#general-operation">19.1. 一般的な操作</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#portability-of-packages">19.1.1. パッケージの移植性</a></span></dt>
<dt><span class="sect2"><a href="#pulling-vars-from-etc-mk.conf">19.1.2. <code class="filename">mk.conf</code> から利用者が設定可能な変数を捕まえる方法</a></span></dt>
<dt><span class="sect2"><a href="#user-interaction">19.1.3. ユーザーとの対話</a></span></dt>
<dt><span class="sect2"><a href="#handling-licenses">19.1.4. ライセンスの処理</a></span></dt>
<dt><span class="sect2"><a href="#restricted-packages">19.1.5. 制限つきパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#dependencies">19.1.6. 依存性の処理</a></span></dt>
<dt><span class="sect2"><a href="#conflicts">19.1.7. 他のパッケージとの衝突の処理</a></span></dt>
<dt><span class="sect2"><a href="#not-building-packages">19.1.8. 構築することができない、あるいはすべきでないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#undeletable-packages">19.1.9. 一旦インストールしたら削除すべきでないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#security-handling">19.1.10. セキュリティー問題を持つパッケージへの対処</a></span></dt>
<dt><span class="sect2"><a href="#bumping-pkgrevision">19.1.11. 既存パッケージ修正時に、バージョンを上げるにはどうするか</a></span></dt>
<dt><span class="sect2"><a href="#fixes.subst">19.1.12. パッケージのファイル中の各種テキストを置換する (SUBST の枠組)</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.fetch">19.2. <span class="emphasis"><em>fetch</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#no-plain-download">19.2.1. distfileのダウンロードが単純にできないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#modified-distfiles-same-name">19.2.2. '古い'名前のまま更新されたdistfileの取り扱い</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.configure">19.3. <span class="emphasis"><em>configure</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#fixes.libtool">19.3.1. 共有ライブラリー - libtool</a></span></dt>
<dt><span class="sect2"><a href="#using-libtool">19.3.2. すでにlibtoolをサポートしているGNUパッケージでlibtoolを使う</a></span></dt>
<dt><span class="sect2"><a href="#autoconf-automake">19.3.3. GNU Autoconf/Automake</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#programming-languages">19.4. プログラミング言語</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#basic-programming-languages">19.4.1. C, C++ および Fortran</a></span></dt>
<dt><span class="sect2"><a href="#java-programming-language">19.4.2. Java</a></span></dt>
<dt><span class="sect2"><a href="#perl-scripts">19.4.3. perl スクリプトを含むパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#other-programming-languages">19.4.4. 他のプログラミング言語</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.build">19.5. <span class="emphasis"><em>build</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#fixes.build.cpp">19.5.1. C および C++ のコードの条件つきコンパイル</a></span></dt>
<dt><span class="sect2"><a href="#compiler-bugs">19.5.2. コンパイラーのバグへの対処方法</a></span></dt>
<dt><span class="sect2"><a href="#undefined-reference">19.5.3. undefined reference to <span class="quote">“<span class="quote">...</span>”</span></a></span></dt>
<dt><span class="sect2"><a href="#out-of-memory">19.5.4. メモリーが不足する</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.install">19.6. <span class="emphasis"><em>install</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#install-scripts">19.6.1. 必要なディレクトリーを作成する</a></span></dt>
<dt><span class="sect2"><a href="#where-to-install-documentation">19.6.2. ドキュメンテーションのインストール場所</a></span></dt>
<dt><span class="sect2"><a href="#installing-score-files">19.6.3. 最高得点ファイルをインストールする</a></span></dt>
<dt><span class="sect2"><a href="#destdir-support">19.6.4. パッケージを DESTDIR に対応させる</a></span></dt>
<dt><span class="sect2"><a href="#hardcoded-paths">19.6.5. その他のインタープリターへのパスがハードコードされているパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#perl-modules">19.6.6. perl モジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#faq.info-files">19.6.7. infoファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#manpages">19.6.8. マニュアルページをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#gconf-data-files">19.6.9. GConf のデータファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#scrollkeeper-data-files">19.6.10. scrollkeeper/rarian のデータファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#x11-fonts">19.6.11. X11 のフォントをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#gtk2-modules">19.6.12. GTK2 のモジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#sgml-xml-data">19.6.13. SGML または XML のデータをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#mime-database">19.6.14. MIME データベースの拡張をインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#intltool">19.6.15. intltool を使うパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#startup-scripts">19.6.16. 起動スクリプトをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#tex-packages">19.6.17. TeX モジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#emulation-packages">19.6.18. エミュレーションによるバイナリーの実行に対応したパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#hicolor-theme">19.6.19. ハイカラーテーマのアイコンをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#desktop-files">19.6.20. デスクトップファイルをインストールするパッケージ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#punting">19.7. パッケージに問題があるという印をつける</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#debug">20. デバッグ</a></span></dt>
<dt><span class="chapter"><a href="#submit">21. 提出およびコミット</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#submitting-binary-packages">21.1. バイナリーパッケージの提出</a></span></dt>
<dt><span class="sect1"><a href="#submitting-your-package">21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)</a></span></dt>
<dt><span class="sect1"><a href="#general-notes-for-changes">21.3. パッケージを追加・更新・削除する際の一般的な覚書</a></span></dt>
<dt><span class="sect1"><a href="#committing-importing">21.4. コミット: パッケージのCVSへのインポート</a></span></dt>
<dt><span class="sect1"><a href="#updating-package">21.5. パッケージを新しいバージョンに更新する</a></span></dt>
<dt><span class="sect1"><a href="#renaming-package">21.6. pkgsrc のパッケージの名前を変更する</a></span></dt>
<dt><span class="sect1"><a href="#moving-package">21.7. pkgsrcのパッケージを移動する</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#devfaq">22. よくある質問</a></span></dt>
<dt><span class="chapter"><a href="#gnome">23. GNOME のパッケージングおよび移植</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#meta-packages">23.1. メタパッケージ</a></span></dt>
<dt><span class="sect1"><a href="#new-package">23.2. GNOME アプリケーションをパッケージングする</a></span></dt>
<dt><span class="sect1"><a href="#full-update">23.3. GNOME を新バージョンに更新する</a></span></dt>
<dt><span class="sect1"><a href="#patching">23.4. 修正の指針</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="part"><a href="#infrastructure">III. pkgsrc 基盤の内部</a></span></dt>
<dd><dl>
<dt><span class="chapter"><a href="#infr.design">24. pkgsrc の基盤の設計</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#infr.vardef">24.1. 変数定義の意図するもの</a></span></dt>
<dt><span class="sect1"><a href="#infr.vardef.problems">24.2. 問題を未然に防ぐ</a></span></dt>
<dt><span class="sect1"><a href="#infr.var">24.3. 変数の評価</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.var.load">24.3.1. 読み込み時</a></span></dt>
<dt><span class="sect2"><a href="#infr.var.run">24.3.2. 実行時</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#infr.varspec">24.4. 変数の仕様を定める方法は?</a></span></dt>
<dt><span class="sect1"><a href="#infr.design.intf">24.5. Makefile の断片のインターフェースを設計する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.design.intf.proc">24.5.1. 引数を伴うプロシージャー</a></span></dt>
<dt><span class="sect2"><a href="#infr.design.intf.action">24.5.2. 引数に応じたアクション</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#infr.order">24.6. ファイルが読み込まれる順序</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.order.prefs">24.6.1. <code class="filename">bsd.prefs.mk</code> での順序</a></span></dt>
<dt><span class="sect2"><a href="#infr.order.pkg">24.6.2. <code class="filename">bsd.pkg.mk</code> での順序</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#regression">25. 退行テスト</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#regression.descr">25.1. 退行テストの枠組</a></span></dt>
<dt><span class="sect1"><a href="#regression.run">25.2. 退行テストを実行する</a></span></dt>
<dt><span class="sect1"><a href="#regression.new">25.3. 新しい退行テストを追加する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#regression.fun.override">25.3.1. 上書き可能な関数</a></span></dt>
<dt><span class="sect2"><a href="#regression.fun.helper">25.3.2. 補助関数</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#porting">26. pkgsrc を移植する</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#porting.opsys">26.1. pkgsrc を未対応のオペレーティングシステムに新たに移植する</a></span></dt>
<dt><span class="sect1"><a href="#porting.compiler">26.2. 未対応のコンパイラーに新たに対応させる</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="appendix"><a href="#examples">A. パッケージの簡単な例: bison</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#example-files">A.1. ファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#example-Makefile">A.1.1. Makefile</a></span></dt>
<dt><span class="sect2"><a href="#example-descr">A.1.2. DESCR</a></span></dt>
<dt><span class="sect2"><a href="#example-plist">A.1.3. PLIST</a></span></dt>
<dt><span class="sect2"><a href="#checking-package-with-pkglint">A.1.4. <span class="command"><strong>pkglint</strong></span> でパッケージをチェックする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#steps-for-b-i-p">A.2. 構築、インストール、パッケージングの手順</a></span></dt>
</dl></dd>
<dt><span class="appendix"><a href="#logs">B. 構築のログ</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#logs.building">B.1. figletの構築</a></span></dt>
<dt><span class="sect1"><a href="#logs.package">B.2. figlet のパッケージング</a></span></dt>
</dl></dd>
<dt><span class="appendix"><a href="#ftp-layout">C. pkgsrc FTP サーバーのディレクトリー配置</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#ftp-distfiles">C.1. <code class="filename">distfiles</code>: ソースファイルの配布物</a></span></dt>
<dt><span class="sect1"><a href="#ftp-misc">C.2. <code class="filename">misc</code>: 種々雑多なもの</a></span></dt>
<dt><span class="sect1"><a href="#ftp-packages">C.3. <code class="filename">packages</code>: バイナリーパッケージ</a></span></dt>
<dt><span class="sect1"><a href="#ftp-reports">C.4. <code class="filename">reports</code>: バルクビルドの結果報告</a></span></dt>
<dt><span class="sect1"><a href="#ftp-source">C.5. <code class="filename">current</code>,
<code class="filename">pkgsrc-20<em class="replaceable"><code>xx</code></em>Q<em class="replaceable"><code>y</code></em></code>:
ソースパッケージ</a></span></dt>
</dl></dd>
<dt><span class="appendix"><a href="#editing">D. the pkgsrc guide 編集の指針</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#targets">D.1. make ターゲット</a></span></dt>
<dt><span class="sect1"><a href="#procedure">D.2. 編集手順</a></span></dt>
</dl></dd>
</dl>
</div>
<div class="list-of-tables">
<p><b>List of Tables</b></p>
<dl>
<dt>1.1. <a href="#supported-platforms">pkgsrc が対応しているプラットフォーム</a>
</dt>
<dt>11.1. <a href="#patch-examples">パッチ適用例</a>
</dt>
<dt>23.1. <a href="#plist-handling">GNOME パッケージ用の PLIST の扱い</a>
</dt>
</dl>
</div>
<div class="chapter" title="Chapter 1. pkgsrc とは何か">
<div class="titlepage"><div><div><h2 class="title">
<a name="introduction"></a>Chapter 1. pkgsrc とは何か</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#introduction-section">1.1. イントロダクション</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#why-pkgsrc">1.1.1. なぜ pkgsrc なのか?</a></span></dt>
<dt><span class="sect2"><a href="#intro.platforms">1.1.2. 対応プラットフォーム</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#overview">1.2. 概要</a></span></dt>
<dt><span class="sect1"><a href="#terminology">1.3. 専門用語</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#term.roles">1.3.1. pkgsrc に関わる人たち</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#typography">1.4. 体裁</a></span></dt>
</dl>
</div>
<div class="sect1" title="1.1. イントロダクション">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="introduction-section"></a>1.1. イントロダクション</h2></div></div></div>
<p>Unix ベースのシステム向けの自由に使えるソフトウェアは数多くあり、
それらはたいていソースコード形式で提供されています。
このようなソフトウェアを使うためには、あらかじめ、ローカルシステム用の設定、
コンパイルおよびインストールをしておく必要がありますが、NetBSD
パッケージコレクション (pkgsrc) はまさにこの作業をおこなってくれます。
このほか、pkgsrc にはバイナリーパッケージを扱うための基本的なコマンドがあるので、
各利用者が時間をかけて自分でパッケージを構築する必要はありません。</p>
<p>pkgsrc には現在、
      以下のものをはじめ数千個のパッケージがあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/apache/README.html" target="_top"><code class="filename">www/apache</code></a> - Apache
	  web サーバー</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/firefox/README.html" target="_top"><code class="filename">www/firefox</code></a> - Firefox
	  web ブラウザー</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/gnome/README.html" target="_top"><code class="filename">meta-pkgs/gnome</code></a> - GNOME
	  デスクトップ環境</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/kde3/README.html" target="_top"><code class="filename">meta-pkgs/kde3</code></a> - K
	  デスクトップ環境</p></li>
</ul></div>
<p>……などなど。</p>
<p>pkgsrc には、各対応プラットフォームについて、
      pthreads や X11 のようなプラットフォームによって異なる依存関係や、
      IPv6 対応のような拡張機能の処理が組み込まれています。</p>
<div class="sect2" title="1.1.1. なぜ pkgsrc なのか?">
<div class="titlepage"><div><div><h3 class="title">
<a name="why-pkgsrc"></a>1.1.1. なぜ pkgsrc なのか?</h3></div></div></div>
<p>
pkgsrc が提供する重要な機能は、以下のようなものです
</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>ソフトウェアのソースからの構築のほか、バイナリーパッケージの作成および
  インストールが容易にできるようになります。ソースと最新のパッチを
  マスターサイトかミラーダウンロードサイトから取得し、チェックサムを検証してから、
  あなたのシステムで構築をおこないます。
  バイナリーのみ配布されているソフトウェアも、ネイティブプラットフォームと
  NetBSD でエミュレートされたプラットフォームの双方で利用可能です。</p></li>
<li class="listitem"><p>バイナリー、ライブラリー、マニュアルページ、その他の文書など、
  すべてのパッケージは首尾一貫したディレクトリーツリーにインストールされます。</p></li>
<li class="listitem"><p>パッケージの依存関係は、パッケージ更新時も含め、
  自動的に解決されます。更新の際には、
  さまざまなパッケージの設定ファイルが自動的に処理され、
  ローカルな変更点は保持されます。</p></li>
<li class="listitem"><p>NetBSD と同様、 pkgsrc は移植性を意図して設計されており、
  高い移植性を持つコードでできています。これにより、
  新しいプラットフォームへの移植は、きわめて迅速な開発が可能です。
  この移植性はまた、 pkgsrc を <span class="emphasis"><em>全プラットフォームの間で一貫したもの</em></span>にしています。</p></li>
<li class="listitem"><p>膨大な数のパッケージに対する、インストール先、
  受け入れ可能なソフトウェアライセンス、国際版の暗号が必要か、
  および構築時オプションは、
  すべて単一の設定ファイルで管理されます。</p></li>
<li class="listitem"><p>完全なソース (ソフトウェアの配布ファイルは含みません) は、
  BSD ライセンスの下で自由に使用できますので、必要に応じて
  pkgsrc の拡張や改造ができます。そのままでローカルパッケージやパッチに
  対応しているので、あなたの環境に合わせて設定することができます。</p></li>
</ul></div>
<p>pkgsrc では、以下の思想が基礎となっています。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><span class="quote">“<span class="quote">正しいもののみが動くべき。</span>”</span>
&mdash; これは、パッケージにバグがある場合に、
パッケージをただインストールして、それがうまく動くよう祈るよりも、
バグを見つけて、そのことを訴えるほうがよいということです。
pkgsrc には、そのようなバグを見つけるために、
静的な分析ツール (<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkglint/README.html" target="_top"><code class="filename">pkgtools/pkglint</code></a>)、構築時の検査 (シェルスクリプトの移植性)や、
インストール後の検査 (インストールされたファイル、
共有ライブラリーの参照、スクリプトインタープリター) といった、
多数の検査が用意されています。</p></li>
<li class="listitem"><p><span class="quote">“<span class="quote">動くものは、どこででも動くべき</span>”</span>
&mdash; NetBSD が多くのハードウェアアーキテクチャーに移植されているのと同様に、
pkgsrc は多くのオペレーティングシステムに移植されています。
すべてのプラットフォームでパッケージが同じように動くように注意が払われています。</p></li>
</ul></div>
</div>
<div class="sect2" title="1.1.2. 対応プラットフォーム">
<div class="titlepage"><div><div><h3 class="title">
<a name="intro.platforms"></a>1.1.2. 対応プラットフォーム</h3></div></div></div>
<p>pkgsrc には、
これらのオペレーティングシステム用のソース配布およびバイナリー配布の両形態があります。
必要なソースまたはバイナリーを取ってくれば、
すぐに pkgsrc で作業を始めることができます。</p>
<p>pkgsrc は FreeBSD の ports システムから派生したもので、
      はじめは NetBSD 専用として開発されていました。その後、
      pkgsrc は大きく成長し、現在では以下のプラットフォームに対応しています。</p>
<div class="table">
<a name="supported-platforms"></a><p class="title"><b>Table 1.1. pkgsrc が対応しているプラットフォーム</b></p>
<div class="table-contents"><table summary="pkgsrc が対応しているプラットフォーム" border="1">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>プラットフォーム</th>
<th>対応した日</th>
</tr></thead>
<tbody>
<tr>
<td><a class="ulink" href="http://www.NetBSD.org/" target="_top">NetBSD</a></td>
<td align="center">1997 年 8 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://wwws.sun.com/software/solaris/" target="_top">Solaris</a></td>
<td align="center">1999 年 3 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.kernel.org/" target="_top">Linux</a></td>
<td align="center">1999 年 6 月</td>
</tr>
<tr>
<td>
          <a class="ulink" href="http://developer.apple.com/darwin/" target="_top">Darwin</a>
          (<a class="ulink" href="http://developer.apple.com/macosx/" target="_top">Mac OS X</a>)
        </td>
<td align="center">2001 年 10 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.freebsd.org/" target="_top">FreeBSD</a></td>
<td align="center">2002 年 11 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.openbsd.org/" target="_top">OpenBSD</a></td>
<td align="center">2002 年 11 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.sgi.com/software/irix/" target="_top">IRIX</a></td>
<td align="center">2002 年 12 月</td>
</tr>
<tr>
<td>BSD/OS</td>
<td align="center">2003 年 12 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www-1.ibm.com/servers/aix/" target="_top">AIX</a></td>
<td align="center">2003 年 12 月</td>
</tr>
<tr>
<td>
          <a class="ulink" href="http://www.microsoft.com/windows/sfu/" target="_top">Interix</a>
          (Microsoft Windows Services for Unix)
        </td>
<td align="center">2004 年 3 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.dragonflybsd.org/" target="_top">DragonFlyBSD</a></td>
<td align="center">2004 年 10 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.tru64.org/" target="_top">OSF/1</a></td>
<td align="center">2004 年 11 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.hp.com/products1/unix/" target="_top">HP-UX</a></td>
<td align="center">2007 年 4 月</td>
</tr>
<tr>
<td><a class="ulink" href="http://www.haiku-os.org/" target="_top">Haiku</a></td>
<td align="center">2010 年 9 月</td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break">
</div>
</div>
<div class="sect1" title="1.2. 概要">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="overview"></a>1.2. 概要</h2></div></div></div>
<p>このドキュメントは三部に別れています。第一部は
	<a class="link" href="#users-guide" title="Part I. pkgsrc 利用者向けの手引き">pkgsrc 利用者向けの手引き</a>で、パッケー
	ジコレクションの一つのパッケージを使う方法を、コンパイル済みのバイナリー
	パッケージのインストールと、自分自身でコピーしたNetBSDパッケージシステムか
	ら構築する方法の両方で説明します。第二部の <a class="link" href="#developers-guide" title="Part II. pkgsrc 開発者向けの手引き">pkgsrc 開発者向けの手引き</a> は、他
	のNetBSDユーザーがその構築の詳細について知らなくても簡単にパッケージを構築
	できるようにするために、パッケージを用意する方法を説明します。第三部の
	<a class="link" href="#infrastructure" title="Part III. pkgsrc 基盤の内部">pkgsrc 基盤の内部</a>
	は、pkgsrc がどのように実装されているかを理解したい方のためのものです。</p>
<p>このドキュメントは、以下の各種形式で利用できます。
	<span class="simplelist"><a class="ulink" href="index.html" target="_top">HTML</a>, <a class="ulink" href="pkgsrc.pdf" target="_top">PDF</a>, <a class="ulink" href="pkgsrc.ps" target="_top">PS</a>, <a class="ulink" href="pkgsrc.txt" target="_top">TXT</a></span>.</p>
</div>
<div class="sect1" title="1.3. 専門用語">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="terminology"></a>1.3. 専門用語</h2></div></div></div>
<p>ここまでですでに<span class="quote">“<span class="quote">ポート(ports)</span>”</span>、
      <span class="quote">“<span class="quote">パッケージ(packages)</span>”</span>などについて何度も触れています。
      ここで、このドキュメント中に使われている用語を説明します。</p>
<div class="variablelist"><dl>
<dt><span class="term">パッケージ(Package)</span></dt>
<dd><p>ファイルのセットで、pkgsrc を使用したソフトウェアを構築
	    するのに必要なことが記述された構築手順書です。パッケージは、伝統的に
	    <code class="filename">/usr/pkgsrc</code>の下に置かれます。</p></dd>
<dt><span class="term">NetBSDパッケージシステム</span></dt>
<dd><p><span class="quote">“<span class="quote">pkgsrc</span>”</span> の旧名です。これは
	  NetBSD オペレーティングシステムの一部分ですが、
	  NetBSD 以外のオペレーティングシステムでも
	  NetBSD 同様に使えるようにすることができます。
	  パッケージの構築 (コンパイル)、インストール、および削除を扱います。</p></dd>
<dt><span class="term">distfile</span></dt>
<dd><p>この用語は、ソフトウェアの作者が、彼の仕事を配布するため
	    に提供しているファイルのことを指しています。NetBSDで構築するのに必要な全
	    ての変更は、対応するパッケージに反映されます。通常distfileは、圧縮された
	    tarアーカイブ形式ですが、他の形式でも使用できます。distfileは通常は
	    <code class="filename">/usr/pkgsrc/distfiles</code>の下に保存されます。</p></dd>
<dt><span class="term">ポート(Port)</span></dt>
<dd><p>これはFreeBSDやOpenBSDの人たちが、
	    私たちがパッケージ(package)と呼んでいるものを表
	    すために使われている用語です。NetBSDでは<span class="quote">“<span class="quote">ポート(port)</span>”</span>は、異なるアーキ
	    テクチャーを参照する用語となります。</p></dd>
<dt><span class="term">コンパイル済み(バイナリー)パッケージ</span></dt>
<dd>
<p>pkgsrc を使ってdistfileより作成されたバイナリーのセット
	    で、ひとつの<code class="filename">.tgz</code>ファイルに集められています。これはリコンパイルなしに同じ
	    マシンアーキテクチャーのマシンにインストールすることができます。パッケー
	    ジは通常は<code class="filename">/usr/pkgsrc/packages</code>に生成され、それ
	    は
	    <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/" target="_top">ftp.NetBSD.org</a>にもアーカイブされています。</p>
<p>時々、これは、特にコンパイル済みのパッケージの文脈で、単に<span class="quote">“<span class="quote">パッケージ</span>”</span>
	    と表されることもあります。</p>
</dd>
<dt><span class="term">プログラム</span></dt>
<dd><p>対応するパッケージが、distfileにあるファイルから作成した、インストールさ
	  れるべきソフトウェアのひとまとまりです。</p></dd>
</dl></div>
<div class="sect2" title="1.3.1. pkgsrc に関わる人たち">
<div class="titlepage"><div><div><h3 class="title">
<a name="term.roles"></a>1.3.1. pkgsrc に関わる人たち</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term">pkgsrc 利用者</span></dt>
<dd>
<p>pkgsrc
	利用者とは、pkgsrc で提供されているパッケージを使う人たちです。
	ふつうはシステム管理者のことです。パッケージを構成するソフトウェアを使う人たち
	(<span class="quote">“<span class="quote">末端利用者</span>”</span> ということがあります) については、
	the pkgsrc guide では対象としません。</p>
<p>pkgsrc 利用者には二通りあります: 一方は、
	構築済みバイナリーパッケージをインストールしたいだけの人たちです。
	もう一方は、pkgsrc のパッケージをソースから構築する人たちで、
	こちらは、そのままインストールすることが目的の場合と、
	バイナリーパッケージ自体を構築することが目的の場合があります。
	pkgsrc 利用者にとって必要なことはすべて、<a class="xref" href="#users-guide" title="Part I. pkgsrc 利用者向けの手引き">Part I, “pkgsrc 利用者向けの手引き”</a> に書いてあるはずです。</p>
</dd>
<dt><span class="term">パッケージメンテナー</span></dt>
<dd><p>
	パッケージメンテナーは、<a class="xref" href="#developers-guide" title="Part II. pkgsrc 開発者向けの手引き">Part II, “pkgsrc 開発者向けの手引き”</a> で説明されているようにパッケージを作成する人です。</p></dd>
<dt><span class="term">基盤開発者</span></dt>
<dd><p><code class="filename">mk/</code>
	ディレクトリー以下にある各ファイルに携わる人たちです。
	<a class="xref" href="#infrastructure" title="Part III. pkgsrc 基盤の内部">Part III, “pkgsrc 基盤の内部”</a> を通しで読む必要があるのは、この人たちだけのはずです
	(基盤開発者以外の人が興味を持つこともあるでしょうが)。</p></dd>
</dl></div>
</div>
</div>
<div class="sect1" title="1.4. 体裁">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="typography"></a>1.4. 体裁</h2></div></div></div>
<p>コマンドの実行例を示す場合、そのコマンドをrootで実行しなければならない/する
      ことができるか、<span class="quote">“<span class="quote">一般の</span>”</span>ユーザー権限で十分であるかを、シェルプロンプトで
      区別します。Cシェルかtcshを使っているものとして、rootのシェルプロンプトには
      <code class="prompt">#</code>を、一般ユーザーのシェルプロンプトには<code class="prompt">%</code>を使います。</p>
</div>
</div>
<div class="part" title="Part I. pkgsrc 利用者向けの手引き">
<div class="titlepage"><div><div><h1 class="title">
<a name="users-guide"></a>Part I. pkgsrc 利用者向けの手引き</h1></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="chapter"><a href="#getting">2. どこからpkgsrcを得て、どうやって最新に保つか</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#getting-first">2.1. pkgsrc を初めて入手する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#getting-via-tar">2.1.1. tar ファイル</a></span></dt>
<dt><span class="sect2"><a href="#getting-via-cvs">2.1.2. anonymous CVS 経由</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#uptodate">2.2. pkgsrc を最新の状態に保つ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#uptodate-tar">2.2.1. tar ファイルを使用</a></span></dt>
<dt><span class="sect2"><a href="#uptodate-cvs">2.2.2. CVS 経由</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#platforms">3. NetBSD 以外のシステムで pkgsrc を使う</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#binarydist">3.1. バイナリー配布</a></span></dt>
<dt><span class="sect1"><a href="#bootstrapping-pkgsrc">3.2. pkgsrc を使う準備をする</a></span></dt>
<dt><span class="sect1"><a href="#platform-specific-notes">3.3. プラットフォーム別の覚書</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#darwin">3.3.1. Darwin (Mac OS X)</a></span></dt>
<dt><span class="sect2"><a href="#freebsd">3.3.2. FreeBSD</a></span></dt>
<dt><span class="sect2"><a href="#interix">3.3.3. Interix</a></span></dt>
<dt><span class="sect2"><a href="#irix">3.3.4. IRIX</a></span></dt>
<dt><span class="sect2"><a href="#linux">3.3.5. Linux</a></span></dt>
<dt><span class="sect2"><a href="#openbsd">3.3.6. OpenBSD</a></span></dt>
<dt><span class="sect2"><a href="#solaris">3.3.7. Solaris</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#using">4. pkgsrc を使う</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#using-pkg">4.1. バイナリーパッケージを使う</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#finding-binary-packages">4.1.1. バイナリーパッケージの配布場所</a></span></dt>
<dt><span class="sect2"><a href="#installing-binary-packages">4.1.2. バイナリーパッケージをインストールする</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_delete">4.1.3. パッケージをアンインストールする</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_info">4.1.4. インストールされているパッケージの情報を得る</a></span></dt>
<dt><span class="sect2"><a href="#vulnerabilities">4.1.5. インストール済パッケージの脆弱性チェック</a></span></dt>
<dt><span class="sect2"><a href="#pkg_versions">4.1.6. インストール済パッケージのより新しいバージョンが pkgsrc にあるかどうか調べる</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_admin">4.1.7. その他の管理用機能</a></span></dt>
<dt><span class="sect2"><a href="#a-word-of-warning">4.1.8. 警告</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#building-packages-from-source">4.2. ソースからパッケージを構築する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#requirements">4.2.1. 必要なもの</a></span></dt>
<dt><span class="sect2"><a href="#fetching-distfiles">4.2.2. 配布ファイルの取得</a></span></dt>
<dt><span class="sect2"><a href="#how-to-build-and-install">4.2.3. 構築とインストール方法</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#configuring">5. pkgsrc を設定する</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#general-configuration">5.1. 全般的な設定</a></span></dt>
<dt><span class="sect1"><a href="#variables-affecting-build">5.2. 構築の過程に影響を及ぼす変数</a></span></dt>
<dt><span class="sect1"><a href="#variables-affecting-installation">5.3. インストール過程に影響をおよぼす変数</a></span></dt>
<dt><span class="sect1"><a href="#conf.compiler">5.4. コンパイラーの選択と設定</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#selecting-the-compiler">5.4.1. コンパイラーを選ぶ</a></span></dt>
<dt><span class="sect2"><a href="#conf.cflags">5.4.2. コンパイラーへのフラグの追加 (<code class="varname">CFLAGS</code>)</a></span></dt>
<dt><span class="sect2"><a href="#conf.ldflags">5.4.3. リンカーへのフラグの追加 (<code class="varname">LDFLAGS</code>)</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#developer-advanced-settings">5.5. 開発者および上級者向けの設定</a></span></dt>
<dt><span class="sect1"><a href="#selecting-build-options">5.6. 構築オプションの選択</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#binary">6. バイナリーパッケージを作る</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#building-a-single-binary-package">6.1. 単数のバイナリーパッケージを構築する</a></span></dt>
<dt><span class="sect1"><a href="#settings-for-creationg-of-binary-packages">6.2. バイナリーパッケージ作成用の設定</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#bulk">7. pkgsrc のバイナリーパッケージを全部作成する
(バルクビルド)</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#bulk.pre">7.1. まず考察、構築はその後</a></span></dt>
<dt><span class="sect1"><a href="#bulk.req">7.2. バルクビルドに必要なもの</a></span></dt>
<dt><span class="sect1"><a href="#bulk.old">7.3. 旧方式のバルクビルドを実行する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#binary.configuration">7.3.1. 設定</a></span></dt>
<dt><span class="sect2"><a href="#other-environmental-considerations">7.3.2. ほか、環境に関する考察</a></span></dt>
<dt><span class="sect2"><a href="#operation">7.3.3. 操作</a></span></dt>
<dt><span class="sect2"><a href="#what-it-does">7.3.4. 何を実行するのか</a></span></dt>
<dt><span class="sect2"><a href="#disk-space-requirements">7.3.5. 必要なディスク容量</a></span></dt>
<dt><span class="sect2"><a href="#setting-up-a-sandbox">7.3.6. chroot構築用の砂場を用意する</a></span></dt>
<dt><span class="sect2"><a href="#building-a-partial-set">7.3.7. パッケージを部分的に構築する</a></span></dt>
<dt><span class="sect2"><a href="#bulk-upload">7.3.8. バルクビルドの成果をアップロードする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#bulk.pbulk">7.4. pbulk 方式のバルクビルドを実行する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#bulk.pbulk.prepare">7.4.1. 事前準備</a></span></dt>
<dt><span class="sect2"><a href="#bulk.pbulk.conf">7.4.2. 設定</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#creating-cdroms">7.5. CD-ROM複数枚に収めたパッケージコレクションの作成</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#cdpack-example">7.5.1. cdpackの使用例</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#files">8. インストールされたファイルのディレクトリー配置</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#files.localbase">8.1. <code class="literal">${LOCALBASE}</code> 以下のファイルシステム配置</a></span></dt>
<dt><span class="sect1"><a href="#files.varbase">8.2. <code class="literal">${VARBASE}</code> 以下のファイルシステム配置</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#faq">9. よくある質問</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#mailing-list-pointers">9.1. pkgについて話しあうためのメーリングリストはありますか?</a></span></dt>
<dt><span class="sect1"><a href="#pkgviews-docs">9.2. pkgviews のドキュメンテーションはどこにあるか?</a></span></dt>
<dt><span class="sect1"><a href="#faq-pkgtools">9.3. パッケージ管理用ユーティリティー (pkgtools)</a></span></dt>
<dt><span class="sect1"><a href="#non-root-pkgsrc">9.4. pkgsrc を root 以外で使う方法</a></span></dt>
<dt><span class="sect1"><a href="#resume-transfers">9.5. distfile 取得時に、転送を再開する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#x.org-from-pkgsrc">9.6. pkgsrc の modular X.org をインストールあるいは使用する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#fetch-behind-firewall">9.7. 防火壁の内側からファイルを取得する方法</a></span></dt>
<dt><span class="sect1"><a href="#passive-ftp">9.8. どうすれば<span class="command"><strong>make fetch</strong></span>でpassive FTPを使用することができますか?</a></span></dt>
<dt><span class="sect1"><a href="#fetching-all-distfiles">9.9. 一度にすべてのdistfileを取得する方法</a></span></dt>
<dt><span class="sect1"><a href="#tmac.andoc-missing">9.10. <span class="quote">“<span class="quote">Don't know how to make
/usr/share/tmac/tmac.andoc</span>”</span> ってどういうこと?</a></span></dt>
<dt><span class="sect1"><a href="#bsd.own.mk-missing">9.11. <span class="quote">“<span class="quote">Could not find bsd.own.mk</span>”</span> ってどういうこと?</a></span></dt>
<dt><span class="sect1"><a href="#using-sudo-with-pkgsrc">9.12. pkgsrcで'sudo'を使う</a></span></dt>
<dt><span class="sect1"><a href="#faq.conf">9.13. 設定ファイルの置き場所を変更する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#audit-packages">9.14. 自動セキュリティーチェック</a></span></dt>
<dt><span class="sect1"><a href="#ufaq-cflags">9.15. <code class="varname">CFLAGS</code> を無視するパッケージがあるのはなぜ?</a></span></dt>
<dt><span class="sect1"><a href="#ufaq-fail">9.16. パッケージが構築できません。どうすればいい?</a></span></dt>
<dt><span class="sect1"><a href="#faq.rcs-conflicts">9.17. <span class="quote">“<span class="quote">Makefile appears to contain unresolved cvs/rcs/??? merge conflicts</span>”</span> ってどういうこと?</a></span></dt>
</dl></dd>
</dl>
</div>
<div class="chapter" title="Chapter 2. どこからpkgsrcを得て、どうやって最新に保つか">
<div class="titlepage"><div><div><h2 class="title">
<a name="getting"></a>Chapter 2. どこからpkgsrcを得て、どうやって最新に保つか</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#getting-first">2.1. pkgsrc を初めて入手する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#getting-via-tar">2.1.1. tar ファイル</a></span></dt>
<dt><span class="sect2"><a href="#getting-via-cvs">2.1.2. anonymous CVS 経由</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#uptodate">2.2. pkgsrc を最新の状態に保つ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#uptodate-tar">2.2.1. tar ファイルを使用</a></span></dt>
<dt><span class="sect2"><a href="#uptodate-cvs">2.2.2. CVS 経由</a></span></dt>
</dl></dd>
</dl>
</div>
<p>ファイルをダウンロードして展開する前に、
ファイルを展開する場所を決めておく必要があります。
pkgsrc を root ユーザーとして使う場合、pkgsrc は通常は
<code class="filename">/usr/pkgsrc</code> にインストールされます。
ソースおよびバイナリーパッケージは、
ファイルシステム中のどこでも好きな場所にインストールしてかまいませんが、
シェルその他のプログラムにとって特別な意味を持つスペースなどの文字は、
パス名に含めてはいけません。
アルファベット、数字、下線とダッシュだけを使うのが安全な方法です。</p>
<div class="sect1" title="2.1. pkgsrc を初めて入手する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="getting-first"></a>2.1. pkgsrc を初めて入手する</h2></div></div></div>
<p>pkgsrc のファイルをダウンロードする前に、
	<span class="emphasis"><em>current</em></span> 枝と <span class="emphasis"><em>stable</em></span>
	(安定版) 枝のどちらを使うのかを決めます。
	後者は、current 枝から四半期ごとに分岐するもので、
	セキュリティー上の更新に限って修正されます。
	stable 枝の名前は、年と四半期を組み合わせたもので、たとえば
	<code class="literal">2009Q1</code> となります。</p>
<p>次に、pkgsrc を<span class="emphasis"><em>どの方法で</em></span>
	ダウンロードするかを決めます。方法としては、tarファイル、
	CVS経由があります。ここでは両方とも説明します。</p>
<div class="sect2" title="2.1.1. tar ファイル">
<div class="titlepage"><div><div><h3 class="title">
<a name="getting-via-tar"></a>2.1.1. tar ファイル</h3></div></div></div>
<p>pkgsrc のあらゆるファイルの一次配布元は
	<a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/" target="_top">ftp://ftp.NetBSD.org/pub/pkgsrc/</a> です。
	目的別に多数のサブディレクトリーがありますが、
	それについては <a class="xref" href="#ftp-layout" title="Appendix C. pkgsrc FTP サーバーのディレクトリー配置">Appendix C, <i>pkgsrc FTP サーバーのディレクトリー配置</i></a> で詳しく説明しています。</p>
<p>current 枝の tar ファイルは、
	<code class="filename">current</code> ディレクトリー内にあり、ファイル名は <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz" target="_top"><code class="filename">pkgsrc.tar.gz</code></a> です。
	このファイルは、毎日、自動生成されます。</p>
<p>安定版の 2009Q1 枝の tar ファイルは、
	<code class="filename">pkgsrc-2009Q1</code> ディレクトリー内にあり、ファイル名は同じく <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/pkgsrc-2009Q1/pkgsrc-2009Q1.tar.gz" target="_top"><code class="filename">pkgsrc-2009Q1.tar.gz</code></a> です。</p>
<p>安定版 pkgsrc の tarball をダウンロードするには、以下のコマンドを実行します。</p>
<pre class="screen">
<code class="prompt">$</code> <strong class="userinput"><code>ftp ftp://ftp.NetBSD.org/pub/pkgsrc/<em class="replaceable"><code>pkgsrc-20xxQy</code></em>/<em class="replaceable"><code>pkgsrc-20xxQy</code></em>.tar.gz</code></strong></pre>
<p>ここで、<em class="replaceable"><code>pkgsrc-20xxQy</code></em> は、
	ダウンロードする安定版の枝名にします。たとえば、
	<span class="quote">“<span class="quote">pkgsrc-2009Q1</span>”</span> になります。</p>
<p>ダウンロードしたら、以下のようにして展開します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>tar -xzf <em class="replaceable"><code>pkgsrc-20xxQy</code></em>.tar.gz -C /usr</code></strong></pre>
<p>こうすると、<code class="filename">/usr/</code> に
	<code class="filename">pkgsrc/</code> ディレクトリーが作られ、
	<code class="filename">/usr/pkgsrc/</code> 以下に全パッケージのソースが置かれます。</p>
<p>pkgsrc-current をダウンロードするには、以下のコマンドを実行します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>ftp ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz</code></strong></pre>
</div>
<div class="sect2" title="2.1.2. anonymous CVS 経由">
<div class="titlepage"><div><div><h3 class="title">
<a name="getting-via-cvs"></a>2.1.2. anonymous CVS 経由</h3></div></div></div>
<p>pkgsrc の stable 枝名を指定して取得するためには、以下のコマンドを実行します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr &amp;&amp; cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -r <em class="replaceable"><code>pkgsrc-20xxQy</code></em> -P pkgsrc</code></strong>
</pre>
<p>ここで、<em class="replaceable"><code>pkgsrc-20xxQy</code></em> は、
	チェックアウトする stable 枝名にします。たとえば <span class="quote">“<span class="quote">pkgsrc-2009Q1</span>”</span> になります。</p>
<p>こうすると、<code class="filename">/usr/</code> ディレクトリーに
	<code class="filename">pkgsrc/</code> ディレクトリーが作られ、
	<code class="filename">/usr/pkgsrc/</code> 以下に全パッケージのソースが置かれます。</p>
<p>pkgsrc current を取得するには、以下のコマンドを実行します。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr &amp;&amp; cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc</code></strong>
</pre>
<p><a class="ulink" href="http://NetBSD.org/FIXME" target="_top">利用可能な CVS ミラーサイト一覧</a>から、もっとも速いものを選んで使ってください。</p>
<p><code class="literal">rsh</code> のエラーメッセージが出た場合は、たとえば以下のようにして、環境変数 CVS_RSH を設定する必要があります。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr &amp;&amp; env CVS_RSH=ssh cvs -q -z3 -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -P pkgsrc</code></strong>
</pre>
<p>CVS_RSH=ssh の設定を今後も有効なままにする方法は、お使いのコマンドシェルのドキュメンテーションをご覧ください。
	Bourne シェルの場合は、この設定を以下のとおりユーザーの <code class="filename">.profile</code> に、
	またはより大域的に <code class="filename">/etc/profile</code> に書くことができます。</p>
<pre class="programlisting">
# set CVS remote shell command
CVS_RSH=ssh
export CVS_RSH
</pre>
<p>CVS は、標準状態では、多くの人の望む挙動をしてくれません。
	しかし、
	以下の内容の <code class="filename">.cvsrc</code>
	というファイルをホームディレクトリーに置いておけば、
	標準での挙動を変えることができます。このファイルを置いておけば、
	あなたの悩みや、余計なバグ報告もなくなるでしょうから、
	そうすることを強くおすすめします。
	このファイルに関する説明は、
	CVS のドキュメンテーションにあります。</p>
<pre class="programlisting">
# recommended CVS configuration file from the pkgsrc guide
cvs -q -z3
checkout -P
update -dP
diff -upN
rdiff -u
release -d
</pre>
</div>
</div>
<div class="sect1" title="2.2. pkgsrc を最新の状態に保つ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="uptodate"></a>2.2. pkgsrc を最新の状態に保つ</h2></div></div></div>
<p>pkgsrc を最新の状態に保つ方法としては、CVS をおすすめします
	(最初に tar ファイルを使ってインストールした場合でも、更新には
	CVS を使えます)。 CVS を使えば、tar ファイルをあらためてダウンロードした場合にくらべ、
	帯域やハードディスクの負荷を減らすことができます。</p>
<div class="sect2" title="2.2.1. tar ファイルを使用">
<div class="titlepage"><div><div><h3 class="title">
<a name="uptodate-tar"></a>2.2.1. tar ファイルを使用</h3></div></div></div>
<div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Warning</h3>
<p>tar ファイルを使って更新する場合は、まず、
	これまで使っていた pkgsrc ディレクトリーを完全に削除する必要があります。
	さもないと、それまでの間に pkgsrc から削除されたファイルがローカルディスクに残ったままになり、
	不整合が生じてしまいます。
	これまで使っていたファイルを消す場合、pkgsrc のファイルに独自に施した変更が、
	更新後にすべて失われてしまいます。
	このため、CVS を使った更新を強くおすすめします。</p>
</div>
<p>なお、distfile とバイナリーパッケージは、標準ではいずれも
	pkgsrc ツリー内に置かれますので、pkgsrc ツリーを更新する前に退避させておくことを忘れないでください。
	<code class="varname">DISTDIR</code> と <code class="varname">PACKAGES</code>
	を設定して、標準のディレクトリーとは別の場所を
	pkgsrc が使うような構成にすることもできます。
	詳細は<a class="xref" href="#configuring" title="Chapter 5. pkgsrc を設定する">Chapter 5, <i>pkgsrc を設定する</i></a>をご覧ください。</p>
<p>tar ファイルを使って pkgsrc を更新するためには、
	初回の入手時と同様に、tar ファイルをダウンロードします。
	次に、pkgsrc ディレクトリーに独自の変更を何も加えていないことを確認します。
	pkgsrc ディレクトリーを削除してから、新しい tar ファイルを展開します。これで完了です。</p>
</div>
<div class="sect2" title="2.2.2. CVS 経由">
<div class="titlepage"><div><div><h3 class="title">
<a name="uptodate-cvs"></a>2.2.2. CVS 経由</h3></div></div></div>
<p>CVS を使って pkgsrc を更新するためには、<code class="filename">pkgsrc</code> ディレクトリーへ移動して cvs を実行します:</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr/pkgsrc &amp;&amp; cvs update -dP</code></strong>
</pre>
<p><code class="literal">rsh</code> がエラーメッセージを出す場合は、前述の新規取得時と同様に、環境変数 CVS_RSH を設定する必要があります。たとえば以下のようにします。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>cd /usr/pkgsrc &amp;&amp; env CVS_RSH=ssh cvs up -dP</code></strong>
</pre>
<div class="sect3" title="2.2.2.1. pkgsrc の別の枝に移る">
<div class="titlepage"><div><div><h4 class="title">
<a name="uptodate-cvs-switch"></a>2.2.2.1. pkgsrc の別の枝に移る</h4></div></div></div>
<p>pkgsrc の更新時、CVS プログラムはそれまで使っていた枝をそのまま追いつづけます。
	しかし、何らかの理由で stable 枝から current 枝に移りたい場合は、
	<span class="quote">“<span class="quote">update</span>”</span> キーワードの後に <span class="quote">“<span class="quote">-A</span>”</span>
	オプションを追加して current に移ることができます。
	current 枝から stable 枝に戻るには、
	<span class="quote">“<span class="quote">-rpkgsrc-2009Q3</span>”</span> オプションを追加します。</p>
</div>
<div class="sect3" title="2.2.2.2. 私がおこなった変更は、更新時にどうなるか?">
<div class="titlepage"><div><div><h4 class="title">
<a name="uptodate-cvs-changes"></a>2.2.2.2. 私がおこなった変更は、更新時にどうなるか?</h4></div></div></div>
<p>pkgsrc の更新時、CVS プログラムは
	CVS リポジトリーに登録されたファイルだけに手を加えます。
	このため、あなたが独自に作成したパッケージは、変更されずに残ります。
	あなたが CVS の管理下にあるファイルを独自に修正している場合、
	CVS による更新時には、あなた独自の変更と他の人による
	(CVS リポジトリーに反映されている) 変更を統合しようとします。
	詳細は、CVS のマニュアルの <span class="quote">“<span class="quote">update</span>”</span> の章をご覧ください。</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter 3. NetBSD 以外のシステムで pkgsrc を使う">
<div class="titlepage"><div><div><h2 class="title">
<a name="platforms"></a>Chapter 3. NetBSD 以外のシステムで pkgsrc を使う</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#binarydist">3.1. バイナリー配布</a></span></dt>
<dt><span class="sect1"><a href="#bootstrapping-pkgsrc">3.2. pkgsrc を使う準備をする</a></span></dt>
<dt><span class="sect1"><a href="#platform-specific-notes">3.3. プラットフォーム別の覚書</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#darwin">3.3.1. Darwin (Mac OS X)</a></span></dt>
<dt><span class="sect2"><a href="#freebsd">3.3.2. FreeBSD</a></span></dt>
<dt><span class="sect2"><a href="#interix">3.3.3. Interix</a></span></dt>
<dt><span class="sect2"><a href="#irix">3.3.4. IRIX</a></span></dt>
<dt><span class="sect2"><a href="#linux">3.3.5. Linux</a></span></dt>
<dt><span class="sect2"><a href="#openbsd">3.3.6. OpenBSD</a></span></dt>
<dt><span class="sect2"><a href="#solaris">3.3.7. Solaris</a></span></dt>
</dl></dd>
</dl>
</div>
<div class="sect1" title="3.1. バイナリー配布">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="binarydist"></a>3.1. バイナリー配布</h2></div></div></div>
<p><a class="xref" href="#using-pkg" title="4.1. バイナリーパッケージを使う">Section 4.1, “バイナリーパッケージを使う”</a>をご覧ください。</p>
</div>
<div class="sect1" title="3.2. pkgsrc を使う準備をする">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="bootstrapping-pkgsrc"></a>3.2. pkgsrc を使う準備をする</h2></div></div></div>
<p>ブートストラップキットは、以下のようにして簡単にソースからインストールすることができます。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>env CVS_RSH=ssh cvs -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout pkgsrc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd pkgsrc/bootstrap</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>./bootstrap</code></strong>
    </pre>
<p>bootstrap を実行する前に、上で例示した方法以外で
    pkgsrc を取得する方法については、<a class="xref" href="#getting" title="Chapter 2. どこからpkgsrcを得て、どうやって最新に保つか">Chapter 2, <i>どこからpkgsrcを得て、どうやって最新に保つか</i></a>を参照してください。
    上で例示した <span class="command"><strong>bootstrap</strong></span> コマンドでは、
    <span class="emphasis"><em>prefix</em></span> (プログラムのインストール先) をデフォルトの
    <code class="filename">/usr/pkg</code> とし、
    パッケージデータベースのディレクトリー (pkgsrc 内部の記録用) を
    <code class="filename">/var/db/pkg</code> とします。
    これらをコマンドライン引数で設定することもできます。</p>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>bootstrap は  <span class="command"><strong>bmake</strong></span> ツールをインストールします。
      pkgsrc で構築をおこなう際には、この <span class="command"><strong>bmake</strong></span> を使ってください。
      たとえばこの手引きにおいて <span class="quote">“<span class="quote">make</span>”</span> は
      <span class="command"><strong>bmake</strong></span> に読み替えてください。</p>
</div>
</div>
<div class="sect1" title="3.3. プラットフォーム別の覚書">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="platform-specific-notes"></a>3.3. プラットフォーム別の覚書</h2></div></div></div>
<p>いくつかのプラットフォームについては、以下のことを知っておくとよいでしょう。</p>
<div class="sect2" title="3.3.1. Darwin (Mac OS X)">
<div class="titlepage"><div><div><h3 class="title">
<a name="darwin"></a>3.3.1. Darwin (Mac OS X)</h3></div></div></div>
<p>対応は、 Darwin 5.x 以上に対しておこなわれています。
      始める前に、Apple Developer Connection から Mac OS X Developer
      Tools をダウンロードしてインストールする必要があります。詳細は
      <a class="ulink" href="http://developer.apple.com/macosx/" target="_top">http://developer.apple.com/macosx/</a>
      をご覧ください。また、X11 Window System を使うパッケージを構築したい場合は、
      X11 (Developer Tools に附属するオプションパッケージ) をインストールしておくことも必要です。</p>
</div>
<div class="sect2" title="3.3.2. FreeBSD">
<div class="titlepage"><div><div><h3 class="title">
<a name="freebsd"></a>3.3.2. FreeBSD</h3></div></div></div>
<p>確認および対応は、 FreeBSD 4.7 および 5.0 に対しておこなわれています。
      これら以外のバージョンでも動くかもしれません。</p>
<p>ブートストラップキットのインストールに際しては、
      FreeBSD のユーザーランドのツールと衝突することがないように注意を払ってください。以下のような複数の事項があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>FreeBSD の ports は、 <code class="filename">/var/db/pkg</code>
	  以下にパッケージデータベースを置きます。このため、
	  ブートストラップスクリプトの --pkgdbdir オプションで、
	  別の場所 (たとえば <code class="filename">/usr/pkgdb</code>)
	  を指定することをおすすめします。</p></li>
<li class="listitem">
<p>FreeBSD ports のツールを使う予定がない場合は、混同を避けるために、
	  それらを移動してしまってもいいかもしれません。たとえば以下のようにします。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/sbin</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_add pkg_add.orig</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_create pkg_create.orig</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_delete pkg_delete.orig</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_info pkg_info.orig</code></strong>
	  </pre>
</li>
<li class="listitem"><p>ブートストラップスクリプトを使った際、
	  <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> ファイルの例は
	  <code class="filename">/etc/mk.conf.example</code> ファイルに置かれます。</p></li>
</ol></div>
</div>
<div class="sect2" title="3.3.3. Interix">
<div class="titlepage"><div><div><h3 class="title">
<a name="interix"></a>3.3.3. Interix</h3></div></div></div>
<p>Interix は Windows NT カーネルの POSIX 準拠のサブシステムで、
      Cygwin よりも密接にカーネルと統合された Unix 風の環境を提供します。
      Interix は Windows Services for Unix パッケージの一部であり、
      ライセンスされた Windows 2000, XP (XP Home は含まず), 2003 のコピー用として、
      無料で使うことができます。SFU は、<a class="ulink" href="http://www.microsoft.com/windows/sfu/" target="_top">http://www.microsoft.com/windows/sfu/</a> からダウンロードできます。</p>
<p>確認は、Services for Unix 3.5 に対しておこなわれています。 3.0
      や 3.1 でも動作するかもしれませんが、公式には対応していません。  (3.0/3.1 の主な違いは、
      pthreads がないことですが、このほかにも libc に欠けているものがあるかもしれません。)</p>
<p>Services for Unix Applications (別名 SUA) は、Windows Server 2003 R2
      (5.2), Windows Vista および Windows Server 2008
      (6.0), Windows 7 および Windows Server 2008 R2 (6.1)
      に統合されている構成要素です。本稿執筆時点において、
      SUA の Interix 6.0 (32 ビット) および 6.1 (64 ビット) サブシステムで確認がおこなわれています。
      これら以外のバージョンでも動作するかもしれません。
      Interix 5.x サブシステムで、pkgsrc を使った確認はまだおこなわれていません。</p>
<div class="sect3" title="3.3.3.1. Interix/SFU のインストールに際して">
<div class="titlepage"><div><div><h4 class="title">
<a name="platform.interix-sfu-install"></a>3.3.3.1. Interix/SFU のインストールに際して</h4></div></div></div>
<p>pkgsrc を使うためには、Windows Services for Unix 3.5 の配布物のうち、
	最低限、以下のパッケージをインストールする必要があります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>Utilities -&gt; Base Utilities</p></li>
<li class="listitem"><p>Interix GNU Components -&gt; (all)</p></li>
<li class="listitem"><p>Remote Connectivity</p></li>
<li class="listitem"><p>Interix SDK</p></li>
</ul></div>
<p>Interix 上で pkgsrc を使う場合、Utilities 以下の "UNIX Perl"
	はインストールしないでください。これは共有モジュールに対応していない Perl 5.6 で、
	/usr/local にインストールされますが、混乱を起こすだけです。これのかわりに、
	pkgsrc (またはバイナリーパッケージ) の Perl 5.8 をインストールします。</p>
<p>Remote Connectivity 以下の "Windows Remote Shell Service"
	のインストールは必須ではありませんが、inetd を動作させるために Remote Connectivity
	そのものはインストールすることをおすすめします。</p>
<p>インストール中に、Interix のプログラムに対して setuid を有効にするかどうか、
	また、パス名の大文字と小文字を標準で区別するかどうかを尋ねられるかもしれません。
	setuid は有効にするようにし、また大文字と小文字はかならず区別するようにします。
	(大文字と小文字を区別しないと、
	perl をはじめ多くのプログラムが構築できなくなります。)</p>
<p>註:  最近の Windows サービスパックでは、
	バイナリーを実行する方法を (データ実行防止機能を使ったものに) 変更します。
	pkgsrc その他の gcc でコンパイルされたバイナリーを信頼して使うためには、
	POSIX.EXE, PSXDLL.DLL, PSXRUN.EXE, PSXSS.EXE (899522 またはこれより新しいもの)
	を含んだホットフィックスをインストールする必要があります。
	ホットフィックスは Microsoft からサポート窓口を通じて提供されていますが、
	Debian Interix Port が、ほとんどの Interix ホットフィックスを個人的に使えるように <a class="ulink" href="http://www.debian-interix.net/hotfixes/" target="_top">http://www.debian-interix.net/hotfixes/</a>
	に用意しています。</p>
<p>Interix を使えるようにするためには、上述のホットフィックスのほか、
	Data Execution Prevention を完全に無効化する必要があるかもしれません。
	これが必要となるのは、ある種の CPU を使っている場合だけです。
	上述のホットフィックスのいずれかひとつをインストールした後にも
	gcc その他のアプリケーションが依然として繰り返し segfault する場合には、
	Windows ブートドライブ上の適切な "boot.ini" 行に、
	以下のオプションを追加することができます: /NoExecute=AlwaysOff
	(警告: これは DEP を完全に無効化するものであり、
	Administrators グループのユーザーとしてアプリケーションをよく実行する場合には、
	セキュリティー上の危険となる可能性があります。)</p>
</div>
<div class="sect3" title="3.3.3.2. Interix/SFU がインストール済みの場合はどうすればよいか">
<div class="titlepage"><div><div><h4 class="title">
<a name="platform.interix-sfu-postinstall"></a>3.3.3.2. Interix/SFU がインストール済みの場合はどうすればよいか</h4></div></div></div>
<p>SFU がすでにインストールされており、その設定を変更して
	pkgsrc が動作するようにしたい場合は、以下のことに気をつけてください。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>UNIX Perl をアンインストールするため、Add/Remove Programs を使い、Microsoft
	    Windows Services for UNIX を選んで Change をクリックします。インストーラーで
	    Add or Remove を選んでから Utilities-&gt;UNIX Perl のチェックを外します。</p></li>
<li class="listitem">
<p>ファイルシステムの大文字と小文字の区別を有効にするため、REGEDIT.EXE を実行して
	    以下のレジストリーキーを変更します。</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\kernel</p>
<p>DWORD 値 "obcaseinsensitive" を 0 に設定した後、リブートします。</p>
</li>
<li class="listitem">
<p>setuid バイナリーを有効にするため (これは必須ではありません)、REGEDIT.EXE を実行して
	    以下のレジストリーキーを変更します。</p>
<p>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Services for UNIX</p>
<p>DWORD 値 "EnableSetuidBinaries" を 1 に設定した後、リブートします。</p>
</li>
</ul></div>
</div>
<div class="sect3" title="3.3.3.3. pkgsrc を使ううえで重要な覚書">
<div class="titlepage"><div><div><h4 class="title">
<a name="platform.interix-notes"></a>3.3.3.3. pkgsrc を使ううえで重要な覚書</h4></div></div></div>
<p>パッケージの管理者 (pkgsrc の "su" ユーザーと
	"pkg_add" を実行するユーザーのいずれかまたは両方) は、ローカルの Administrators
	グループに所属している必要があります。bootstrap を実行するユーザーも同様です。これは、通常の
	pkgsrc が "root" を要求するのにくらべ、若干緩い条件です。</p>
<p>パッケージの管理者は umask を 002 に設定するようにします。そうしておかないと、
	自動的に "make install" が文句をいうようになります。こう設定することで、
	/var/db/pkg 以下に書かれるディレクトリーに Administrators グループが確実に書き込み可能とできます。</p>
<p>http://www.interopsystems.com/ にある人気のある Interix バイナリーパッケージは、
	古いバージョンの pkgsrc の pkg_* ツールを使います。
	理想的には、これらは pkgsrc と混用しないほうがよいものです。
	これらを pkgsrc のパッケージと同時に使う場合は、かならず、
	それぞれのバイナリーパッケージに応じて適切な pkg_* ツールを使うようにしてください。</p>
<p>DOS 型のコンソールウィンドウ (csh および ksh
	のスタートアップショートカットから起動されるものを含む)
	用の TERM の設定は "interix" です。
	たいていのシステムには、そのような termcap/terminfo エントリーがありませんが、
	ほとんどの場合、以下のような .termcap エントリーを用意すれば十分です。</p>
<pre class="programlisting">
interix:kP=\E[S:kN=\E[T:kH=\E[U:dc@:DC@:tc=pcansi:
	</pre>
</div>
<div class="sect3" title="3.3.3.4. Interix プラットフォームの制約">
<div class="titlepage"><div><div><h4 class="title">
<a name="platform.interix-limits"></a>3.3.3.4. Interix プラットフォームの制約</h4></div></div></div>
<p>Interix は、完全な Unix 風のプラットフォームの
	とっつきやすく柔軟な代替品としては十分なものですが、Interix
	を最大限に活用したい場合は、若干の制約があることを知っておくとよいでしょう。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p><span class="strong"><strong>X11:</strong></span></p>
<p>Interix には標準的な X11R6 クライアントライブラリー一式が附属しており、
	  X11 にもとづくアプリケーションを実行することができますが、
	  X サーバーは附属<span class="emphasis"><em>しません</em></span>。X サーバーの選択肢としては、
	  <a class="ulink" href="http://www.starnet.com/products/xwin32/" target="_top">StarNet X-Win32</a>,
	  <a class="ulink" href="http://connectivity.hummingbird.com/products/nc/exceed/" target="_top">Hummingbird Exceed</a>
	  (Interix 用に調整された
	  <a class="ulink" href="http://www.interopsystems.com/InteropXserver.htm" target="_top">Interop X Server</a>
	  というものを、Interop Systems が提供しています) や、
	  <a class="ulink" href="http://x.cygwin.com/" target="_top">Cygwin</a>
	  に含まれるフリーの X11 サーバーがあります。</p>
</li>
<li class="listitem">
<p><span class="strong"><strong>X11 アクセラレーション:</strong></span></p>
<p>Interix は、Win32 アプリケーションとは完全に別の
	  NT サブシステム内で動いているため、現在のところ、アクセラレーションのための
	  X11 プロトコルの各種拡張 (MIT-SHM や DGA など) には対応していません。
	  ローカルの X サーバーを使った対話的なアプリケーションのほとんどは、
	  そこそこ速く動きますが、フルモーションビデオなど画像に特化したアプリケーションを動かすには、
	  思ったよりも速い CPU が必要になるかもしれません。</p>
</li>
<li class="listitem">
<p><span class="strong"><strong>オーディオ:</strong></span></p>
<p>Interix は、オーディオ出力にネイティブで対応していません。
	  オーディオに対応するため、pkgsrc では Interix 上で <span class="command"><strong>esound</strong></span>
	  クライアントサーバー型オーディオシステムを使っています。
	  他のほとんどのプラットフォームとは異なり、
	  <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/audio/esound/README.html" target="_top"><code class="filename">audio/esound</code></a> パッケージには、
	  <span class="command"><strong>esd</strong></span> サーバーが含まれません。
	  Interix ホストを経由してオーディオを出力するには、
	  <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/emulators/cygwin_esound/README.html" target="_top"><code class="filename">emulators/cygwin_esound</code></a>
	  パッケージもあわせてインストールする必要があります。</p>
</li>
<li class="listitem">
<p><span class="strong"><strong>CD/DVD, USB, SCSI:</strong></span></p>
<p>現在のところ、Interix はデバイスへの直接のアクセスに対応していませんので、
	  CD/DVD ドライブ、USB デバイス、SCSI デバイスを、
	  ファイルシステム経由以外の方法で使うことはできません。このため、
	  Interix を使って、直接 CD/DVD を焼くことなどはできません。</p>
</li>
<li class="listitem">
<p><span class="strong"><strong>テープドライブ:</strong></span></p>
<p>CD-ROM や SCSI デバイスと同様の制約があるため、
	  Interix ではテープドライブに直接アクセスすることもできません。ただし、
	  Cygwin を介して使うことで (Cygwin の esound
	  サーバーを介してオーディオを使えるように)
	  テープドライブにアクセスできるようにするための作業がおこなわれています。</p>
</li>
</ul></div>
</div>
<div class="sect3" title="3.3.3.5. Interix 上での pkgsrc に関する、既知の問題">
<div class="titlepage"><div><div><h4 class="title">
<a name="platform.interix-knownissues"></a>3.3.3.5. Interix 上での pkgsrc に関する、既知の問題</h4></div></div></div>
<p>一般的に、Windows システム上に "root" ユーザーを用意することは必須ではありません。
	ユーザーがローカルの Administrators グループに属してさえいれば、それで十分です。
	ただし、現在のところ、パッケージのなかには
	"root" という名前のユーザーが特権ユーザーであることを前提にしているものがあります。
	そのようなパッケージのために、"root" という名前のユーザーを作ってもかまいませんが、
	ローカルの Administrators グループ (または、お使いの言語でこれに対応するもの)
	に属させるようにしてください。</p>
<p><span class="command"><strong>pkg_add</strong></span> は、<code class="filename">$PKG_DBDIR</code> 内のディレクトリーを、モード 0775 ではなく
	0755 で作成します。この問題を回避するため、当面は、ローカルの
	Administrator (または、お使いの言語でこれに対応するもの)
	としてパッケージをインストールするか、
	各パッケージのインストール後に以下のコマンドを実行してください。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>chmod -R g+w $PKG_DBDIR</code></strong>
	</pre>
</div>
</div>
<div class="sect2" title="3.3.4. IRIX">
<div class="titlepage"><div><div><h3 class="title">
<a name="irix"></a>3.3.4. IRIX</h3></div></div></div>
<p>機能する C コンパイラー、つまり、 gcc または SGI の MIPS
      および MIPSpro コンパイラー (cc/c89) が必要です。 <code class="varname">CC</code> 環境変数を、
      使用するコンパイラーに応じて設定してください。
      MIPSpro コンパイラースイートのライセンスがない場合は、<a class="ulink" href="http://freeware.sgi.com/" target="_top">http://freeware.sgi.com/</a>
      から gcc の tar 配布ファイルをダウンロードすることができます。</p>
<p>IRIX 6.5.17 以上が必要です。
      このバージョンの IRIX で <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?if_indextoname+3+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">if_indextoname</span>(3)</span></a>, <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?if_nametoindex+3+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">if_nametoindex</span>(3)</span></a>
      などへの対応がおこなわれたからです。</p>
<p>現在のところ、pkgsrc は同時には一つの ABI にしか対応しません。つまり、
	古い 32 ビット ABI、新しい 32 ビット ABI、64 ビット ABI を切り替えることはできません。
	最初に "abi=n32" を使って始めた場合は、
	すべてのパッケージがこれを使って構築されることになります。</p>
<p>このため、環境変数または <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> の
      <code class="varname">CFLAGS</code> が衝突しないようにしてください。
      特に、 n32 オブジェクトファイルに lib64 を、また、その逆の組合せを、
      リンクしないようにしてください。
      <code class="filename">/etc/compiler.defaults</code> を確認してください。</p>
<p>pkgsrc ツリーの実体を別ホストから NFS を使ってマウントしている場合は、必ず
      <code class="varname">WRKOBJDIR</code> をローカルのディレクトリーに設定しておいてください。
      IRIX のリンカーは、ネットワーク経由でマウントされたファイルシステム越しにリンクするときに
      問題を起こすことが時々あるからです。</p>
<p>事前準備の過程では、imake(1) などのプログラムにすべて正しいオプションが設定されるはずですが、
      ローカルの設定に依存するオプションを設定したい場合があるかもしれません。
      詳細は、<code class="filename">pkgsrc/mk/defaults/mk.conf</code> をご覧ください。
      そしてもちろん、お使いのコンパイラーのマニュアルページもご覧ください。</p>
<p>SGI の MIPSPro コンパイラーを使っている場合は、
         <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で

      </p>
<pre class="programlisting">
PKGSRC_COMPILER=        mipspro
      </pre>
<p>

      を設定してください。これを設定しないと、
      pkgsrc は gcc を使っていることを仮定するので、コンパイラーに不適切なフラグを渡すことがあります。
      なお、標準状態では、bootstrap は適切な <code class="filename">mk.conf.example</code>
      を作成するはずです。</p>
<p>gcc と MIPSPro コンパイラーチェインの両方をインストールしているが、
      必ず MIPSPro を使うようにしたい場合は、<code class="varname">PATH</code>
      に gcc の場所 (ありがちなのは
      <code class="filename">/usr/freeware/bin</code>) を<span class="emphasis"><em>含めない</em></span>でください。さらに (重要)、
      '--preserve-path' フラグを bootstrap に渡してください。</p>
</div>
<div class="sect2" title="3.3.5. Linux">
<div class="titlepage"><div><div><h3 class="title">
<a name="linux"></a>3.3.5. Linux</h3></div></div></div>
<p>Linux のなかには、libtermcap と libcurses (libncurses) のいずれかを必要とするものがあります
      (たとえば Debian GNU/Linux など)。そのようなディストリビューションでは
      libncurses-dev パッケージ (または相当品) をインストールすれば問題なくなるはずです。</p>
<p>pkgsrc は gcc (GNU Compiler Collection) と icc
      (Intel C++ Compiler) のどちらにも対応しています。gcc が標準で使われます。
      icc は i386 上の icc 8.0 と 8.1 で確認がおこなわれています。      </p>
<p>icc を使って bootstrap をおこなうには、以下のようにします
      (icc は標準のディレクトリーにインストールされているものとします)。</p>
<pre class="programlisting">
env CC=/opt/intel_cc_80/bin/icc LDFLAGS=-static-libcxa \
ac_cv___attribute__=yes ./bootstrap
      </pre>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>icc 8.1 では、引数の -static-libcxa を `-i-static' にする必要があります。</p>
</div>
<p>icc は __attribute__ に対応していますが、GNU configure のテストではネストした関数を使っており、
      icc はネストした関数に対応していません。__attribute__ を #undef してしまうと、
      Linux の多くのヘッダーファイルが __attribute__ なしでは正しくコンパイルできず、
      壊れてしまうという副作用があります。このため、テストは、コンパイラーが
      __attribute__ に対応しているとしたもので上書きする必要があります。</p>
<p>bootstrap した後に、<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で
      <code class="varname">PKGSRC_COMPILER</code> を設定します。</p>
<pre class="programlisting">
PKGSRC_COMPILER=        icc
      </pre>
<p>icc がインストールされるディレクトリーは標準では
      <code class="filename">/opt/intel_cc_80</code> であり、pkgsrc
      でもこのディレクトリーを標準としています。これ以外のディレクトリーに
      icc をインストールしている場合は、<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で
      <code class="varname">ICCBASE</code> を設定してください。</p>
<pre class="programlisting">
ICCBASE=                /opt/icc
      </pre>
<p>pkgsrc は、icc が提供する実行時ライブラリーを静的リンクするので、
      作られたバイナリーはその共有ライブラリーがインストールされていないシステムでも
      動かすことができます。</p>
<p>ただし、libtool は、C++ の共有ライブラリーをリンクして記録する時に実行された
      (ライブラリーごとに -Bstatic や -Bdynamic オプションの指定がまちまちな)
      <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?ld+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">ld</span>(1)</span></a> コマンドをもとにライブラリーの一覧を展開します
      このことから、libtool でリンクされた C++ の共有ライブラリーは、libtool が修正されない限り、
      icc のライブラリーに対して実行時依存性を持った状態になります。</p>
</div>
<div class="sect2" title="3.3.6. OpenBSD">
<div class="titlepage"><div><div><h3 class="title">
<a name="openbsd"></a>3.3.6. OpenBSD</h3></div></div></div>
<p>確認および対応は、 OpenBSD 3.0 および 3.2 に対しておこなわれています。</p>
<p>ブートストラップキットのインストールに際しては、
	OpenBSD のユーザーランドのツールと衝突することがないように注意を払ってください。以下のような複数の事項があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>OpenBSD の ports は、 <code class="filename">/var/db/pkg</code>
	  以下にパッケージデータベースを置きます。このため、
	  ブートストラップスクリプトの --pkgdbdir オプションで、
	  別の場所 (たとえば <code class="filename">/usr/pkgdb</code>)
	  を指定することをおすすめします。</p></li>
<li class="listitem">
<p>OpenBSD ports のツールを使う予定がない場合は、混同を避けるために、
	  それらを移動してしまってもいいかもしれません。たとえば以下のようにします。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/sbin</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_add pkg_add.orig</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_create pkg_create.orig</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_delete pkg_delete.orig</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mv pkg_info pkg_info.orig</code></strong>
	  </pre>
</li>
<li class="listitem">
<p>ブートストラップスクリプトを使った際、
	    <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> ファイルの例は
	    <code class="filename">/etc/mk.conf.example</code> ファイルに置かれます。
	    OpenBSD の make プログラムは
	    <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> も使います。
	    このファイル中の pkgsrc 特有の記述を以下のように括ることで、
	    回避することができます。</p>
<pre class="programlisting">
.ifdef BSD_PKG_MK
# pkgsrc の記述。たとえば defaults/mk.conf の挿入など
.else
# OpenBSD の記述
.endif
	  </pre>
</li>
</ol></div>
</div>
<div class="sect2" title="3.3.7. Solaris">
<div class="titlepage"><div><div><h3 class="title">
<a name="solaris"></a>3.3.7. Solaris</h3></div></div></div>
<p>対応は x86 と sparc それぞれの Solaris 2.6 から 9 までに対しておこなわれています。
      機能する C コンパイラーが必要です。 gcc 2.95.3 および
      Sun WorkShop 5 の両者で確認がおこなわれています。</p>
<p>Solaris 8 でのブートストラップ過程およびパッケージの構築では、
      以下の各パッケージが必要になります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>SUNWsprot</p></li>
<li class="listitem"><p>SUNWarc</p></li>
<li class="listitem"><p>SUNWbtool</p></li>
<li class="listitem"><p>SUNWtoo</p></li>
<li class="listitem"><p>SUNWlibm</p></li>
</ul></div>
<p>なお、2006 年 6 月現在、Solaris 上では GNU binutils
      はサポートされて<span class="emphasis"><em>いません</em></span>。</p>
<p>どのコンパイラーを使うにせよ、コンパイラーツールと
      $prefix を、必ず <code class="varname">PATH</code> に含めてください。
      これは、<code class="filename">/usr/ccs/{bin,lib}</code>
      や、たとえば <code class="filename">/usr/pkg/{bin,sbin}</code> などです。</p>
<div class="sect3" title="3.3.7.1. gcc を使う場合">
<div class="titlepage"><div><div><h4 class="title">
<a name="solaris-gcc-note"></a>3.3.7.1. gcc を使う場合</h4></div></div></div>
<p>どのパッケージの構築にも同じ gcc だけを使うようにすると、
	話が簡単になります。</p>
<p>外部から導入した gcc を使うのはブートストラップの時だけにして、
	その後は gcc を
	<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/lang/gcc/README.html" target="_top"><code class="filename">lang/gcc</code></a> から構築するかバイナリーパッケージをインストールして、
	ブートストラップで使った gcc は削除することをおすすめします。</p>
<p>gcc のバイナリーパッケージは、<a class="ulink" href="http://www.sunfreeware.com/" target="_top">http://www.sunfreeware.com/</a> から辿れます。</p>
</div>
<div class="sect3" title="3.3.7.2. Sun WorkShop を使う場合">
<div class="titlepage"><div><div><h4 class="title">
<a name="solaris-sun-workshop-note"></a>3.3.7.2. Sun WorkShop を使う場合</h4></div></div></div>
<p>少なくとも、以下の各パッケージを (WorkShop 5.0 から)
	インストールしておく必要があります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>SPROcc
	  - Sun WorkShop Compiler C 5.0</p></li>
<li class="listitem"><p>SPROcpl
	  - Sun WorkShop Compiler C++ 5.0</p></li>
<li class="listitem"><p>SPROild
	  - Sun WorkShop Incremental Linker</p></li>
<li class="listitem"><p>SPROlang
	  - Sun WorkShop Compilers common components</p></li>
</ul></div>
<p><a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
	で、以下の変数を設定します。</p>
<pre class="programlisting">
CC=     cc
CXX=    CC
CPP=    cc -E
CXXCPP= CC -E
</pre>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>C プリプロセッサーを使って
	C のソースコード以外のものを処理するパッケージのなかには、
	この <code class="varname">CPP</code> の設定では問題が起きるものがあるかもしれません。</p>
</div>
</div>
<div class="sect3" title="3.3.7.3. SunPro を使って 64 ビットバイナリーを構築する">
<div class="titlepage"><div><div><h4 class="title">
<a name="solaris-sunpro-64"></a>3.3.7.3. SunPro を使って 64 ビットバイナリーを構築する</h4></div></div></div>
<p>64 ビットパッケージを構築する場合に必要なことは、
	<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> ファイルに以下の行を追加するだけです。</p>
<pre class="programlisting">
PKGSRC_COMPILER=        sunpro
ABI=                    64
</pre>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>この設定は、SPARC アーキテクチャーについてのみ確認がおこなわれています。
	Intel および AMD マシンでは、
	必要な作業がまだ残っています。</p>
</div>
</div>
<div class="sect3" title="3.3.7.4. ありがちな問題">
<div class="titlepage"><div><div><h4 class="title">
<a name="plat.sunos.problems"></a>3.3.7.4. ありがちな問題</h4></div></div></div>
<p><span class="command"><strong>libtool</strong></span> を使っていると、時々、<code class="filename">/bin/ksh</code>
      がセグメンテーションフォールトを起こしてクラッシュすることがあります。
      回避策は、たとえば <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/shells/bash/README.html" target="_top"><code class="filename">shells/bash</code></a> をインストールして、
      以下の各行を <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> に追加するなどして、
      別のシェルを configure スクリプト用に使うことです。</p>
<pre class="programlisting">
CONFIG_SHELL=   ${LOCALBASE}/bin/bash
WRAPPER_SHELL=  ${LOCALBASE}/bin/bash
      </pre>
<p>こうしてから、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/libtool-base/README.html" target="_top"><code class="filename">devel/libtool-base</code></a> パッケージを構築しなおします。</p>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter 4. pkgsrc を使う">
<div class="titlepage"><div><div><h2 class="title">
<a name="using"></a>Chapter 4. pkgsrc を使う</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#using-pkg">4.1. バイナリーパッケージを使う</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#finding-binary-packages">4.1.1. バイナリーパッケージの配布場所</a></span></dt>
<dt><span class="sect2"><a href="#installing-binary-packages">4.1.2. バイナリーパッケージをインストールする</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_delete">4.1.3. パッケージをアンインストールする</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_info">4.1.4. インストールされているパッケージの情報を得る</a></span></dt>
<dt><span class="sect2"><a href="#vulnerabilities">4.1.5. インストール済パッケージの脆弱性チェック</a></span></dt>
<dt><span class="sect2"><a href="#pkg_versions">4.1.6. インストール済パッケージのより新しいバージョンが pkgsrc にあるかどうか調べる</a></span></dt>
<dt><span class="sect2"><a href="#using.pkg_admin">4.1.7. その他の管理用機能</a></span></dt>
<dt><span class="sect2"><a href="#a-word-of-warning">4.1.8. 警告</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#building-packages-from-source">4.2. ソースからパッケージを構築する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#requirements">4.2.1. 必要なもの</a></span></dt>
<dt><span class="sect2"><a href="#fetching-distfiles">4.2.2. 配布ファイルの取得</a></span></dt>
<dt><span class="sect2"><a href="#how-to-build-and-install">4.2.3. 構築とインストール方法</a></span></dt>
</dl></dd>
</dl>
</div>
<p>基本的に、pkgsrc には二通りの使い方があります。
一つ目の使い方は、パッケージ用のツールだけをインストールして、
他の人が用意したバイナリーパッケージを使うものです。
これは、pkgsrc のうち <span class="quote">“<span class="quote">pkg</span>”</span> に相当します。
二つ目の使い方は、pkgsrc の <span class="quote">“<span class="quote">src</span>”</span> もインストールするものです。
こうすると、自分でパッケージを構築することができますし、
他の人が用意したバイナリーパッケージを使うこともできます。</p>
<div class="sect1" title="4.1. バイナリーパッケージを使う">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="using-pkg"></a>4.1. バイナリーパッケージを使う</h2></div></div></div>
<p><a class="ulink" href="ftp://ftp.NetBSD.org/" target="_top">ftp.NetBSD.org</a>
  サーバーとそのミラーサイトには、バイナリーパッケージを揃えて置いてあり、
  すぐにインストールして使える状態になっています。このバイナリーパッケージは、
  以下のような、標準のディレクトリーの設定を使って構築されています。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">LOCALBASE</code> は <code class="filename">/usr/pkg</code> で、ここにほとんどのファイルがインストールされます。</p></li>
<li class="listitem"><p>設定ファイルは <code class="filename">/usr/pkg/etc</code> です。</p></li>
<li class="listitem"><p><code class="varname">VARBASE</code> は <code class="filename">/var</code> で、インストール後に変更することのあるファイルはここにインストールされます。</p></li>
</ul></div>
<p>何らかの理由 (root 権限がないなど) でこの各ディレクトリーが使えない場合は、
  このバイナリーパッケージを使うことはできないので、
  パッケージ用ツールを自分で構築する必要があります。これについては<a class="xref" href="#bootstrapping-pkgsrc" title="3.2. pkgsrc を使う準備をする">Section 3.2, “pkgsrc を使う準備をする”</a>に説明があります。</p>
<div class="sect2" title="4.1.1. バイナリーパッケージの配布場所">
<div class="titlepage"><div><div><h3 class="title">
<a name="finding-binary-packages"></a>4.1.1. バイナリーパッケージの配布場所</h3></div></div></div>
<p>バイナリーパッケージをインストールするためには、
    まず、バイナリーパッケージがどこで入手できるか知っている必要があります。
    最初に調べる場所は、pkgsrc の主たる FTP サーバーの <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/" target="_top"><code class="filename">/pub/pkgsrc/packages</code></a>
    ディレクトリーです。</p>
<p>このディレクトリーには、複数のプラットフォーム用の
    バイナリーパッケージがあります。
    最初に、お使いのオペレーティングシステムのディレクトリーを選んでください。
    (バージョン番号がついているディレクトリーは、
    歴史的な理由で残っているだけですので、無視してください。)
    次に、ハードウェアアーキテクチャーを選び、
    その次に、OS のバージョンと pkgsrc の<span class="quote">“<span class="quote">バージョン</span>”</span>の組合せを選びます。</p>
<p>多くの場合、このディレクトリーには、
    パッケージ管理ツールが入った <code class="filename">bootstrap.tar.gz</code>
    というファイルがあります。このファイルがない場合は、
    お使いのオペレーティングシステムにパッケージ管理ツールがもともとあるのでしょう。
    このファイルをダウンロードして <code class="filename">/</code> ディレクトリーに展開します。
    展開すると、<code class="filename">/usr/pkg</code> (この下には、
    バイナリーパッケージ管理用のツールがある) および <code class="filename">/var/db/pkg</code>
    (インストールされたパッケージのデータベース用) の各ディレクトリーが作られます。</p>
</div>
<div class="sect2" title="4.1.2. バイナリーパッケージをインストールする">
<div class="titlepage"><div><div><h3 class="title">
<a name="installing-binary-packages"></a>4.1.2. バイナリーパッケージをインストールする</h3></div></div></div>
<p>前節で説明したディレクトリーには、
    <code class="filename">All</code> というサブディレクトリーがあり、
    当該プラットフォーム向けのバイナリーパッケージがすべて置かれています。
    ただし、FTP または CDROM (利用しているメディアによって異なります)
    経由での配布ができないパッケージは、
    除かれています。</p>
<p>パッケージを FTP または HTTP サーバーから直接インストールするには、
    Bourne シェルと互換のシェルで、以下のコマンドを実行します (最初に
    <span class="command"><strong>su</strong></span> して root になっておくことを忘れずに)。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>PATH="/usr/pkg/sbin:$PATH"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>PKG_PATH="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/<em class="replaceable"><code>OPSYS</code></em>/<em class="replaceable"><code>ARCH</code></em>/<em class="replaceable"><code>VERSIONS</code></em>/All"</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>export PATH PKG_PATH</code></strong>
</pre>
<p>CDROM, DVD または NFS でマウントされた置き場所からインストールする場合などは、
    URL のかわりに、ローカルのパスを使うこともできます。
    複数の置き場所からパッケージをインストールしたい場合は、
    それらをセミコロンで区切って <code class="varname">PKG_PATH</code>
    に設定することができます。</p>
<p>以上の準備ができれば、
    パッケージのインストールは非常に簡単です。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>pkg_add openoffice2</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pkg_add kde-3.5.7</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pkg_add ap2-php5-*</code></strong>
</pre>
<p>なお、インストールしようとするパッケージを実行するために必要となるパッケージも、
    すべて一緒にインストールされますが、
    この必要なパッケージも同じ置き場所に用意されていると仮定されます
    (訳註: 必要なパッケージがすべて揃うように PKG_PATH を設定する必要があるということ)。</p>
<p>パッケージをインストールすると、脆弱性のあるパッケージがインストールされることもありえます。
    このため、<span class="command"><strong>pkg_admin audit</strong></span> を定期的に
    (特に、パッケージを新たにインストールした後には) 実行して、
    脆弱性の影響がある構成となっているかどうかを確認するようにしてください。</p>
<p>パッケージをインストールした後に、<code class="varname">PATH</code>に
    <code class="filename">/usr/pkg/bin</code> と <code class="filename">/usr/pkg/sbin</code> が含まれている事を確
    認してください。これで、インストールされたプログラムを実際に使い始めること
    ができます。</p>
</div>
<div class="sect2" title="4.1.3. パッケージをアンインストールする">
<div class="titlepage"><div><div><h3 class="title">
<a name="using.pkg_delete"></a>4.1.3. パッケージをアンインストールする</h3></div></div></div>
<p>パッケージをアンインストールする方法は、そのパッケージを、
    ソースコードからインストールしたかバイナリーパッケージからインストールしたかにかかわらず同じです。
    どちらの方法でインストールされたかは、<span class="command"><strong>pkg_delete</strong></span> コマンドは一切関知しません。
    パッケージの削除は、<span class="command"><strong>pkg_delete
    <em class="replaceable"><code>package-name</code></em></strong></span> を実行するだけでおこなうことができます。
    パッケージ名はバージョン番号をつけてもつけなくてもかまいません。
    一連のパッケージをアンインストールするために、
    たとえば <code class="literal">*emacs*</code> のようにワイルドカードを使うこともできます。
    この場合、ワイルドカードが
    <code class="literal">pkg_delete</code> に渡る前にシェルに展開されないようにするため、
    ワイルドカードはかならずクォートするようにします。</p>
<p><code class="option">-r</code> オプションは非常に強力です。これを使うと、
    指定したパッケージに依存しているパッケージをすべて削除してから、
    指定したパッケージそのものを削除します。たとえば、

    </p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>pkg_delete -r jpeg</code></strong>
    </pre>
<p>

    は、jpeg および jpeg を使うすべてのパッケージを削除します。これにより、
    jpeg パッケージをアップグレードすることが可能になります。</p>
</div>
<div class="sect2" title="4.1.4. インストールされているパッケージの情報を得る">
<div class="titlepage"><div><div><h3 class="title">
<a name="using.pkg_info"></a>4.1.4. インストールされているパッケージの情報を得る</h3></div></div></div>
<p><span class="command"><strong>pkg_info</strong></span> は、インストールされているパッケージや、
    バイナリーパッケージのファイルに関する情報を表示します。</p>
</div>
<div class="sect2" title="4.1.5. インストール済パッケージの脆弱性チェック">
<div class="titlepage"><div><div><h3 class="title">
<a name="vulnerabilities"></a>4.1.5. インストール済パッケージの脆弱性チェック</h3></div></div></div>
<p>
      NetBSD セキュリティーオフィサーとパッケージグループでは、
      pkgsrc に含まれる (あるいは含まれていた) パッケージの既知の脆弱性のリストを
      保守しています。このリストは、 NetBSD FTP サイトの
      <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/vulnerabilities" target="_top">ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/vulnerabilities</a>
      から入手できます
    </p>
<p>
      <span class="command"><strong>pkg_admin fetch-pkg-vulnerabilities</strong></span> を使うと、
      このリストを自動的にダウンロードし、
      システムにインストールされているパッケージすべてについて
      セキュリティー検証をすることができます。
    </p>
<p>
      このセキュリティー検証は、ふたつの部分からできています。
      ひとつめの段階は <span class="command"><strong>pkg_admin fetch-pkg-vulnerabilities</strong></span> で、
      NetBSD FTP サイトから
      脆弱性のリストをダウンロードするものです。 ふたつめは
      <span class="command"><strong>pkg_admin audit</strong></span> で、インストールされているパッケージに脆弱性が
      ないかどうか検証するものです。脆弱性のあるパッケージがあった場合、
      次のように出力してくれます:
    </p>
<pre class="screen">Package samba-2.0.9 has a local-root-shell vulnerability, see
    http://www.samba.org/samba/whatsnew/macroexploit.html</pre>
<p>
      <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/vulnerabilities" target="_top">vulnerabilities</a>
      ファイルを毎日ダウンロードして、常に最新の状態にしておきたいという方もいらっしゃることでしょう。
      root ユーザーの <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?crontab+5+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">crontab</span>(5)</span></a> エントリーを適切に書いておけば、そういうこともできます。
      たとえば、
      </p>
<pre class="screen">
# vulnerabilities ファイルをダウンロード
0 3 * * * /usr/sbin/pkg_admin fetch-pkg-vulnerabilities &gt;/dev/null 2&gt;&amp;1
      </pre>
<p>
      というエントリーを書けば、毎日午前 3 時に vulnerability リストを更新することになります。
      この例は一日一回ですが、もっと頻繁に更新することもできます。

      さらに、パッケージの検証を daily security script でおこないたい方もいらっしゃるでしょう。
      これは、以下のような行を <code class="filename">/etc/security.local</code>
      に書いておけば実現できます。
      </p>
<pre class="screen">
/usr/sbin/pkg_admin audit
      </pre>
<p>
    </p>
</div>
<div class="sect2" title="4.1.6. インストール済パッケージのより新しいバージョンが pkgsrc にあるかどうか調べる">
<div class="titlepage"><div><div><h3 class="title">
<a name="pkg_versions"></a>4.1.6. インストール済パッケージのより新しいバージョンが pkgsrc にあるかどうか調べる</h3></div></div></div>
<p>
      インストール済パッケージが最新かどうかを確認するには、
      <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/lintpkgsrc/README.html" target="_top"><code class="filename">pkgtools/lintpkgsrc</code></a> をインストールして、
      <span class="command"><strong>lintpkgsrc</strong></span> に <span class="quote">“<span class="quote">-i</span>”</span> を付けて実行します。たとえば以下のようになります。
    </p>
<pre class="screen">
<code class="prompt">%</code> <strong class="userinput"><code>lintpkgsrc -i</code></strong>
...
Version mismatch: 'tcsh' 6.09.00 vs 6.10.00
    </pre>
<p>このようになった場合、パッケージを更新し、そのパッケージに依存しているパッケージをすべて再構築するために、
    <span class="command"><strong>make update</strong></span> を使うことができます。
    </p>
</div>
<div class="sect2" title="4.1.7. その他の管理用機能">
<div class="titlepage"><div><div><h3 class="title">
<a name="using.pkg_admin"></a>4.1.7. その他の管理用機能</h3></div></div></div>
<p><span class="command"><strong>pkg_admin</strong></span> は、パッケージシステムにおける、
    各種の管理用機能を実行します。</p>
</div>
<div class="sect2" title="4.1.8. 警告">
<div class="titlepage"><div><div><h3 class="title">
<a name="a-word-of-warning"></a>4.1.8. 警告</h3></div></div></div>
<p><a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> マニュアルページで警告されている、自分自身で作ったものでないバイナリー
    パッケージをインストールすることが孕む危険性、無思慮にこのようなファイルを
    インストールすることにより、あなたのシステムにセキュリティーホールが生じる
    事についてよく注意してください。</p>
<p>もちろん、パッケージ、パッケージの構築用のコンパイラー、
    その他、呼び出されるすべてのツールのソースコードを完全に読んで理解したわけではない場合は、
    ソースからインストールしたパッケージにもすべて、
    同じ警告があてはまります。</p>
</div>
</div>
<div class="sect1" title="4.2. ソースからパッケージを構築する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="building-packages-from-source"></a>4.2. ソースからパッケージを構築する</h2></div></div></div>
<p>pkgsrc を入手すると、 <code class="filename">pkgsrc</code> ディレクトリーには、
  カテゴリー別に整理されたパッケージ一式が含まれます。
  オンラインでパッケージの索引を見られますし、また、 <code class="filename">pkgsrc</code>
  ディレクトリーで <span class="command"><strong>make readme</strong></span> してローカルで <code class="filename">README.html</code>
  を作って、 <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/lynx/README.html" target="_top"><code class="filename">www/lynx</code></a> や <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/firefox/README.html" target="_top"><code class="filename">www/firefox</code></a> などの好みの
  web ブラウザーで見られるようにすることもできます。</p>
<p>パッケージのインストール先の<span class="emphasis"><em>プレフィックス</em></span>は、
  デフォルトでは <code class="filename">/usr/pkg</code> です。これを変えたい場合は、
  <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で <code class="varname">LOCALBASE</code>
  を設定してください。一つのシステム内で複数の
  <code class="varname">LOCALBASE</code> を定義して使い分けるようなことはしないでください
  (chroot 環境内は除く)。 </p>
<p>以下、本章では、パッケージがすでに pkgsrc に含まれていると仮定
  しています。もし、そうでなければ、<a class="xref" href="#developers-guide" title="Part II. pkgsrc 開発者向けの手引き">Part II, “pkgsrc 開発者向けの手引き”</a>で、
  パッケージを新たに作る方法をご覧ください。</p>
<div class="sect2" title="4.2.1. 必要なもの">
<div class="titlepage"><div><div><h3 class="title">
<a name="requirements"></a>4.2.1. 必要なもの</h3></div></div></div>
<p>ソースからパッケージを構築するためには、機能する C
    コンパイラーが必要です。NetBSD の場合は、
    <span class="quote">“<span class="quote">comp</span>”</span> および <span class="quote">“<span class="quote">text</span>”</span>
    配布物一式をインストールしておく必要があります。X11関連のパッケージを
    構築する場合は、さらに<span class="quote">“<span class="quote">xbase</span>”</span>および<span class="quote">“<span class="quote">xcomp</span>”</span>
    配布物一式も必要です。</p>
</div>
<div class="sect2" title="4.2.2. 配布ファイルの取得">
<div class="titlepage"><div><div><h3 class="title">
<a name="fetching-distfiles"></a>4.2.2. 配布ファイルの取得</h3></div></div></div>
<p>パッケージを構築するうえで最初にすることは、配布ファイル (未変更のソース)
    のダウンロードです。配布ファイルがまだダウンロードされていない場合、
    pkgsrc は自動的に配布ファイルを取得します。</p>
<p><code class="filename">distfiles</code> ディレクトリー
    に必要なファイルが
    すでに存在していれば、インターネットに接続する必要はありません。
    CD-ROMなどにdistfilesがある場合には、CD-ROMを <code class="filename">/cdrom</code> にmountし、
    </p>
<pre class="screen">DISTDIR=/cdrom/pkgsrc/distfiles</pre>
<p>
    を <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
    に加えて、使うことができます。</p>
<p>標準状態では、人気のあるパッケージを置いているサーバー
    (たとえば SourceForge.net のミラー) に過大な負荷をかけないようにするため、
    配布サイトのリストの順序はランダムに入れ換えられます。
    このため、別の distfile を取得する必要が生ずるたびに、
    すべてのミラーからの取得を、新たな (ランダムな) 順序で試みます。
    この機能は、<code class="varname">MASTER_SORT_RANDOM=NO</code>
    を設定して止めることができます (<code class="varname">PKG_DEVELOPER</code>
    が設定されている場合は、すでに無効化されています)。</p>
<p>主要な配布サイトをあなたのところに近いサイトで上書きす
    ることができます。
    変数をひとつかふたつ設定すると、
    マスターサイトにアクセスする順序を変えることができます。
    <code class="varname">MASTER_SORT</code> には、
    ドメインの接尾辞を空白で区切ったリストが含まれます。
    <code class="varname">MASTER_SORT_REGEX</code> はこれより柔軟なもので、
    正規表現を空白で区切ったリストが含まれます。
    これは <code class="varname">MASTER_SORT</code> より高い優先度を持ちます。
    <code class="filename">pkgsrc/mk/defaults/mk.conf</code>の例を参照してください。これにより、帯域幅
    と時間が節約できるかもしれません。</p>
<p>これらの設定は、シェルの環境変数でも変更できますし、その設定を今後も有効に
    したければ、
    <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
    ファイルにその定義を書き加えておくこともできます。</p>
<p>
      パッケージが他のパッケージ(例えば <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/kde3/README.html" target="_top"><code class="filename">meta-pkgs/kde3</code></a> など)
      に依存している場合、
      ダウンロードとコンパイルを交互に繰り返すことがあります。
      最初に必要なすべてのソースを確実にダウンロードするには、
      次のコマンドを使用します:
      </p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make fetch-list | sh</code></strong></pre>
<p>
      このコマンドは必要なファイルを取ってきて<code class="filename">distfiles</code> ディレクトリー
      に保存するためのシェルコマンドを出力、実行します。必要なファイルを手動で
      ダウンロードするという方法もあります。
    </p>
</div>
<div class="sect2" title="4.2.3. 構築とインストール方法">
<div class="titlepage"><div><div><h3 class="title">
<a name="how-to-build-and-install"></a>4.2.3. 構築とインストール方法</h3></div></div></div>
<p>
      ソフトウェアがダウンロードされると、パッチが適用された上で、
      コンパイルされます。それにかかる時間はあなたのコンピューターによりますし、
      そのソフトウェアが依存している他のパッケージの数とそれらのコンパイルに
      かかる時間にもよります。
    </p>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>bootstrap または pkgsrc を NetBSD 以外のシステムで使う場合は、
    この手引きで例示されている <span class="quote">“<span class="quote">make</span>”</span> ではなく
    pkgsrc の <span class="command"><strong>bmake</strong></span> コマンドを使ってください。</p>
</div>
<p>たとえば、パッケージの各構成要素を構築するには、シェルプロンプトで</p>
<pre class="screen">
<code class="prompt">%</code> <strong class="userinput"><code>cd misc/figlet</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make</code></strong>
    </pre>
<p>とします。</p>
<p>次は新たにコンパイルされたプログラムを、
    実際にあなたのシステムにインストールします。
    インストールしようとしているパッケージのディレクトリーにいる間に

    </p>
<pre class="screen">
<code class="prompt">%</code> <strong class="userinput"><code>make install</code></strong>
    </pre>
<p>

    と入力してください。</p>
<p>パッケージをシステムにインストールするには root 権限が必要なことがあります。
    ただし、pkgsrc には<span class="emphasis"><em>必要な時のみ  su する</em></span>機能があり、
    実際のインストール時にのみ root になることができます。</p>
<p>そのソフトウェアは今まさにインストールされ、
    使用できるようにセットアップされたことになります。
    もうこれ以上コンパイル後の作業ファイルは必要とされないので、

    </p>
<pre class="screen">
<code class="prompt">%</code> <strong class="userinput"><code>make clean</code></strong>
    </pre>
<p>

    と入力し作業ディレクトリー内のファイルを削除してしまってもかまいません。
    もし、プログラムをコンパイルするときに、
    依存関係により他のパッケージがコンパイル/インストールされたならば、
    それらも次のコマンドにより、きちんと削除することができます。</p>
<pre class="screen">
<code class="prompt">%</code> <strong class="userinput"><code>make clean-depends</code></strong>
    </pre>
<p>figlet ユーティリティーを例にあげると、<a class="xref" href="#logs" title="Appendix B. 構築のログ">Appendix B, <i>構築のログ</i></a>のように構築することに
    より、システムにインストールすることができます。</p>
<p>プログラムはパッケージツリーのデフォルトルート- <code class="filename">/usr/pkg</code>にインストール
    されます。もし、このディレクトリーが趣味にあわないのであれば、環境変数
    <code class="varname">LOCALBASE</code>
    を設定してください。この値はパッケージツリーのルートとして使用さ
    れます。例えば、<code class="filename">/usr/local</code>を使う場合、
    <code class="varname">LOCALBASE=/usr/local</code> と設定してください。
    なお、これにはパッケージ専用のディレクトリーを使い、他のプログ
    ラムと共有させないようにします(つまり、 <code class="varname">LOCALBASE=/usr</code> などとしてはいけませ
    ん)。また、<code class="varname">LOCALBASE</code>ツリー内には、独自のファイルやディレクトリー
    (<code class="filename">src/</code>,
    <code class="filename">obj/</code>, <code class="filename">pkgsrc/</code>
    のようなもの)は一切追加しないようにしてください。これは、パッ
    ケージシステムがインストールするプログラムなどのファイルが、そこにインストー
    ルされているかもしれない別のファイルと衝突することがないようにするためです。</p>
<p>いくつかのパッケージは、構築時にいくつかのコンフィギュレーションオプション
    を変えるために<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>を参照します。デフォルトの設定項目については、
    <code class="filename">pkgsrc/mk/defaults/mk.conf</code>をのぞいてみてください。<code class="varname">LOCALBASE</code>
    といっ
    た環境変数は、pkgsrc使用時に毎回使えるように<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>で設定しておくこと
    ができます。</p>
<p>時々、 パッケージの構築やインストールの際に、<span class="quote">“<span class="quote">水面下</span>”</span>で何が起きているかを
    見たいことがあります。これは、デバッグのためなのかもしれませんし、好奇心が
    高じたものかもしれません。このような用途に使うための変数がいくつも用意され
    ています。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
<p><a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>コマンドを
	<code class="varname">PKG_DEBUG_LEVEL=2</code>付きで呼び出すと、大量の情報が表示さ
	れるようになります。たとえば、</p>
<pre class="screen"><strong class="userinput"><code>make patch PKG_DEBUG_LEVEL=2</code></strong></pre>
<p>は、<span class="quote">“<span class="quote">patch</span>”</span>の段階および、そこに至るまでに呼び出されるコマンドをすべて表示し
	ます。</p>
</li>
<li class="listitem">
<p>特定の<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>定義の値を知りたい場合は、
	show-varターゲットとともに、
	<code class="varname">VARNAME</code>定義を使います。たとえば、
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>変数
	<code class="varname">LOCALBASE</code>の展開結果を表示するには、以下のようにします。</p>
<pre class="screen">
<code class="prompt">%</code> <strong class="userinput"><code>make show-var VARNAME=LOCALBASE</code></strong>
/usr/pkg
<code class="prompt">%</code>
	</pre>
</li>
</ol></div>
<p>自分で作った(次章参照)、手動でpkgsrc/packagesに置いた、またはリモートFTPサー
    バーに置かれたバイナリーパッケージをインストール
    したい場合は、"bin-install"ターゲットを使うことができます。このターゲットは、
    - もし可能ならば - <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>を使ってバイナリーパッケージをインストールするほ
    か、<span class="command"><strong>make package</strong></span>をおこないます。検索先リモートFTPサーバーのリストは
    <code class="varname">BINPKG_SITES</code>変数に保持され、デフォルトはftp.NetBSD.orgです。<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>に与え
    るべきフラグはすべて、<code class="varname">BIN_INSTALL_FLAGS</code>変数で保持することができます。詳細は
    <code class="filename">pkgsrc/mk/defaults/mk.conf</code>をご覧ください。</p>
<p>最後に警告: 標準でない<code class="varname">LOCALBASE</code>
    の設定をしたシステムの場合は、
    各パッケージのインストール前にこれらを設定するようにしてください。複数のディ
    レクトリーを同じ目的用に分散して使うことはできないからです。そのようなこと
    をすると、pkgsrcはインストール済みのパッケージを正しく検出することができず、
    無惨に失敗することになるでしょう。また、コンパイル済バイナリーパッケージは、
    通常はデフォルトの<code class="varname">LOCALBASE</code>である
    <code class="filename">/usr/pkg</code>を使って構築されているので、標準で
    ない<code class="varname">LOCALBASE</code>を使っている場合は、とにかくコンパイル済バイナリーパッケージを
    インストールしては<span class="emphasis"><em>いけません</em></span>。</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter 5. pkgsrc を設定する">
<div class="titlepage"><div><div><h2 class="title">
<a name="configuring"></a>Chapter 5. pkgsrc を設定する</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#general-configuration">5.1. 全般的な設定</a></span></dt>
<dt><span class="sect1"><a href="#variables-affecting-build">5.2. 構築の過程に影響を及ぼす変数</a></span></dt>
<dt><span class="sect1"><a href="#variables-affecting-installation">5.3. インストール過程に影響をおよぼす変数</a></span></dt>
<dt><span class="sect1"><a href="#conf.compiler">5.4. コンパイラーの選択と設定</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#selecting-the-compiler">5.4.1. コンパイラーを選ぶ</a></span></dt>
<dt><span class="sect2"><a href="#conf.cflags">5.4.2. コンパイラーへのフラグの追加 (<code class="varname">CFLAGS</code>)</a></span></dt>
<dt><span class="sect2"><a href="#conf.ldflags">5.4.3. リンカーへのフラグの追加 (<code class="varname">LDFLAGS</code>)</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#developer-advanced-settings">5.5. 開発者および上級者向けの設定</a></span></dt>
<dt><span class="sect1"><a href="#selecting-build-options">5.6. 構築オプションの選択</a></span></dt>
</dl>
</div>
<a name="mk.conf"></a><p>pkgsrc システム全体の設定は、ひとつのファイル (通常は
<code class="filename">mk.conf</code>) でおこなわれます。pkgsrc
がこのファイルをどのディレクトリーから探すかは、
インストールの時に決まります。NetBSD で、ベースシステムの
<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> を使う場合は、<code class="filename">/etc/</code>
ディレクトリーとなります。これ以外の場合はすべて、
<code class="literal">${PREFIX}/etc/</code> が標準の場所となり、これは
bootstrap プログラムに指示したバイナリーパッケージのインストール先に依存します。</p>
<p>bootstrap の実行中に、設定ファイルの例が作成されます。
このファイルを使うには、
<code class="filename">${PREFIX}/etc</code> ディレクトリーを作って、
その中にこのファイルをコピーする必要があります。</p>
<p>この設定ファイルの書式は、通常の BSD 形式の
<code class="filename">Makefile</code> の書式です。pkgsrc 全体の設定は、
このファイルで変数を設定することでおこなわれます。なお、
ここではあらゆる種類の変数を定義することができ、また、
特別なエラーの検査 (たとえば、綴りの誤り) はおこなわれないので、
設定が有効かどうか調べるには、
いろいろ試す必要があるということに注意してください。</p>
<div class="sect1" title="5.1. 全般的な設定">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="general-configuration"></a>5.1. 全般的な設定</h2></div></div></div>
<p>本節では、pkgsrc の全パッケージに影響する変数をいくつか掲げます。
    ユーザーが設定可能な変数の完全な一覧は、
    <code class="filename">mk/defaults/mk.conf</code> にあり、
    各変数の目的もコメントで説明されています。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">LOCALBASE</code>:
	    パッケージをどこにインストールするか。標準では
	    <code class="filename">/usr/pkg</code> になります。異なる <code class="varname">LOCALBASE</code>
	    をもつバイナリーパッケージを混在させないでください。</p></li>
<li class="listitem"><p><code class="varname">CROSSBASE</code>:
	    <span class="quote">“<span class="quote">cross</span>”</span> カテゴリーのパッケージをどこにインストールするか。
	    標準では
	    <code class="filename">${LOCALBASE}/cross</code> になります。</p></li>
<li class="listitem"><p><code class="varname">X11BASE</code>:
	    当該システムで X11 がどこにインストールされているか。標準では
	    <code class="filename">/usr/X11R6</code> になります。</p></li>
<li class="listitem"><p><code class="varname">DISTDIR</code>: pkgsrc のパッケージ構築用にダウンロードしたままの状態の
	    ソース配布物をどこに置くか。標準では
	    <code class="filename">${PKGSRCDIR}/distfiles</code> になります。</p></li>
<li class="listitem"><p><code class="varname">PKG_DBDIR</code>: インストールされたパッケージに関する
	    データベースをどこに置くか。標準では
	    <code class="filename">/var/db/pkg</code> になります。</p></li>
<li class="listitem"><p><code class="varname">MASTER_SITE_OVERRIDE</code>:
	    設定した場合、その値でパッケージの
	    <code class="varname">MASTER_SITES</code> が上書きされます。</p></li>
<li class="listitem"><p><code class="varname">MASTER_SITE_BACKUP</code>:
	    配布ファイルおよびパッチファイルが、ローカルにも、
	    <code class="filename">${MASTER_SITES}</code> や
	    <code class="filename">${PATCH_SITES}</code> にもなかった場合のための予備の場所 (複数可)。
	    標準では
	    <code class="filename">ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/${DIST_SUBDIR}/</code>
	    と
	    <code class="filename">ftp://ftp.freebsd.org/pub/FreeBSD/distfiles/${DIST_SUBDIR}/</code> になります。</p></li>
<li class="listitem"><p><code class="varname">BINPKG_SITES</code>:
	    バイナリーパッケージの配布サイトのリストです。<em class="replaceable"><code>rel</code></em> および
	    <em class="replaceable"><code>arch</code></em> は、それぞれ OS
	    リリース (<span class="quote">“<span class="quote">2.0</span>”</span> など) およびアーキテクチャー
	    (<span class="quote">“<span class="quote">mipsel</span>”</span> など) で置き換えられます。</p></li>
<li class="listitem"><p><code class="varname">ACCEPTABLE_LICENSES</code>:
	    受け入れ可能なライセンスのリストです。ライセンス名は、大文字・小文字を区別します。
	    このリストにないライセンスが適用されるパッケージを構築しようとするたびに、
	    エラーメッセージが表示されます。
	    簡便な変更でライセンスを受け入れるようにできる場合は、
	    エラーメッセージでこの値の変更方法の説明も表示されます。</p></li>
</ul></div>
</div>
<div class="sect1" title="5.2. 構築の過程に影響を及ぼす変数">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="variables-affecting-build"></a>5.2. 構築の過程に影響を及ぼす変数</h2></div></div></div>
<p>XXX
      </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PACKAGES</code>: バイナリーパッケージ用のディレクトリーの最上層。
	    標準では
	    <code class="filename">${PKGSRCDIR}/packages</code> になります。</p></li>
<li class="listitem"><p><code class="varname">WRKOBJDIR</code>:
	    設定した場合、この値を最上層として、
	    別に分離された作業ディレクトリーが作られて
	    <code class="filename">${WRKDIR}</code> (前述) からシンボリックリンクされます。
	    これは、複数のアーキテクチャー用のパッケージを構築する際に便利です。
	    さらに、<code class="filename">${PKGSRCDIR}</code> を NFS マウントして、
	    <code class="filename">${WRKOBJDIR}</code>
	    は各アーキテクチャーのローカルに置くということができます。(なお、
	    <code class="varname">PKGSRCDIR</code>
	    は利用者が設定するようなものではないことを断っておきます
	    &mdash;これは pkgsrc ツリーのルートを参照する内部的な定義です。
	    ここでいう pkgsrc ツリーは、多くの文脈がありえます。)</p></li>
<li class="listitem"><p><code class="varname">LOCALPATCHES</code>:
	    pkgsrc に含まれていないローカルなパッチ用のディレクトリーです。
	    さらなる情報は、<a class="xref" href="#components.patches" title="11.3. patches/*">Section 11.3, “patches/*”</a>
	    をご覧ください。</p></li>
<li class="listitem"><p><code class="varname">PKGMAKECONF</code>: パッケージの
	    BSD 形式の Makefile が使用する <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
	    ファイルの場所です。この変数が設定されていない場合は、
	    <code class="filename">/usr/src</code> 以下の構築用の設定を見ることのないようにするために、
	    <code class="varname">MAKECONF</code> が
	    <code class="filename">/dev/null</code> に設定されます。</p></li>
<li class="listitem"><p><code class="varname">DEPENDS_TARGET</code>:
	    標準では、依存するパッケージはインストールされるだけで、
	    バイナリーパッケージの作成まではおこなわれません。
	    この変数を <code class="literal">package</code> に設定して、
	    依存パッケージのインストール後にバイナリーパッケージを自動的に作成することができます。</p></li>
</ul></div>
</div>
<div class="sect1" title="5.3. インストール過程に影響をおよぼす変数">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="variables-affecting-installation"></a>5.3. インストール過程に影響をおよぼす変数</h2></div></div></div>
<p>ほとんどのパッケージは、<code class="varname">WRKDIR</code>
    のサブディレクトリーへのインストールに対応しています。そのようにインストールをすれば、
    本番のファイルシステムに手を加えずにパッケージを構築することができます。
    DESTDIR への対応には、以下の二通りの形態があります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>基本的な (basic) DESTDIR 対応。
      パッケージのインストールや、バイナリーパッケージ作成は、
      通常と同じく root で実行します。</p></li>
<li class="listitem"><p>完全な (full) DESTDIR 対応。
      完全な構築、インストール、バイナリーパッケージ作成を、
      通常ユーザー権限でおこなうことができます。root 権限が必要なのは、
      パッケージを追加するときだけです。</p></li>
</ul></div>
<p>現在では、標準状態で DESTDIR へ対応するようになっています。
    <code class="varname">USE_DESTDIR=no</code> を設定すれば
    以前のような DESTDIR を使わない挙動に戻すことができますが、この設定は廃止予定ですので、
    パッケージを DESTDIR 対応にするほうが望ましいでしょう。</p>
<p>DESTDIR への対応によって、各種ターゲットの挙動が少し変わります。
    パッケージを構築してからインストールする場合は、
    <code class="literal">package-install</code> を使ってください。<code class="literal">package</code>
    および <code class="literal">install</code> の各ターゲットは、何もしてくれません。
    <code class="literal">package-install</code> は、
    <code class="varname">DEPENDS_TARGET</code> にすることができます。
    <code class="literal">bin-install</code>
    は、インストール用に root のパスワードを尋ねてきますが、
    その後に失敗し、
    <code class="literal">package-install</code> があらためてパスワードを尋ねてきます。</p>
<p>基本的な DESTDIR 対応を使う場合、<strong class="userinput"><code>make
    clean</code></strong> は root で実行する必要があります。</p>
<p><code class="filename">foo/bar</code> パッケージに対して、
    DESTDIR に完全に対応できているかどうか、以下のコマンドでテストすることができます。

</p>
<pre class="programlisting">
<code class="prompt">$</code> id
uid=1000(myusername) gid=100(users) groups=100(users),0(wheel)
<code class="prompt">$</code> mkdir $HOME/packages
<code class="prompt">$</code> cd $PKGSRCDIR/foo/bar
</pre>
<p>

    <code class="varname">DESTDIR</code> に完全に対応しているか確認します。
    root 権限は必要ないはずです。

</p>
<pre class="programlisting">
<code class="prompt">$</code> make USE_DESTDIR=yes install
</pre>
<p>

    root 権限なしでパッケージを作ってみます。

</p>
<pre class="programlisting">
<code class="prompt">$</code> make USE_DESTDIR=yes PACKAGES=$HOME/packages package
</pre>
<p>

    以下のコマンドでは、
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?su+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> を使って root 権限を得られることが必要です。

</p>
<pre class="programlisting">
<code class="prompt">$</code> make USE_DESTDIR=yes PACKAGES=$HOME/packages package-install
</pre>
<p>

    あとは、通常のユーザーで以下のコマンドを実行します。

</p>
<pre class="programlisting">
<code class="prompt">$</code> make clean
</pre>
<p>

    </p>
</div>
<div class="sect1" title="5.4. コンパイラーの選択と設定">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="conf.compiler"></a>5.4. コンパイラーの選択と設定</h2></div></div></div>
<div class="sect2" title="5.4.1. コンパイラーを選ぶ">
<div class="titlepage"><div><div><h3 class="title">
<a name="selecting-the-compiler"></a>5.4.1. コンパイラーを選ぶ</h3></div></div></div>
<p>pkgsrc は、標準では GCC を使ってパッケージを構築します。
    これは /etc/mk.conf で以下の変数を設定して変えることができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">PKGSRC_COMPILER</code>:</span></dt>
<dd>
<p>パッケージ構築時に使われる一連のコンパイラーを指定する値を並べたものです。
	  以下の値を使うことができます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">distcc</code>:
	    分散 C/C++ コンパイラー (連鎖可能)</p></li>
<li class="listitem"><p><code class="varname">ccache</code>:
	    コンパイラーキャッシュ (連鎖可能)</p></li>
<li class="listitem"><p><code class="varname">gcc</code>:
	    GNU C/C++ コンパイラー</p></li>
<li class="listitem"><p><code class="varname">mipspro</code>:
	    Silicon Graphics, Inc. MIPSpro (n32/n64)</p></li>
<li class="listitem"><p><code class="varname">mipspro</code>:
	    Silicon Graphics, Inc. MIPSpro (o32)</p></li>
<li class="listitem"><p><code class="varname">sunpro</code>:
	    Sun Microsystems, Inc. WorkShip/Forte/Sun ONE Studio</p></li>
</ul></div>
<p>標準では
	  <span class="quote">“<span class="quote"><code class="varname">gcc</code></span>”</span> になります。
	  <code class="varname">PKGSRC_COMPILER</code> の設定には、適切なコンパイラー本体とともに、
	  <code class="varname">ccache</code> と
	  <code class="varname">distcc</code> のいずれかまたは両方を併用することができます。
	  たとえば <span class="quote">“<span class="quote"><code class="varname">ccache gcc</code></span>”</span> のようにします。
	  この変数の設定では、コンパイラー本体を示す値を最後に置くようにします。
	  なお、コンパイラー本体はただ一つだけ掲げるようにします (たとえば、
	  <span class="quote">“<span class="quote"><code class="varname">sunpro gcc</code></span>”</span> などとすることはできません)。</p>
</dd>
<dt><span class="term"><code class="varname">GCC_REQD</code>:</span></dt>
<dd><p>パッケージの構築用として、最低限必要な
	  GCC のバージョンを指定します。システム附属の GCC
	  がこの条件を満たさない場合、pkgsrc はそのかわりに使うため、
	  GCC のパッケージを構築してインストールします。</p></dd>
</dl></div>
</div>
<div class="sect2" title="5.4.2. コンパイラーへのフラグの追加 (CFLAGS)">
<div class="titlepage"><div><div><h3 class="title">
<a name="conf.cflags"></a>5.4.2. コンパイラーへのフラグの追加 (<code class="varname">CFLAGS</code>)</h3></div></div></div>
<p><code class="varname">CFLAGS</code> 変数を設定したい場合は、
	<code class="literal">=</code> 演算子は使わずに、
	かならず <code class="literal">+=</code> 演算子を使ってください。</p>
<pre class="programlisting">
CFLAGS+=        -your -flags
</pre>
<p><code class="varname">CFLAGS=</code> のようにする (つまり、<span class="quote">“<span class="quote">+</span>”</span>を付けない) と、
	独自のフラグを追加する必要があるパッケージで問題を起こすことがあります。
	CPU に特化した最適化に関心がある場合は、
	<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/cpuflags/README.html" target="_top"><code class="filename">devel/cpuflags</code></a>
	パッケージを見ておくとよいでしょう。</p>
</div>
<div class="sect2" title="5.4.3. リンカーへのフラグの追加 (LDFLAGS)">
<div class="titlepage"><div><div><h3 class="title">
<a name="conf.ldflags"></a>5.4.3. リンカーへのフラグの追加 (<code class="varname">LDFLAGS</code>)</h3></div></div></div>
<p>configure および build の各段階において、リンカーにフラグを渡したい場合、
二通りの方法を使うことができます。すなわち、
<code class="varname">LDFLAGS</code> または <code class="varname">LIBS</code> のいずれかを設定します。
両者の違いは、<code class="varname">LIBS</code> はコマンドラインに付け加えられますが、
<code class="varname">LDFLAGS</code> はそれより早く現れます。
<code class="varname">LDFLAGS</code> はあらかじめ読み込まれ、
<code class="varname">USE_IMAKE</code> の設定や
<code class="filename">mk/x11.buildlink3.mk</code> のインクルードの有無に応じた
ELF マシン向けの rpath の設定が追加されます。
<code class="varname">CFLAGS</code> と同様に、この設定を上書きしたいわけでなければ、
<code class="literal">+=</code> 演算子を使います。</p>
<pre class="programlisting">
LDFLAGS+=        -your -linkerflags
</pre>
</div>
</div>
<div class="sect1" title="5.5. 開発者および上級者向けの設定">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="developer-advanced-settings"></a>5.5. 開発者および上級者向けの設定</h2></div></div></div>
<p>XXX
      </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="varname">PKG_DEVELOPER</code>:
	    パッケージ開発者向けに、いくつかの正当性検査を実行します。
	    </p>
<div class="itemizedlist"><ul class="itemizedlist" type="circle">
<li class="listitem"><p>パッチが曖昧さゼロで適用できることを確認する
	      </p></li>
<li class="listitem"><p>check-shlibs を実行して、
	      すべてのバイナリーパッケージが共有ライブラリーを見つけられることを確認する。</p></li>
</ul></div>
<p>
	</p>
</li>
<li class="listitem"><p><code class="varname">PKG_DEBUG_LEVEL</code>:
	パッケージの構築およびインストールの際に表示される、
	デバッグ用出力の水準です。標準の値は 0 です。この場合、コマンドは
	(通常の、標準状態で、静粛な操作で) 実行されるだけで、表示されません。
	値が 1 の場合、すべてのシェルコマンドを実行前に表示します。
	値が 2 の場合、すべてのシェルコマンドを実行前に表示するほか、
	実際に実行される経過を <span class="command"><strong>set
	-x</strong></span> により表示します。</p></li>
</ul></div>
<p>
    </p>
</div>
<div class="sect1" title="5.6. 構築オプションの選択">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="selecting-build-options"></a>5.6. 構築オプションの選択</h2></div></div></div>
<p>パッケージのなかには、構築時にオプションがあるものがあります。
    通常は、数通りの依存性からいずれかを選択、大きな依存性を伴うオプション対応の有効化、
    実験的な機能の有効化などです。</p>
<p>パッケージがどんなオプションに対応しているか (対応している場合)、
    また、どのオプション同士が排他的かを調べるには、<span class="command"><strong>make
    show-options</strong></span> を実行します。結果は、たとえば以下のようになります。</p>
<pre class="programlisting">
    The following options are supported by this package:
        ssl      Enable SSL support.
    Exactly one of the following gecko options is required:
        firefox  Use firefox as gecko rendering engine.
        mozilla  Use mozilla as gecko rendering engine.
    At most one of the following database options may be selected:
        mysql    Enable support for MySQL database.
        pgsql    Enable support for PostgreSQL database.

    These options are enabled by default: firefox
    These options are currently enabled: mozilla ssl
</pre>
<p>以下の変数を <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で定義して、
    パッケージに対してどのオプションを有効にするかを選んでおくことができます:
    <code class="varname">PKG_DEFAULT_OPTIONS</code> は、対応している全パッケージを対象に、
    オプションを選択または無効化するために使うことができます。
    <code class="varname">PKG_OPTIONS.<em class="replaceable"><code>pkgbase</code></em></code>
    は、特定のパッケージ <em class="replaceable"><code>pkgbase</code></em> を対象に、
    オプションを選択または無効化するために使うことができます。
    この両変数で列挙された各変数が選択され、<span class="quote">“<span class="quote">-</span>”</span>
    が先頭についた変数は無効化されます。いくつか例を示します。</p>
<pre class="screen">
<code class="prompt">$</code> <span class="command"><strong>grep "PKG.*OPTION" <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a></strong></span>
PKG_DEFAULT_OPTIONS=    -arts -dvdread -esound
PKG_OPTIONS.kdebase=    debug -sasl
PKG_OPTIONS.apache=     suexec </pre>
<p>ここで重要なことは、
    パッケージのメンテナーがこの方法を使って標準状態のオプションを提示している場合、
    そのオプションを選択したくなければ明示的に削除する必要があるということです。
    よくわからない場合は、<span class="command"><strong>make show-options</strong></span>
    を使ってオプションの設定状況を調べることができます。</p>
<p>以下の各設定は、以下に掲げた順に適用されます。
    このため、あるオプションは、
    それが最後に選択または無効化された設定に従って選択または無効化されます。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>パッケージのメンテナーが提示した、
      標準状態のオプション</p></li>
<li class="listitem"><p>旧式の変数 (後述)
      の設定から導かれるオプション</p></li>
<li class="listitem"><p><code class="varname">PKG_DEFAULT_OPTIONS</code></p></li>
<li class="listitem"><p><code class="varname">PKG_OPTIONS.<em class="replaceable"><code>pkgbase</code></em></code></p></li>
</ol></div>
<p>互いに排他的なオプション群からは、
    最後に選択されたオプションが使われ、それ以外のオプションは自動的に無効化されます。
    オプション群のあるオプションが明示的に無効化された場合は、
    その前に選択されたオプションがあれば、それが使われます。
    必須のオプション群からどのオプションも選択されなかった場合は、
    エラーとなり、パッケージの構築は失敗します。</p>
<p>このオプションの枠組が導入される前は、
    構築オプションは <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
    で各オプションごとの変数 (たいていは
    <code class="varname">USE_<em class="replaceable"><code>FOO</code></em></code> という名前)
    を設定することで選択していました。
    利用者が現在のオプションの枠組に容易に移行できるようにするため、
    このような旧式の変数は、適切なオプションの設定
    (<code class="varname">PKG_OPTIONS.<em class="replaceable"><code>pkgbase</code></em></code>)
    に自動的に変換されます。利用者に対しては、
    <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
    を更新してオプションの枠組を直接使うよう促す警告が表示されます。
    旧式の変数への対応は、いずれ打ち切られる予定です。</p>
</div>
</div>
<div class="chapter" title="Chapter 6. バイナリーパッケージを作る">
<div class="titlepage"><div><div><h2 class="title">
<a name="binary"></a>Chapter 6. バイナリーパッケージを作る</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#building-a-single-binary-package">6.1. 単数のバイナリーパッケージを構築する</a></span></dt>
<dt><span class="sect1"><a href="#settings-for-creationg-of-binary-packages">6.2. バイナリーパッケージ作成用の設定</a></span></dt>
</dl>
</div>
<div class="sect1" title="6.1. 単数のバイナリーパッケージを構築する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="building-a-single-binary-package"></a>6.1. 単数のバイナリーパッケージを構築する</h2></div></div></div>
<p>パッケージを構築しインストールしたら、
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> を使って別のシステムにインストールすることができる<span class="emphasis"><em>バイナリーパッ
    	ケージ</em></span>を作ることができます。
    こうすると、複数のホストで同じパッケージを構築するような、
    CPU時間の無駄をなくすことができます。
    また、あなたのバイナリーパッケージを配布して、
    他の人が簡単にインストールできるようにすることもできます。</p>
<p>バイナリーパッケージを作るには、pkgsrc の適切なディレクトリーへ移動したうえで、
    <span class="command"><strong>make package</strong></span> を実行します。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cd misc/figlet</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make package</code></strong>
    </pre>
<p>これにより、パッケージが構築、インストール(もし、まだ済んでいなけれ
    ば)され、インストールされたパッケージからバイナリーパッケージが構築
    されます。これは<span class="command"><strong>pkg_*</strong></span>ツールを使い操作できます。
    バイナリーパッケージは<code class="filename">/usr/pkgsrc/packages</code>
    以下に、gzipされたtarファイルとして作成されます。
    上記の<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/misc/figlet/README.html" target="_top"><code class="filename">misc/figlet</code></a>の例の続きは、<a class="xref" href="#logs.package" title="B.2. figlet のパッケージング">Section B.2, “figlet のパッケージング”</a>を参照して下さい。</p>
<p>このようなバイナリーパッケージを提出する方法については、このドキュメント
    の後の<a class="xref" href="#submit" title="Chapter 21. 提出およびコミット">Chapter 21, <i>提出およびコミット</i></a>を参照してください。</p>
</div>
<div class="sect1" title="6.2. バイナリーパッケージ作成用の設定">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="settings-for-creationg-of-binary-packages"></a>6.2. バイナリーパッケージ作成用の設定</h2></div></div></div>
<p><a class="xref" href="#build.helpful-targets" title="17.17. 他の役に立つターゲット">Section 17.17, “他の役に立つターゲット”</a>を参照してください。</p>
</div>
</div>
<div class="chapter" title="Chapter 7. pkgsrc のバイナリーパッケージを全部作成する (バルクビルド)">
<div class="titlepage"><div><div><h2 class="title">
<a name="bulk"></a>Chapter 7. pkgsrc のバイナリーパッケージを全部作成する
(バルクビルド)</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#bulk.pre">7.1. まず考察、構築はその後</a></span></dt>
<dt><span class="sect1"><a href="#bulk.req">7.2. バルクビルドに必要なもの</a></span></dt>
<dt><span class="sect1"><a href="#bulk.old">7.3. 旧方式のバルクビルドを実行する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#binary.configuration">7.3.1. 設定</a></span></dt>
<dt><span class="sect2"><a href="#other-environmental-considerations">7.3.2. ほか、環境に関する考察</a></span></dt>
<dt><span class="sect2"><a href="#operation">7.3.3. 操作</a></span></dt>
<dt><span class="sect2"><a href="#what-it-does">7.3.4. 何を実行するのか</a></span></dt>
<dt><span class="sect2"><a href="#disk-space-requirements">7.3.5. 必要なディスク容量</a></span></dt>
<dt><span class="sect2"><a href="#setting-up-a-sandbox">7.3.6. chroot構築用の砂場を用意する</a></span></dt>
<dt><span class="sect2"><a href="#building-a-partial-set">7.3.7. パッケージを部分的に構築する</a></span></dt>
<dt><span class="sect2"><a href="#bulk-upload">7.3.8. バルクビルドの成果をアップロードする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#bulk.pbulk">7.4. pbulk 方式のバルクビルドを実行する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#bulk.pbulk.prepare">7.4.1. 事前準備</a></span></dt>
<dt><span class="sect2"><a href="#bulk.pbulk.conf">7.4.2. 設定</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#creating-cdroms">7.5. CD-ROM複数枚に収めたパッケージコレクションの作成</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#cdpack-example">7.5.1. cdpackの使用例</a></span></dt></dl></dd>
</dl>
</div>
<p>同じパッケージが動くマシンが複数ある場合、
それぞれのマシンでソースからパッケージを構築するのは、時間の無駄です。
バイナリーパッケージ一式を作る方法が二通りあります。
古いバルクビルドシステムと、新しい (2007 年からの) 分散バルクビルド
(parallel bulk build, pbulk) システムです。本章では、
構築したパッケージが有用なものにできるよう、
この二通りのバルクビルドの設定方法を説明します。</p>
<div class="sect1" title="7.1. まず考察、構築はその後">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="bulk.pre"></a>7.1. まず考察、構築はその後</h2></div></div></div>
<p>バルクビルドを最後までおこなうには、数日、あるいは数週間かかることもあります。
このため、始める前に、その準備について考えたほうがよいでしょう。
少なくとも、以下の点に注意を払ってください。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p>バイナリーパッケージを
ftp.NetBSD.org にアップロードしたい場合、バイナリーパッケージに関する以下の条件を、
かならず満たすようにします。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="circle">
<li class="listitem"><p>ftp.NetBSD.org に置かれるパッケージは、
NetBSD 開発者が、信頼のおけるマシン (つまり、あなたが root 権限を持っており、かつ、
あなただけが root 権限を持つマシン) で構築したものである必要があります。</p></li>
<li class="listitem"><p>ftp.NetBSD.org には、安定版の枝 (たとえば 2009Q1 など)
から作成されたものだけを置くようにします。これは、利用者が一見しただけで、
置かれているパッケージがどれだけ古いものかわかるようにするためです。</p></li>
<li class="listitem"><p>パッケージは root で構築する必要があります。
パッケージのなかには、実行時に set-uid バイナリーを必要とするものがあり、
今のところ、そのようなパッケージを特権ユーザー以外で作成すると、うまく動作しないからです。</p></li>
</ul></div>
</li>
<li class="listitem"><p>バルクビルドによって、お使いのシステムが壊されることのないようにしてください。
バルクビルドの大半は、root 権限で動くので、少なくとも chroot 環境か、
(お使いのオペレーティングシステムに応じた) 何らかの制限環境で実行するようにします。
個々のパッケージが、ファイルを
<code class="filename">LOCALBASE</code> 以外の場所にインストールしようとしたり、
<code class="filename">/etc</code> にあるファイルを編集しようとしたりする事例が、
いくつもあります。
さらに、バルクビルドでは、その過程において、
<code class="filename">/usr/pkg</code> (あるいは
<code class="filename">LOCALBASE</code> で設定された場所)
にパッケージをインストールしたりアンインストールしたりするので、
構築中は、どのパッケージも必要ない (アンインストールされても困らない)
ようにしておいてください。</p></li>
</ul></div>
</div>
<div class="sect1" title="7.2. バルクビルドに必要なもの">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="bulk.req"></a>7.2. バルクビルドに必要なもの</h2></div></div></div>
<p>完全なバルクビルドには、大量のディスク容量が必要です。
ディスクスペースの一部は読み取り専用でもかまいませんが、
書き込みが必要なものもあります。
ディスクスペースの一部はリモートファイルシステム (NFS など) でもかまいませんが、
ローカルとしたほうがよいものもあります。
ディスクスペースの一部は一時ファイルシステムでもかまいませんが、
突然リブートしても平気な (恒久的な) ファイルシステムが必要なものもあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>10 GB: distfile 用 (要読み書き、リモート可、一時可)</p></li>
<li class="listitem"><p>10 GB: バイナリーパッケージ用 (要読み書き、リモート可、要恒久)</p></li>
<li class="listitem"><p>400 MB: pkgsrc ツリー用 (読み取り専用可、リモート可、要恒久)</p></li>
<li class="listitem"><p>5 GB: <code class="filename">LOCALBASE</code> 用 (要読み書き、ローカル推奨、pbulk では一時可、旧形式では要恒久)</p></li>
<li class="listitem"><p>5 GB: ログファイル用 (要読み書き、リモート可、要恒久ファイルシステム)</p></li>
<li class="listitem"><p>5 GB: 一時ファイル用 (要読み書き、ローカル推奨、一時ファイルシステム可)</p></li>
</ul></div>
</div>
<div class="sect1" title="7.3. 旧方式のバルクビルドを実行する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="bulk.old"></a>7.3. 旧方式のバルクビルドを実行する</h2></div></div></div>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>バルクビルドには、二つの方式があります。
旧方式のバルクビルドと、新方式の <span class="quote">“<span class="quote">pbulk</span>”</span> です。
後者の方式をおすすめします。</p>
</div>
<div class="sect2" title="7.3.1. 設定">
<div class="titlepage"><div><div><h3 class="title">
<a name="binary.configuration"></a>7.3.1. 設定</h3></div></div></div>
<div class="sect3" title="7.3.1.1. build.conf">
<div class="titlepage"><div><div><h4 class="title">
<a name="binary.bulk.build.conf"></a>7.3.1.1. <code class="filename">build.conf</code>
</h4></div></div></div>
<p><code class="filename">build.conf</code> ファイルは、
	バルクビルドの主たる設定ファイルです。pkgsrc ツリーを最新に保つ方法、
	distfile のダウンロード方法、パッケージの構築方法や、
	報告の作成方法を設定することができます。註釈つきの設定例が
	<code class="filename">pkgsrc/mk/bulk/build.conf-example</code> にあります。
	これを使うには、<code class="filename">build.conf-example</code> を
	<code class="filename">build.conf</code> にコピーし、
	このファイル中のコメントに従って編集します。</p>
</div>
<div class="sect3" title="7.3.1.2. mk.conf">
<div class="titlepage"><div><div><h4 class="title">
<a name="binary.mk.conf"></a>7.3.1.2. <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
</h4></div></div></div>
<p><a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で以下の変数を設定するとよいでしょう。デフォルト設定についての詳細
	は<code class="filename">pkgsrc/mk/defaults/mk.conf</code>を見てください。
	<code class="varname">ACCEPTABLE_LICENSES</code>はローカルポリシーに適合するようにしておきます。
	この例では <code class="varname">SKIP_LICENSE_CHECK=yes</code> としており、
	ライセンスの検査を一切おこないません。</p>
<pre class="programlisting">
PACKAGES?=      ${_PKGSRCDIR}/packages/${MACHINE_ARCH}
WRKOBJDIR?=     /usr/tmp/pkgsrc   # build here instead of in pkgsrc
BSDSRCDIR=      /usr/src
BSDXSRCDIR=     /usr/xsrc         # for x11/xservers
OBJHOSTNAME?=   yes               # use work.`hostname`
FAILOVER_FETCH= yes               # insist on the correct checksum
PKG_DEVELOPER?= yes
SKIP_LICENSE_CHECK=    yes
</pre>
<p>バルクビルド用として、特に有用なオプションが、
	<code class="filename">mk/bulk/bsd.bulk-pkg.mk</code>
	の冒頭にいくつかあります。そのなかでも最も有用な部類のものを、
	ここで簡単に説明します。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>遅いマシンを使っている場合は、
	  <code class="varname">USE_BULK_BROKEN_CHECK</code> を
	  <span class="quote">“<span class="quote">no</span>”</span> に設定するとよいでしょう。</p></li>
<li class="listitem"><p>読み出し専用の pkgsrc ツリーを使ってバルクビルドをする場合は、
	  ログファイルが作られるディレクトリーとして <code class="varname">BULKFILESDIR</code>
	  を設定する必要があります。そうしないと、
	  pkgsrc ディレクトリー内にログファイルが作られます。</p></li>
<li class="listitem"><p>このほか、重要な変数として
	  <code class="varname">BULK_PREREQ</code> があります。
	  これは、他のパッケージを構築する際には常に使える状態になっているべきパッケージを
	  並べたリストです。</p></li>
</ul></div>
<p>その他、いくつかのオプションが、
	pkgsrc の基盤内に散在しています。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">ALLOW_VULNERABLE_PACKAGES</code>
	  は <code class="literal">yes</code> に設定するようにします。
	  バルクビルドの目的はバイナリーパッケージを作ることであり、
	  脆弱性の有無は重要ではありません。
	  この変数を設定しておかないと、バルクビルドにおいて、
	  脆弱性のあるパッケージを構築しようとしなくなるため、
	  構築でエラーがあっても検出できなくなってしまいます。</p></li>
<li class="listitem"><p><code class="varname">CHECK_FILES</code>
	  (<code class="filename">pkgsrc/mk/check/check-files.mk</code>) を
	  <span class="quote">“<span class="quote">yes</span>”</span> に設定すると、インストールされた一連のファイルが
	  <code class="filename">PLIST</code> と一致することを確認することができます。</p></li>
<li class="listitem"><p><code class="varname">CHECK_INTERPRETER</code>
	  (<code class="filename">pkgsrc/mk/check/check-interpreter.mk</code>) を
	  <span class="quote">“<span class="quote">yes</span>”</span> に設定すると、インストールされた
	  <span class="quote">“<span class="quote">#!</span>”</span> で始まるスクリプトが、
	  指定されたインタープリターを見つけられることを確認することができます。</p></li>
<li class="listitem"><p><code class="varname">PKGSRC_RUN_TEST</code> を
	  <span class="quote">“<span class="quote"><code class="literal">yes</code></span>”</span> に設定して、
	  各パッケージのインストール前に自己診断を実行することができます。
	  なお、パッケージのなかには<span class="quote">“<span class="quote">良質の</span>”</span>乱数を大量に使うものがあるので、
	  バルクビルドを実行しているマシンが、
	  完全なアイドル状態にはならないようにする必要があります。
	  さもないと、一部の診断プログラムが、
	  新しい乱数データが使えるようになるのを待つ間、
	  ハングしているかのように見えるようになります。</p></li>
</ul></div>
</div>
<div class="sect3" title="7.3.1.3. pre-build.local">
<div class="titlepage"><div><div><h4 class="title">
<a name="pre-build.local"></a>7.3.1.3. <code class="filename">pre-build.local</code>
</h4></div></div></div>
<p>バルクビルドでは、ビルド前の段階の最後に、サイト独自の作業を行なうよう設定
	することができます。<code class="filename">/usr/pkgsrc/mk/bulk</code>に
	<code class="filename">pre-build.local</code>ファイルがあると、ビ
	ルド前の段階の最後に、このファイルが(<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?sh+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a>スクリプトとして)実行されます。
	<code class="filename">pre-build.local</code>の使い方の例としては、このファイルに</p>
<pre class="screen">echo "I do not have enough disk space to build this pig." \
	&gt; misc/openoffice/$BROKENF</pre>
<p>のような内容を書いておいて、3 GB近くのディスク容量が必要な個々のパッケージ
	の構築をしないようにする、というものがあります。</p>
</div>
</div>
<div class="sect2" title="7.3.2. ほか、環境に関する考察">
<div class="titlepage"><div><div><h3 class="title">
<a name="other-environmental-considerations"></a>7.3.2. ほか、環境に関する考察</h3></div></div></div>
<p><code class="filename">/usr/pkg</code>はバルクビルド開始時に完全に削除されるので、ログインシェルが別の場
      所にあることを確認してください。ログインシェルを<code class="filename">/usr/local/bin</code>に移して(それ
      に合わせて passwd ファイルも修正して)おくか、<code class="filename">/etc/rc.local</code>で<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>を使っ
      て(再)インストールするようにしておきます。これでリブート後もログインできま
      す(パッケージが削除されてもシェルのプロセスは死なず、シェルを新たに起動でき
      なくなるだけです)。また、1.5より前のNetBSDを使っていたり、何らかの
      理由でpkgsrc版のsshを使いたい場合は、<code class="filename">rc.local</code>でsshdが起動する前にsshをイン
      ストールするようにしておきます:</p>
<pre class="programlisting">
(cd /usr/pkgsrc/security/ssh &amp;&amp; make bulk-install)
if [ -f /usr/pkg/etc/rc.d/sshd ]; then
  /usr/pkg/etc/rc.d/sshd
fi
</pre>
<p>こうしておかないと、バルクビルド終了後や、あるいはマシンがリブートやクラッ
      シュした場合にsshでログインできなくなります。警告しておきましたよ! :)</p>
</div>
<div class="sect2" title="7.3.3. 操作">
<div class="titlepage"><div><div><h3 class="title">
<a name="operation"></a>7.3.3. 操作</h3></div></div></div>
<p>すでにインストールされているどのパッケージも必要ない状態にしてください。</p>
<div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Warning</h3>
<p>バルクビルドの過程で、<span class="emphasis"><em>すべてのパッケージ、
	設定ファイルと、さらに、
	<code class="filename">/var</code>, <code class="filename">/home</code>
	その他の場所にあるファイルがいくつか削除されます。
	なので、システムに悪影響を与えるおそれのある権限で、
	バルクビルドを実行しないでください。</em></span></p>
</div>
<p>その他、
      構築の妨げになりうるもの(<code class="filename">/usr/local</code>にインストールされているライブラリーなど)
      もすべて削除しておいてください。root になって、以下のようにタイプします:</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/pkgsrc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh mk/bulk/build</code></strong>
      </pre>
<p>何らかの理由で前回の構築が完了していない場合(電源断、システムパニックなど)
      は、以下を実行すると、その続きをすることができます:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>sh mk/bulk/build restart</code></strong></pre>
<p>バルクビルドが終わると、その要約がメールで届きます。また、<code class="filename">build.conf</code>
      ファイルの<code class="varname">FTP</code>で指定したディレクトリーに、構築ログがあります。</p>
</div>
<div class="sect2" title="7.3.4. 何を実行するのか">
<div class="titlepage"><div><div><h3 class="title">
<a name="what-it-does"></a>7.3.4. 何を実行するのか</h3></div></div></div>
<p>バルクビルドは三つの段階からなります:</p>
<div class="variablelist"><dl>
<dt><span class="term">1. ビルド前</span></dt>
<dd><p>スクリプトがpkgsrcツリーを(anon)cvsで更新します。そして、壊れている
	    distfileをすべて一掃し、インストールされているパッケージをすべて削
	    除します。</p></dd>
<dt><span class="term">2. バルクビルド</span></dt>
<dd><p>これは基本的に、
	    <span class="quote">“<span class="quote">make bulk-package</span>”</span>を、パッケージの構築順
	    序を最適化しておこなうものです。他のパッケージに依存しないパッケー
	    ジが最初に構築され、多くの依存関係を持つパッケージは後に構築されま
	    す。</p></dd>
<dt><span class="term">3. ビルド後</span></dt>
<dd><p>報告を作成し、<code class="filename">build.conf</code>で指定されたディレクトリーに
	    <code class="filename">broken.html</code> という名前で置きます。あわせて、この報告の簡略版が
	    構築管理者にメールで送られます。</p></dd>
</dl></div>
<p>構築中、壊れているパッケージの一覧が<code class="filename">/usr/pkgsrc/.broken</code>
      (<code class="varname">OBJMACHINE</code>
      が設定されている場合は
      <code class="filename">.../.broken.${MACHINE}</code>)
      に作られ、構築が壊れているものの個々の
      構築ログは、各パッケージのディレクトリーに置かれます。これらのファイルは、
      壊れているパッケージを再度構築しようとするような無駄をなくすために、bulk-ター
      ゲットが構築が壊れていることを記録するのに使われます。また、壊れているパッ
      ケージを後でデバッグするためにも使えます。</p>
</div>
<div class="sect2" title="7.3.5. 必要なディスク容量">
<div class="titlepage"><div><div><h3 class="title">
<a name="disk-space-requirements"></a>7.3.5. 必要なディスク容量</h3></div></div></div>
<p>現在、
      NetBSD 2.0/i386 ではおおむね以下の容量が必要です:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>10 GB - distfile (NFSでも可)</p></li>
<li class="listitem"><p>8 GB - 全バイナリー一式 (NFSでも可)</p></li>
<li class="listitem"><p>5 GB - コンパイル用の一時領域 (ローカルディスクを推奨)</p></li>
</ul></div>
<p>各パッケージは、バイナリーパッケージ作成直後にアンインストールされた上、
      ソースも削除されます。このため、莫大なディスク容量は必要ありません。後
      になって、このパッケージがまた必要となった場合は、再度構築することなく
      <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> でインストールされるので、
      無駄な再コンパイルの繰り返しは発生しません。</p>
</div>
<div class="sect2" title="7.3.6. chroot構築用の砂場を用意する">
<div class="titlepage"><div><div><h3 class="title">
<a name="setting-up-a-sandbox"></a>7.3.6. chroot構築用の砂場を用意する</h3></div></div></div>
<p>バルクビルドによってパッケージを全部消される(マシンがパッケージのコンパイル
      以外に無用なものになってしまう)のが嫌な場合は、chroot環境下でパッケージをバ
      ルクビルドすることもできます。</p>
<p>最初にすることは、chrootされた砂場を、
      たとえば<code class="filename">/usr/sandbox</code>に用意することです。
      これは null マウントを使って、または手動でおこなうことができます。</p>
<p><code class="filename">pkgsrc/mk/bulk/mksandbox</code> というシェルスクリプトがあり、
      null マウントを使った砂場の環境を用意してくれます。このスクリプトは、
      砂場の環境のルートに <code class="filename">sandbox</code> というスクリプトも作ります。
      これは、<span class="command"><strong>sandbox mount</strong></span> コマンドで null マウントをした状態にしたり、
      <span class="command"><strong>sandbox umount</strong></span>
      コマンドでアンマウントした状態にしたりすることができるものです。</p>
<p>砂場の環境を手動で用意するには、
      NetBSDのインストール配布物をすべて展開するか、<code class="filename">/usr/src/etc</code>で
      <span class="command"><strong>make distribution DESTDIR=/usr/sandbox</strong></span>を実行した後、以下のものを用意して
      適切に設定された状態にします。</p>
<div class="procedure"><ol class="procedure" type="1">
<li class="step" title="Step 1">
<p>カーネル</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /netbsd /usr/sandbox</code></strong></pre>
</li>
<li class="step" title="Step 2">
<p><code class="filename">/dev/*</code></p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/sandbox/dev ; sh MAKEDEV all</code></strong></pre>
</li>
<li class="step" title="Step 3">
<p><code class="filename">/etc/resolv.conf</code> (<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/security/smtpd/README.html" target="_top"><code class="filename">security/smtpd</code></a>およびメール用):</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/resolv.conf /usr/sandbox/etc</code></strong></pre>
</li>
<li class="step" title="Step 4">
<p>動作する(!)ようなメールの設定 (hostname, sendmail.cf):</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cp /etc/mail/sendmail.cf /usr/sandbox/etc/mail</code></strong></pre>
</li>
<li class="step" title="Step 5">
<p><code class="filename">/etc/localtime</code> (<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/security/smtpd/README.html" target="_top"><code class="filename">security/smtpd</code></a>用):</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -sf /usr/share/zoneinfo/UTC /usr/sandbox/etc/localtime</code></strong></pre>
</li>
<li class="step" title="Step 6">
<p><code class="filename">/usr/src</code> (たとえば
	  <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/sysutils/aperture/README.html" target="_top"><code class="filename">sysutils/aperture</code></a> 用のシステムソース):</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>ln -s ../disk1/cvs .</code></strong>
	  <code class="prompt">#</code> <strong class="userinput"><code>ln -s cvs/src-2.0 src</code></strong></pre>
</li>
<li class="step" title="Step 7">
<p><code class="filename">/var/db/pkg</code>を作成する(デフォルトのインストールには含まれません):</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/sandbox/var/db/pkg</code></strong></pre>
</li>
<li class="step" title="Step 8">
<p><code class="filename">/usr/pkg</code>を作成する(デフォルトのインストールには含まれません):</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>mkdir /usr/sandbox/usr/pkg</code></strong></pre>
</li>
<li class="step" title="Step 9">
<p>cvs を使って、<code class="filename">/usr/sandbox/usr/pkgsrc</code>
	  内にpkgsrcをチェックアウトする:</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/sandbox/usr</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cvs -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout -d -P pkgsrc</code></strong>
	  </pre>
<p>この pkgsrc ツリーを、開発用の pkgsrc ツリーにマウントしたりリンクしたりしてはいけません。
	  そういうことをすると問題を起こしがちだからです。</p>
</li>
<li class="step" title="Step 10"><p><code class="filename">/usr/sandbox/usr/pkgsrc/packages</code> と
	  <code class="filename">.../distfiles</code> が、適切な場所を指すようにする。
	  これらは NFS や nullfs でマウントしておくと便利かもしれません。</p></li>
<li class="step" title="Step 11"><p><a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> を編集する。<a class="xref" href="#binary.mk.conf" title="7.3.1.2. mk.conf">Section 7.3.1.2, “<code class="filename">mk.conf</code>”</a>参照。</p></li>
<li class="step" title="Step 12"><p><code class="filename">mk/bulk/build.conf</code>を必要に合わせて調整する。</p></li>
</ol></div>
<p>chroot砂場の用意ができれば、
      以下の手順で構築を開始できます:</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/sandbox/usr/pkgsrc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh mk/bulk/do-sandbox-build</code></strong>
      </pre>
<p>このコマンドは、砂場内に移動して、構築を開始するものです。構築が終わ
	ると、構築の結果がメールで送信されます。できあがったバイナリーパッケージは、
      <code class="filename">/usr/sandbox/usr/pkgsrc/packages</code> (の指す/マウントされた先/元)に置かれます。</p>
</div>
<div class="sect2" title="7.3.7. パッケージを部分的に構築する">
<div class="titlepage"><div><div><h3 class="title">
<a name="building-a-partial-set"></a>7.3.7. パッケージを部分的に構築する</h3></div></div></div>
<p><code class="filename">pkgsrc/mk/bulk/build</code> スクリプトは、
      pkgsrc の全パッケージの一式の構築のほか、
      pkgsrc に含まれるパッケージの部分集合の構築にも使うことができます。
      <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で <code class="varname">SPECIFIC_PKGS</code>
      を定義すると、</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>SITE_SPECIFIC_PKGS</p></li>
<li class="listitem"><p>HOST_SPECIFIC_PKGS</p></li>
<li class="listitem"><p>GROUP_SPECIFIC_PKGS</p></li>
<li class="listitem"><p>USER_SPECIFIC_PKGS</p></li>
</ul></div>
<p>の各変数で構築対象のパッケージを定義できるようになります。
      構築対象として定義されたパッケージの依存関係によって必要となるパッケージも、
      バルクビルドのコードが構築対象に追加します。</p>
<p>この使い方のひとつに、
      サイトで必要なバイナリーパッケージをすべて用意するために、
      <code class="varname">SPECIFIC_PKGS</code> を使ったバルクビルドを
      chroot 環境で定期的に実行するというものがあります。
      こうすれば、不要なパッケージまで構築するような余計な負荷はかかりません。</p>
</div>
<div class="sect2" title="7.3.8. バルクビルドの成果をアップロードする">
<div class="titlepage"><div><div><h3 class="title">
<a name="bulk-upload"></a>7.3.8. バルクビルドの成果をアップロードする</h3></div></div></div>
<p>本節では、pkgsrc 開発者がバルクビルドで構築したバイナリーパッケージを
      ftp.NetBSD.org へアップロードする方法を説明します。</p>
<p>アップロードしようとしているバイナリーパッケージの
      チェックサムファイルを自動生成したい場合は、
      <code class="filename">mk/bulk/build.conf</code> で
      <code class="varname">MKSUMS=yes</code> を忘れずに設定してください。</p>
<p>チェックサムファイルに PGP 署名をしたい場合
      (そうすることを強くおすすめします)は、
      <code class="filename">mk/bulk/build.conf</code> で
      <code class="varname">SIGN_AS=username@NetBSD.org</code> を忘れずに設定してください。
      こうしておくと、ファイルをアップロードする前には常に、そのファイルに署名するため、
      GPG パスワードの入力を促すようになります。</p>
<p>次に、<code class="filename">mk/bulk/build.conf</code> ファイルで
      <code class="varname">RSYNC_DST</code> が適切に設定された状態にします。
      つまり、この変数値を以下のような形式に調節します。</p>
<pre class="screen">RSYNC_DST=ftp.NetBSD.org:/pub/pkgsrc/packages/NetBSD/arch/a.b.c-20xxQy/upload</pre>
<p>このなかの "20xxQy" (枝),
      "a.b.c" (OS のバージョン), "arch" を、適切な値にしてください。
      ftp.NetBSD.org でのログイン名がローカルのログイン名と異なる場合は、
      そのログイン名を直接指定します。たとえば、
      筆者のローカルアカウントは "feyrer" ですが、ログイン名は "hubertf" なので、以下のようにします。</p>
<pre class="screen">RSYNC_DST=hubertf@ftp.NetBSD.org:/pub/pkgsrc/packages/NetBSD/arch/a.b.c-20xxQy/upload</pre>
<p>ここでは、アップロードの最中はディレクトリーを公開しないようにするため、
      独立した <code class="filename">upload</code> ディレクトリーにアップロードします。
      そうするために、ftp.NetBSD.org で以下のコマンドを実行しておきます。</p>
<pre class="screen">nbftp% <strong class="userinput"><code>mkdir -p -m 750 /pub/pkgsrc/packages/NetBSD/arch/a.b.c-20xxQy/upload</code></strong></pre>
<p>バイナリーパッケージをアップロードする前に、以下のような
      ssh の認証が必要となります。以下の例は、<span class="emphasis"><em>砂場内における</em></span>
      root アカウント用の一時的な鍵を使うようにする方法です。
      (同じ鍵を常時使うことはしないものとします)。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>chroot /usr/sandbox</code></strong>
chroot-<code class="prompt">#</code> <strong class="userinput"><code>rm $HOME/.ssh/id-dsa*</code></strong>
chroot-<code class="prompt">#</code> <strong class="userinput"><code>ssh-keygen -t rsa</code></strong>
chroot-<code class="prompt">#</code> <strong class="userinput"><code>cat $HOME/.ssh/id-rsa.pub</code></strong>
      </pre>
<p>ここで出力した <code class="filename">id-rsa.pub</code> の内容を、
      ftp.NetBSD.org の <code class="filename">~/.ssh/authorized_keys</code>
      ファイルに追加します。パッケージのアップロードが終わったら、
      この鍵は削除してください。</p>
<p>次に、ssh でうまく接続できることを確認します。</p>
<pre class="screen">chroot-<code class="prompt">#</code> <strong class="userinput"><code>ssh ftp.NetBSD.org date</code></strong> </pre>
<p>ここでは、適宜 "-l yourNetBSDlogin" を使ってください。</p>
<p>すべて順調にいけば、
      砂場から抜けて、アップロードを始めることができます。</p>
<pre class="screen">
chroot-<code class="prompt">#</code> <strong class="userinput"><code>exit</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd /usr/sandbox/usr/pkgsrc</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>sh mk/bulk/do-sandbox-upload</code></strong>
      </pre>
<p>アップロードにはそれなりに時間がかかるかもしれません。
      FTP サーバーで <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?ls+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">ls</span>(1)</span></a> や <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?du+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">du</span>(1)</span></a> して、アップロードの過程を見てください。
      アップロード用スクリプトは、制限つきのパッケージはアップロードしないように
      処理してくれます。</p>
<p>アップロードが終わった後に、最初にすることは、ssh でアクセスして以下のようにすることです。</p>
<pre class="screen">nbftp% <strong class="userinput"><code>vi ~/.ssh/authorized_keys</code></strong>
      Gdd:x! </pre>
<p>アップロード用に事前に追加しておいた鍵はすべて削除してください。
      最後に、アップロードしたパッケージを
      <code class="filename">upload</code> ディレクトリーの外に出して、
      公開された状態にします。</p>
<pre class="screen">
nbftp% <strong class="userinput"><code>cd /pub/pkgsrc/packages/NetBSD/arch/a.b.c-20xxQy</code></strong>
nbftp% <strong class="userinput"><code>mv upload/* .</code></strong>
nbftp% <strong class="userinput"><code>rmdir upload</code></strong>
nbftp% <strong class="userinput"><code>chgrp -R netbsd .</code></strong>
nbftp% <strong class="userinput"><code>find . -type d | xargs chmod 775</code></strong>
      </pre>
</div>
</div>
<div class="sect1" title="7.4. pbulk 方式のバルクビルドを実行する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="bulk.pbulk"></a>7.4. pbulk 方式のバルクビルドを実行する</h2></div></div></div>
<p>pbulk 方式のバルクビルドの実行の概要は、以下のとおりです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>最初に、まっさらな pkgsrc ツリー内で pbulk 基盤を構築する。</p></li>
<li class="listitem"><p>次に、この pbulk 基盤を使って、まっさらの pkgsrc ディレクトリーから個々のパッケージを構築する。</p></li>
</ul></div>
<div class="sect2" title="7.4.1. 事前準備">
<div class="titlepage"><div><div><h3 class="title">
<a name="bulk.pbulk.prepare"></a>7.4.1. 事前準備</h3></div></div></div>
<p>最初に、pbulk 基盤を作るための pkgsrc 基盤を作る必要があります。プラットフォームが何であっても (NetBSD であっても)、専用のディレクトリーを用意してそこに対して bootstrap をしてください。このディレクトリーは <code class="filename">/usr/pbulk</code> または <code class="filename">$HOME/pbulk</code> としましょう。bootstrap すると、バルクビルドに必要なツールがインストールされます。</p>
<pre class="screen">
$ <strong class="userinput"><code>cd /usr/pkgsrc</code></strong>
$ <strong class="userinput"><code>./bootstrap/bootstrap --prefix=/usr/pbulk --varbase=/usr/pbulk/var --workdir=/tmp/pbulk-bootstrap</code></strong>
$ <strong class="userinput"><code>rm -rf /tmp/pbulk-bootstrap</code></strong>
</pre>
<p>これで、pbulk 基盤のための基本的な環境がインストールされましたが、いくつかのツールはまだありません。ここで、pkgsrc の設定ファイル <code class="filename">/usr/pbulk/etc/mk.conf</code> を pbulk 向けに編集しましょう。ここでの典型的な設定内容は以下のとおりです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="literal"><code class="varname">PKG_DEVELOPER</code>=yes</code>, より多くの整合性確認をするため</p></li>
<li class="listitem"><p><code class="literal"><code class="varname">WRKOBJDIR</code>=/tmp/pbulk-outer</code>, <code class="filename">/usr/pkgsrc</code> にいかなる変更も加わらないようにするため</p></li>
<li class="listitem"><p><code class="literal"><code class="varname">DISTDIR</code>=/distfiles</code>, ダウンロードされた distfile (pbluk 基盤および構築するパッケージ用) を、すべて、ただひとつのデイレクトリーに置くようにするため</p></li>
<li class="listitem"><p><code class="literal"><code class="varname">ACCEPTABLE_LICENSES</code>+=...</code>, 普及しているフリー/オープンソースライセンスのうち許容できるものを追加するため</p></li>
<li class="listitem"><p><code class="literal"><code class="varname">SKIP_LICENSE_CHECK</code>=yes</code>, ライセンスの検査を省略するため</p></li>
</ul></div>
<p>これで、pbulk 基盤の残りの部分を構築する準備ができました。</p>
<pre class="screen">
$ <strong class="userinput"><code>cd pkgtools/pbulk</code></strong>
$ <strong class="userinput"><code>/usr/pbulk/bin/bmake install</code></strong>
$ <strong class="userinput"><code>rm -rf /tmp/pbulk-outer</code></strong>
</pre>
<p>これで、pbulk 基盤が構築・インストールされました。この基盤を設定したうえで、さらなる準備が必要です。そうした後に、実際のバルクビルドを始めることができるようになります。</p>
</div>
<div class="sect2" title="7.4.2. 設定">
<div class="titlepage"><div><div><h3 class="title">
<a name="bulk.pbulk.conf"></a>7.4.2. 設定</h3></div></div></div>
<p>TODO; さらなる情報は pkgsrc/doc/HOWTO-pbulk をご覧ください。</p>
<p>TODO: つづきを書く</p>
</div>
</div>
<div class="sect1" title="7.5. CD-ROM複数枚に収めたパッケージコレクションの作成">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="creating-cdroms"></a>7.5. CD-ROM複数枚に収めたパッケージコレクションの作成</h2></div></div></div>
<p>pkgsrcのバルクビルド完了後、できあがったバイナリーパッケージからCD-ROMを作っ
    て、他のマシンへのインストール用に使うことができます。
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/cdpack/README.html" target="_top"><code class="filename">pkgtools/cdpack</code></a>パッケージに、そのようなISO 9660イメージ作成用の簡単
    なツールがあります。<span class="command"><strong>cdpack</strong></span>は、依存関係が一枚のCD内で完結するように、パッ
    ケージを複数枚のCD-ROMに編集してくれます。</p>
<div class="sect2" title="7.5.1. cdpackの使用例">
<div class="titlepage"><div><div><h3 class="title">
<a name="cdpack-example"></a>7.5.1. cdpackの使用例</h3></div></div></div>
<p>cdpackの完全なドキュメンテーションはcdpack(1)マニュアルページにあります。
      以下の短い例では、
      バイナリーパッケージが<code class="filename">/usr/pkgsrc/packages/All</code>に置いてあり、ISO 9660イメー
      ジ用の十分なディスク容量が<code class="filename">/u2</code>にあるものとします。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /u2/images</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>pkg_add /usr/pkgsrc/packages/All/cdpack</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cdpack /usr/pkgsrc/packages/All /u2/images</code></strong>
      </pre>
<p>各CDに共通ファイル(<code class="filename">COPYRIGHT</code>, <code class="filename">README</code>, など)を含めたい場合は、そのファイルを
      含むディレクトリーを作る必要があります。たとえば以下のようにします。</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /tmp/common</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "This is a README" &gt; /tmp/common/README</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "Another file" &gt; /tmp/common/COPYING</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir /tmp/common/bin</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "#!/bin/sh" &gt; /tmp/common/bin/myscript</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>echo "echo Hello world" &gt;&gt; /tmp/common/bin/myscript</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>chmod 755 /tmp/common/bin/myscript</code></strong>
      </pre>
<p>ここで、以下のようにしてイメージを作成します。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cdpack -x /tmp/common /usr/pkgsrc/packages/All /u2/images</code></strong></pre>
<p>こうすると、各イメージのルートディレクトリーに<code class="filename">README</code>, <code class="filename">COPYING</code>および
      <code class="filename">bin/myscript</code>が含まれるようになります。</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter 8. インストールされたファイルのディレクトリー配置">
<div class="titlepage"><div><div><h2 class="title">
<a name="files"></a>Chapter 8. インストールされたファイルのディレクトリー配置</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#files.localbase">8.1. <code class="literal">${LOCALBASE}</code> 以下のファイルシステム配置</a></span></dt>
<dt><span class="sect1"><a href="#files.varbase">8.2. <code class="literal">${VARBASE}</code> 以下のファイルシステム配置</a></span></dt>
</dl>
</div>
<p>pkgsrc を使ってインストールされたファイルは、ベースシステムの
<code class="filename">/usr</code> ディレクトリー以下と似た配置で体系化されていますが、
細かい点がいくらか異なっています。これは、pkgsrc がもともと FreeBSD
から派生したものであり、FreeBSD のファイルシステム階層に準じていたからです。
その後は NetBSD の影響を大きく受けています。
ただし、pkgsrc をどのオペレーティングシステムで使っているかにかかわらず、
pkgsrc の配置は同じになると思っていただいて結構です。</p>
<p>pkgsrc 用のルートディレクトリーは、主に四つあり、いずれも
<code class="filename">bootstrap/bootstrap</code> スクリプトで設定可能です。
pkgsrc を root としてインストールした場合の、
標準の場所は以下のとおりです。</p>
<pre class="programlisting">
LOCALBASE=              /usr/pkg
PKG_SYSCONFBASE=        /usr/pkg/etc
VARBASE=                /var
PKG_DBDIR=              /var/db/pkg
</pre>
<p>非特権モード (pkgsrc を root 以外のユーザーとしてインストールした場合)
での、標準の場所は以下のとおりです。</p>
<pre class="programlisting">
LOCALBASE=              ${HOME}/pkg
PKG_SYSCONFBASE=        ${HOME}/pkg/etc
VARBASE=                ${HOME}/pkg/var
PKG_DBDIR=              ${HOME}/pkg/var/db/pkg
</pre>
<p>この四つのディレクトリーの使用目的とその内容は、
以下で説明します。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">LOCALBASE</code> は、ベースシステムの
<code class="filename">/usr</code> ディレクトリーに対応します。
ファイルがインストールされる場所として<span class="quote">“<span class="quote">主たる</span>”</span>ディレクトリーであり、
<code class="filename">bin</code>,
<code class="filename">include</code>, <code class="filename">lib</code>,
<code class="filename">share</code>,
<code class="filename">sbin</code> などのよく知られたサブディレクトリーがあります。</p></li>
<li class="listitem"><p><code class="varname">VARBASE</code> は、ベースシステムの
<code class="filename">/var</code> に対応します。
一部のプログラム (特に、ゲームとネットワークデーモン) は、
通常の操作時に、このディレクトリーへの書き込み権限を持っている必要があります。</p></li>
<li class="listitem"><p><code class="varname">PKG_SYSCONFDIR</code> は、ベースシステムの
<code class="filename">/etc</code> に対応します。
pkgsrc 自体の設定ファイル <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> のほか、
個々のパッケージの設定ファイルを含みます。</p></li>
</ul></div>
<div class="sect1" title="8.1. ${LOCALBASE} 以下のファイルシステム配置">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="files.localbase"></a>8.1. <code class="literal">${LOCALBASE}</code> 以下のファイルシステム配置</h2></div></div></div>
<p>pkgsrc を通常にインストールした場合、<code class="filename">${LOCALBASE}</code>
以下には以下のディレクトリーが存在します。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">bin</code></span></dt>
<dd><p>エンドユーザーが直接使うことを前提とした、
実行形式のプログラムを含みます。</p></dd>
<dt><span class="term"><code class="filename">emul</code></span></dt>
<dd><p>特に NetBSD 用の、
他の各種オペレーティングシステムのエミュレーション層用のファイルを含みます。</p></dd>
<dt><span class="term"><code class="filename">etc</code> (<code class="filename">${PKG_SYSCONFDIR}</code>
の通常の場所)</span></dt>
<dd><p>設定ファイルを含みます。</p></dd>
<dt><span class="term"><code class="filename">include</code></span></dt>
<dd><p>C および C++
プログラミング言語用のヘッダーを含みます。</p></dd>
<dt><span class="term"><code class="filename">info</code></span></dt>
<dd><p>各種パッケージの
GNU info ファイルを含みます。</p></dd>
<dt><span class="term"><code class="filename">lib</code></span></dt>
<dd><p>静的共有ライブラリーを含みます。</p></dd>
<dt><span class="term"><code class="filename">libdata</code></span></dt>
<dd><p>インストール後に変更されることがないデータファイルを含みます。
変更されることのあるデータファイルは
<code class="filename">${VARBASE}</code> 以下に置かれます。</p></dd>
<dt><span class="term"><code class="filename">libexec</code></span></dt>
<dd><p>補助プログラムやネットワークデーモンなど、
エンドユーザーが直接使うことを前提としないプログラムを含みます。</p></dd>
<dt><span class="term"><code class="filename">libexec/cgi-bin</code></span></dt>
<dd><p>web サーバーが
CGI スクリプトとして実行することを前提としたプログラムを含みます。</p></dd>
<dt><span class="term"><code class="filename">man</code> (<code class="filename">${PKGMANDIR}</code>
の通常の値)</span></dt>
<dd><p>マニュアルページ形式の短いドキュメンテーションを含みます。</p></dd>
<dt><span class="term"><code class="filename">sbin</code></span></dt>
<dd><p>スーパーユーザーだけが使うことを前提としたプログラムを含みます。</p></dd>
<dt><span class="term"><code class="filename">share</code></span></dt>
<dd><p>インストール後に変更されることがないプラットフォーム独立のデータファイルを含みます。</p></dd>
<dt><span class="term"><code class="filename">share/doc</code></span></dt>
<dd><p>パッケージに附属するドキュメンテーションファイルを含みます。</p></dd>
<dt><span class="term"><code class="filename">share/examples</code></span></dt>
<dd><p>パッケージに附属する例ファイルを含みます。
設定ファイルの原本も、インストール時にここに保存されたうえで
<code class="filename">${PKG_SYSCONFDIR}</code>
へコピーされます。</p></dd>
<dt><span class="term"><code class="filename">share/examples/rc.d</code></span></dt>
<dd><p>rc.d
スクリプトファイルの原本を含みます。</p></dd>
<dt><span class="term"><code class="filename">var</code> (<code class="filename">${VARBASE}</code>
の通常の場所)</span></dt>
<dd><p>インストール後に変更されることのあるファイルを含みます。</p></dd>
</dl></div>
</div>
<div class="sect1" title="8.2. ${VARBASE} 以下のファイルシステム配置">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="files.varbase"></a>8.2. <code class="literal">${VARBASE}</code> 以下のファイルシステム配置</h2></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">db/pkg</code> (<code class="filename">${PKG_DBDIR}</code>
の通常の場所)</span></dt>
<dd><p>現在インストールされているパッケージに関する情報を含みます。</p></dd>
<dt><span class="term"><code class="filename">games</code></span></dt>
<dd><p>最高得点ファイルを含みます。</p></dd>
<dt><span class="term"><code class="filename">log</code></span></dt>
<dd><p>ログファイルを含みます。</p></dd>
<dt><span class="term"><code class="filename">run</code></span></dt>
<dd><p>現在実行されているデーモンに関する情報ファイルを含みます。</p></dd>
</dl></div>
</div>
</div>
<div class="chapter" title="Chapter 9. よくある質問">
<div class="titlepage"><div><div><h2 class="title">
<a name="faq"></a>Chapter 9. よくある質問</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#mailing-list-pointers">9.1. pkgについて話しあうためのメーリングリストはありますか?</a></span></dt>
<dt><span class="sect1"><a href="#pkgviews-docs">9.2. pkgviews のドキュメンテーションはどこにあるか?</a></span></dt>
<dt><span class="sect1"><a href="#faq-pkgtools">9.3. パッケージ管理用ユーティリティー (pkgtools)</a></span></dt>
<dt><span class="sect1"><a href="#non-root-pkgsrc">9.4. pkgsrc を root 以外で使う方法</a></span></dt>
<dt><span class="sect1"><a href="#resume-transfers">9.5. distfile 取得時に、転送を再開する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#x.org-from-pkgsrc">9.6. pkgsrc の modular X.org をインストールあるいは使用する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#fetch-behind-firewall">9.7. 防火壁の内側からファイルを取得する方法</a></span></dt>
<dt><span class="sect1"><a href="#passive-ftp">9.8. どうすれば<span class="command"><strong>make fetch</strong></span>でpassive FTPを使用することができますか?</a></span></dt>
<dt><span class="sect1"><a href="#fetching-all-distfiles">9.9. 一度にすべてのdistfileを取得する方法</a></span></dt>
<dt><span class="sect1"><a href="#tmac.andoc-missing">9.10. <span class="quote">“<span class="quote">Don't know how to make
/usr/share/tmac/tmac.andoc</span>”</span> ってどういうこと?</a></span></dt>
<dt><span class="sect1"><a href="#bsd.own.mk-missing">9.11. <span class="quote">“<span class="quote">Could not find bsd.own.mk</span>”</span> ってどういうこと?</a></span></dt>
<dt><span class="sect1"><a href="#using-sudo-with-pkgsrc">9.12. pkgsrcで'sudo'を使う</a></span></dt>
<dt><span class="sect1"><a href="#faq.conf">9.13. 設定ファイルの置き場所を変更する方法は?</a></span></dt>
<dt><span class="sect1"><a href="#audit-packages">9.14. 自動セキュリティーチェック</a></span></dt>
<dt><span class="sect1"><a href="#ufaq-cflags">9.15. <code class="varname">CFLAGS</code> を無視するパッケージがあるのはなぜ?</a></span></dt>
<dt><span class="sect1"><a href="#ufaq-fail">9.16. パッケージが構築できません。どうすればいい?</a></span></dt>
<dt><span class="sect1"><a href="#faq.rcs-conflicts">9.17. <span class="quote">“<span class="quote">Makefile appears to contain unresolved cvs/rcs/??? merge conflicts</span>”</span> ってどういうこと?</a></span></dt>
</dl>
</div>
<p>この節では、pkgsrc の特別な事柄に関する助言、技巧や要領のうち、
前章までに適当な掲載場所がなかったものを掲載しています。
ここでは、pkgsrc 利用者向けの情報と pkgsrc 開発者向けの情報を、どちらも掲載します。</p>
<div class="sect1" title="9.1. pkgについて話しあうためのメーリングリストはありますか?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="mailing-list-pointers"></a>9.1. pkgについて話しあうためのメーリングリストはありますか?</h2></div></div></div>
<p>pkgsrc の利用者向けに、以下のようなメーリングリストがあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a class="ulink" href="http://www.NetBSD.org/mailinglists/index.html#pkgsrc-users" target="_top">pkgsrc-users</a>:
	  pkgsrc 関連の話題のほとんどをプラットフォームにかかわらず扱う汎用目的のメーリングリストです。
	  たとえば、pkgsrc の設定に関する助けの要請、
	  予期しない構築失敗、個々のパッケージの使用、
	  インストールした pkgsrc の更新、pkgsrc リリース枝に関する質問などです。
	  ここには、一般的なお知らせや、pkgsrc 利用者コミュニティーに影響のある変更
	  (たとえば、大規模な基盤の変更、新機能、パッケージ削除など)
	  の提案も投稿されることがあります。</p></li>
<li class="listitem"><p><a class="ulink" href="http://www.NetBSD.org/mailinglists/index.html#pkgsrc-bulk" target="_top">pkgsrc-bulk</a>:
	  pkgsrc のバルクビルドの結果が送付され、
	  その議論がおこなわれるメーリングリストです。</p></li>
<li class="listitem"><p><a class="ulink" href="http://www.NetBSD.org/mailinglists/index.html#pkgsrc-changes" target="_top">pkgsrc-changes</a>:
	  pkgsrc のすべての変更についての
	  commit メッセージが流れるメーリングリストです。
	  毎日、 24 時間分のすべての commit メッセージをまとめて送る、
	  ダイジェスト版もあります。</p></li>
</ul></div>
<p>参加するためには以下のようにして下さい。</p>
<pre class="programlisting">
<code class="prompt">%</code> echo subscribe <em class="replaceable"><code>listname</code></em> | mail majordomo@NetBSD.org
</pre>
<p>以上の各メーリングリストのアーカイブは
<a class="ulink" href="http://mail-index.NetBSD.org/" target="_top">http://mail-index.NetBSD.org/</a> から辿れます。</p>
</div>
<div class="sect1" title="9.2. pkgviews のドキュメンテーションはどこにあるか?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="pkgviews-docs"></a>9.2. pkgviews のドキュメンテーションはどこにあるか?</h2></div></div></div>
<p>pkgviews は buildlink に密接に統合されています。
pkgviews の利用者向けの手引きは
<code class="filename">pkgsrc/mk/buildlink3/PKGVIEWS_UG</code> にあります。</p>
</div>
<div class="sect1" title="9.3. パッケージ管理用ユーティリティー (pkgtools)">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="faq-pkgtools"></a>9.3. パッケージ管理用ユーティリティー (pkgtools)</h2></div></div></div>
<p><code class="filename">pkgsrc/pkgtools</code> ディレクトリー以下には、
pkgsrc の利用者および開発者それぞれにとって便利なユーティリティーがいくつもあります。
この節の目的は、このユーティリティーの存在と、
どんな場合に有用かを知っていただくことだけであり、
各パッケージの附属ドキュメントを引き写すことではありません。</p>
<p>pkgsrc が使用するユーティリティー (必要に応じて自動的にインストールされます):</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/x11-links/README.html" target="_top"><code class="filename">pkgtools/x11-links</code></a>:
      buildlink が使用するシンボリックリンクです。</p></li></ul></div>
<p>OS ツールの拡張 (必要に応じて自動的にインストールされます):</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/digest/README.html" target="_top"><code class="filename">pkgtools/digest</code></a>:
      各種チェックサム(SHA1 など) を計算します。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/libnbcompat/README.html" target="_top"><code class="filename">pkgtools/libnbcompat</code></a>:
      pkgsrc ツール用の互換ライブラリーです。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/mtree/README.html" target="_top"><code class="filename">pkgtools/mtree</code></a>: BSD 以外のシステムにはネイティブの
      mtree がないため、これがインストールされます。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_install/README.html" target="_top"><code class="filename">pkgtools/pkg_install</code></a>:
      <code class="filename">/usr/sbin/pkg_install</code>
      を最新版に置き換えます。または、
      pkg_install のないオペレーティングシステム用です。</p></li>
</ul></div>
<p>pkgsrc が使用するユーティリティー (自動ではインストールされません):</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_tarup/README.html" target="_top"><code class="filename">pkgtools/pkg_tarup</code></a>:
      インストールされているパッケージをもとに、
      バイナリーパッケージを作成します。 <span class="command"><strong>make replace</strong></span>
      が古いパッケージを保存するのに使います。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/dfdisk/README.html" target="_top"><code class="filename">pkgtools/dfdisk</code></a>:
      distfile を複数の場所から
      fetch できる機能を pkgsrc に追加します。現在のところ、
      以下の方法に対応しています: 複数の CD-ROM および FTP/HTTP
      のネットワーク接続。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/xpkgwedge/README.html" target="_top"><code class="filename">pkgtools/xpkgwedge</code></a>: X11 パッケージの場所を変えます
      (標準で有効となります)。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/cpuflags/README.html" target="_top"><code class="filename">devel/cpuflags</code></a>: お使いの CPU とコンパイラー用にコードを最適化するための
      コンパイラーのフラグを考えてくれます。 </p></li>
</ul></div>
<p>インストールしたパッケージの追跡や最新への追従用などのユーティリティー:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_chk/README.html" target="_top"><code class="filename">pkgtools/pkg_chk</code></a>: インストールされているパッケージのバージョンが
      pkgsrc の最新バージョンと異なるものを報告します。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdep/README.html" target="_top"><code class="filename">pkgtools/pkgdep</code></a>: パッケージ更新計画の策定を支援するため、
      パッケージの依存関係のグラフを作成します。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdepgraph/README.html" target="_top"><code class="filename">pkgtools/pkgdepgraph</code></a>: <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdep/README.html" target="_top"><code class="filename">pkgtools/pkgdep</code></a> の出力をもとに
      (graphviz を使って) 図表を作成します。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkglint/README.html" target="_top"><code class="filename">pkgtools/pkglint</code></a>: pkglint(1) プログラムは
      pkgsrc の個々のパッケージに誤りがないか検査します。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/lintpkgsrc/README.html" target="_top"><code class="filename">pkgtools/lintpkgsrc</code></a>: lintpkgsrc(1) プログラムは
      pkgsrc システム全体に対して各種の検査をおこないます。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgsurvey/README.html" target="_top"><code class="filename">pkgtools/pkgsurvey</code></a>:
      インストール済みのパッケージを報告します。</p></li>
</ul></div>
<p>個々のパッケージの保守や作成をする人のためのユーティリティー:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdiff/README.html" target="_top"><code class="filename">pkgtools/pkgdiff</code></a>: パッケージ用のパッチの作成や保守を自動化します
      (pkgdiff, pkgvi, mkpatches, ...
      が含まれます)。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/rpm2pkg/README.html" target="_top"><code class="filename">pkgtools/rpm2pkg</code></a>,
      <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/url2pkg/README.html" target="_top"><code class="filename">pkgtools/url2pkg</code></a>: pkgsrc
      への変換の補助ツールです。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/gensolpkg/README.html" target="_top"><code class="filename">pkgtools/gensolpkg</code></a>: pkgsrc を Solaris
      パッケージに変換します。</p></li>
</ul></div>
<p>pkgsrc を保守する人のためのユーティリティー (あるいは、もっと地味な pkg
ユーティリティー)</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_comp/README.html" target="_top"><code class="filename">pkgtools/pkg_comp</code></a>: chroot
      領域でパッケージを構築します。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/libkver/README.html" target="_top"><code class="filename">pkgtools/libkver</code></a>: chroot 環境でのクロス構築用に、
      カーネルのバージョンを誤魔化します。</p></li>
</ul></div>
</div>
<div class="sect1" title="9.4. pkgsrc を root 以外で使う方法">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="non-root-pkgsrc"></a>9.4. pkgsrc を root 以外で使う方法</h2></div></div></div>
<p>pkgsrc を root 以外のユーザーで使いたい場合は、いくつかの変数を設定すれば、
そのような環境で pkgsrc が動くようにすることができます。
最低限、<code class="varname">UNPRIVILEGED</code> を <span class="quote">“<span class="quote">yes</span>”</span>
に設定することが必要です。こうすると非特権モードに切り替わり、
関連のある複数の変数が設定されて、
root 以外のユーザーがパッケージをインストールできるようになります。</p>
<p>標準状態の非特権モードでは不十分な場合は、
他の変数を調節するとよいでしょう。たとえば、
ユーザーやグループの自動検出により正しくない (あるいは使いたくない)
値が検出される場合は、それぞれ、
<code class="varname">UNPRIVILEGED_USER</code> や
<code class="varname">UNPRIVILEGED_GROUP</code> を設定すれば変更することができます。</p>
<p>なお、ブートストラップについては、<span class="command"><strong>bootstrap</strong></span>
スクリプトに <span class="quote">“<span class="quote">--ignore-user-check</span>”</span> フラグを与えると、
標準で使われるインストール先が
<code class="filename">~/pkg</code> 以下の複数のディレクトリーになるため、
非 root 用の構成にしやすくなることを覚えておいてください。このディレクトリーは、
他のディレクトリーの配置が細かく調節可能であるのと同様に、
スクリプトに <span class="quote">“<span class="quote">--prefix</span>”</span>
フラグを与えて上書きすることができます。</p>
</div>
<div class="sect1" title="9.5. distfile 取得時に、転送を再開する方法は?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="resume-transfers"></a>9.5. distfile 取得時に、転送を再開する方法は?</h2></div></div></div>
<p>標準では、pkgsrc の転送再開機能は有効になっていませんが、
<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> にオプション
<code class="varname">PKG_RESUME_TRANSFERS=YES</code> を追加すれば、
この機能を有効にすることができます。こうすると、fetch している最中に、
不完全な distfile があった場合、pkgsrc はそのファイルの残りの部分を取得しようとします。</p>
<p>また、
<code class="varname">FETCH_CMD</code> 変数を変更すれば、
標準である <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?ftp+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">ftp</span>(1)</span></a> 以外のプログラムを使うこともできます。
この変数値を ftp, fetch, wget または curl にすると、指定したプログラムを使うことができます。
このほか、変数値を manual にすると、取得をしないようにすることができます。
変数値を custom にすると、システム標準の設定を使わないようになり、
取得プログラムに対する依存性も追わないようになります。
この場合は、<code class="varname">FETCH_CMD</code>, <code class="varname">FETCH_BEFORE_ARGS</code>,
<code class="varname">FETCH_RESUME_ARGS</code>, <code class="varname">FETCH_OUTPUT_ARGS</code>,
<code class="varname">FETCH_AFTER_ARGS</code> の各変数を設定する必要があります。</p>
<p>たとえば、
ダウンロードに <code class="filename">wget</code>
を使いたい場合は、以下のような設定が必要です。</p>
<pre class="programlisting">
FETCH_USING=	wget
</pre>
</div>
<div class="sect1" title="9.6. pkgsrc の modular X.org をインストールあるいは使用する方法は?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="x.org-from-pkgsrc"></a>9.6. pkgsrc の modular X.org をインストールあるいは使用する方法は?</h2></div></div></div>
<p>システム附属の X11 (<code class="filename">/usr/X11R6</code>,
<code class="filename">/usr/openwin</code>, ...) ではなく pkgsrc の
modular X.org を使いたい場合は、<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
に以下の行を追加する必要があります。</p>
<pre class="programlisting">
X11_TYPE=modular
</pre>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>DragonFly オペレーティングシステムは、標準で、
この pkgsrc の modular X.org の X11 の実装を使います。</p>
</div>
</div>
<div class="sect1" title="9.7. 防火壁の内側からファイルを取得する方法">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="fetch-behind-firewall"></a>9.7. 防火壁の内側からファイルを取得する方法</h2></div></div></div>
<p>もし、あなたが防火壁の内側にいて、インターネットのホストに直接接続できない
(つまりNATを使っていない)場合、適切なプロキシーホストを指定することができます。
これはURL形式の環境変数で指定します。例えば、Amdahlドメインにおいては、
<span class="quote">“<span class="quote">orpheus.amdahl.com</span>”</span> というマシンは防火壁のひとつで、プロキシーポート番号として、
80番のポートを使用します。この場合、proxy環境変数は以下のようになります。</p>
<pre class="programlisting">
ftp_proxy=ftp://orpheus.amdahl.com:80/
http_proxy=http://orpheus.amdahl.com:80/
</pre>
</div>
<div class="sect1" title="9.8. どうすればmake fetchでpassive FTPを使用することができますか?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="passive-ftp"></a>9.8. どうすれば<span class="command"><strong>make fetch</strong></span>でpassive FTPを使用することができますか?</h2></div></div></div>
<p>distfileの取得にどのユーティリティーを使っているかによります。
<code class="filename">bsd.pkg.mk</code>は、以下のリストのなかで利用可能なコマンドのうち、
最初のものを<code class="varname">FETCH_CMD</code>に割り当てます:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="filename">${LOCALBASE}/bin/ftp</code></p></li>
<li class="listitem"><p><code class="filename">/usr/bin/ftp</code></p></li>
</ul></div>
<p>NetBSD のデフォルトのインストールでは、<code class="filename">/usr/bin/ftp</code>となり、これは自動的に、
最初はパッシブ接続を試みます。そして、サーバーがパッシブ接続を拒否した場合
は、アクティブ接続に切り替わります。これ以外のツールの場合は、
<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>に以下の設定を追加してください。
<code class="varname">PASSIVE_FETCH=1</code></p>
<p>これを設定すると、
<code class="filename">/usr/bin/ftp</code>
はアクティブ転送への切り替えをおこなわなくなります。</p>
</div>
<div class="sect1" title="9.9. 一度にすべてのdistfileを取得する方法">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="fetching-all-distfiles"></a>9.9. 一度にすべてのdistfileを取得する方法</h2></div></div></div>
<p><span class="command"><strong>make
fetch</strong></span>を実行できない職場や大学において、
一回のバッチ処理で、すべてのdistfileをダウンロードしたいと思うことがあるかもしれません。<a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/" target="_top">ftp.NetBSD.org</a>
に distfile が置かれていますが、
このディレクトリーをまるごとダウンロードするのは不適切です。</p>
<p>現時点では、<span class="command"><strong>make fetch-list</strong></span>を
<code class="filename">/usr/pkgsrc</code>またはそのサブディレクトリーで実行し、
その結果のリストを職場や学校のマシンに持ってきて、使用してくださいとしかいえません。
NetBSD と互換な <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?ftp+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">ftp</span>(1)</span></a> (tnftpなど)が使えない場合は、
URLを指定して取得ができるコマンドを
<code class="varname">FETCH_CMD</code>に指定することを忘れないでください:</p>
<p>自宅で:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/pkgsrc</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make fetch-list FETCH_CMD=wget DISTDIR=/tmp/distfiles &gt;/tmp/fetch.sh</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>scp /tmp/fetch.sh work:/tmp</code></strong></pre>
<p>職場で:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>sh /tmp/fetch.sh</code></strong></pre>
<p>実行後、 <code class="filename">/tmp/distfiles</code> を
tar で固めて自宅に持って帰ります。</p>
<p>NetBSD で動いているマシンがあって、<span class="emphasis"><em>すべての</em></span>distfile
(そのマシンのアーキテクチャー向けではないものも含む)を取得したい場合は、
上述の<span class="command"><strong>make fetch-list</strong></span>の方法を使うか、
以下のようにしてdistfileを直接取得することができます。</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make mirror-distfiles</code></strong></pre>
<p><code class="varname">NO_{SRC,BIN}_ON_{FTP,CDROM}</code>
も無視したい場合は、
以下のようにしてすべてのものを取得することができます。</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make fetch NO_SKIP=yes</code></strong></pre>
</div>
<div class="sect1" title="9.10. “Don't know how to make /usr/share/tmac/tmac.andoc” ってどういうこと?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="tmac.andoc-missing"></a>9.10. <span class="quote">“<span class="quote">Don't know how to make
/usr/share/tmac/tmac.andoc</span>”</span> ってどういうこと?</h2></div></div></div>
<p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_install/README.html" target="_top"><code class="filename">pkgtools/pkg_install</code></a>パッケージのコンパイル時に、makeが
<code class="filename">/usr/share/tmac/tmac.andoc</code>
の作り方がわからないというエラーを出します。これは、そのマシンに
NetBSD の基本配布物の<span class="quote">“<span class="quote">text</span>”</span>セット(nroffなど)
がインストールされていないことを意味しています。マニュアルページの整形ができるようにするため、
<span class="quote">“<span class="quote">text</span>”</span>セットをインストールしてください。</p>
<p>この<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_install/README.html" target="_top"><code class="filename">pkgtools/pkg_install</code></a>パッケージの事例は、
環境変数か<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>のどちらかで
<code class="varname">NOMAN=YES</code>を設定して回避することもできます。</p>
</div>
<div class="sect1" title="9.11. “Could not find bsd.own.mk” ってどういうこと?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="bsd.own.mk-missing"></a>9.11. <span class="quote">“<span class="quote">Could not find bsd.own.mk</span>”</span> ってどういうこと?</h2></div></div></div>
<p>NetBSD のインストール時にコンパイラー一式<code class="filename">comp.tgz</code>
をインストールしなかったからです。<code class="filename">comp.tgz</code>を入手し、
<code class="filename">/</code>で展開してインストールしてください:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>tar --unlink -zxvpf .../comp.tgz</code></strong></pre>
<p><code class="filename">comp.tgz</code>は NetBSD のどのリリースにも含まれていますので、
あなたがインストールしたリリース (<span class="command"><strong>uname
-r</strong></span>で調べられます) に合ったものを入手してください。</p>
</div>
<div class="sect1" title="9.12. pkgsrcで'sudo'を使う">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="using-sudo-with-pkgsrc"></a>9.12. pkgsrcで'sudo'を使う</h2></div></div></div>
<p>パッケージのインストールをroot以外のユーザーで実行し、
root権限が必要なところではpkgsrcの <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?su+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">su</span>(1)</span></a> 機能を使う場合、
必要なパッケージをインストールするたびに
rootのパスワードを打つのは面倒かもしれません。これを避けるために、
パスワードを一定時間保持してくれるsudoパッケージを使うことができます。
sudoを使うには、sudoを(バイナリーパッケージ、または<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/security/sudo/README.html" target="_top"><code class="filename">security/sudo</code></a>のいずれかから)
インストールしてから、<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> の、
<code class="varname">LOCALBASE</code> 変数の定義より
<span class="emphasis"><em>後</em></span>の部分に、以下の内容を書いておきます。</p>
<pre class="programlisting">
.if exists(${LOCALBASE}/bin/sudo)
SU_CMD=        ${LOCALBASE}/bin/sudo /bin/sh -c
.endif
</pre>
</div>
<div class="sect1" title="9.13. 設定ファイルの置き場所を変更する方法は?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="faq.conf"></a>9.13. 設定ファイルの置き場所を変更する方法は?</h2></div></div></div>
<p>システム管理者は、設定ファイルがインストールされる場所を選ぶことができます。
標準の設定では、設定ファイルはすべて <code class="filename">${PREFIX}/etc</code>
またはそのサブディレクトリー以下にインストールされます。
設定ファイルのインストール先は、あなたの都合 (たとえば、
NFS でエクスポートされた読み込み専用の <code class="varname">PREFIX</code>
で、パッケージの設定をマシン毎にする必要がある場合)
にあわせて調整することができます。</p>
<p>標準の設定を変えるために、(<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
で) <code class="varname">PKG_SYSCONFBASE</code> 変数を、
好みの設定用ディレクトリーを指すように変えることができます。
一般的な設定例としては、<code class="filename">/etc</code> や
<code class="filename">/etc/pkg</code> などがあります。</p>
<p>さらに、<code class="varname">PKG_SYSCONFDIR.${PKG_SYSCONFVAR}</code>
変数を設定することで、パッケージ毎に設定用ディレクトリーを変更することができます。
<code class="varname">PKG_SYSCONFVAR</code> の値は、通常は変更対象のパッケージ名に合わせたもの、
つまり、<code class="varname">PKGBASE</code> の値にします。</p>
<p>なお、この設定を変更した後は、影響を受けるパッケージをすべて再構築し、
再インストールする必要があります。</p>
</div>
<div class="sect1" title="9.14. 自動セキュリティーチェック">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="audit-packages"></a>9.14. 自動セキュリティーチェック</h2></div></div></div>
<p>サードパーティーのソフトウェアにはしばしばバグがあること、
そして、バグのなかにはマシンをアタッカーの攻撃に対して脆弱な状態にするものもあることに、
どうか注意してください。そのような攻撃にさらされることを減らすために、NetBSD
パッケージチームでは、pkgsrc化されたことのあるパッケージに関する既知の攻撃のデータベースを保守しています。
このデータベースを自動的にダウンロードして、
システムにインストールされている全パッケージのセキュリティー監査をおこなうことができます。
これをおこなうには、以下の二つのツール (<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_install/README.html" target="_top"><code class="filename">pkgtools/pkg_install</code></a>
パッケージの一部としてインストールされます) を使います。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
<p><span class="command"><strong>pkg_admin fetch-pkg-vulnerabilities</strong></span>: セキュリティー脆弱性情報のリストの
    ダウンロードを簡単にできるようにするものです。この脆弱性情報のリストは、
    pkgsrc セキュリティーチームが最新の状態に保っており、
    NetBSD ftpサーバーで配布されています。</p>
<p><a class="ulink" href="ftp://ftp.NetBSD.org/pkgsrc/distfiles/pkg-vulnerabilities" target="_top">ftp://ftp.NetBSD.org/pkgsrc/distfiles/pkg-vulnerabilities</a></p>
</li>
<li class="listitem"><p><span class="command"><strong>pkg_admin audit</strong></span>: マシンの監査を簡単にできるようにするもので、
    既知の各脆弱性の確認をします。
    脆弱性のあるパッケージがインストールされていた場合、そのことを標準出力に出力します。
    この出力には、脆弱性の種類の説明と詳細情報のURLが含まれます。</p></li>
</ol></div>
<p>これらのツールを使うよう強くおすすめします。
<span class="quote">“<span class="quote">pkg_install</span>”</span> をインストールした後に、
パッケージのメッセージを読んでください。このメッセージは <strong class="userinput"><code>pkg_info -D
pkg_install</code></strong> を実行すれば表示できます。</p>
<p>このパッケージをインストールすると、pkgsrc
は各パッケージの構築前にこのパッケージを使ってセキュリティーのチェックをするようになります。
このチェックを制御する方法については<a class="xref" href="#variables-affecting-build" title="5.2. 構築の過程に影響を及ぼす変数">Section 5.2, “構築の過程に影響を及ぼす変数”</a>をご覧ください。</p>
</div>
<div class="sect1" title="9.15. CFLAGS を無視するパッケージがあるのはなぜ?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="ufaq-cflags"></a>9.15. <code class="varname">CFLAGS</code> を無視するパッケージがあるのはなぜ?</h2></div></div></div>
<p><a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で
	<code class="varname">CFLAGS</code> 変数に独自の設定をした場合、
	設定されたフラグは環境変数によって <code class="filename">./configure</code>
	スクリプトに渡されてから <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> に渡されます。
	パッケージの作者によっては、
	環境変数で渡された <code class="varname">CFLAGS</code> を、
	パッケージの <code class="filename">Makefile</code> で上書きして、
	無視するようにしていることがあります。</p>
<p>現在のところ、この問題の解決策はありません。
	独自の <code class="varname">CFLAGS</code> を使うことがどうしても必要な場合は、
	パッケージのディレクトリーで <span class="command"><strong>make patch</strong></span> を実行してから、
	<code class="filename">Makefile</code> と
	<code class="filename">Makefile.in</code> をすべて調べて、
	<code class="varname">CFLAGS</code> を明示的に定義していないかを調べてください。
	ふつうは、その部分を削除することができます。
	ただし、一部の<span class="quote">“<span class="quote">小賢しい</span>”</span>プログラマーは、
	彼らが選んだ特定の <code class="varname">CFLAGS</code>
	の組合せのもとでしか動作しないような、
	まずいコードを書いていることに注意してください。</p>
</div>
<div class="sect1" title="9.16. パッケージが構築できません。どうすればいい?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="ufaq-fail"></a>9.16. パッケージが構築できません。どうすればいい?</h2></div></div></div>
<div class="procedure"><ol class="procedure" type="1">
<li class="step" title="Step 1"><p>使っている pkgsrc ツリーの一貫性を確認します。
	この問題の原因としてありがちなのは、
	時間などを節約するために pkgsrc の一部だけを更新していたというものです。
	pkgsrc は小さなシステムの寄せ集めではなく、ひとつの大きなシステムですので、
	pkgsrc ツリー全体を更新しておかないと動かなくなるような変更が時々おこなわれます。</p></li>
<li class="step" title="Step 2"><p>CVS の衝突が起きていないことを確認します。
	pkgsrc のファイルすべてについて、
	<span class="quote">“<span class="quote">&lt;&lt;&lt;&lt;&lt;&lt;</span>”</span> や
	<span class="quote">“<span class="quote">&gt;&gt;&gt;&gt;&gt;&gt;</span>”</span> という文字列を検索します。</p></li>
<li class="step" title="Step 3"><p>古いパッケージが展開されていないことを確認します。
	これを確認するには、<span class="command"><strong>make clean clean-depends</strong></span>
	を実行します。</p></li>
<li class="step" title="Step 4"><p>以上の確認をおこなってもなお問題がある場合は、
	<code class="literal">pkgsrc-users</code> メーリングリストにメールを出してください。</p></li>
</ol></div>
</div>
<div class="sect1" title="9.17. “Makefile appears to contain unresolved cvs/rcs/??? merge conflicts” ってどういうこと?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="faq.rcs-conflicts"></a>9.17. <span class="quote">“<span class="quote">Makefile appears to contain unresolved cvs/rcs/??? merge conflicts</span>”</span> ってどういうこと?</h2></div></div></div>
<p>あなたが pkgsrc のファイルに変更を加えており、かつ、
他の誰かが CVS リポジトリーにおいて同じファイルに変更を加えています。
この変更がいずれもファイル内の同じ箇所に対するものであるため、
あなたが pkgsrc を更新したときに、変更が衝突したという印を
<code class="literal">cvs</code> コマンドがファイルにつけたのです。
この印があるために、ファイルが妥当な
<code class="filename">Makefile</code> ではなくなっています。</p>
<p>ファイルの内容を見てください。あなたが独自に加えた変更がもはや不要であれば、
ファイルを削除してからそのディレクトリーで <span class="command"><strong>cvs -q update
-dP</strong></span> を実行し、最新版のファイルをダウンロードすることができます。</p>
</div>
</div>
</div>
<div class="part" title="Part II. pkgsrc 開発者向けの手引き">
<div class="titlepage"><div><div><h1 class="title">
<a name="developers-guide"></a>Part II. pkgsrc 開発者向けの手引き</h1></div></div></div>
<div class="partintro" title="pkgsrc 開発者向けの手引き">
<div></div>
<p>この部では、パッケージの作成や変更を扱います。
	新しいパッケージを作る <span class="quote">“<span class="quote">HOWTO</span>”</span> 的な手引きから始めます。
	その後の章は、
	pkgsrc のリファレンスマニュアルに近いものになっています。</p>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="chapter"><a href="#creating">10. 新しいパッケージを一から作る</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#creating.common">10.1. ありがちな種類のパッケージ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#creating.perl-module">10.1.1. Perl モジュール</a></span></dt>
<dt><span class="sect2"><a href="#creating.kde-app">10.1.2. KDE アプリケーション</a></span></dt>
<dt><span class="sect2"><a href="#creating.python-module">10.1.3. Python モジュールおよびプログラム</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#creating.examples">10.2. 例</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#creating.nvu">10.2.1. www/nvu パッケージはいかに pkgsrc に追加されたか</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#components">11. パッケージコンポーネント - ファイル、ディレクトリー、およびコンテンツ</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#components.Makefile">11.1. <code class="filename">Makefile</code></a></span></dt>
<dt><span class="sect1"><a href="#components.distinfo">11.2. <code class="filename">distinfo</code></a></span></dt>
<dt><span class="sect1"><a href="#components.patches">11.3. patches/*</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#components.patch.structure">11.3.1. 個々のパッチファイルの構造</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.caveats">11.3.2. パッチファイルを作成する</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.sources">11.3.3. パッチファイルの出どころ</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.guidelines">11.3.4. パッチ作成の指針</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.feedback">11.3.5. 作者へのフィードバック</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#other-mandatory-files">11.4. その他の必須のファイル</a></span></dt>
<dt><span class="sect1"><a href="#components.optional">11.5. オプションのファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#components.optional.bin">11.5.1. バイナリーパッケージに影響をおよぼすファイル</a></span></dt>
<dt><span class="sect2"><a href="#components.optional.build">11.5.2. 構築の過程に影響をおよぼすファイル</a></span></dt>
<dt><span class="sect2"><a href="#components.optional.none">11.5.3. 何の影響もおよぼさないファイル</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#work-dir">11.6. <code class="filename">work*</code></a></span></dt>
<dt><span class="sect1"><a href="#files-dir">11.7. <code class="filename">files/*</code></a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#makefile">12. <code class="filename">Makefile</code> におけるプログラミング</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#makefile.style">12.1. 警告</a></span></dt>
<dt><span class="sect1"><a href="#makefile.variables">12.2. <code class="filename">Makefile</code> 変数</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#makefile.variables.names">12.2.1. 命名規約</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#makefile.code">12.3. コードの断片</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#adding-to-list">12.3.1. リストに要素を追加する</a></span></dt>
<dt><span class="sect2"><a href="#converting-internal-to-external">12.3.2. 内部リストを外部リストに変換する</a></span></dt>
<dt><span class="sect2"><a href="#passing-variable-to-shell">12.3.3. シェルコマンドに値を渡す</a></span></dt>
<dt><span class="sect2"><a href="#quoting-guideline">12.3.4. クォートの指針</a></span></dt>
<dt><span class="sect2"><a href="#bsd-make-bug-workaround">12.3.5. BSD Make のバグの回避方法</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#plist">13. PLIST 問題</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#rcs-id">13.1. RCS ID</a></span></dt>
<dt><span class="sect1"><a href="#automatic-plist-generation">13.2. <code class="filename">PLIST</code> の半自動生成</a></span></dt>
<dt><span class="sect1"><a href="#print-PLIST">13.3. <span class="command"><strong>make print-PLIST</strong></span> の出力を細工する</a></span></dt>
<dt><span class="sect1"><a href="#plist.misc">13.4. PLIST における各種の置換</a></span></dt>
<dt><span class="sect1"><a href="#manpage-compression">13.5. マニュアルページの圧縮</a></span></dt>
<dt><span class="sect1"><a href="#using-PLIST_SRC">13.6. <code class="varname">PLIST_SRC</code> を使って PLIST のソースを変更する</a></span></dt>
<dt><span class="sect1"><a href="#platform-specific-plist">13.7. プラットフォーム別に異なるPLIST</a></span></dt>
<dt><span class="sect1"><a href="#faq.common-dirs">13.8. 複数のパッケージでディレクトリーを共有する</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#buildlink">14. buildlink 方法論</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#converting-to-buildlink3">14.1. パッケージを変換して buildlink3 を使うようにする</a></span></dt>
<dt><span class="sect1"><a href="#creating-buildlink3.mk">14.2. <code class="filename">buildlink3.mk</code> ファイルを書く</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#anatomy-of-bl3">14.2.1. buildlink3.mk ファイルの分析</a></span></dt>
<dt><span class="sect2"><a href="#updating-buildlink-depends">14.2.2. <code class="filename">buildlink3.mk</code> ファイルの <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code> を更新する</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#writing-builtin.mk">14.3. <code class="filename">builtin.mk</code> ファイルを書く</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#anatomy-of-builtin.mk">14.3.1. <code class="filename">builtin.mk</code> ファイルの分析</a></span></dt>
<dt><span class="sect2"><a href="#native-or-pkgsrc-preference">14.3.2. ネイティブおよび pkgsrc のソフトウェアの選択に関する、大域的な設定</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#pkginstall">15. pkginstall の枠組</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#files-and-dirs-outside-prefix">15.1. インストール用のプレフィックス以外の場所にあるファイルとディレクトリー</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#dirs-outside-prefix">15.1.1. ディレクトリーの操作</a></span></dt>
<dt><span class="sect2"><a href="#files-outside-prefix">15.1.2. ファイルの操作</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#conf-files">15.2. 設定ファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#conf-files-sysconfdir">15.2.1. <code class="varname">PKG_SYSCONFDIR</code> はどのように設定されるか</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-configure">15.2.2. ソフトウェアに設定ファイルの置き場所を教える</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-patching">15.2.3. インストールの過程を修正する</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-disable">15.2.4. 設定ファイルの処理をしないようにする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#rcd-scripts">15.3. システム起動スクリプト</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#rcd-scripts-disable">15.3.1. システム起動スクリプトの処理をしないようにする</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#users-and-groups">15.4. システムユーザーとグループ</a></span></dt>
<dt><span class="sect1"><a href="#shells">15.5. システムシェル</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#shells-disable">15.5.1. シェルの登録をしないようにする</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#fonts">15.6. フォント</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#fonts-disable">15.6.1. フォントデータベースの自動更新をしないようにする</a></span></dt></dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#options">16. オプションの扱い</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#global-default-options">16.1. 標準の大域的なオプション</a></span></dt>
<dt><span class="sect1"><a href="#converting-to-options">16.2. パッケージを変換して <code class="filename">bsd.options.mk</code> を使うようにする</a></span></dt>
<dt><span class="sect1"><a href="#option-names">16.3. オプション名</a></span></dt>
<dt><span class="sect1"><a href="#option-build">16.4. 依存パッケージのオプションを判別する</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#build">17. 構築の手順</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#build.intro">17.1. 序</a></span></dt>
<dt><span class="sect1"><a href="#build.prefix">17.2. プログラムの場所</a></span></dt>
<dt><span class="sect1"><a href="#build.builddirs">17.3. 構築の過程で使われるディレクトリー</a></span></dt>
<dt><span class="sect1"><a href="#build.running">17.4. 相の実行</a></span></dt>
<dt><span class="sect1"><a href="#build.fetch">17.5. <span class="emphasis"><em>fetch</em></span> 相</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#build.fetch.what">17.5.1. 何を、どこから取得するか</a></span></dt>
<dt><span class="sect2"><a href="#build.fetch.how">17.5.2. ファイルの取得はどのようにおこなわれるか?</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#build.checksum">17.6. <span class="emphasis"><em>checksum</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.extract">17.7. <span class="emphasis"><em>extract</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.patch">17.8. <span class="emphasis"><em>patch</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.tools">17.9. <span class="emphasis"><em>tools</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.wrapper">17.10. <span class="emphasis"><em>wrapper</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.configure">17.11. <span class="emphasis"><em>configure</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.build">17.12. <span class="emphasis"><em>build</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.test">17.13. <span class="emphasis"><em>test</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.install">17.14. <span class="emphasis"><em>install</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.package">17.15. <span class="emphasis"><em>package</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.clean">17.16. 掃除をする</a></span></dt>
<dt><span class="sect1"><a href="#build.helpful-targets">17.17. 他の役に立つターゲット</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#tools">18. 構築や実行のために必要なツール</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#pkgsrc-tools">18.1. pkgsrc 構築用のツール</a></span></dt>
<dt><span class="sect1"><a href="#package-tools">18.2. パッケージが必要とするツール</a></span></dt>
<dt><span class="sect1"><a href="#platform-tools">18.3. プラットフォーム附属のツール</a></span></dt>
<dt><span class="sect1"><a href="#tools.questions">18.4. ツールに関する質問</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#fixes">19. パッケージを動くようにする</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#general-operation">19.1. 一般的な操作</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#portability-of-packages">19.1.1. パッケージの移植性</a></span></dt>
<dt><span class="sect2"><a href="#pulling-vars-from-etc-mk.conf">19.1.2. <code class="filename">mk.conf</code> から利用者が設定可能な変数を捕まえる方法</a></span></dt>
<dt><span class="sect2"><a href="#user-interaction">19.1.3. ユーザーとの対話</a></span></dt>
<dt><span class="sect2"><a href="#handling-licenses">19.1.4. ライセンスの処理</a></span></dt>
<dt><span class="sect2"><a href="#restricted-packages">19.1.5. 制限つきパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#dependencies">19.1.6. 依存性の処理</a></span></dt>
<dt><span class="sect2"><a href="#conflicts">19.1.7. 他のパッケージとの衝突の処理</a></span></dt>
<dt><span class="sect2"><a href="#not-building-packages">19.1.8. 構築することができない、あるいはすべきでないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#undeletable-packages">19.1.9. 一旦インストールしたら削除すべきでないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#security-handling">19.1.10. セキュリティー問題を持つパッケージへの対処</a></span></dt>
<dt><span class="sect2"><a href="#bumping-pkgrevision">19.1.11. 既存パッケージ修正時に、バージョンを上げるにはどうするか</a></span></dt>
<dt><span class="sect2"><a href="#fixes.subst">19.1.12. パッケージのファイル中の各種テキストを置換する (SUBST の枠組)</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.fetch">19.2. <span class="emphasis"><em>fetch</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#no-plain-download">19.2.1. distfileのダウンロードが単純にできないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#modified-distfiles-same-name">19.2.2. '古い'名前のまま更新されたdistfileの取り扱い</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.configure">19.3. <span class="emphasis"><em>configure</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#fixes.libtool">19.3.1. 共有ライブラリー - libtool</a></span></dt>
<dt><span class="sect2"><a href="#using-libtool">19.3.2. すでにlibtoolをサポートしているGNUパッケージでlibtoolを使う</a></span></dt>
<dt><span class="sect2"><a href="#autoconf-automake">19.3.3. GNU Autoconf/Automake</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#programming-languages">19.4. プログラミング言語</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#basic-programming-languages">19.4.1. C, C++ および Fortran</a></span></dt>
<dt><span class="sect2"><a href="#java-programming-language">19.4.2. Java</a></span></dt>
<dt><span class="sect2"><a href="#perl-scripts">19.4.3. perl スクリプトを含むパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#other-programming-languages">19.4.4. 他のプログラミング言語</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.build">19.5. <span class="emphasis"><em>build</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#fixes.build.cpp">19.5.1. C および C++ のコードの条件つきコンパイル</a></span></dt>
<dt><span class="sect2"><a href="#compiler-bugs">19.5.2. コンパイラーのバグへの対処方法</a></span></dt>
<dt><span class="sect2"><a href="#undefined-reference">19.5.3. undefined reference to <span class="quote">“<span class="quote">...</span>”</span></a></span></dt>
<dt><span class="sect2"><a href="#out-of-memory">19.5.4. メモリーが不足する</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.install">19.6. <span class="emphasis"><em>install</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#install-scripts">19.6.1. 必要なディレクトリーを作成する</a></span></dt>
<dt><span class="sect2"><a href="#where-to-install-documentation">19.6.2. ドキュメンテーションのインストール場所</a></span></dt>
<dt><span class="sect2"><a href="#installing-score-files">19.6.3. 最高得点ファイルをインストールする</a></span></dt>
<dt><span class="sect2"><a href="#destdir-support">19.6.4. パッケージを DESTDIR に対応させる</a></span></dt>
<dt><span class="sect2"><a href="#hardcoded-paths">19.6.5. その他のインタープリターへのパスがハードコードされているパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#perl-modules">19.6.6. perl モジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#faq.info-files">19.6.7. infoファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#manpages">19.6.8. マニュアルページをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#gconf-data-files">19.6.9. GConf のデータファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#scrollkeeper-data-files">19.6.10. scrollkeeper/rarian のデータファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#x11-fonts">19.6.11. X11 のフォントをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#gtk2-modules">19.6.12. GTK2 のモジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#sgml-xml-data">19.6.13. SGML または XML のデータをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#mime-database">19.6.14. MIME データベースの拡張をインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#intltool">19.6.15. intltool を使うパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#startup-scripts">19.6.16. 起動スクリプトをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#tex-packages">19.6.17. TeX モジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#emulation-packages">19.6.18. エミュレーションによるバイナリーの実行に対応したパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#hicolor-theme">19.6.19. ハイカラーテーマのアイコンをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#desktop-files">19.6.20. デスクトップファイルをインストールするパッケージ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#punting">19.7. パッケージに問題があるという印をつける</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#debug">20. デバッグ</a></span></dt>
<dt><span class="chapter"><a href="#submit">21. 提出およびコミット</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#submitting-binary-packages">21.1. バイナリーパッケージの提出</a></span></dt>
<dt><span class="sect1"><a href="#submitting-your-package">21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)</a></span></dt>
<dt><span class="sect1"><a href="#general-notes-for-changes">21.3. パッケージを追加・更新・削除する際の一般的な覚書</a></span></dt>
<dt><span class="sect1"><a href="#committing-importing">21.4. コミット: パッケージのCVSへのインポート</a></span></dt>
<dt><span class="sect1"><a href="#updating-package">21.5. パッケージを新しいバージョンに更新する</a></span></dt>
<dt><span class="sect1"><a href="#renaming-package">21.6. pkgsrc のパッケージの名前を変更する</a></span></dt>
<dt><span class="sect1"><a href="#moving-package">21.7. pkgsrcのパッケージを移動する</a></span></dt>
</dl></dd>
<dt><span class="chapter"><a href="#devfaq">22. よくある質問</a></span></dt>
<dt><span class="chapter"><a href="#gnome">23. GNOME のパッケージングおよび移植</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#meta-packages">23.1. メタパッケージ</a></span></dt>
<dt><span class="sect1"><a href="#new-package">23.2. GNOME アプリケーションをパッケージングする</a></span></dt>
<dt><span class="sect1"><a href="#full-update">23.3. GNOME を新バージョンに更新する</a></span></dt>
<dt><span class="sect1"><a href="#patching">23.4. 修正の指針</a></span></dt>
</dl></dd>
</dl>
</div>
</div>
<div class="chapter" title="Chapter 10. 新しいパッケージを一から作る">
<div class="titlepage"><div><div><h2 class="title">
<a name="creating"></a>Chapter 10. 新しいパッケージを一から作る</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#creating.common">10.1. ありがちな種類のパッケージ</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#creating.perl-module">10.1.1. Perl モジュール</a></span></dt>
<dt><span class="sect2"><a href="#creating.kde-app">10.1.2. KDE アプリケーション</a></span></dt>
<dt><span class="sect2"><a href="#creating.python-module">10.1.3. Python モジュールおよびプログラム</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#creating.examples">10.2. 例</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#creating.nvu">10.2.1. www/nvu パッケージはいかに pkgsrc に追加されたか</a></span></dt></dl></dd>
</dl>
</div>
<p>あなたが pkgsrc にまだ入っていないパッケージを見つけた場合、
たいていはソースコードをどの URL からダウンロードできるかわかっているでしょう。
この URL をもとにして、
いくつかの段階を踏むだけでパッケージを作成することができます。</p>
<div class="procedure"><ol class="procedure" type="1">
<li class="step" title="Step 1"><p>最初に、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/url2pkg/README.html" target="_top"><code class="filename">pkgtools/url2pkg</code></a> および <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkglint/README.html" target="_top"><code class="filename">pkgtools/pkglint</code></a> の両パッケージをインストールします。</p></li>
<li class="step" title="Step 2"><p>次に、そのパッケージの属するカテゴリーとして、
最上層のディレクトリーをひとつ選びます。既存のもののかわりに、
専用のディレクトリー (<code class="filename">local</code> など) を作ってもかまいません。
このカテゴリーのディレクトリーの下に、パッケージ用にもうひとつディレクトリーを作り、
その中に移動します。</p></li>
<li class="step" title="Step 3"><p>プログラム <span class="command"><strong>url2pkg</strong></span> を実行します。
実行すると URL をたずねてきます。配布ファイル (たいていは
<code class="filename">.tar.gz</code> ファイルです)の URL を入力して、
パッケージの基本的な要素が自動的に作られてゆくようすを観察します。
配布ファイルは自動的に展開され、
<code class="filename">Makefile</code> の詳しい内容の一部を自動的に書いてくれますが、
残りは手動でやる必要があるでしょう。</p></li>
<li class="step" title="Step 4">
<p>パッケージの依存性を判断するため、展開されたファイルを調べます。
<code class="filename">README</code> のようなファイルに依存性について書かれているのが理想的ですが、
実際はそうなっていないこともあります。
それぞれの依存先について、それが pkgsrc のどこにあるかを調べて、
依存先のディレクトリーに <code class="filename">buildlink3.mk</code>
というファイルがある場合はそれを <code class="filename">Makefile</code>
の最後の行の直前でインクルードします。
依存先に <code class="filename">buildlink3.mk</code> がない場合は、
このファイルをまず作ります。<code class="filename">buildlink3.mk</code> ファイルは、
依存先パッケージのインクルードファイルとライブラリーが確実に用意されるようにするためのものです。</p>
<p>単に、あるパッケージに含まれるバイナリーが必要なだけならば、
依存するバージョンと pkgsrc における場所を指定する
<code class="varname">DEPENDS</code> 行を Makefile に追加します。
この行は 3 番目の段落に書くようにします。
依存性がパッケージを構築するためだけに必要で、使用するためには必要ない場合は、
<code class="varname">DEPENDS</code> ではなく <code class="varname">BUILD_DEPENDS</code> を使います。
これにより、作成中のパッケージは以下のようになるでしょう。</p>
<pre class="programlisting">
[...]

BUILD_DEPENDS+= lua&gt;=5.0:../../lang/lua
DEPENDS+=       screen-[0-9]*:../../misc/screen
DEPENDS+=       screen&gt;=4.0:../../misc/screen

[...]

.include "../../<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>package</code></em>/buildlink3.mk"
.include "../../devel/glib2/buildlink3.mk"
.include "../../mk/bsd.pkg.mk"
</pre>
</li>
<li class="step" title="Step 5"><p>パッケージを<span class="quote">“<span class="quote">使い物</span>”</span>にするにはあと何をする必要があるかを確認するため、
<span class="command"><strong>pkglint</strong></span> を実行します。
pkglint のメッセージの意味がわからない場合は、
追加説明を出力してくれる <span class="command"><strong>pkglint
--explain</strong></span> または <span class="command"><strong>pkglint
-e</strong></span> を試してみてください。</p></li>
<li class="step" title="Step 6"><p>多くの場合、パッケージはまだ構築できるようにはなっていません。
もっともありがちな場合については、次の節<a class="xref" href="#creating.common" title="10.1. ありがちな種類のパッケージ">Section 10.1, “ありがちな種類のパッケージ”</a>で説明しています。この説明に従えば、
おそらく先に進めるでしょう。</p></li>
<li class="step" title="Step 7"><p><span class="command"><strong>bmake clean</strong></span> を実行して、
作業ディレクトリーから展開されたファイルを掃除します。
作業ディレクトリーには、展開されたファイルのほかにも、
キャッシュファイルその他のシステム情報が置かれており、
これらが残っていると <code class="filename">Makefile</code>
編集後に悪影響のあることがあります。</p></li>
<li class="step" title="Step 8"><p>ここで、<span class="command"><strong>bmake</strong></span> を実行してパッケージを構築します。
この段階では、さまざまな要因により構築がうまくいかないことがありますので、<a class="xref" href="#fixes" title="Chapter 19. パッケージを動くようにする">Chapter 19, <i>パッケージを動くようにする</i></a>を調べてください。</p></li>
<li class="step" title="Step 9"><p>パッケージがうまく構築できた場合、次にすることは、
パッケージのインストールです。<span class="command"><strong>bmake install</strong></span>
を実行して、うまくいくようお祈りします。</p></li>
<li class="step" title="Step 10"><p>ここに至るまで、パッケージがインストールしたファイルの一覧を内容にもつ
<code class="filename">PLIST</code> ファイルの内容は、
ほとんど空でした。<span class="command"><strong>bmake print-PLIST
&gt;PLIST</strong></span> を実行して、おそらく正しいであろう一覧を作成します。
作成したファイルを、お好きなテキストエディターを使って、
ファイルの一覧がそれらしいものになっているか確認します。</p></li>
<li class="step" title="Step 11"><p>再度 <span class="command"><strong>pkglint</strong></span> を実行して、
作成した <code class="filename">PLIST</code> に余計なものが含まれていないか調べます。</p></li>
<li class="step" title="Step 12"><p>さきほど <span class="command"><strong>bmake install</strong></span> を実行した時に、
インストールされたファイルのデータベースにこのパッケージが登録されましたが、
ファイルの一覧は空のものが登録されています。これを修正するため、
<span class="command"><strong>bmake deinstall</strong></span> を実行してから <span class="command"><strong>bmake install</strong></span>
を再度実行します。これで、このパッケージは <code class="filename">PLIST</code>
のファイルの一覧とともに登録されます。</p></li>
<li class="step" title="Step 13"><p><span class="command"><strong>bmake package</strong></span> を実行して、
インストールされたファイル一式からバイナリーパッケージを作成します。</p></li>
</ol></div>
<div class="sect1" title="10.1. ありがちな種類のパッケージ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="creating.common"></a>10.1. ありがちな種類のパッケージ</h2></div></div></div>
<div class="sect2" title="10.1.1. Perl モジュール">
<div class="titlepage"><div><div><h3 class="title">
<a name="creating.perl-module"></a>10.1.1. Perl モジュール</h3></div></div></div>
<p>簡単な Perl モジュールは、<span class="command"><strong>url2pkg</strong></span>
を使って、依存性も含めて自動的に処理することができます。</p>
</div>
<div class="sect2" title="10.1.2. KDE アプリケーション">
<div class="titlepage"><div><div><h3 class="title">
<a name="creating.kde-app"></a>10.1.2. KDE アプリケーション</h3></div></div></div>
<p>KDE アプリケーションは、かならず
<code class="filename">meta-pkgs/kde3/kde3.mk</code> をインクルードしてください。
これには、KDE パッケージでよくある設定が多数含まれています。</p>
</div>
<div class="sect2" title="10.1.3. Python モジュールおよびプログラム">
<div class="titlepage"><div><div><h3 class="title">
<a name="creating.python-module"></a>10.1.3. Python モジュールおよびプログラム</h3></div></div></div>
<p>Python のモジュールとプログラムは、
あらかじめ用意された変数を使って、簡単にパッケージを作ることができます。</p>
<p>ほとんどの Python パッケージは、<span class="quote">“<span class="quote">distutils</span>”</span> または
easy-setup (<span class="quote">“<span class="quote">eggs</span>”</span>) のいずれかを使っています。
ソフトウェアが <span class="quote">“<span class="quote">distutils</span>”</span> を使っている場合は、
pkgsrc がこの枠組を使うようにするため、
<code class="varname">PYDISTUTILSPKG</code> 変数を <span class="quote">“<span class="quote">yes</span>”</span> に設定します。
<span class="quote">“<span class="quote">distutils</span>”</span> では、<code class="filename">setup.py</code> という名前のスクリプトを使いますが、
<span class="quote">“<span class="quote">distutils</span>”</span> ドライバーが
<code class="filename">setup.py</code> という名前でない場合は、
<code class="varname">PYSETUP</code> 変数をスクリプト名に設定します。</p>
<p>
ソフトウェアが既定の Python バージョンに対応していない場合は、
<code class="varname">PYTHON_VERSIONS_ACCEPTED</code> 変数を、
そのソフトウェアが動作する Python バージョンに設定します。
バージョンは新しいものから古いものの順に並べます。たとえば以下のようにします。
</p>
<pre class="programlisting">
PYTHON_VERSIONS_ACCEPTED=       25 24
</pre>
<p>
パッケージにするソフトウェアが Python モジュールである場合は、
<span class="quote">“<span class="quote"><code class="filename">../../lang/python/extension.mk</code></span>”</span> をインクルードします。
この場合は、パッケージのディレクトリー名を
<span class="quote">“<span class="quote">py-software</span>”</span> という形式にし、
<code class="varname">PKGNAME</code> を
<span class="quote">“<span class="quote">${PYPKGPREFIX}-${DISTNAME}</span>”</span> に設定します。たとえば以下のようにします。
</p>
<pre class="programlisting">
DISTNAME=   foopymodule-1.2.10
PKGNAME=    ${PYPKGPREFIX}-${DISTNAME}
</pre>
<p>パッケージにするソフトウェアがアプリケーションである場合は、
<span class="quote">“<span class="quote">extension.mk</span>”</span> をインクルードする前に
<span class="quote">“<span class="quote"><code class="filename">../../lang/python/application.mk</code></span>”</span> もインクルードします。</p>
<p>パッケージにするソフトウェア (アプリケーションでもモジュールでも) が
egg に対応している場合、必要なことは、
<span class="quote">“<span class="quote"><code class="filename">../../lang/python/egg.mk</code></span>”</span> をインクルードすることだけです。</p>
<p>Python インタープリターへのパスを適切に設定するために、
<code class="varname">REPLACE_PYTHON</code> 変数を使います。この変数に、
パスの修正が必要なファイルのリストを設定します。たとえば以下のようにします。
</p>
<pre class="programlisting">
REPLACE_PYTHON=   ${WRKSRC}/*.py
</pre>
</div>
</div>
<div class="sect1" title="10.2. 例">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="creating.examples"></a>10.2. 例</h2></div></div></div>
<div class="sect2" title="10.2.1. www/nvu パッケージはいかに pkgsrc に追加されたか">
<div class="titlepage"><div><div><h3 class="title">
<a name="creating.nvu"></a>10.2.1. www/nvu パッケージはいかに pkgsrc に追加されたか</h3></div></div></div>
<div class="sect3" title="10.2.1.1. 作り始めのパッケージ">
<div class="titlepage"><div><div><h4 class="title">
<a name="creating.nvu.init"></a>10.2.1.1. 作り始めのパッケージ</h4></div></div></div>
<p>私は <code class="filename">pkgsrc/doc/TODO</code> ファイルを見て、
<span class="quote">“<span class="quote">nvu</span>”</span> パッケージが pkgsrc にまだ入っていないことに気づきました。
web 用に使うものと説明されているので、カテゴリーの選択は明らかに
<span class="quote">“<span class="quote">www</span>”</span> です。</p>
<pre class="programlisting">
<code class="prompt">$</code> mkdir www/nvu
<code class="prompt">$</code> cd www/nvu
</pre>
<p>web サイトによれば、ソースは tar ファイルの形で用意されているので、
その URL を <span class="command"><strong>url2pkg</strong></span> プログラムに与えます。</p>
<pre class="programlisting">
<code class="prompt">$</code> url2pkg http://cvs.nvu.com/download/nvu-1.0-sources.tar.bz2
</pre>
<p>エディターが立ち上がりますので、<code class="varname">DISTNAME</code> の行の前に
<code class="varname">PKGNAME</code> の行を追加します。パッケージ名に
<span class="quote">“<span class="quote">sources</span>”</span> という単語は含めないものだからです。さらに、
<code class="varname">MAINTAINER</code>, <code class="varname">HOMEPAGE</code>,
<code class="varname">COMMENT</code> の各行を記載します。これにより、
パッケージの <code class="filename">Makefile</code> は以下のようになります。</p>
<pre class="programlisting">
# $NetBSD$
#

DISTNAME=       nvu-1.0-sources
PKGNAME=        nvu-1.0
CATEGORIES=     www
MASTER_SITES=   http://cvs.nvu.com/download/
EXTRACT_SUFX=   .tar.bz2

MAINTAINER=     rillig@NetBSD.org
HOMEPAGE=       http://cvs.nvu.com/
COMMENT=        Web Authoring System

# url2pkg-marker (please do not remove this line.)
.include "../../mk/bsd.pkg.mk"
</pre>
<p>ここで、エディターを終了し、
pkgsrc が大きなソースアーカイブをダウンロードするのを観察します。</p>
<pre class="programlisting">
url2pkg&gt; Running "make makesum" ...
=&gt; Required installed package digest&gt;=20010302: digest-20060826 found
=&gt; Fetching nvu-1.0-sources.tar.bz2
Requesting http://cvs.nvu.com/download/nvu-1.0-sources.tar.bz2
100% |*************************************| 28992 KB  150.77 KB/s00:00 ETA
29687976 bytes retrieved in 03:12 (150.77 KB/s)
url2pkg&gt; Running "make extract" ...
=&gt; Required installed package digest&gt;=20010302: digest-20060826 found
=&gt; Checksum SHA1 OK for nvu-1.0-sources.tar.bz2
=&gt; Checksum RMD160 OK for nvu-1.0-sources.tar.bz2
work.bacc -&gt; /tmp/roland/pkgsrc/www/nvu/work.bacc
===&gt; Installing dependencies for nvu-1.0
===&gt; Overriding tools for nvu-1.0
===&gt; Extracting for nvu-1.0
url2pkg&gt; Adjusting the Makefile.

Remember to correct CATEGORIES, HOMEPAGE, COMMENT, and DESCR when you're done!

Good luck! (See pkgsrc/doc/pkgsrc.txt for some more help :-)
</pre>
</div>
<div class="sect3" title="10.2.1.2. パッケージを機能するようにするための多くの問題を修正する">
<div class="titlepage"><div><div><h4 class="title">
<a name="creating.nvu.problems"></a>10.2.1.2. パッケージを機能するようにするための多くの問題を修正する</h4></div></div></div>
<p>これで、パッケージが展開されたので、その内容を見ていきましょう。
このパッケージには <code class="filename">README.txt</code> がありますが、
mozilla に関することしか書かれていませんので、おそらく、
パッケージの依存性を調べるための役には立たないでしょう。
しかし、パッケージに GNU configure スクリプトがあるので、
必要なものについて逐一文句を言ってくれることを期待しましょう。</p>
<pre class="programlisting">
<code class="prompt">$</code> bmake
=&gt; Required installed package digest&gt;=20010302: digest-20060826 found
=&gt; Checksum SHA1 OK for nvu-1.0-sources.tar.bz2
=&gt; Checksum RMD160 OK for nvu-1.0-sources.tar.bz2
===&gt; Patching for nvu-1.0
===&gt; Creating toolchain wrappers for nvu-1.0
===&gt; Configuring for nvu-1.0
[...]
configure: error: Perl 5.004 or higher is required.
[...]
WARNING: Please add USE_TOOLS+=perl to the package Makefile.
[...]
</pre>
<p>うまく文句を言ってくれました。そこで、パッケージの Makefile
をエディターで開き、<code class="varname">USE_TOOLS</code> 行がすでにあったので、
そこに <span class="quote">“<span class="quote">perl</span>”</span> を追加します。これによりパッケージの依存性が変更されたこと、
また、perl のラッパーが <span class="quote">“<span class="quote">tools</span>”</span> 相で自動的にインストールされることから、
パッケージの構築を最初からやり直すことが必要になりました。</p>
<pre class="programlisting">
<code class="prompt">$</code> bmake clean
===&gt; Cleaning for nvu-1.0
<code class="prompt">$</code> bmake
[...]
*** /tmp/roland/pkgsrc/www/nvu/work.bacc/.tools/bin/make is not \
GNU Make.  You will not be able to build Mozilla without GNU Make.
[...]
</pre>
<p>そこで、<span class="quote">“<span class="quote">gmake</span>”</span> を
<code class="varname">USE_TOOLS</code> 行に追加して、もう一度 (最初から) やり直します。</p>
<pre class="programlisting">
[...]
checking for GTK - version &gt;= 1.2.0... no
*** Could not run GTK test program, checking why...
[...]
</pre>
<p>今度は別の依存性です。最初の問題は、
「GTK のパッケージは pkgsrc のどこに隠されているか?」です。</p>
<pre class="programlisting">
<code class="prompt">$</code> echo ../../*/gtk*
[many packages ...]
<code class="prompt">$</code> echo ../../*/gtk
../../x11/gtk
<code class="prompt">$</code> echo ../../*/gtk2
../../x11/gtk2
<code class="prompt">$</code> echo ../../*/gtk2/bui*
../../x11/gtk2/buildlink3.mk
</pre>
<p>最初の結果は、明らかに多すぎです。二つ目は、ただひとつの結果が出ており、
非常にみごとです。しかし、ここには GNOME パッケージに関する罠があります。
GNOME 2 がリリースされる前から、pkgsrc にはすでに多数の
GNOME 1 パッケージがありました。そのような GNOME 1
パッケージをそのまま使い続けることができるようにするために、
GNOME 2 パッケージはそれらとは別のパッケージとして導入されており、
通常はパッケージ名に <span class="quote">“<span class="quote">2</span>”</span> が付け加えられています。
このため、gtk がこれに該当するかを確認したところ、
実際に該当していました。</p>
<p>GTK2 パッケージには <code class="filename">buildlink3.mk</code>
があるので、依存性の追加は非常に簡単です。パッケージの
<code class="filename">Makefile</code> の最後の行の直前に
<code class="literal">.include</code> 行を追加します。これにより以下のようになりました。</p>
<pre class="programlisting">
[...]
.include "../../x11/gtk2/buildlink3.mk"
.include "../../mk/bsd.pkg.mk
</pre>
<p>改めて <span class="command"><strong>bmake clean &amp;&amp; bmake</strong></span> を実行すると、
以下のようになりました。</p>
<pre class="programlisting">
[...]
checking for gtk-config... /home/roland/pkg/bin/gtk-config
checking for GTK - version &gt;= 1.2.0... no
*** Could not run GTK test program, checking why...
*** The test program failed to compile or link. See the file config.log for the
*** exact error that occured. This usually means GTK was incorrectly installed
*** or that you have moved GTK since it was installed. In the latter case, you
*** may want to edit the gtk-config script: /home/roland/pkg/bin/gtk-config
configure: error: Test for GTK failed.
[...]
</pre>
<p>この事例では、<span class="quote">“<span class="quote">どのパッケージも GNOME 2 を好む</span>”</span>との仮定は誤りでした。
上のエラーメッセージの最初のほうの行から、
このパッケージは実際には GNOME 1 バージョンの GTK を必要としていることがわかります。
もしこのパッケージが GTK2 を探していたなら、<span class="command"><strong>gtk-config</strong></span>
ではなく <span class="command"><strong>pkg-config</strong></span> を探していたでしょう。
そこで、パッケージの <code class="filename">Makefile</code> 中の <code class="literal">x11/gtk2</code>
を <code class="literal">x11/gtk</code> に書き換えてから、
またやり直します。</p>
<pre class="programlisting">
[...]
cc -o xpidl.o -c -DOSTYPE=\"NetBSD3\" -DOSARCH=\"NetBSD\"   -I../../../dist/include/xpcom -I../../../dist/include -I/tmp/roland/pkgsrc/www/nvu/work.bacc/mozilla/dist/include/nspr -I/usr/X11R6/include   -fPIC -DPIC -I/home/roland/pkg/include -I/usr/include  -I/usr/X11R6/include -Wall -W -Wno-unused -Wpointer-arith -Wcast-align -Wno-long-long -pedantic -O2 -I/home/roland/pkg/include -I/usr/include -Dunix -pthread -pipe  -DDEBUG -D_DEBUG -DDEBUG_roland -DTRACING -g -I/home/roland/pkg/include/glib/glib-1.2 -I/home/roland/pkg/lib/glib/include -I/usr/pkg/include/orbit-1.0   -I/home/roland/pkg/include -I/usr/include  -I/usr/X11R6/include -include ../../../mozilla-config.h -DMOZILLA_CLIENT -Wp,-MD,.deps/xpidl.pp xpidl.c
In file included from xpidl.c:42:
xpidl.h:53:24: libIDL/IDL.h: No such file or directory
In file included from xpidl.c:42:
xpidl.h:132: error: parse error before "IDL_ns"
[...]
</pre>
<p>パッケージの依存先が、まだ全部は見つかっていません。
ここでの問題は「ヘッダーファイル <code class="filename">libIDL/IDL.h</code>
はどのパッケージが提供しているのか?」です。</p>
<pre class="programlisting">
<code class="prompt">$</code> echo ../../*/*idl*
../../devel/py-idle ../../wip/idled ../../x11/acidlaunch
<code class="prompt">$</code> echo ../../*/*IDL*
../../net/libIDL
</pre>
<p>二つ目で見つかったものを試してみましょう。そこで、
<code class="filename">../../net/libIDL/buildlink3.mk</code> ファイルをインクルードしてから、
またやり直します。しかし、エラーはさきほどと変わりません。コードをいくらか調べたすえ、
パッケージの構築の過程が壊れているせいで機能しないという結論に達しました。
しかし、Mozilla のソースツリーは非常に巨大なので、修正する気にはなりません。
そこで、パッケージの <code class="filename">Makefile</code> に以下の内容を追加して、
またやり直します。</p>
<pre class="programlisting">
CPPFLAGS+=              -I${BUILDLINK_PREFIX.libIDL}/include/libIDL-2.0
BUILDLINK_TRANSFORM+=   -l:IDL:IDL-2
</pre>
<p>パッケージ側では <code class="filename">libIDL.so</code>
というライブラリーを期待していますが、実際には
<code class="filename">libIDL-2.so</code> だけが利用可能なので、下の行が必要です。
これにより、コンパイラーのラッパーにその場で書き換えをするよう伝えます。</p>
<p>次の問題は、FreeType インターフェースの最近の変更に関するものです。
<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/seamonkey/README.html" target="_top"><code class="filename">www/seamonkey</code></a> のパッチファイルがこの問題に対処しているので、
これを <code class="filename">patches</code> ディレクトリーにコピーします。
そして、はじめからやり直し、パッチをきれいに適用できるよう修正して、
またやり直します。これで、すべてうまくいきました。</p>
</div>
<div class="sect3" title="10.2.1.3. パッケージをインストールする">
<div class="titlepage"><div><div><h4 class="title">
<a name="creating.nvu.inst"></a>10.2.1.3. パッケージをインストールする</h4></div></div></div>
<pre class="programlisting">
<code class="prompt">$</code> bmake CHECK_FILES=no install
[...]
<code class="prompt">$</code> bmake print-PLIST &gt;PLIST
<code class="prompt">$</code> bmake deinstall
<code class="prompt">$</code> bmake install
</pre>
</div>
</div>
</div>
</div>
<div class="chapter" title="Chapter 11. パッケージコンポーネント - ファイル、ディレクトリー、およびコンテンツ">
<div class="titlepage"><div><div><h2 class="title">
<a name="components"></a>Chapter 11. パッケージコンポーネント - ファイル、ディレクトリー、およびコンテンツ</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#components.Makefile">11.1. <code class="filename">Makefile</code></a></span></dt>
<dt><span class="sect1"><a href="#components.distinfo">11.2. <code class="filename">distinfo</code></a></span></dt>
<dt><span class="sect1"><a href="#components.patches">11.3. patches/*</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#components.patch.structure">11.3.1. 個々のパッチファイルの構造</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.caveats">11.3.2. パッチファイルを作成する</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.sources">11.3.3. パッチファイルの出どころ</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.guidelines">11.3.4. パッチ作成の指針</a></span></dt>
<dt><span class="sect2"><a href="#components.patches.feedback">11.3.5. 作者へのフィードバック</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#other-mandatory-files">11.4. その他の必須のファイル</a></span></dt>
<dt><span class="sect1"><a href="#components.optional">11.5. オプションのファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#components.optional.bin">11.5.1. バイナリーパッケージに影響をおよぼすファイル</a></span></dt>
<dt><span class="sect2"><a href="#components.optional.build">11.5.2. 構築の過程に影響をおよぼすファイル</a></span></dt>
<dt><span class="sect2"><a href="#components.optional.none">11.5.3. 何の影響もおよぼさないファイル</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#work-dir">11.6. <code class="filename">work*</code></a></span></dt>
<dt><span class="sect1"><a href="#files-dir">11.7. <code class="filename">files/*</code></a></span></dt>
</dl>
</div>
<p>パッケージを用意する際にはいつも、以下のセクションで述べられている多くのファ
イルが存在します。</p>
<div class="sect1" title="11.1. Makefile">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.Makefile"></a>11.1. <code class="filename">Makefile</code>
</h2></div></div></div>
<p>構築、インストールおよびバイナリーパッケージの作成は、すべてパッケージの
  <code class="filename">Makefile</code>によりコントロールされます。
  <code class="filename">Makefile</code> には、パッケージに関するさまざまな情報が記述されています。
  たとえば、パッケージをどこで取得するか、
  パッケージをどのように構成、構築、インストールするか、などです。</p>
<p>パッケージの <code class="filename">Makefile</code> は、
  当該パッケージについて記述した、複数の節からなっています。</p>
<p>最初の節には、以下に掲げる変数を書きます。
  これらは以下に掲げたままの順で並べるようにします。
  このような変数の順序や節へのまとめ方は、ほとんど歴史的なものであって、
  それ以上の意味はありません。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">DISTNAME</code> は、当該パッケージの
    web サイトからダウンロードされる配布ファイルの
    基礎となる名前です。</p></li>
<li class="listitem"><p><code class="varname">PKGNAME</code> は、
    pkgsrc が使うパッケージ名です。これは、
    <code class="varname">DISTNAME</code> (標準での値) が pkgsrc
    におけるパッケージ名としてふさわしくない場合のみ書く必要があります。
    通常、これはディレクトリー名とバージョン番号を合わせたものになります。
    この値は正規表現 <code class="varname">^[A-Za-z0-9][A-Za-z0-9-_.+]*$</code>
    にマッチする必要があります。すなわち、使える文字は、
    アルファベット・数字・マイナス記号・下線・ピリオド・プラス記号だけであり、
    また、最初の文字はアルファベットまたは数字である必要があります。</p></li>
<li class="listitem"><p><code class="varname">SVR4_PKGNAME</code> は、
    <code class="varname">PKGNAME</code> が SVR4 のシステムにおいて一意なものにならない場合に、
    パッケージファイルを作成する際に使う名前です。標準では
    <code class="varname">PKGNAME</code> であり、これの短縮は
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/gensolpkg/README.html" target="_top"><code class="filename">pkgtools/gensolpkg</code></a> を使っておこなうことができます。
    <code class="varname">SVR4_PKGNAME</code> を使うのは、SVR4 のシステムで
    <code class="varname">PKGNAME</code> から一意なパッケージ名が得られない場合だけです。
    <code class="varname">SVR4_PKGNAME</code> の長さの上限は 5 文字です。</p></li>
<li class="listitem">
<p><code class="varname">CATEGORIES</code> は、
    当該パッケージにふさわしいカテゴリーのリストです。
    pkgsrc の最上層にあるディレクトリーから自由に選ぶことができます。</p>
<p>現在<code class="varname">CATEGORIES</code>の値として以下が使用できます。もし複数にまたがる場合、それら
    の値はスペースで分けられる必要があります:</p>
<pre class="programlisting">
archivers     cross         geography     meta-pkgs     security
audio         databases     graphics      misc          shells
benchmarks    devel         ham           multimedia    sysutils
biology       editors       inputmethod   net           textproc
cad           emulators     lang          news          time
chat          finance       mail          parallel      wm
comms         fonts         math          pkgtools      www
converters    games         mbone         print         x11
</pre>
</li>
<li class="listitem"><p><code class="varname">MASTER_SITES</code>,
    <code class="varname">DYNAMIC_MASTER_SITES</code>,
    <code class="varname">DIST_SUBDIR</code>, <code class="varname">EXTRACT_SUFX</code>,
    <code class="varname">DISTFILES</code> の各変数については、
    <a class="xref" href="#build.fetch" title="17.5. fetch 相">Section 17.5, “<span class="emphasis"><em>fetch</em></span> 相”</a>で詳しく論じます。</p></li>
</ul></div>
<p>二つ目の節には、別途ダウンロードするパッチがある場合に、
  そのパッチに関する情報を書きます。
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PATCHFILES:</code>
    配布されているパッチを含んでいる、追加ファイルのファイル名です。
    標準の値はありません。pkgsrc はこのファイルを
    <code class="varname">PATCH_SITES</code> から探します。
    ファイル名の末尾が <code class="filename">.gz</code> または
    <code class="filename">.Z</code> の場合は、
    パッチ適用前に自動的に伸長されます。</p></li>
<li class="listitem"><p><code class="varname">PATCH_SITES</code>:
    配布されているパッチファイル (上述の
    <code class="varname">PATCHFILES</code> を参照) がローカルにない場合用の、主な配布場所です。</p></li>
</ul></div>
<p>三つ目の節には、以下に掲げる変数を書きます。
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">MAINTAINER</code> は、
    当該パッケージの担当者であることを自覚しており、
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?send-pr+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> を使って報告された問題や質問の面倒をもっともよく見そうな人の電子メールアドレスです。
    他の開発者がパッケージに変更を加える際には、
    事前に <code class="varname">MAINTAINER</code> に連絡してもかまいませんが、必ずしも連絡する必要はありません。
    新しいプログラムをパッケージ化する場合は、
    <code class="varname">MAINTAINER</code> をあなた自身に設定してください。
    そのパッケージを将来の更新に応じて保守することがどうしてもできない場合は、
    <code class="email">&lt;<a class="email" href="mailto:pkgsrc-users@NetBSD.org">pkgsrc-users@NetBSD.org</a>&gt;</code> に設定します。</p></li>
<li class="listitem"><p><code class="varname">OWNER</code> は、
    他の開発者に無断でパッケージを更新されたり変更されたりしたくない場合に、
    <code class="varname">MAINTAINER</code> のかわりに使うものです。
    パッケージの Makefile には、
    <code class="varname">MAINTAINER</code> または <code class="varname">OWNER</code>
    のいずれか一方を含めるようにしますが、
    両方書いてはいけません。  </p></li>
<li class="listitem"><p><code class="varname">HOMEPAGE</code> は、当該パッケージについて、
    利用者がより詳しい情報を得られる URL です。</p></li>
<li class="listitem"><p><code class="varname">COMMENT</code> は、
    当該パッケージについての一行説明です
    (パッケージ名は含めません)。</p></li>
</ul></div>
<p>このほか、構築に影響のある変数としては、以下のものがあります。
  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<p><code class="varname">WRKSRC</code>: 当該パッケージに関連する配布ファイルが置かれるディレクトリーです。
      標準では <code class="filename">${WRKDIR}/${DISTNAME}</code> になり、
      ほとんどのパッケージはこの標準状態のままで動作します。</p>
<p>パッケージが専用のサブディレクトリー
      (たとえば、ほとんどのGNUソフトウェアはこれを作ります) を作らずに、
      カレントディレクトリーに展開される場合、
      <code class="varname">WRKSRC=${WRKDIR}</code> を設定します。</p>
<p>パッケージが <code class="varname">DISTNAME</code> と同名のサブディレクトリーは作らずに、
      別の名前のサブディレクトリーを作る場合は、
      <code class="varname">WRKSRC</code> を設定して、
      <code class="filename">${WRKDIR}</code> 内の適切な名前を指すようにします。
      たとえば
      <code class="varname">WRKSRC=${WRKDIR}/${DISTNAME}/unix</code> のようにします。
      さらに別の例としては
      <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/lang/tcl/README.html" target="_top"><code class="filename">lang/tcl</code></a> と <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/x11/tk/README.html" target="_top"><code class="filename">x11/tk</code></a> を見てください。</p>
<p> pkgsrc が作成する作業用ディレクトリーの名前には、
      <code class="varname">WRKDIR_BASENAME</code>
      変数が使われます。この値は、標準では
      <code class="filename">work</code> です。同じ
      pkgsrc ツリーを複数の異なる種類のバイナリーパッケージの構築用に使いたい場合は、
      必要に応じて、この変数の値を変えることができます。
      <code class="varname">WRKDIR_BASENAME</code> の設定をありがちな方法でおこなうために、
      二つの変数をそれぞれ使うことができます。
      <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で
      <code class="varname">OBJHOSTNAME</code> が定義されると、
      ホスト名の最初の部分がディレクトリー名に付け加えられます。
      <code class="varname">OBJMACHINE</code> が定義されると、
      <code class="filename">work.i386</code>
      や <code class="filename">work.sparc</code>
      のように、プラットフォーム名が付け加えられます。</p>
</li></ul></div>
<p>以下の事柄に気を配ってください。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>もしパッケージによりマニュアルページが圧縮され
      た形式でインストールされる場合、<code class="varname">MANCOMPRESSED</code>を追加してください。
      パッケージが BSD 形式の makefile を使っており、MANZ の設定に従う場合には、
      <code class="varname">MANCOMPRESSED_IF_MANZ</code> を使います。</p></li>
<li class="listitem"><p>すべてのファイルの<code class="filename">/usr/local</code>を<span class="quote">“<span class="quote">${PREFIX}</span>”</span>に変更してください。(後述のパッチ
      を参照)</p></li>
<li class="listitem"><p>もし、パッケージがinfoファイルをインストールするのであれば、<a class="xref" href="#faq.info-files" title="19.6.7. infoファイルをインストールするパッケージ">Section 19.6.7, “infoファイルをインストールするパッケージ”</a>を参照してください。</p></li>
</ul></div>
</div>
<div class="sect1" title="11.2. distinfo">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.distinfo"></a>11.2. <code class="filename">distinfo</code>
</h2></div></div></div>
<p><code class="filename">distinfo</code> ファイルには、パッケージが必要とする各
  distfile のメッセージダイジェストあるいはチェックサムが格納されます。
  作者が配布した元のファイルに対して、
  このメッセージダイジェストが一致することを確認しています。これをもとに、イ
  ンターネットから取得したdistfileが転送中にファイルが壊れたり、悪意によりセ
  キュリティーホールを入れられたファイルに変更されていたりしていないことを確
  認します。
  最近、ダイジェストアルゴリズムの弱さについての噂があるため、
  すべての distfile は、ファイルサイズに加えて、
  SHA1 と RMD160 の両方のメッセージダイジェストを使って守られています。</p>
<p><code class="filename">patches</code>
  ディレクトリーに入っているすべてのパッチ (<a class="xref" href="#components.patches" title="11.3. patches/*">Section 11.3, “patches/*”</a>参照) のチェックサムも、
  この <code class="filename">distinfo</code>ファイルに格納されます。</p>
<p><code class="filename">distinfo</code> ファイルを作り直すには、
  <span class="command"><strong>make makedistinfo</strong></span> または <span class="command"><strong>make mdi</strong></span>
  コマンドを使います。</p>
<p>パッケージのなかには、プラットフォームによってdistfileの組が異なるものがありま
  す(たとえば <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/lang/openjdk7/README.html" target="_top"><code class="filename">lang/openjdk7</code></a>)。この情報は単一の<code class="filename">distinfo</code>ファイルに
  書かれるので、このようなパッケージの更新時には、distfileの情報が失われない
  ように注意を払ってください。</p>
</div>
<div class="sect1" title="11.3. patches/*">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.patches"></a>11.3. patches/*</h2></div></div></div>
<p>多くのパッケージは、pkgsrc で対応している各種プラットフォーム上で、
  まだ無修正では動きません。このため、そのようなパッケージを動くようにするために、
  多数の独自のパッチファイルが必要です。このパッチファイルは、
  <code class="filename">patches/</code> ディレクトリーにあります。</p>
<p><span class="emphasis"><em>patch</em></span> 相では、<code class="varname">WRKSRC</code>
  以下にファイルが展開された後に、展開されたファイルに対して、
  このパッチファイルが<a class="ulink" href="http://www.opengroup.org/onlinepubs/009695399/utilities/xcu_chap02.html#tag_02_13_03" target="_top">アルファベット
  順</a>で適用されます。</p>
<div class="sect2" title="11.3.1. 個々のパッチファイルの構造">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patch.structure"></a>11.3.1. 個々のパッチファイルの構造</h3></div></div></div>
<p>問題を避けるため、<code class="filename">patch-*</code>ファイルは
  <span class="command"><strong>diff -bu</strong></span>フォーマットとし、かつ、曖昧
  さなしで適用できるようにします。(曖昧さがあっても強制的にパッチを適用させる
  ため、<code class="varname">PATCH_FUZZ_FACTOR=-F2</code>を設定することができます)。
  さらに、各パッチファイルは一つのファイルに対する修正だけを含むようにし、
  また、一つのファイルを複数のパッチファイルによって修正するようなことはしないようにします。
  こうすることで、将来の変更が簡単になります。</p>
<p>各パッチファイルは、以下のような構造となっています: 最初の行には
  パッチそのものの RCS Id があります。2 行目は、見栄えをよくするため、
  空にします。これより後には、そのパッチによる各変更についてのコメントを書きます。
  これには標準的な事例がいくつもあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>一般に知られている脆弱性に対するパッチには、
  その脆弱性の ID (CAN, CVE) を記すようにします。</p></li>
<li class="listitem"><p>ソースコードを変更するパッチには、
  そのパッチを必要とするプラットフォームやその他の環境 (たとえばコンパイラー)
  を記すようにします。</p></li>
</ul></div>
<p>あらゆる事例において、
  そのアプリケーションのコードを理解している開発者がパッチを利用できるようにするため、
  パッチにはコメントを書くようにします。上流の開発者に対しては特に注意が必要です。
  たいていの場合、私たちの将来の作業を減らすために、
  上流の開発者にパッチを採用してもらいたいからです。</p>
</div>
<div class="sect2" title="11.3.2. パッチファイルを作成する">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.caveats"></a>11.3.2. パッチファイルを作成する</h3></div></div></div>
<p>一つ重要なこととして、NetBSD CVSツリーにチェックインした後に問題を引き起こ
  すので、パッチファイルにRCS IDを含ませないように注意してください。
  この問題を避けるため、 <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdiff/README.html" target="_top"><code class="filename">pkgtools/pkgdiff</code></a> パッケージの
  <span class="command"><strong>pkgdiff</strong></span>
  コマンドを使ってください。</p>
<p>さらに自動化するため、同パッケージの<span class="command"><strong>mkpatches</strong></span>を使ってパッチ一式を作ることを
  おすすめします。あなたがやらねばならないことは、ファイルの編集前に
  <span class="command"><strong>cp -p filename filename.orig</strong></span>のようにするか、あるいはさらに簡単に、同パッケージの
  <span class="command"><strong>pkgvi</strong></span>を使って、元のファイルを<code class="filename">filename.orig</code>の名前でバックアップしておくだ
  けです。この方法でパッケージをアップグレードした場合、<span class="command"><strong>patchdiff</strong></span>を使って、新
  しいパッチと既存のパッチを簡単に比較することができます。
  <code class="filename">patches</code> 以下のファイルは新しいファイルに置き換えられますので、
  変更点が適切かどうかをしっかり確認してください。</p>
<p>パッケージを作り終えたとき、忘れずに<span class="command"><strong>make
  makepatchsum</strong></span>コマンドでパッチファ
  イルのチェックサムを生成するようにしてください。<a class="xref" href="#components.distinfo" title="11.2. distinfo">Section 11.2, “<code class="filename">distinfo</code>”</a>を参照してくだ
  さい。</p>
<p>(たとえば、マニュアルページのインストール先を
  pkgsrc の流儀に合わせて変えるといったものではなく)
  distfile の問題を正すパッチを追加した場合は、
  そのパッチをバグ報告としてメンテナーに送ってください。
  こうすることで、pkgsrc を使っていない利用者も幸せになれますし、
  通常は、将来のバージョンでパッチを削除することができるようになります。</p>
<p>パッチファイルのファイル名は、通常は
  <code class="filename">patch-<em class="replaceable"><code>path_to_file__with__underscores.c</code></em></code> という形式です。
  多くのパッケージでは、以前使われていた
  <code class="filename">patch-<em class="replaceable"><code>[a-z][a-z]</code></em></code> という形式をまだ使っていますが、
  パッチを新たに作る場合は、ファイル名を含んだ形式にしてください。<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdiff/README.html" target="_top"><code class="filename">pkgtools/pkgdiff</code></a> に含まれている
  <span class="command"><strong>mkpatches</strong></span> は、
  パッチファイルのファイル名を自動で処理します。</p>
</div>
<div class="sect2" title="11.3.3. パッチファイルの出どころ">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.sources"></a>11.3.3. パッチファイルの出どころ</h3></div></div></div>
<p>pkgsrc の複数のパッケージが同じ distfile を使っているなどの理由で、
  複数のパッケージの間でパッチを共有したい場合は、
  <code class="varname">PATCHDIR</code> をパッチファイルのある場所へのパスに設定します。
  たとえば以下のようにします。</p>
<pre class="programlisting">
PATCHDIR= ${.CURDIR}/../xemacs/patches
</pre>
<p>作者その他のメンテナーが配布しているパッチファイルは、
    <code class="varname">PATCHFILES</code>
    に列挙することができます。</p>
<p>置いておきたいパッチがあるがpkgsrcにcommitすべきものではない場合、それを
    pkgsrcツリーの外の
    <code class="filename">$LOCALPATCHES</code>
    ディレクトリーに置いておくことができます。こ
    のディレクトリーツリーはpkgsrcと同様の
    <span class="quote">“<span class="quote">category/package</span>”</span>の構造を持つように
    し、パッチを各パッケージのディレクトリー(すなわち<code class="filename">$LOCALPATCHES/$PKGPATH</code>)に
    置くようになっています。たとえば、
    <code class="filename">pkgsrc/graphics/png</code>に私的なパッチを適用す
    るようにしたい場合は、そのパッチを
    <code class="filename">$LOCALPATCHES/graphics/png/mypatch</code>に置き
    ます。このディレクトリーにあるファイルはすべてパッチファイルとして扱われ、
    <span class="emphasis"><em>pkgsrcのパッチが適用された後に、このパッチが適用されます</em></span>。</p>
</div>
<div class="sect2" title="11.3.4. パッチ作成の指針">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.guidelines"></a>11.3.4. パッチ作成の指針</h3></div></div></div>
<p>コードの移植性に関する問題を修正する場合は、
      プリプロセッサーの細工を使ってオペレーティングシステムやプラットフォームを判別するようなことはしてはいけません。
      そのような方法では、各 OS 固有性の詳細が適切に抽象化できないため、
      他のオペレーティングシステムに対する移植性を損なってしまいます。</p>
<p>一般的な決めごとは、
      アプリケーションを構築しているオペレーティングシステムそのものを検査するのではなく、
      必要としている特有の<span class="emphasis"><em>機能</em></span>を検査する、というものです。
      たとえば、kqueue は NetBSD において利用可能であると仮定して
      <code class="varname">__NetBSD__</code> マクロを kqueue 対応の条件として使う、
      ということはせずに、kqueue 自体を検出するようにするのです。
      そしてこれは、一般的には
      <span class="command"><strong>configure</strong></span> スクリプトにパッチを適用することになります。
      ある OS が他の OS (たとえば kqueue を実装した Linux)
      のインターフェースを採用してはいけない理由はまったくありませんが、
      前述のようにオペレーティングシステムそのものを検査してしまうと、
      そのような状況に対応することができません。</p>
<p>もちろん、機能を検査することは、
      一般的に、開発者側の負担が多くなります。しかし、
      機能を検査するようにすれば、その結果はきれいな変更となり、
      他の多くのプラットフォームで動作させられる可能性があります。
      また、本家のソースに統合される可能性が高くなることはいうまでもありません。
      <span class="emphasis"><em>正しくない限り動かない</em></span>の哲学を忘れないでください。</p>
<p>典型的な例としては、以下のようなものがあります。</p>
<div class="table">
<a name="patch-examples"></a><p class="title"><b>Table 11.1. パッチ適用例</b></p>
<div class="table-contents"><table summary="パッチ適用例" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>場所</th>
<th>誤</th>
<th>正</th>
</tr></thead>
<tbody>
<tr>
<td>configure スクリプト</td>
<td>
<pre class="programlisting">
case ${target_os} in
netbsd*) have_kvm=yes ;;
*)       have_kvm=no  ;;
esac
</pre>
	      </td>
<td>
<pre class="programlisting">
AC_CHECK_LIB(kvm, kvm_open, have_kvm=yes, have_kvm=no)
</pre>
	      </td>
</tr>
<tr>
<td>C ソースファイル</td>
<td>
<pre class="programlisting">
#if defined(__NetBSD__)
#  include &lt;sys/event.h&gt;
#endif
</pre>
	      </td>
<td>
<pre class="programlisting">
#if defined(HAVE_SYS_EVENT_H)
#  include &lt;sys/event.h&gt;
#endif
</pre>
	      </td>
</tr>
<tr>
<td>C ソースファイル</td>
<td>
<pre class="programlisting">
int
monitor_file(...)
{
#if defined(__NetBSD__)
        int fd = kqueue();
        ...
#else
        ...
#endif
}
</pre>
	      </td>
<td>
<pre class="programlisting">
int
monitor_file(...)
{
#if defined(HAVE_KQUEUE)
        int fd = kqueue();
        ...
#else
	...
#endif
}
</pre>
	      </td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break"><p>さらなる情報は、<span class="emphasis"><em>Making
      packager-friendly software</em></span> の記事 (<a class="ulink" href="http://www.onlamp.com/pub/a/onlamp/2005/03/31/packaging.html" target="_top">第
      1 部</a>、<a class="ulink" href="http://www.oreillynet.com/pub/a/onlamp/2005/04/28/packaging2.html" target="_top">第
      2 部</a>) をお読みください。この記事では、ソフトウェアをパッケージ化しやすくする方法について、
      複数の点での詳細をまとめています。ここで述べられている提案は、いずれも、
      私たちが pkgsrc の作業をした経験から集められたものですので、
      パッチの作成に際しても役に立つかもしれません。</p>
</div>
<div class="sect2" title="11.3.5. 作者へのフィードバック">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.patches.feedback"></a>11.3.5. 作者へのフィードバック</h3></div></div></div>
<p>常に、常に、<span class="strong"><strong>常に</strong></span>、
      パッケージに施したあらゆる<span class="emphasis"><em>移植性に関する修正</em></span>や改良点を、
      本家の開発者に還元するようにしてください。
      彼らに移植性についての注意を喚起して、将来のバージョンが無修正で
      NetBSD で構築できるようにするためには、そうするしかないのです。
      また、将来のバージョンの配布ファイルの利用者は、
      フィードバックされた修正をパッケージのコードから直接利用することができるようになります。</p>
<p>フィードバックをする方法は、一般的には、
      パッチをきれいに書き直し (pkgsrc で追加されたパッチは、
      時にはクイックハックであることがあるからです)、
      フィードバック先のプロジェクト用の適切な追跡システムに対してバグ報告をし、
      変更が受け入れられるよう本家の作者とともに作業する、というものです。
      フィードバックをすることで、pkgsrc のパッケージを単純なものとし、
      さほど労力を割かずに将来の変更ができるようにするということが、
      <span class="emphasis"><em>特に重要</em></span>です。</p>
<p>フィードバックをしたら、上流のバグレポートの URL を
      パッチのコメントに追加してください。</p>
<p>フリーソフトウェアの理念をサポートして下さい。</p>
</div>
</div>
<div class="sect1" title="11.4. その他の必須のファイル">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="other-mandatory-files"></a>11.4. その他の必須のファイル</h2></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">DESCR</code></span></dt>
<dd><p>ソフトウェアについての複数行の説明。このファイルには適切なクレジットを含
	  めておいてください。他人があなたのユーモアのセンス(あるいは変わった綴り)
	  を理解してくれない事、そしてここに書かれたものすべてを他人が読むであろう
	  という事を念頭においておいてください。</p></dd>
<dt><span class="term"><code class="filename">PLIST</code></span></dt>
<dd><p>このファイルは、システムにインストールされるファイルを管理します:すべて
	  のバイナリー、マニュアルページ、その他。ディレクトリーの作成、削除、イン
	  サートされた(inserted)ファイルの位置を管理するための、他のディレクティブ
	  もこのファイルに記述されます。
	  詳細は<a class="xref" href="#plist" title="Chapter 13. PLIST 問題">Chapter 13, <i>PLIST 問題</i></a>を参照してください。</p></dd>
</dl></div>
</div>
<div class="sect1" title="11.5. オプションのファイル">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="components.optional"></a>11.5. オプションのファイル</h2></div></div></div>
<div class="sect2" title="11.5.1. バイナリーパッケージに影響をおよぼすファイル">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.optional.bin"></a>11.5.1. バイナリーパッケージに影響をおよぼすファイル</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">INSTALL</code></span></dt>
<dd><p>このシェルスクリプトは<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>によって二度起動されます。
	    最初は、パッケー
	    ジが展開された後、ファイルが移動される前に、二度目はインストールするファ
	    イルが移動された後。このファイルは、
	    <code class="filename">PLIST</code>内の@execコマンドでは不可能な特
	    別な処理のために使うことができます。より詳細な情報は<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>と
	    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_create+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_create</span>(1)</span></a>を参照してください。<a class="xref" href="#files-and-dirs-outside-prefix" title="15.1. インストール用のプレフィックス以外の場所にあるファイルとディレクトリー">Section 15.1, “インストール用のプレフィックス以外の場所にあるファイルとディレクトリー”</a>もあわせて参照してください。</p></dd>
<dt><span class="term"><code class="filename">DEINSTALL</code></span></dt>
<dd><p>このスクリプトは、ファイルが削除される前後に実行されます。このスクリプト
	    の責任は、パッケージのインストレーションにかかわる雑多なものをきれいにす
	    ることです。なぜなら、pkg_deleteは、オリジナルのディストリビューションで
	    作成されたファイルをどのように削除するかをすべて知っておかなければならな
	    いからです。より詳細な情報は<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>と
	    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_create+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_create</span>(1)</span></a>を参照してください。</p></dd>
<dt><span class="term"><code class="filename">MESSAGE</code></span></dt>
<dd>
<p>パッケージのインストール後にこのファイルの内容が表示されます。
	    完全にフリーではないソフトウェアについての法的な通知や、
	    apache, PHP などのモジュールのインストール後の
	    設定ファイルの更新に関するヒント等に役立ちます。
	    パッケージの<code class="filename">Makefile</code>で
	    <code class="varname">MESSAGE_SUBST</code>を使うことで、変数を簡単に変えられる
	    ことに注意してください:</p>
<pre class="programlisting">
MESSAGE_SUBST+=  SOMEVAR="somevalue"
</pre>
<p>とすると、<code class="filename">MESSAGE</code>中の "${SOMEVAR}" は、
	    <span class="quote">“<span class="quote">somevalue</span>”</span>に置換されます。標準では、置換は
	    <code class="varname">PKGNAME</code>,
	    <code class="varname">PKGBASE</code>, <code class="varname">PREFIX</code>,
	    <code class="varname">LOCALBASE</code>, <code class="varname">X11PREFIX</code>,
	    <code class="varname">X11BASE</code>,
	    <code class="varname">PKG_SYSCONFDIR</code>,
	    <code class="varname">ROOT_GROUP</code>,
	    <code class="varname">ROOT_USER</code> に対しておこなわれます。</p>
<p><code class="varname">MESSAGE_SRC</code> 変数を設定すると、
	    置換の対象のファイルを変えたり追加したりすることができます。
	    この変数は、<code class="filename">MESSAGE</code> (このファイルが存在する場合)
	    です。</p>
</dd>
<dt><span class="term"><code class="filename">ALTERNATIVES</code></span></dt>
<dd><p>FIXME: alternatives の枠組に関するドキュメンテーションは、
	ありません。</p></dd>
</dl></div>
</div>
<div class="sect2" title="11.5.2. 構築の過程に影響をおよぼすファイル">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.optional.build"></a>11.5.2. 構築の過程に影響をおよぼすファイル</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">Makefile.common</code></span></dt>
<dd><p>このファイルには、<code class="filename">Makefile</code>
	に書くことができることを好きなように含めることができますが、
	このファイルの目的は複数のパッケージから利用することです。
	このファイルを利用するパッケージがあらかじめわかっている場合に限り、
	使うようにします。それ以外の場合には、<code class="filename">*.mk</code>
	ファイルを書いて、
	その役割をあらわすファイル名をつけたほうがよいことが多いでしょう。</p></dd>
<dt><span class="term"><code class="filename">buildlink3.mk</code></span></dt>
<dd><p>このファイルには、buildlink3 の枠組 (<a class="xref" href="#buildlink" title="Chapter 14. buildlink 方法論">Chapter 14, <i>buildlink 方法論</i></a>参照) のための
	依存性情報が含まれます。</p></dd>
<dt><span class="term"><code class="filename">hacks.mk</code></span></dt>
<dd><p>このファイルには、コンパイラーのバグや、
	それに類する事象への回避策が含まれます。このファイルは pkgsrc
	の基盤が自動的にインクルードしますので、インクルードのための
	<code class="literal">.include</code> 行は必要ありません。</p></dd>
<dt><span class="term"><code class="filename">options.mk</code></span></dt>
<dd><p>このファイルには、
	利用者が選択可能なパッケージ固有のオプション (<a class="xref" href="#options" title="Chapter 16. オプションの扱い">Chapter 16, <i>オプションの扱い</i></a>参照)
	のためのコードが含まれます。パッケージにオプションが一つか二つしかない場合は、
	このコードを <code class="filename">Makefile</code> 内に直接書いてもかまいません。</p></dd>
</dl></div>
</div>
<div class="sect2" title="11.5.3. 何の影響もおよぼさないファイル">
<div class="titlepage"><div><div><h3 class="title">
<a name="components.optional.none"></a>11.5.3. 何の影響もおよぼさないファイル</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">README*</code></span></dt>
<dd><p>このファイルは、
	パッケージの作成に対して何の影響もおよぼさず、
	パッケージ開発者向けの情報を記しただけのものです。</p></dd>
<dt><span class="term"><code class="filename">TODO</code></span></dt>
<dd><p>このファイルには、
	パッケージを改良するためにおこなう必要があることが含まれます。</p></dd>
</dl></div>
</div>
</div>
<div class="sect1" title="11.6. work*">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="work-dir"></a>11.6. <code class="filename">work*</code>
</h2></div></div></div>
<p><span class="command"><strong>make</strong></span>とタイプした時に、配布ファイルが
    <code class="varname">WRKDIR</code> で示されたディレクトリーに展開されます。
    <span class="command"><strong>make clean</strong></span>
    を実行すれば、これらを削除することができます。
    このディレクトリーは、ソースの展開のほか、
    さまざまなタイムスタンプファイルを作っておくためにも使用されます。
    これらも、clean によって<span class="emphasis"><em>完全に削除されます</em></span>。
    標準では <code class="filename">${.CURDIR}/work</code>
    (<code class="varname">OBJMACHINE</code> が設定されている場合は
    <code class="filename">${.CURDIR}/work.${MACHINE_ARCH}</code>) です。</p>
</div>
<div class="sect1" title="11.7. files/*">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="files-dir"></a>11.7. <code class="filename">files/*</code>
</h2></div></div></div>
<p>また、もしあなたがコンフィギュレーションまたは構築するより前に、パッケージ
    中に何かファイルを置きたいならば、それらのファイルをfilesディレクトリーに置
    くことができますし、<span class="quote">“<span class="quote">pre-configure</span>”</span>ターゲットで、
    <span class="command"><strong>${CP}</strong></span>コマンドによりコピーす
    ることができます。あるいは、<code class="filename">/dev/null</code>に対するそのファイルの単純なdiffをとり、
    パッチメカニズムを使用して、そのファイルを生成することもできます。</p>
<p>files ディレクトリーにファイルを置く方法で、他のパッケージとファイルを共有したい場合は、
    <code class="varname">FILESDIR</code> 変数を、他のパッケージの
    <code class="filename">files</code> ディレクトリーを指すように設定します。
    たとえば以下のようにします。</p>
<pre class="programlisting">
FILESDIR=${.CURDIR}/../xemacs/files
</pre>
</div>
</div>
<div class="chapter" title="Chapter 12. Makefile におけるプログラミング">
<div class="titlepage"><div><div><h2 class="title">
<a name="makefile"></a>Chapter 12. <code class="filename">Makefile</code> におけるプログラミング</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#makefile.style">12.1. 警告</a></span></dt>
<dt><span class="sect1"><a href="#makefile.variables">12.2. <code class="filename">Makefile</code> 変数</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#makefile.variables.names">12.2.1. 命名規約</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#makefile.code">12.3. コードの断片</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#adding-to-list">12.3.1. リストに要素を追加する</a></span></dt>
<dt><span class="sect2"><a href="#converting-internal-to-external">12.3.2. 内部リストを外部リストに変換する</a></span></dt>
<dt><span class="sect2"><a href="#passing-variable-to-shell">12.3.3. シェルコマンドに値を渡す</a></span></dt>
<dt><span class="sect2"><a href="#quoting-guideline">12.3.4. クォートの指針</a></span></dt>
<dt><span class="sect2"><a href="#bsd-make-bug-workaround">12.3.5. BSD Make のバグの回避方法</a></span></dt>
</dl></dd>
</dl>
</div>
<p>pkgsrc は、多くの <code class="filename">Makefile</code> の断片からなっており、
  この各断片が、pkgsrc システムの各部分を明確に形成しています。
  pkgsrc のような大規模なシステムのプログラミング言語として <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>
  システムを使う場合、コードを適切かつわかりやすい状態に保つために、
  いくらかの規律が必要です。</p>
<p><code class="filename">Makefile</code> プログラミングの基本的な構成要素は、
  変数 (実はマクロ) とシェルコマンドです。
  シェルコマンドは、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?awk+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">awk</span>(1)</span></a> プログラムのような複雑なものになることもあります。
  各シェルコマンドを意図どおりに動かすため、変数を使うときは、
  すべての変数を適切にクォートすることが必要です。</p>
<p>本章では、<code class="filename">Makefile</code>
  で頻出するいくつかのパターンと、
  それらに伴う落とし穴を説明します。</p>
<div class="sect1" title="12.1. 警告">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="makefile.style"></a>12.1. 警告</h2></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<p>ルールのターゲットとしてファイルを作る場合、
    常に、データをまず一時ファイルに書き込んでから、
    最後にファイル名を変えるようにしてください。
    そうしておかないと、ファイルの生成の途中にエラーが起きた場合、
    利用者が <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> を 2 回目に実行したときに、
    前回のファイルが存在したままとなり、ファイルが正しく再生成されません。
    たとえば、</p>
<pre class="programlisting">
wrong:
        @echo "line 1" &gt; ${.TARGET}
        @echo "line 2" &gt;&gt; ${.TARGET}
        @false

correct:
        @echo "line 1" &gt; ${.TARGET}.tmp
        @echo "line 2" &gt;&gt; ${.TARGET}.tmp
        @false
        @mv ${.TARGET}.tmp ${.TARGET}
</pre>
<p><span class="command"><strong>make wrong</strong></span> を 2 回実行したときに、
    1 回目の実行でエラーメッセージが出ますが、
    ファイル <code class="filename">wrong</code> は作られた状態になります。
    一方、<span class="command"><strong>make
    correct</strong></span> を実行すると、エラーメッセージが 2 回出るという、
    期待どおりの動作となります。</p>
<p>エラーの場合には <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> が <code class="literal">${.TARGET}</code>
    を削除することがあるということをご存知かもしれませんが、
    この削除は、たとえば <code class="literal">^C</code> を押すなど、
    割り込みがあった場合にのみおこなわれます。コマンドのどれかが
    (上の例の <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?false+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">false</span>(1)</span></a> のように) 失敗した場合には、
    削除は<span class="emphasis"><em>おこなわれません</em></span>。</p>
</li></ul></div>
</div>
<div class="sect1" title="12.2. Makefile 変数">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="makefile.variables"></a>12.2. <code class="filename">Makefile</code> 変数</h2></div></div></div>
<p><code class="filename">Makefile</code> 変数は文字列を値として持ち、
    文字列は 5 種類の演算子  ``='', ``+='', ``?='',
    ``:='', ``!='' を使って操作することができます。演算子については
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> マニュアルページに説明があります。</p>
<p><code class="filename">Makefile</code> の変数が解釈される際、
    ハッシュ文字 ``#'' とバックスラッシュ文字  ``\'' は特別扱いされます。
    バックスラッシュに改行が続く場合、当該バックスラッシュの直前にあるあらゆる空白・
    当該バックスラッシュ・改行・改行の直後にあるあらゆる空白は、
    ひとつのスペースに置き換えられます。
    バックスラッシュ文字とその直後に続くハッシュ文字は、
    ひとつのハッシュ文字に置き換えられます。
    以上の場合以外は、バックスラッシュはそのまま渡されます。
    変数への代入の際は、ハッシュ文字 (その前にバックスラッシュがないもの)
    はコメントの開始となり、そこから論理行の最後までがコメントとなります。</p>
<p><span class="emphasis"><em>註:</em></span> このようなアルゴリズムで解釈されるせいで、
    バックスラッシュ一文字を値として持つ変数を作るには、
    ``!='' 演算子を使う方法しかありません。たとえば以下のようにします: <code class="varname">BACKSLASH!=echo "\\"</code>.</p>
<p>以上は、変数の定義に関する説明です。このほか、変数に関してできることは、
    変数を評価することです。変数が評価されるのは、変数が ``:='' または ``!=''
    演算子の右辺にある場合と、変数がシェルコマンドの一部となっている場合
    (コマンドが実行される直前に評価される) です。これら以外の場合、
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> は遅延評価をおこないます。つまり、
    変数は他の処理がすべてすんだ後に評価されます。
    このほか、マニュアルページに記載されている「修飾子」も、
    変数を評価します。</p>
<p>修飾子のなかには、文字列を語に分割してから、分割した語に対して操作をするものがあります。
    それ以外の修飾子は、文字列全体に対して操作をします。
    文字列が語に分割される場合、その分割は、
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?sh+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">sh</span>(1)</span></a> の解釈と同様の方式でおこなわれます。</p>
<p>例外のない規則はありません&mdash; <span class="command"><strong>.for</strong></span>
    ループはシェルのクォートの規約には従わず、
    空白の並びで分離します。</p>
<p>変数には、取り扱い方が異なる複数の種類の変数があります。
    文字列 (strings) と、二種類のリストです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>文字列 (<span class="emphasis"><em>strings</em></span>) には、
      任意の文字を含めることができます。とはいえ、
      使うのは印字可能文字だけにしておくのがよいでしょう。
      例としては <code class="varname">PREFIX</code> や
      <code class="varname">COMMENT</code> があります。</p></li>
<li class="listitem"><p>内部リスト (<span class="emphasis"><em>internal lists</em></span>) は、
      シェルコマンドに決して渡されることのないリストです。
      内部リストの要素は空白で区切られます。このため、
      要素自体に空白を含めることはできません。空白以外の文字はすべて使うことができます。
      内部リストは <span class="command"><strong>.for</strong></span> ループ内で使うことができます。
      例としては <code class="varname">DEPENDS</code> や
      <code class="varname">BUILD_DEPENDS</code> があります。</p></li>
<li class="listitem"><p>外部リスト (<span class="emphasis"><em>external lists</em></span>) は、
      シェルコマンドに渡すことのできるリストです。外部リストの要素には、
      空白を含む任意の文字を含めることができます。このことが理由で、
      外部リストは <span class="command"><strong>.for</strong></span> ループ内では使うことができません。
      例としては <code class="varname">DISTFILES</code> や
      <code class="varname">MASTER_SITES</code> があります。</p></li>
</ul></div>
<div class="sect2" title="12.2.1. 命名規約">
<div class="titlepage"><div><div><h3 class="title">
<a name="makefile.variables.names"></a>12.2.1. 命名規約</h3></div></div></div>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>下線で始まる変数名はすべて、
	pkgsrc の基盤が使うために予約されています。
	そのような変数名はパッケージの
	<code class="filename">Makefile</code> では使ってはいけません。</p></li>
<li class="listitem"><p><span class="command"><strong>.for</strong></span> ループでは、
	反復変数の変数名は小文字にします。
	</p></li>
<li class="listitem"><p>リスト変数はすべて、<code class="varname">PKG_OPTIONS</code> や
	<code class="varname">DISTFILES</code> のように、
	「複数形」の名前にします。</p></li>
</ul></div>
</div>
</div>
<div class="sect1" title="12.3. コードの断片">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="makefile.code"></a>12.3. コードの断片</h2></div></div></div>
<p>本節では、読者がコードを書く際に使うことになるコードの断片を
    いくつか説明します。適当なコードがここに載っていない場合は、
    あなたのコードをテストして、ここに追加してください。</p>
<div class="sect2" title="12.3.1. リストに要素を追加する">
<div class="titlepage"><div><div><h3 class="title">
<a name="adding-to-list"></a>12.3.1. リストに要素を追加する</h3></div></div></div>
<pre class="programlisting">
STRING=                 foo * bar `date`
INT_LIST=               # empty
ANOTHER_INT_LIST=       apache-[0-9]*:../../www/apache
EXT_LIST=               # empty
ANOTHER_EXT_LIST=       a=b c=d

INT_LIST+=              ${STRING}               # 1
INT_LIST+=              ${ANOTHER_INT_LIST}     # 2
EXT_LIST+=              ${STRING:Q}             # 3
EXT_LIST+=              ${ANOTHER_EXT_LIST}     # 4
</pre>
<p>文字列を外部リストに追加する場合 (例 3) は、
      その文字列をクォートする必要があります。それ以外の場合は、
      クォートを追加してはいけません。内部リストと外部リストは、
      その各要素がどちらのリストでも適切に処理されることが確実な場合をのぞき、
      統合してはいけません。</p>
</div>
<div class="sect2" title="12.3.2. 内部リストを外部リストに変換する">
<div class="titlepage"><div><div><h3 class="title">
<a name="converting-internal-to-external"></a>12.3.2. 内部リストを外部リストに変換する</h3></div></div></div>
<pre class="programlisting">
EXT_LIST=       # empty
.for i in ${INT_LIST}
EXT_LIST+=      ${i:Q}""
.endfor
</pre>
<p>このコードは、内部リスト
      <code class="varname">INT_LIST</code> を外部リスト
      <code class="varname">EXT_LIST</code> に変換します。内部リストの要素はクォートされていないので、
      変換に際してはクォートする必要があります。
      <code class="varname">""</code> を追加する理由は後述します。</p>
</div>
<div class="sect2" title="12.3.3. シェルコマンドに値を渡す">
<div class="titlepage"><div><div><h3 class="title">
<a name="passing-variable-to-shell"></a>12.3.3. シェルコマンドに値を渡す</h3></div></div></div>
<p>時には、任意の文字列を出力したいことがあるかもしれません。
	不具合を起こす方法はたくさんありますが、
	どんな複雑なものも扱えるような方法は少ししかありません。</p>
<pre class="programlisting">
STRING=         foo bar &lt;    &gt; * `date` $$HOME ' "
EXT_LIST=       string=${STRING:Q} x=second\ item

all:
        echo ${STRING}                  # 1
        echo "${STRING}"                # 2
        echo "${STRING:Q}"              # 3
        echo ${STRING:Q}                # 4
        echo x${STRING:Q} | sed 1s,.,,  # 5
        printf "%s\\n" ${STRING:Q}""    # 6
        env ${EXT_LIST} /bin/sh -c 'echo "$$string"; echo "$$x"'
</pre>
<p>例 1 は、シェルで構文エラーを起こします。
      各文字がそのままコピーされるだけだからです。</p>
<p>例 2 も構文エラーを起こします。また、<code class="varname">${STRING}</code> の末尾の "
      文字を除いた場合は、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?date+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">date</span>(1)</span></a> が実行されてしまいます。
      また、<code class="varname">$HOME</code> シェル変数も評価されるでしょう。</p>
<p>例 3 は、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?echo+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">echo</span>(1)</span></a> コマンドの実装によって、
      各空白文字の前にバックスラッシュが出力されたり、
      されなかったりします。</p>
<p>例 4 は、最初の文字がダッシュでない文字列はすべて適切に処理します。
      文字列の最初の文字がダッシュの場合、結果がどうなるかは
      <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?echo+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">echo</span>(1)</span></a> コマンドの実装に依存します。
      入力される文字列の最初の文字がダッシュにならないことを保証できる限りは、この形式は適切です。</p>
<p>例 5 は、たとえ文字列がダッシュで始まっていたとしても、
      適切に処理します。</p>
<p>例 6 も、あらゆる文字列を適切に処理できますし、
      それ自体に問題のあるパイプを使わないので、
      より軽い方法です。</p>
<p><code class="varname">EXT_LIST</code> はクォートする必要はありません。
      なぜなら、リストに要素を追加した時に、
      すでにクォートされているからです。</p>
<p>内部リストはシェルに渡されないものなので、
      例示はありません。</p>
</div>
<div class="sect2" title="12.3.4. クォートの指針">
<div class="titlepage"><div><div><h3 class="title">
<a name="quoting-guideline"></a>12.3.4. クォートの指針</h3></div></div></div>
<p>変数が不適切にクォートされたソースは、多くありえます。
      本節では、よく知られている例をいくつか掲げます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p>リストの値を使うときは常に、
	値の冒頭や末尾にある空白がどうなるかを考えてください。
	リストが整形式のシェルの式である場合、それぞれの語から冒頭や末尾の空白を取り除くために、
	<code class="varname">:M*</code> 修飾子を使うことができます。
	<code class="varname">:M</code> 演算子は、最初にその引数をシェルの規約に従って分割してから、
	シェルのグロブ式 <code class="varname">*</code> にマッチする語 (つまり全部)
	すべてからなるリストを新たに作ります。
	これが必要となる状況は、<code class="varname">CPPFLAGS</code> のような変数を
	<code class="varname">CONFIGURE_ARGS</code> に追加する場合です。
	configure スクリプトが別の configure スクリプトから呼び出される場合、
	呼び出された側のスクリプトは変数から冒頭と末尾の空白を取り除き、
	それを別の configure スクリプトに渡します。しかし、この両 configure
	スクリプトは、(子の) <code class="varname">CPPFLAGS</code> 変数が
	親の <code class="varname">CPPFLAGS</code> と同じものであると見込んでいます。
	これが、<code class="varname">CPPFLAGS</code> の値を適切に切り取ったものを
	渡したほうがよい理由です。そして、以下に掲げるのは、その方法です。</p>
<pre class="programlisting">
CPPFLAGS=               # empty
CPPFLAGS+=              -Wundef -DPREFIX=\"${PREFIX:Q}\"
CPPFLAGS+=              ${MY_CPPFLAGS}

CONFIGURE_ARGS+=        CPPFLAGS=${CPPFLAGS:M*:Q}

all:
        echo x${CPPFLAGS:Q}x            # 前後に空白がつく
        echo x${CONFIGURE_ARGS}x        # 適切に切り取られる
</pre>
</li>
<li class="listitem"><p>上の例にはバグがひとつあります:
	<code class="varname">${PREFIX}</code> は適切にクォートされたシェルの式ですが、
	シェルの後には C コンパイラーがあり、こちらでも適切に
	(今度は C の文法で) クォートされている必要があります。
	このため、上で例示したものは、<code class="varname">${PREFIX}</code>
	の値にバックスラッシュや二重引用符が含まれていない場合に限って、
	正しいものになります。これらの文字を含めたい場合、
	C の文字列リテラルとして扱われる値をすべてクォートするために、
	もう一つの層を追加する必要があります。
	<code class="varname">:Q</code> 演算子はシェル用のクォートしかできないので、
	C コンパイラー用のクォートには使えません。</p></li>
<li class="listitem">
<p>値が空になりうる場合は、
	<code class="varname">:Q</code> 演算子が妙な結果を出すことがあります。
	以下に 2 種類のまったく異なる事例を掲げますが、
	どちらも同じ細工をすることで解決できます。</p>
<pre class="programlisting">
EMPTY=                  # empty
empty_test:
        for i in a ${EMPTY:Q} c; do \
            echo "$$i"; \
        done

for_test:
.for i in a:\ a:\test.txt
        echo ${i:Q}
        echo "foo"
.endfor
</pre>
<p>一つ目の例では、3 行が表示されると思うかもしれませんが、
	そのうちの 2 行しか表示されません。これは、
	<code class="varname">${EMPTY:Q}</code> が空の文字列に展開され、
	シェルからは見えなくなるからです。回避策は、
	<code class="varname">${EMPTY:Q}""</code> と書くことです。このパターンは、
	<code class="varname">${TEST} -z ${VAR:Q}</code> や <code class="varname">${TEST}
	-f ${FNAME:Q}</code> のように、しばしば見られます
	(いずれも、間違いです)。</p>
<p>二つ目の例では、表示されるのは 4 行ではなく 3 行です。
	最初に表示される行は <code class="varname">a:\ echo foo</code> のようになります。
	これは、値 <code class="varname">a:\</code> のバックスラッシュを
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> が継続行として処理し、2 行目が 1 行目の
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?echo+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">echo</span>(1)</span></a> コマンドの引数になってしまうためです。
	これを防ぐには、<code class="varname">${i:Q}""</code>
	と書きます。</p>
</li>
</ul></div>
</div>
<div class="sect2" title="12.3.5. BSD Make のバグの回避方法">
<div class="titlepage"><div><div><h3 class="title">
<a name="bsd-make-bug-workaround"></a>12.3.5. BSD Make のバグの回避方法</h3></div></div></div>
<p>pkgsrc の bmake プログラムは、以下のような代入を適切に処理することができません。
      <code class="varname">_othervar_</code> が ``-'' 文字を含んでいる場合、
      以下のコードを実行すると、閉じ中括弧のひとつが
      <code class="varname">${VAR}</code> に含まれてしまいます。</p>
<pre class="programlisting">
VAR:=   ${VAR:N${_othervar_:C/-//}}
</pre>
<p>もっと複雑なコードの断片と回避策については、
      <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/regress/make-quoting/README.html" target="_top"><code class="filename">regress/make-quoting</code></a> パッケージのテストケース
      <code class="varname">bug1</code> をご覧ください。</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter 13. PLIST 問題">
<div class="titlepage"><div><div><h2 class="title">
<a name="plist"></a>Chapter 13. PLIST 問題</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#rcs-id">13.1. RCS ID</a></span></dt>
<dt><span class="sect1"><a href="#automatic-plist-generation">13.2. <code class="filename">PLIST</code> の半自動生成</a></span></dt>
<dt><span class="sect1"><a href="#print-PLIST">13.3. <span class="command"><strong>make print-PLIST</strong></span> の出力を細工する</a></span></dt>
<dt><span class="sect1"><a href="#plist.misc">13.4. PLIST における各種の置換</a></span></dt>
<dt><span class="sect1"><a href="#manpage-compression">13.5. マニュアルページの圧縮</a></span></dt>
<dt><span class="sect1"><a href="#using-PLIST_SRC">13.6. <code class="varname">PLIST_SRC</code> を使って PLIST のソースを変更する</a></span></dt>
<dt><span class="sect1"><a href="#platform-specific-plist">13.7. プラットフォーム別に異なるPLIST</a></span></dt>
<dt><span class="sect1"><a href="#faq.common-dirs">13.8. 複数のパッケージでディレクトリーを共有する</a></span></dt>
</dl>
</div>
<p><code class="filename">PLIST</code> ファイルは、パッケージの
  <span class="quote">“<span class="quote">packing list</span>”</span> (梱包明細) です。すなわち、
  パッケージを構成するファイルの一覧 (インストール先である
  <code class="filename">${PREFIX}</code> ディレクトリーからの相対位置)
  と、それに加えて、いくつかの追加情報
  (完全な一覧は <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_create+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_create</span>(1)</span></a> マニュアルページを参照) が載っています。
  この章では、<code class="filename">PLIST</code>ファイル
  (複数の場合もあります、以下を参照してください)を扱う場合に注意が必要な、
  いくつかの特別な問題について述べます。</p>
<div class="sect1" title="13.1. RCS ID">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="rcs-id"></a>13.1. RCS ID</h2></div></div></div>
<p>あなたが書いたすべての<code class="filename">PLIST</code>ファイルの先頭行にRCS IDが追加されていること
    を確認してください。</p>
<pre class="programlisting">
@comment $NetBSD$
    </pre>
</div>
<div class="sect1" title="13.2. PLIST の半自動生成">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="automatic-plist-generation"></a>13.2. <code class="filename">PLIST</code> の半自動生成</h2></div></div></div>
<p><span class="command"><strong>make print-PLIST</strong></span>コマンドを使って、パッケージの展開後に新しくできた全ファ
    イルにマッチするPLISTを出力することができます。このターゲットに関するさ
    らなる情報は、
    <a class="xref" href="#build.helpful-targets" title="17.17. 他の役に立つターゲット">Section 17.17, “他の役に立つターゲット”</a>をご覧ください。</p>
</div>
<div class="sect1" title="13.3. make print-PLIST の出力を細工する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="print-PLIST"></a>13.3. <span class="command"><strong>make print-PLIST</strong></span> の出力を細工する</h2></div></div></div>
<p>*-dirs パッケージを<a class="xref" href="#faq.common-dirs" title="13.8. 複数のパッケージでディレクトリーを共有する">Section 13.8, “複数のパッケージでディレクトリーを共有する”</a>で説明したように
    使った場合、<span class="command"><strong>make print-PLIST</strong></span> で、
    実際の <code class="varname">@dirrm</code> 行のかわりに
    <code class="varname">@comment</code> が出力されることにお気づきかもしれません。
    ここでディレクトリーやファイルを指定して、
    実際に近い結果を出力させることもできます。
    これはパッケージの更新の際に<span class="emphasis"><em>非常に
    </em></span>役立ちます。</p>
<p><code class="varname">PRINT_PLIST_AWK</code> 変数を、
    print-PLIST の出力をフィルターする
    AWK のパターンと動作の一式に設定します。
    AWK スクリプト塊を好きなように
    <span class="emphasis"><em>追加</em></span>することができますが、
    適切にクォートするよう注意してください。</p>
<p>たとえば、PLIST の結果から <code class="filename">libdata/foo</code>
    ディレクトリー内のファイルをすべて消すには、
    以下のようにします。</p>
<pre class="programlisting">
PRINT_PLIST_AWK+=       /^libdata\/foo/ { next; }
    </pre>
<p>また、特定の (共有) ディレクトリーを参照している
    <code class="varname">@dirrm</code> 行を <code class="varname">@comment</code>
    に変換するには、以下のようにします。</p>
<pre class="programlisting">
PRINT_PLIST_AWK+=       /^@dirrm share\/specific/ { print "@comment " $$0; next; }
    </pre>
</div>
<div class="sect1" title="13.4. PLIST における各種の置換">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="plist.misc"></a>13.4. PLIST における各種の置換</h2></div></div></div>
<p>パッケージがシステムにインストールされる際に、
    PLIST 内のいくつもの変数が自動的に置換されます。
    置換される変数には、以下のようなものがあります。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">${MACHINE_ARCH}</code>, <code class="varname">${MACHINE_GNU_ARCH}</code></span></dt>
<dd>
<p>emacs、およびperlのようないくつかのパッケージは、それらが構築されたアー
	  キテクチャーに関する情報を、インストールするファイルのパス名に埋め込みま
	  す。このようなケースに対応するため、実際に使われる前に、PLISTに前処理が
	  おこなわれます。そして、シンボル
	  <span class="quote">“<span class="quote"><code class="varname">${MACHINE_ARCH}</code></span>”</span>は、<span class="command"><strong>uname -p</strong></span>の出
	  力でおきかえられます。
	  <code class="varname">${MACHINE_GNU_ARCH}</code>がPLISTのどこかにうめこまれてい
	  る場合も同様の事がおこなわれます。これは、GNU autoconfで作成された
	  configureスクリプトを持つパッケージで使われます。</p>
<div class="note" title="昔の話" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">昔の話</h3>
<p><span class="quote">“<span class="quote"><code class="varname">$ARCH</code></span>”</span>シンボルは<span class="command"><strong>uname
	    -m</strong></span>の出力によって置きかえられていま
	    した。しかし、もはやサポートされていませんし、削除されています。</p>
</div>
</dd>
<dt><span class="term"><code class="varname">${OPSYS}</code>, <code class="varname">${LOWER_OPSYS}</code>, <code class="varname">${OS_VERSION}</code></span></dt>
<dd>
<p>いくつかのパッケージでは、OS名とバージョンをいくつかのパス名に埋め込みま
	  す。このような場合、<code class="filename">PLIST</code>で以下の各変数を使用してください。
	  </p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">${OPSYS}</code> - <span class="quote">“<span class="quote"><span class="command"><strong>uname -s</strong></span></span>”</span>の出力</p></li>
<li class="listitem"><p><code class="varname">${LOWER_OPSYS}</code> - 共通名の小文字表記(例: <span class="quote">“<span class="quote">solaris</span>”</span>)</p></li>
<li class="listitem"><p><code class="varname">${OS_VERSION}</code> - <span class="quote">“<span class="quote"><span class="command"><strong>uname -r</strong></span></span>”</span></p></li>
</ul></div>
</dd>
</dl></div>
<p>デフォルトで置換される値の全一覧は、
    <code class="filename">bsd.pkg.mk</code> を参照してください (あわせて、
    <code class="varname">PLIST_SUBST</code> を調べてください)。</p>
<p>上述以外の変数を置換したい場合は、
    <code class="varname">MESSAGE_SUBST</code> (<a class="xref" href="#components.optional" title="11.5. オプションのファイル">Section 11.5, “オプションのファイル”</a>参照) と同様に、
    以下のようにして、変数とその展開方法を定義することができます。</p>
<pre class="programlisting">
PLIST_SUBST+=   SOMEVAR="somevalue"
    </pre>
<p>こうすると、<code class="filename">PLIST</code>
    内のすべての <span class="quote">“<span class="quote">${SOMEVAR}</span>”</span>
    が <span class="quote">“<span class="quote">somevalue</span>”</span> で置き換えられます。</p>
<p><code class="varname">PLIST_VARS</code> 変数を使うと、
    条件に応じて <code class="filename">PLIST</code>
    の項目を追加することができます。
    <code class="literal"><code class="varname">PLIST_VARS</code>+=foo</code>
    のように値を追加して、
    これに対応する <code class="varname">PLIST.foo</code> 変数を
    <code class="literal">yes</code> に設定します。
    このように設定すると、<code class="filename">PLIST</code> にある 
    <span class="quote">“<span class="quote"><code class="varname">${PLIST.foo}</code></span>”</span> が
    <span class="quote">“<span class="quote"><code class="literal">""</code></span>”</span> に置換されるようになります
    (設定していない場合は
    <span class="quote">“<span class="quote"><code class="literal">"@comment "</code></span>”</span> に置換されます)。
    たとえば、<code class="filename">Makefile</code> では以下のようにします。</p>
<pre class="programlisting">
PLIST_VARS+=	foo
.if <em class="replaceable"><code>condition</code></em>
PLIST.foo=	yes
.else
    </pre>
<p>こうしたうえで、<code class="filename">PLIST</code> では以下のようにします。</p>
<pre class="programlisting">
@comment $NetBSD$
bin/bar
man/man1/bar.1
${PLIST.foo}bin/foo
${PLIST.foo}man/man1/foo.1
${PLIST.foo}share/bar/foo.data
${PLIST.foo}@dirrm share/bar
    </pre>
</div>
<div class="sect1" title="13.5. マニュアルページの圧縮">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="manpage-compression"></a>13.5. マニュアルページの圧縮</h2></div></div></div>
<p>もし、(<code class="filename">bsd.own.mk</code>に)<code class="varname">MANZ</code>が設定されていれば、マニュアルページは圧縮形式で
    インストールされます。そうでなければ展開された形式でインストールされます。
    <code class="filename">PLIST</code>ファイルでこれをサポートするために、<code class="varname">MANZ</code>と <code class="varname">MANCOMPRESSED</code>の設定の有
    無に従い、<span class="quote">“<span class="quote">.gz</span>”</span>サフィックスがマニュアルページに自動的に追加、削除され
    ます。この<code class="filename">PLIST</code>ファイルに対する変更は、<code class="filename">PLIST</code>自身にたいしてでなく、それが
    コピーされる時におこなわれます。</p>
</div>
<div class="sect1" title="13.6. PLIST_SRC を使って PLIST のソースを変更する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="using-PLIST_SRC"></a>13.6. <code class="varname">PLIST_SRC</code> を使って PLIST のソースを変更する</h2></div></div></div>
<p>ひとつ以上のファイルを、バイナリーパッケージを構築するために<code class="filename">PLIST</code>のソース
    として使用する時は、それらのファイル名を変数<code class="varname">PLIST_SRC</code>に設定してください。こ
    れらのファイルは、後で<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?cat+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">cat</span>(1)</span></a>によって連結されます。連結の順番は重要です。
    <code class="varname">PLIST_SRC</code> は、標準では <code class="filename">${PKGDIR}/PLIST</code> になります。</p>
</div>
<div class="sect1" title="13.7. プラットフォーム別に異なるPLIST">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="platform-specific-plist"></a>13.7. プラットフォーム別に異なるPLIST</h2></div></div></div>
<p>パッケージのなかには、インストールするファイルの組合せを、対象のオペレー
    ティングシステムによって変えるものがあります。このような差異は、以下のファ
    イルを使って自動的に処理することができます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="filename">PLIST.common</code></p></li>
<li class="listitem"><p><code class="filename">PLIST.${OPSYS}</code></p></li>
<li class="listitem"><p><code class="filename">PLIST.${MACHINE_ARCH}</code></p></li>
<li class="listitem"><p><code class="filename">PLIST.${OPSYS}-${MACHINE_ARCH}</code></p></li>
<li class="listitem"><p><code class="filename">PLIST.common_end</code></p></li>
</ul></div>
</div>
<div class="sect1" title="13.8. 複数のパッケージでディレクトリーを共有する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="faq.common-dirs"></a>13.8. 複数のパッケージでディレクトリーを共有する</h2></div></div></div>
<p><span class="quote">“<span class="quote">共有ディレクトリー</span>”</span>とは、複数の (かつ関連のない)
    パッケージがファイルをインストールするディレクトリーのことです。
    以前は、共有ディレクトリーは、条件に応じた削除のために PLIST に特殊な細工をするか、
    集権的な処理用パッケージを用意する必要があったので、
    問題を起こすことがありました。</p>
<p>現在の pkgsrc では、話は単純になっています。
    各パッケージは、必要に応じて、ディレクトリーを作成してファイルをインストールします。
    <span class="command"><strong>pkg_delete</strong></span> は、パッケージのアンインストール後、
    空のディレクトリーが残っていればすべて削除します。</p>
<p>パッケージの動作のために空のディレクトリーが必要な場合は、
    インストール時に通常と同じようにディレクトリーを作成するようにし、
    さらに PLIST に以下のような項目を追加します。
    </p>
<pre class="programlisting">
@pkgdir path/to/empty/directory
    </pre>
<p>
    </p>
</div>
</div>
<div class="chapter" title="Chapter 14. buildlink 方法論">
<div class="titlepage"><div><div><h2 class="title">
<a name="buildlink"></a>Chapter 14. buildlink 方法論</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#converting-to-buildlink3">14.1. パッケージを変換して buildlink3 を使うようにする</a></span></dt>
<dt><span class="sect1"><a href="#creating-buildlink3.mk">14.2. <code class="filename">buildlink3.mk</code> ファイルを書く</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#anatomy-of-bl3">14.2.1. buildlink3.mk ファイルの分析</a></span></dt>
<dt><span class="sect2"><a href="#updating-buildlink-depends">14.2.2. <code class="filename">buildlink3.mk</code> ファイルの <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code> を更新する</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#writing-builtin.mk">14.3. <code class="filename">builtin.mk</code> ファイルを書く</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#anatomy-of-builtin.mk">14.3.1. <code class="filename">builtin.mk</code> ファイルの分析</a></span></dt>
<dt><span class="sect2"><a href="#native-or-pkgsrc-preference">14.3.2. ネイティブおよび pkgsrc のソフトウェアの選択に関する、大域的な設定</a></span></dt>
</dl></dd>
</dl>
</div>
<p>buildlink は pkgsrc における枠組のひとつで、パッケージのコンフィギュレーション (configure)
  および構築 (build) の過程で、どのヘッダーやライブラリーが使われるかを制御するものです。
  これは以下の二つの手順によって実現されます。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p><code class="varname">BUILDLINK_DIR</code> (標準では、
      <code class="varname">WRKDIR</code> のサブディレクトリー) 内に、
      依存するヘッダーやライブラリーを指すシンボリックリンクを作ります。</p></li>
<li class="listitem"><p>通常のコンパイラーツールを置き換えるラッパースクリプトを生成します。
      これは、<code class="option">-I${LOCALBASE}/include</code> および
      <code class="option">-L${LOCALBASE}/lib</code> を、
      <code class="varname">BUILDLINK_DIR</code> への参照に変換します。
      また、オペレーティングシステムによっては、このラッパースクリプトは、
      ネイティブのコンパイラーが GCC に見えるようにし、
      GCC を要求するパッケージを修正することなく、
      ネイティブのコンパイラーで構築できるようにします。</p></li>
</ol></div>
<p>こうすることで、パッケージ構築環境を正規化して、
  他にどのようなソフトウェアがインストールされているかにかかわらず、
  パッケージを一貫して構築できるようにします。
  なお、通常のシステムヘッダーおよびライブラリーのパス、
  たとえば <code class="filename">/usr/include</code>,
  <code class="filename">/usr/lib</code> などは、すでに探索されていることに注意してください
  -- buildlink3 は、パッケージの構築を、
  システム非標準のソフトウェアから独立させるために設計されたものなのです。</p>
<div class="sect1" title="14.1. パッケージを変換して buildlink3 を使うようにする">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="converting-to-buildlink3"></a>14.1. パッケージを変換して buildlink3 を使うようにする</h2></div></div></div>
<p>パッケージが buildlink3 の枠組を使うようにする変換の過程
    (<span class="quote">“<span class="quote">bl3ifying</span>”</span> - buildlink3 化) は、かなり単純です。
    以下のことに注意してください。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>構築の際には、常に、
        toolchain 本体ではなくラッパースクリプトが呼ばれるようにしてください。
        パッケージによっては巧妙なものがあるので、
        ラッパーが呼ばれたかどうかを確実に調べる方法は、
        <code class="filename">${WRKDIR}/.work.log</code> を確認することだけです。</p></li>
<li class="listitem"><p>たとえば Java VM やスタンドアローンのシェルでは、
	パッケージの Makefile で <code class="varname">PREFIX</code>
	を上書きしないでください。<code class="filename">${BUILDLINK_DIR}</code>
	からシンボリックリンクするためのコードは、
	<span class="quote">“<span class="quote">pkg_info -qp <em class="replaceable"><code>pkgname</code></em></span>”</span>
	からの相対位置にあるファイルを探すからです。
	</p></li>
<li class="listitem"><p>パッケージの依存性として追加されるのは、パッケージの Makefile に列挙した
	<code class="filename">buildlink3.mk</code> ファイル<span class="emphasis"><em>だけ</em></span>
	であることを忘れないでください。
	</p></li>
</ol></div>
<p>あるパッケージのライブラリーやヘッダーに対する依存性が必要な場合は、</p>
<pre class="programlisting">
DEPENDS+=       foo&gt;=1.1.0:../../category/foo
</pre>
<p>を、以下のものに置き換えます。</p>
<pre class="programlisting">
.include "../../category/foo/buildlink3.mk"
</pre>
<p>通常は、buildlink3.mk ファイルで必要な依存性を定義します。
    buildlink3.mk ファイルを使う際に、より新しいバージョンへの依存性が必要な場合は、
    そのことを Makefile で定義することができます。たとえば以下のようにします。</p>
<pre class="programlisting">
BUILDLINK_API_DEPENDS.foo+=   foo&gt;=1.1.0
.include "../../category/foo/buildlink3.mk"
</pre>
<p><code class="filename">pkgsrc/mk</code> 以下には、
    特別なパッケージを扱うための
    <code class="filename">buildlink3.mk</code> ファイルがいくつかあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="filename">bdb.buildlink3.mk</code> は、
	<code class="varname">BDB_ACCEPTED</code> および
	<code class="varname">BDB_DEFAULT</code> の値にもとづき、
	ネイティブまたは pkgsrc の Berkeley DB の実装のどちらかを選択します。</p></li>
<li class="listitem"><p><code class="filename">curses.buildlink3.mk</code>: システムに
	Curses も NCurses も附属しない場合に、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/ncurses/README.html" target="_top"><code class="filename">devel/ncurses</code></a>
	パッケージをインストールしてくれます。</p></li>
<li class="listitem"><p><code class="filename">krb5.buildlink3.mk</code> は、
	<code class="varname">KRB5_ACCEPTED</code> の値を使って、
	Kerberos 5 の実装を必要とするパッケージを
	Heimdal または MIT-krb5 のどちらに依存させるかを選択します。</p></li>
<li class="listitem"><p><code class="filename">motif.buildlink3.mk</code> は、
	システム附属の Motif がインストールされているかを確認し、
	ない場合は、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/x11/lesstif/README.html" target="_top"><code class="filename">x11/lesstif</code></a> または <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/x11/openmotif/README.html" target="_top"><code class="filename">x11/openmotif</code></a> への依存性を追加します。
	利用者は、<code class="varname">MOTIF_TYPE</code> を <span class="quote">“<span class="quote">dt</span>”</span>,
	<span class="quote">“<span class="quote">lesstif</span>”</span> または <span class="quote">“<span class="quote">openmotif</span>”</span> に設定して、
	どの版の Motif を使うかを選択することができます。</p></li>
<li class="listitem"><p><code class="filename">oss.buildlink3.mk</code> は、
	Open Sound System (OSS) API
	を使うパッケージが使うことがある変数をいくつか定義します。</p></li>
<li class="listitem"><p><code class="filename">pgsql.buildlink3.mk</code> は、
	Postgres 8.0, 8.1 または 8.2 のうち、インストールされているものを受け入れます。
	さらなる情報は、このファイルの内容をご覧ください。</p></li>
<li class="listitem"><p><code class="filename">pthread.buildlink3.mk</code> は、
	<code class="varname">PTHREAD_OPTS</code> の値を使うとともに、ネイティブの pthread があるか確認し、
	ない場合は、必要に応じて <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/pth/README.html" target="_top"><code class="filename">devel/pth</code></a> への依存性を追加します。</p></li>
<li class="listitem"><p><code class="filename">xaw.buildlink3.mk</code> は、
	<code class="varname">XAW_TYPE</code> の値を使って、具体的にどの
	Athena widget ライブラリーを使うかを選択します。</p></li>
</ul></div>
<p>それぞれの <code class="filename">buildlink3.mk</code>
    ファイルのコメントに、
    適切な使い方に関するより詳しい説明があります。</p>
</div>
<div class="sect1" title="14.2. buildlink3.mk ファイルを書く">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="creating-buildlink3.mk"></a>14.2. <code class="filename">buildlink3.mk</code> ファイルを書く</h2></div></div></div>
<a name="buildlink3.mk"></a><p>パッケージの <code class="filename">buildlink3.mk</code> ファイルは、
    そのパッケージに附属するヘッダーファイルやライブラリーをコンパイルしたりリンクしたりする必要があることを示すために、
    Makefile からインクルードされます。
    <code class="filename">buildlink3.mk</code> ファイルは、
    適切な種類の依存関係を追加したり、
    さらに必要となるヘッダーやライブラリーを使うために別の
    <code class="filename">buildlink3.mk</code> をインクルードしたりするために必要な情報を、
    いつでも提供できるように作ります。</p>
<p>編集するための元となる <code class="filename">buildlink3.mk</code>
    ファイルを作るには、Rene Hexel の  <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/createbuildlink/README.html" target="_top"><code class="filename">pkgtools/createbuildlink</code></a>
    パッケージを使うことを強くおすすめします。ほとんどのパッケージに対しては、
    以下のコマンドを使うと、<code class="filename">buildlink3.mk</code>
    ファイルのよい出発点となるものを作ってくれます。</p>
<pre class="screen">
<code class="prompt">%</code> <strong class="userinput"><code>cd pkgsrc/<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>pkgdir</code></em>
<code class="prompt">%</code> createbuildlink &gt;buildlink3.mk</code></strong>
    </pre>
<div class="sect2" title="14.2.1. buildlink3.mk ファイルの分析">
<div class="titlepage"><div><div><h3 class="title">
<a name="anatomy-of-bl3"></a>14.2.1. buildlink3.mk ファイルの分析</h3></div></div></div>
<p>以下に掲げるのは、
      <code class="filename">pkgsrc/graphics/tiff</code> における
      <code class="filename">buildlink3.mk</code> の実例です。</p>
<pre class="programlisting">
# $NetBSD: buildlink3.mk,v 1.16 2009/03/20 19:24:45 joerg Exp $

BUILDLINK_TREE+=	tiff

.if !defined(TIFF_BUILDLINK3_MK)
TIFF_BUILDLINK3_MK:=

BUILDLINK_API_DEPENDS.tiff+=	tiff&gt;=3.6.1
BUILDLINK_ABI_DEPENDS.tiff+=	tiff&gt;=3.7.2nb1
BUILDLINK_PKGSRCDIR.tiff?=	../../graphics/tiff

.include "../../devel/zlib/buildlink3.mk"
.include "../../graphics/jpeg/buildlink3.mk"
.endif # TIFF_BUILDLINK3_MK

BUILDLINK_TREE+=	-tiff
</pre>
<p>ヘッダーとフッターで、
      <code class="varname">BUILDLINK_TREE</code> の値を操作しています。
      この変数は、パッケージの依存関係を辿るために、
      すべての <code class="filename">buildlink3.mk</code> ファイルの間で、
      共通に使われます。</p>
<p>本体の節では、多重のインクルードを防いだうえで、
      <em class="replaceable"><code>pkg</code></em> への依存性をどのように追加するかを制御しています。
      いくつもの重要な変数がこの節で設定されます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
	  は、インストールされるパッケージに対して、実際に記録される依存性です。
	  この変数の既存のリストを残したまま追加するために、
	  かならず <span class="command"><strong>+=</strong></span> を使って設定します。
	  この変数の設定値は、
	  パッケージの API が現行のものになった以降の最初 (最古) のバージョンにします。
	  </p></li>
<li class="listitem"><p><code class="varname">BUILDLINK_PKGSRCDIR.<em class="replaceable"><code>pkg</code></em></code>
	  は、pkgsrc における
	  <em class="replaceable"><code>pkg</code></em> のディレクトリーです。</p></li>
<li class="listitem"><p><code class="varname">BUILDLINK_DEPMETHOD.<em class="replaceable"><code>pkg</code></em></code>
	  (上の例には出てきません) は、
	  <em class="replaceable"><code>pkg</code></em> への依存性として
	  <code class="varname">BUILD_DEPENDS</code> と
	  <code class="varname">DEPENDS</code> のどちらを使うかを制御します。
	  <code class="varname">BUILDLINK_DEPMETHOD.<em class="replaceable"><code>pkg</code></em></code>
	  を <span class="quote">“<span class="quote">build</span>”</span> にすれば、
	  構築時の依存性となります。この変数を設定しなかった場合は、
	  完全な依存性となります。</p></li>
<li class="listitem"><p><code class="varname">BUILDLINK_INCDIRS.<em class="replaceable"><code>pkg</code></em></code>
	    および
	    <code class="varname">BUILDLINK_LIBDIRS.<em class="replaceable"><code>pkg</code></em></code>
	    (上の例には出てきません) は、ヘッダーおよびライブラリーの検索パスに追加するための、
	    <code class="filename">${BUILDLINK_PREFIX.<em class="replaceable"><code>pkg</code></em>}</code>
	    のサブディレクトリーです。設定しなかった場合は、それぞれ
	    <span class="quote">“<span class="quote">include</span>”</span> および <span class="quote">“<span class="quote">lib</span>”</span>
	  となります。</p></li>
<li class="listitem"><p><code class="varname">BUILDLINK_CPPFLAGS.<em class="replaceable"><code>pkg</code></em></code>
	    (上の例には出てきません) は、<code class="varname">CPPFLAGS</code>
	    に追加するためのプリプロセッサー用のフラグで、このフラグは
	    configure および build の段階に渡されます。<span class="quote">“<span class="quote">-I</span>”</span>
	    オプションは使わずに、上述の
	    <code class="varname">BUILDLINK_INCDIRS.<em class="replaceable"><code>pkg</code></em></code>
	  を使って処理するようにしてください。</p></li>
</ul></div>
<p>以下の各変数はすべて、二つ目の (多重のインクルードを防いでいる) 節において、
      任意に定義されるものであり、どのパッケージのファイルを
      <code class="filename">${BUILDLINK_DIR}</code> からシンボリックリンクするか、および、
      シンボリックリンクによってファイル名をどのように変換するか、
      を制御します。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">BUILDLINK_FILES.<em class="replaceable"><code>pkg</code></em></code>
	    (上の例には出てきません) は、
	    <code class="filename">${BUILDLINK_DIR}</code>
	    からシンボリックリンクされるリンク先の、
	    <code class="filename">${BUILDLINK_PREFIX.<em class="replaceable"><code>pkg</code></em>}</code>
	    からの相対位置のシェルのグロブパターンです。
	  たとえば <code class="filename">include/*.h</code> のようになります。</p></li>
<li class="listitem"><p><code class="varname">BUILDLINK_FILES_CMD.<em class="replaceable"><code>pkg</code></em></code>
	    (上の例には出てきません) は、
	    <code class="filename">${BUILDLINK_PREFIX.<em class="replaceable"><code>pkg</code></em>}</code>.
	    からの相対位置でのファイルのリストを標準出力に出力する、シェルのパイプラインです。
	    これにより出力されるファイルは、
	    <code class="filename">${BUILDLINK_DIR}</code> からシンボリックリンクされます。指定しなかった場合、
	    <em class="replaceable"><code>pkg</code></em> の
	    <code class="filename">+CONTENTS</code> を
	    <code class="varname">${BUILDLINK_CONTENTS_FILTER.<em class="replaceable"><code>pkg</code></em>}</code>
	    でフィルターした結果が出力されるようになります。</p></li>
<li class="listitem"><p><code class="varname">BUILDLINK_CONTENTS_FILTER.<em class="replaceable"><code>pkg</code></em></code>
	    (上の例には出てきません) は、<code class="filename">+CONTENTS</code>
	    を入力にとり、
	    <code class="filename">${BUILDLINK_PREFIX.<em class="replaceable"><code>pkg</code></em>}</code>
	    からの相対位置でのファイルのリストを標準出力に出力するフィルターコマンドです。
	    指定しなかった場合、overwrite パッケージでは、
	    <code class="varname">BUILDLINK_CONTENTS_FILTER.<em class="replaceable"><code>pkg</code></em></code>
	    はパッケージの <code class="filename">+CONTENTS</code> から <code class="filename">include</code>
	    および <code class="filename">lib</code> ディレクトリーの内容を出力し、
	    pkgviews パッケージでは、<code class="filename">lib</code> ディレクトリーにある
	    libtool アーカイブをすべて出力します。</p></li>
<li class="listitem"><p><code class="varname">BUILDLINK_FNAME_TRANSFORM.<em class="replaceable"><code>pkg</code></em></code>
	    (上の例には出てきません) は、元ファイル名から宛先ファイル名への変換用の
	    sed の引数のリストです。たとえば <span class="command"><strong>-e
	    "s|/curses.h|/ncurses.h|g"</strong></span> のようになります。</p></li>
</ul></div>
<p>この節では、
      <em class="replaceable"><code>pkg</code></em> のライブラリー依存性として必要な
      <code class="filename">buildlink3.mk</code> をすべてインクルードすることができます。
      ここで <code class="filename">buildlink3.mk</code> ファイルをインクルードすると、
      <em class="replaceable"><code>pkg</code></em> の
      <code class="filename">buildlink3.mk</code> ファイルがインクルードされる場合はいつも、
      これらへの依存性のためのヘッダーやライブラリーも、
      <code class="filename">${BUILDLINK_DIR}</code>
      からシンボリックリンクされることになります。
      依存性が追加されるのは、
      <code class="filename">buildlink3.mk</code> ファイルを直接インクルードした場合だけです。</p>
</div>
<div class="sect2" title="14.2.2. buildlink3.mk ファイルの BUILDLINK_API_DEPENDS.pkg を更新する">
<div class="titlepage"><div><div><h3 class="title">
<a name="updating-buildlink-depends"></a>14.2.2. <code class="filename">buildlink3.mk</code> ファイルの <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code> を更新する</h3></div></div></div>
<p>パッケージを更新した際に
	<code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
	に列挙されている依存性のバージョンを上げる必要があるのは、
      その更新で API やヘッダーファイルへのインターフェースが変わった場合です。</p>
<p>このような場合は、
      <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
      を調節して、最低限、新しいパッケージのバージョンを要するようにします。
      場合によっては、新しいバージョンに依存するパッケージの
      <code class="varname">PKGREVISION</code> を上げる必要があることがあります。
      また、依存しているパッケージに <code class="filename">buildlink3.mk</code>
      ファイルがある場合は、
      <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
      も調節します。これは、pkgsrc が適切なパッケージの依存性を求めるようにして、
      ソースからの構築時に古いパッケージに依存したりしないようにするために、
      必要なことです。</p>
<p><code class="varname">BUILDLINK_ABI_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
	を上げるのは、バイナリーインターフェースや、
	インストールされている共有ライブラリーのいずれかの soname
	(ライブラリーのバージョンのメジャー番号) が変わった場合です。
	これは、これらを使うバイナリーパッケージが、
	適切なパッケージの依存性を求めるようにして、
	必要な共有ライブラリーをもたない古いパッケージに依存したりしないようにするために、
      必要なことです。</p>
<p><code class="varname">BUILDLINK_ABI_DEPENDS</code> および
	<code class="varname">ABI_DEPENDS</code> の定義を含めた、
	他のパッケージへの依存性について、さらなる情報は、
      <a class="xref" href="#dependencies" title="19.1.6. 依存性の処理">Section 19.1.6, “依存性の処理”</a>をご覧ください。</p>
<p>なお、必要もないのにパッケージを削除したり再構築したりするようなことのないよう、
      <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
      や
      <code class="varname">BUILDLINK_ABI_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
      の調節は、事前に熟考するようにしてください。
      多くの場合、新しいバージョンのパッケージは、
      従前の依存性のままでも問題なく動作します。</p>
<p>また、
	<code class="varname">BUILDLINK_ABI_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
	は、
	<code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
      と同じ値となる場合には設定する必要はありません。	</p>
</div>
</div>
<div class="sect1" title="14.3. builtin.mk ファイルを書く">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="writing-builtin.mk"></a>14.3. <code class="filename">builtin.mk</code> ファイルを書く</h2></div></div></div>
<p>pkgsrc のパッケージのなかには、
      ベースシステムにも存在するようなヘッダーやライブラリーをインストールするものがあります。
      そのようなパッケージでは、
      <code class="filename">buildlink3.mk</code> ファイルとは別に、
      <code class="filename">builtin.mk</code> ファイルも含めておきます。
      このファイルでは、ベースシステム附属のソフトウェアと
    pkgsrc のソフトウェアのどちらを使うのが適切かを判断するために必要な確認をおこないます。</p>
<p><em class="replaceable"><code>pkg</code></em> 用の
    builtin.mk ファイルで必要なのは、以下のことだけです。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>インクルードされた後に
	<code class="varname">USE_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
	を <span class="quote">“<span class="quote">yes</span>”</span> または <span class="quote">“<span class="quote">no</span>”</span>
	のどちらかに設定すること。</p></li>
<li class="listitem"><p><code class="filename">builtin.mk</code> ファイルがインクルードされる前から定義されている
	<code class="varname">USE_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
	を、一切上書き<span class="emphasis"><em>しない</em></span>こと。</p></li>
<li class="listitem"><p>複数のインクルードができるように書くこと。
	これは<span class="emphasis"><em>非常に</em></span>重要なことであり、
	<code class="filename">Makefile</code> のコーディングに対する配慮となります。</p></li>
</ol></div>
<div class="sect2" title="14.3.1. builtin.mk ファイルの分析">
<div class="titlepage"><div><div><h3 class="title">
<a name="anatomy-of-builtin.mk"></a>14.3.1. <code class="filename">builtin.mk</code> ファイルの分析</h3></div></div></div>
<p>以下に掲げるのは、builtin.mk
      ファイルの推奨テンプレートです。</p>
<pre class="programlisting">
.if !defined(IS_BUILTIN.foo)
#
# IS_BUILTIN.foo is set to "yes" or "no" depending on whether "foo"
# genuinely exists in the system or not.
#
IS_BUILTIN.foo?=        no

# BUILTIN_PKG.foo should be set here if "foo" is built-in and its package
# version can be determined.
#
.  if !empty(IS_BUILTIN.foo:M[yY][eE][sS])
BUILTIN_PKG.foo?=       foo-1.0
.  endif
.endif  # IS_BUILTIN.foo

.if !defined(USE_BUILTIN.foo)
USE_BUILTIN.foo?=       ${IS_BUILTIN.foo}
.  if defined(BUILTIN_PKG.foo)
.    for _depend_ in ${BUILDLINK_API_DEPENDS.foo}
.      if !empty(USE_BUILTIN.foo:M[yY][eE][sS])
USE_BUILTIN.foo!=                                                       \
        ${PKG_ADMIN} pmatch '${_depend_}' ${BUILTIN_PKG.foo}            \
        &amp;&amp; ${ECHO} "yes" || ${ECHO} "no"
.      endif
.    endfor
.  endif
.endif  # USE_BUILTIN.foo

CHECK_BUILTIN.foo?=     no
.if !empty(CHECK_BUILTIN.foo:M[nN][oO])
#
# Here we place code that depends on whether USE_BUILTIN.foo is set to
# "yes" or "no".
#
.endif  # CHECK_BUILTIN.foo
</pre>
<p>最初の節では、<em class="replaceable"><code>pkg</code></em>
      がベースシステムに実際に存在するかどうかに応じて、
      <code class="varname">IS_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      を設定しています。これは、ベースシステムに <em class="replaceable"><code>pkg</code></em>
      相当の機能のソフトウェアが存在するかどうかではありません。
      この変数を <span class="quote">“<span class="quote">yes</span>”</span> にするのは、
      このパッケージそのものがベースシステムの一部として附属する場合だけです。
      この変数は、<code class="filename">builtin.mk</code>
      ファイルの内部でのみ使われます。</p>
<p>二つ目の節では、<em class="replaceable"><code>pkg</code></em>
      がベースシステムに存在する場合 (つまり
      <code class="varname">IS_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      が <span class="quote">“<span class="quote">yes</span>”</span> の場合)、
      <code class="varname">BUILTIN_PKG.<em class="replaceable"><code>pkg</code></em></code>
      をそのバージョンに設定しています。この変数は、<code class="filename">builtin.mk</code>
      ファイルの内部でのみ使われます。</p>
<p>三つ目の節では、
      <code class="varname">USE_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      を設定しており、これはすべての <code class="filename">builtin.mk</code>
      ファイルで<span class="emphasis"><em>必須です</em></span>。
      この節のコードは、ベースシステム附属のソフトウェアが、
      <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
      で列挙されている依存性を満たすのに十分かどうかを判別する必要があります。
      この判別は、たいていは、
      <code class="varname">BUILTIN_PKG.<em class="replaceable"><code>pkg</code></em></code>
      を、
      <code class="varname">BUILDLINK_API_DEPENDS.<em class="replaceable"><code>pkg</code></em></code>
      の各依存性と比較することでおこなわれます。

      <code class="varname">USE_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      は、<code class="filename">builtin.mk</code> ファイルの終わりまでに、
      適切な値に設定する<span class="emphasis"><em>必要があります</em></span>。なお、たとえ
      <code class="varname">IS_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      が <span class="quote">“<span class="quote">no</span>”</span> であっても、
      <code class="varname">USE_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      は <span class="quote">“<span class="quote">yes</span>”</span> にすることができます。なぜなら、
      ベースシステム附属のソフトウェアが依存パッケージに十分似ており、
      代替可能であるという判断もできるからです。</p>
<p>最後の節は
      <code class="varname">CHECK_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      に守られており、前の節で設定された
      <code class="varname">USE_BUILTIN.<em class="replaceable"><code>pkg</code></em></code>
      の値を使うコードをインクルードします。たいていの場合、ここでインクルードするのは、
      たとえば依存性への制約の追加や、<code class="filename">${BUILDLINK_DIR}</code>
      からシンボリックリンクされるファイルのリストの
      (<code class="varname">BUILDLINK_FILES.<em class="replaceable"><code>pkg</code></em></code>
      を使った) 追加などです。</p>
</div>
<div class="sect2" title="14.3.2. ネイティブおよび pkgsrc のソフトウェアの選択に関する、大域的な設定">
<div class="titlepage"><div><div><h3 class="title">
<a name="native-or-pkgsrc-preference"></a>14.3.2. ネイティブおよび pkgsrc のソフトウェアの選択に関する、大域的な設定</h3></div></div></div>
<p>パッケージの構築時に、
	依存性を満たすソフトウェアとして組み込み (ネイティブ)
	のものを使うか pkgsrc のものを使うかを、
	大域的な設定に応じて切替えることができます。
	この制御は、<code class="varname">PREFER_PKGSRC</code> および
	<code class="varname">PREFER_NATIVE</code> を設定することでおこないます。
	この両変数は、<span class="quote">“<span class="quote">yes</span>”</span>, <span class="quote">“<span class="quote">no</span>”</span>
	またはパッケージのリストを値として持ちます。
	<code class="varname">PREFER_PKGSRC</code> は pkgsrc 版のソフトウェアを使うことを、
	<code class="varname">PREFER_NATIVE</code> で組み込み版を使うことを、
	それぞれ指示します。この設定は、
	対象パッケージではどちらを使うのがもっとも適当かに応じて、
	<code class="varname">PREFER_PKGSRC</code> か
	<code class="varname">PREFER_NATIVE</code> のいずれかで指定します。
	あるパッケージがどちらにも設定されていない場合、
	または両方で設定されている場合は、
	<code class="varname">PREFER_PKGSRC</code> が
	<code class="varname">PREFER_NATIVE</code> より優先します。たとえば、
	NetBSD システムの最も基本的な要素を除き、
	すべて pkgsrc 版のソフトウェアを使うこととする場合、
      以下のように設定することができます。</p>
<pre class="programlisting">
PREFER_PKGSRC=  yes
PREFER_NATIVE=  getopt skey tcp_wrappers
</pre>
<p>あるパッケージを <code class="varname">PREFER_NATIVE</code>
      のリストに加えるには、そのパッケージに
      <code class="filename">builtin.mk</code>
      ファイルがある<span class="emphasis"><em>必要があります</em></span>。
      このファイルがない場合は、リストに加えても単に無視されます。</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter 15. pkginstall の枠組">
<div class="titlepage"><div><div><h2 class="title">
<a name="pkginstall"></a>Chapter 15. pkginstall の枠組</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#files-and-dirs-outside-prefix">15.1. インストール用のプレフィックス以外の場所にあるファイルとディレクトリー</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#dirs-outside-prefix">15.1.1. ディレクトリーの操作</a></span></dt>
<dt><span class="sect2"><a href="#files-outside-prefix">15.1.2. ファイルの操作</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#conf-files">15.2. 設定ファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#conf-files-sysconfdir">15.2.1. <code class="varname">PKG_SYSCONFDIR</code> はどのように設定されるか</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-configure">15.2.2. ソフトウェアに設定ファイルの置き場所を教える</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-patching">15.2.3. インストールの過程を修正する</a></span></dt>
<dt><span class="sect2"><a href="#conf-files-disable">15.2.4. 設定ファイルの処理をしないようにする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#rcd-scripts">15.3. システム起動スクリプト</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#rcd-scripts-disable">15.3.1. システム起動スクリプトの処理をしないようにする</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#users-and-groups">15.4. システムユーザーとグループ</a></span></dt>
<dt><span class="sect1"><a href="#shells">15.5. システムシェル</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#shells-disable">15.5.1. シェルの登録をしないようにする</a></span></dt></dl></dd>
<dt><span class="sect1"><a href="#fonts">15.6. フォント</a></span></dt>
<dd><dl><dt><span class="sect2"><a href="#fonts-disable">15.6.1. フォントデータベースの自動更新をしないようにする</a></span></dt></dl></dd>
</dl>
</div>
<p>本章では、<code class="literal">pkginstall</code> の枠組について説明します。
主な機能は以下のとおりです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>pkgsrc が扱うツリー (<code class="varname">LOCALBASE</code>)
    以外の場所のディレクトリーやファイルの、汎用的なインストールおよび操作。</p></li>
<li class="listitem"><p>インストール時における、設定ファイルの自動処理
    (パッケージが正しく設計されていればですが)。</p></li>
<li class="listitem"><p>システム起動スクリプトの作成およびインストール。</p></li>
<li class="listitem"><p>システムユーザーおよびグループの登録。</p></li>
<li class="listitem"><p>システムシェルの登録。</p></li>
<li class="listitem"><p>フォントデータベースの自動更新。</p></li>
</ul></div>
<p>以下の各節では、上述の各機能について詳しく見てゆきます。</p>
<p>本章で説明する機能の多くは、パッケージのインストール後のターゲット
(<code class="literal">post-install</code>) を使うだけで簡単に実現できるのではないか、
とお思いになるかもしれませんが、<span class="emphasis"><em>それは正しくありません</em></span>。
このターゲットのコードは、パッケージをソースから構築した場合しか実行されないからです。
バイナリーパッケージを使う場合は、(コード自体が利用できないので)
このターゲットのコードでは何もできません。したがって、上述の各機能は、
pkginstall が自動生成するインストール用スクリプトでしか実現できないのです。</p>
<div class="sect1" title="15.1. インストール用のプレフィックス以外の場所にあるファイルとディレクトリー">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="files-and-dirs-outside-prefix"></a>15.1. インストール用のプレフィックス以外の場所にあるファイルとディレクトリー</h2></div></div></div>
<p>すでにご存知のとおり、<code class="filename">PLIST</code> ファイルには、
パッケージに属するファイルとディレクトリーの一覧が書かれています。
この一覧では、インストール用のプレフィックス
(<code class="filename">${PREFIX}</code>) からの相対位置を使うため、
このディレクトリー以外の場所にあるファイルを書くことはできません
(絶対パス名は使えません)。この制約がある一方で、
パッケージによってはそのような場所、たとえば
<code class="filename">${VARBASE}</code> や
<code class="filename">${PKG_SYSCONFDIR}</code>
以下にファイルをインストールする必要があります。
これをおこなう唯一の方法は、インストール時にインストール用のスクリプトを使って
インストール対象のファイルを作成することです。</p>
<p>汎用のインストール用スクリプトは、
任意のコードを含めることのできるシェルスクリプトです。
実行するスクリプトを並べたリストを <code class="varname">INSTALL_FILE</code> 変数で与えます。
この変数の値は標準では <code class="filename">INSTALL</code> です。
パッケージの削除用としても、同様の変数があります (<code class="varname">DEINSTALL_FILE</code>:
標準の値は <code class="filename">DEINSTALL</code>)。
これらのスクリプトでは任意のコマンドを実行できるので、
ファイルシステム中のどこであってもファイルの作成や管理をすることができます。</p>
<p>以上のような汎用のインストール用スクリプトを使うことはおすすめしませんが、
特殊な事例では必要となることがあります。これらを使うべきでない理由のひとつは、
インストール用スクリプト内に不必要なコードや単純に誤ったコードが入っていないことについて、
利用者がパッケージ作成者を信頼する必要があるということです。
また、以前は、同じ機能のために同様のコードがたくさん使われており、
それらに共通するエラーを修正する場合は、
同様のコードをすべて探して変更する必要がありました。</p>
<p>pkginstall の枠組では、これとは異なる標準化された方法を提供します。
パッケージの <code class="filename">Makefile</code> で設定された変数にもとづき、
インストール対象のファイルやディレクトリーを操作するための汎用のスクリプトを提供します。
以下、本節では、この用途で使う変数を説明します。</p>
<div class="sect2" title="15.1.1. ディレクトリーの操作">
<div class="titlepage"><div><div><h3 class="title">
<a name="dirs-outside-prefix"></a>15.1.1. ディレクトリーの操作</h3></div></div></div>
<p>以下の変数は、ファイルシステムの任意の場所へディレクトリーを作成するために、
設定することができます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">MAKE_DIRS</code> と <code class="varname">OWN_DIRS</code> は、
    インストール用スクリプトが作成したり、
    削除を試みたりする対象のディレクトリーのリストを値として持ちます。
    両変数の違いは、後者はアンインストール時に (空でなかったために)
    削除できなかった各ディレクトリーを削除するよう管理者に対してうながしますが、
    前者はそうしないことです。</p></li>
<li class="listitem">
<p><code class="varname">MAKE_DIRS_PERMS</code> と
    <code class="varname">OWN_DIRS_PERMS</code> は、インストール用スクリプトが作成したり、
    削除しようとしたりする対象のディレクトリーについて記述したタプルのリストを値として持ちます。
    各タプルは、ディレクトリー名、所有者、所有グループと、
    数字で表したモードの値をスペースで区切ったものからなります。
    たとえば以下のようになります。</p>
<pre class="programlisting">
MAKE_DIRS_PERMS+=         ${VARBASE}/foo/private ${ROOT_USER} ${ROOT_GROUP} 0700
</pre>
<p>両変数の違いは、<code class="varname">PERMS</code>
    のつかない変数の違いとまったく同じです。</p>
</li>
</ul></div>
</div>
<div class="sect2" title="15.1.2. ファイルの操作">
<div class="titlepage"><div><div><h3 class="title">
<a name="files-outside-prefix"></a>15.1.2. ファイルの操作</h3></div></div></div>
<p>インストール用プレフィックス以外の場所に空でないファイルを作ることは、やりにくいことです。
なぜなら <code class="filename">PLIST</code> は全ファイルをインストール用プレフィックス内にあるものとして扱うからです。
この問題に対する唯一の解決策は、インストールの際に、
ファイルをいったん既知の場所 (つまり、インストール用プレフィックス内)
に展開し、それを本来の場所にコピーすることです
(pkginstall が生成するインストール用スクリプトがおこないます)。
以下、インストール用プレフィックス以外の場所のファイルを自動的かつ首尾一貫して扱うために使える変数について説明しますが、
ここではプレフィックス内にいったん展開したファイルのことを原本ファイル (<span class="emphasis"><em>master
file</em></span>) ということにします。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="varname">CONF_FILES</code> と
    <code class="varname">REQD_FILES</code> は、
    原本ファイルとコピー先ファイルの組のリストを値として持ちます。
    インストール時に、コピー先ファイルが存在しなかった場合に限って、
    原本ファイルがコピー先ファイルにコピーされます。アンインストール時は、
    コピー先ファイルがインストールにおいて変更されていなければ、
    コピー先ファイルが削除されます。</p>
<p>両変数の違いは、後者はアンインストール時に (空でなかったために)
    削除できなかった各ファイルを削除するよう管理者に対してうながしますが、
    前者はそうしないことです。</p>
</li>
<li class="listitem">
<p><code class="varname">CONF_FILES_PERMS</code> と
    <code class="varname">REQD_FILES_PERMS</code> は、
    原本ファイルとコピー先ファイルについて記述したタプルのリストを値として持ちます。
    各タプルは、ファイル名のほか、両ファイルの所有者、所有グループと、
    数字で表したパーミッションを、この順番で指定します。
    たとえば以下のようになります。</p>
<pre class="programlisting">
REQD_FILES_PERMS+= ${PREFIX}/share/somefile ${VARBASE}/somefile ${ROOT_USER} ${ROOT_GROUP} 0700
</pre>
<p>両変数の違いは、<code class="varname">PERMS</code>
    のつかない変数の違いとまったく同じです。</p>
</li>
</ul></div>
</div>
</div>
<div class="sect1" title="15.2. 設定ファイル">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="conf-files"></a>15.2. 設定ファイル</h2></div></div></div>
<p>(個々のパッケージの) 設定ファイルは、パッケージに固有のディレクトリー
<code class="varname">PKG_SYSCONFDIR</code> にインストールされ、また、
インストール時には特別扱いが必要である (ほとんどのことは、pkginstall
で自動化されています) という点で、特別です。主に心がける必要があることは、
設定ファイルであるとされたファイルは、インストール時に、
そのファイルがもともと存在しなかった場合<span class="emphasis"><em>に限って</em></span>、
正しい場所 (<code class="varname">PKG_SYSCONFDIR</code>
以下のどこか) に自動的にコピーされるということです。同様にして、
設定ファイルにローカルな変更が加わっている場合には、
アンインストール時に削除されません。こうすることで、
管理者が独自に変更をおこなっても、その変更が失われることがないようにしています。</p>
<div class="sect2" title="15.2.1. PKG_SYSCONFDIR はどのように設定されるか">
<div class="titlepage"><div><div><h3 class="title">
<a name="conf-files-sysconfdir"></a>15.2.1. <code class="varname">PKG_SYSCONFDIR</code> はどのように設定されるか</h3></div></div></div>
<p>前述のとおり、<code class="varname">PKG_SYSCONFDIR</code>
変数は設定ファイルのインストール先を指定します。この変数の値は、
以下の各変数をもとに設定されます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PKG_SYSCONFBASE</code>: 設定ディレクトリーのルートです。
    指定しなかった場合は <code class="filename">${PREFIX}/etc</code> となりますが、
    利用者は好みの場所 (たとえば、
    <code class="filename">/etc</code>, <code class="filename">/etc/pkg</code> など)
    を指すよう上書きすることもできます。
    パッケージがこの変数を直接使うことはできません。</p></li>
<li class="listitem">
<p><code class="varname">PKG_SYSCONFSUBDIR</code>: <code class="varname">PKG_SYSCONFBASE</code>
    のサブディレクトリーで、
    構築されたパッケージ用の設定ファイルはこの下に置かれます。
    この変数は、パッケージの
    <code class="filename">Makefile</code> で定義された場合にのみ意味を持ちます (つまり、
    利用者がカスタマイズすることはできません)。</p>
<p>例としては、Apache のパッケージ
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/apache2/README.html" target="_top"><code class="filename">www/apache2</code></a> をご覧ください。Apache では、設定ファイルを
    <code class="varname">PKG_SYSCONFBASE</code> のサブディレクトリー
    <code class="filename">httpd/</code> に置いています。この変数は、パッケージの
    Makefile で設定します。</p>
</li>
<li class="listitem"><p><code class="varname">PKG_SYSCONFVAR</code>: このパッケージの設定ディレクトリー
    (<code class="varname">PKG_SYSCONFBASE</code> と異なる場合) を保持する変数の名前を指定します。
    指定しなかった場合は、<code class="varname">PKGBASE</code> の値となります。
    また、常に <code class="literal">PKG_SYSCONFDIR</code> が前につきます。</p></li>
<li class="listitem"><p><code class="varname">PKG_SYSCONFDIR.${PKG_SYSCONFVAR}</code>:
    <code class="varname">PKG_SYSCONFVAR</code>
    で区別されるパッケージの設定ファイルをどのディレクトリーに置くかを保持します。</p></li>
</ul></div>
<p>以上の各変数をもとに、pkginstall は <code class="varname">PKG_SYSCONFDIR</code>
の値を決めます。パッケージが設定ディレクトリーを参照するには、
この <code class="varname">PKG_SYSCONFDIR</code> 変数<span class="emphasis"><em>だけ</em></span>を使うことができます。
この値の設定に使われるアルゴリズムは、
基本的には以下のとおりです。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p><code class="varname">PKG_SYSCONFDIR.${PKG_SYSCONFVAR}</code> が設定されている場合は、
    この値が使われます。</p></li>
<li class="listitem"><p>前項の変数は定義されていないが、
    <code class="varname">PKG_SYSCONFSUBDIR</code> がパッケージの
    <code class="filename">Makefile</code> で設定されている場合は、
    <code class="filename">${PKG_SYSCONFBASE}/${PKG_SYSCONFSUBDIR}</code> が使われます。</p></li>
<li class="listitem"><p>以上の場合以外は、
    <code class="filename">${PKG_SYSCONFBASE}</code> に設定されます。</p></li>
</ol></div>
<p>なお、<code class="filename">${PKG_SYSCONFDIR}</code> は自動的に
<code class="filename">OWN_DIRS</code> に追加されることを断っておきます。この意味については、<a class="xref" href="#dirs-outside-prefix" title="15.1.1. ディレクトリーの操作">Section 15.1.1, “ディレクトリーの操作”</a>をご覧ください。
ただし、<code class="filename">${PKG_SYSCONFDIR}</code> のサブディレクトリーは追加されませんので、
OWN_DIRS または MAKE_DIRS を使って作成する必要があります。</p>
</div>
<div class="sect2" title="15.2.2. ソフトウェアに設定ファイルの置き場所を教える">
<div class="titlepage"><div><div><h3 class="title">
<a name="conf-files-configure"></a>15.2.2. ソフトウェアに設定ファイルの置き場所を教える</h3></div></div></div>
<p>pkgsrc (とユーザーも) が、設定ファイルを既知の場所に置くことを前提としている場合は、
設定ファイルをインストールする場所を各パッケージに教えてやる必要があります。
場合によっては、パッケージの Makefile を修正する必要があります。
この修正は、運がよければ、
コンフィギュレーションスクリプトに渡すフラグを追加する程度ですみます。
これは、GNU Autoconf が生成したファイルの場合が該当します。</p>
<pre class="programlisting">
CONFIGURE_ARGS+= --sysconfdir=${PKG_SYSCONFDIR}
</pre>
<p>なお、ここで指定しているのは、
パッケージが設定ファイルを<span class="emphasis"><em>探す</em></span>必要のある場所であって、
設定ファイルのもともとのインストール先ではありません (困った事に、
両者ははっきり区別できませんが)。</p>
</div>
<div class="sect2" title="15.2.3. インストールの過程を修正する">
<div class="titlepage"><div><div><h3 class="title">
<a name="conf-files-patching"></a>15.2.3. インストールの過程を修正する</h3></div></div></div>
<p>前述のとおり、pkginstall は設定ファイルを自動的に処理します。
つまり、<span class="strong"><strong>パッケージ本体側では、
<code class="filename">${PKG_SYSCONFDIR}</code> の内容を直接いじってはいけない</strong></span>
ことになります。まずいことに、多くのソフトウェアのインストール用スクリプトは、
そのまま実行すると、このディレクトリーの内容に手を加えてしまいます。では、
この問題を適切に直すにはどうすればいいのでしょうか?</p>
<p>パッケージに対して、すべての設定ファイルを examples
階層 <code class="filename">share/examples/${PKGBASE}/</code> 以下にインストールするように
(ふつうは、手でパッチを当てて) 指示する必要があります。こうすると、
<code class="filename">PLIST</code> はこれらを登録します。
また、管理者はインストールされたままの設定ファイルを常に使うことができます。</p>
<p>必要な設定ファイルを適切な場所 (つまり、examples 階層の下) に置けば、
pkginstall の枠組は、このファイルを、パッケージのインストール時に
<code class="filename">${PKG_SYSCONFDIR}</code>
以下のファイルを更新するための原本として使うことができます。これをおこなうために、
<code class="varname">CONF_FILES</code> および <code class="varname">CONF_FILES_PERMS</code>
の各変数が使われます。この各変数の書式と使い方は、
<a class="xref" href="#files-outside-prefix" title="15.1.2. ファイルの操作">Section 15.1.2, “ファイルの操作”</a>でご確認ください。
<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/mail/mutt/README.html" target="_top"><code class="filename">mail/mutt</code></a> パッケージから抜粋した例を以下に掲げます。</p>
<pre class="programlisting">
EGDIR=        ${PREFIX}/share/doc/mutt/samples
CONF_FILES=   ${EGDIR}/Muttrc ${PKG_SYSCONFDIR}/Muttrc
</pre>
<p>なお、<code class="varname">EGDIR</code> 変数は当該パッケージに特有のものであって、
それ以外では意味を持たないことに注意してください。</p>
</div>
<div class="sect2" title="15.2.4. 設定ファイルの処理をしないようにする">
<div class="titlepage"><div><div><h3 class="title">
<a name="conf-files-disable"></a>15.2.4. 設定ファイルの処理をしないようにする</h3></div></div></div>
<p>設定ファイルの自動コピーは、パッケージをインストールする前に環境変数
<code class="varname">PKG_CONFIG</code> を設定しておけば、
おこなうかどうかを切替えることができます。</p>
</div>
</div>
<div class="sect1" title="15.3. システム起動スクリプト">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="rcd-scripts"></a>15.3. システム起動スクリプト</h2></div></div></div>
<p>システムの起動スクリプトは、OS ごとに決まった場所にインストールする必要があり、
その場所はたいていインストール用のプレフィックス以外の場所にある、という点で、
特別なファイルです。したがって、<a class="xref" href="#files-and-dirs-outside-prefix" title="15.1. インストール用のプレフィックス以外の場所にあるファイルとディレクトリー">Section 15.1, “インストール用のプレフィックス以外の場所にあるファイルとディレクトリー”</a>で説明したのと同じ方法を適用して、
同じ解決法を使うことができます。ただし、
pkginstall では起動スクリプトの処理専用の仕組みを用意しています。</p>
<p>システムの起動スクリプトが附属するパッケージでは、
以下のことをおこなう必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>スクリプトに <code class="literal">.sh</code> サフィックスを付け加えて、
    <code class="filename">${FILESDIR}</code> 内に置きます。例としては、
    files ディレクトリーに <code class="filename">cupsd.sh</code> がある
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/print/cups/README.html" target="_top"><code class="filename">print/cups</code></a> パッケージをご覧ください。</p></li>
<li class="listitem">
<p>スクリプト名から拡張子を抜いたものを <code class="varname">RCD_SCRIPTS</code>
    変数に追加して、pkginstall がこのスクリプトを処理するようにします。
    前出の例では以下のようになります。</p>
<pre class="programlisting">
RCD_SCRIPTS+=   cupsd
</pre>
</li>
</ol></div>
<p>以上のことをおこなえば、pkginstall は各スクリプトに対して、
以下の手順を自動的におこないます。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>files ディレクトリー以下の各ファイルに対して、
    <code class="filename">FILES_SUBST</code>
    変数で示されている置換をすべて適用します。</p></li>
<li class="listitem"><p>スクリプトを、files ディレクトリーから examples
    階層 <code class="filename">${PREFIX}/share/examples/rc.d/</code> にコピーします。
    なお、この原本ファイルは、<code class="filename">PLIST</code>
    に明示的に登録する必要があります。</p></li>
<li class="listitem"><p>起動スクリプトを examples
    階層からシステム全体の起動スクリプト用ディレクトリーにコピーするためのコードを、
    インストール用スクリプトに追加します。</p></li>
</ol></div>
<div class="sect2" title="15.3.1. システム起動スクリプトの処理をしないようにする">
<div class="titlepage"><div><div><h3 class="title">
<a name="rcd-scripts-disable"></a>15.3.1. システム起動スクリプトの処理をしないようにする</h3></div></div></div>
<p>設定ファイルの自動コピーは、パッケージをインストールする前に環境変数
<code class="varname">PKG_RCD_SCRIPTS</code> を設定しておけば、
おこなうかどうかを切替えることができます。なお、起動スクリプトは常に
examples 階層 <code class="filename">${PREFIX}/share/examples/rc.d/</code>
にコピーされますが、これはこの変数値の影響を受けません。</p>
</div>
</div>
<div class="sect1" title="15.4. システムユーザーとグループ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="users-and-groups"></a>15.4. システムユーザーとグループ</h2></div></div></div>
<p>パッケージのインストール時に、特別なユーザーやグループを作成する必要がある場合、
pkginstall の枠組を使って作成することができます。</p>
<p><code class="varname">PKG_USERS</code> 変数にユーザーのエントリーを追加すると、
ユーザーを作ることができます。各エントリーは、
以下のような書式となります。</p>
<pre class="programlisting">
user:group
</pre>
<p>ユーザーごとに変数を設定して、
ユーザーの属性をさらに詳しく指定することができます。
<code class="varname">PKG_UID.<em class="replaceable"><code>user</code></em></code> は、
ユーザーの数字の UID です。
<code class="varname">PKG_GECOS.<em class="replaceable"><code>user</code></em></code> は、
ユーザーの説明またはコメントです。
<code class="varname">PKG_HOME.<em class="replaceable"><code>user</code></em></code> は、
ユーザーのホームディレクトリーで、指定しなかった場合は
<code class="filename">/nonexistent</code>
となります。
<code class="varname">PKG_SHELL.<em class="replaceable"><code>user</code></em></code> は、
ユーザーのシェルで、指定しなかった場合は
<code class="filename">/sbin/nologin</code> となります。</p>
<p>同様にして、<code class="varname">PKG_GROUPS</code> 変数にグループのエントリーを追加すると、
グループを作ることができます。こちらの書式は以下のようになります。</p>
<pre class="programlisting">
group
</pre>
<p><code class="varname">PKG_GID.<em class="replaceable"><code>group</code></em></code>
を定義すると、グループの数字の GID を設定することができます。</p>
<p>もっと前の段階でユーザーやグループを作る必要がある場合は、
どの相の直後にユーザーやグループを作るかを表すために、
<code class="varname">USERGROUP_PHASE</code> を
<code class="literal">configure</code> または <code class="literal">build</code> に設定することができます。
こうした場合は、作られるユーザーやグループの数字の UID や GID は、
自動的に最終的なインストール用スクリプトにハードコードされます。</p>
</div>
<div class="sect1" title="15.5. システムシェル">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="shells"></a>15.5. システムシェル</h2></div></div></div>
<p>パッケージがシステムシェルをインストールする場合は、管理者の手間を減らせるよう、
インストールしたシェルをシェルデータベース <code class="filename">/etc/shells</code>
に登録するようにします。この登録は、どのシステム上でもバイナリーパッケージが機能するようにするため、
インストール用スクリプトでおこなう必要があります。pkginstall では、
このことを簡単に実現できる方法を用意しています。</p>
<p>パッケージがシェルインタープリターを提供する場合は、
<code class="varname">PKG_SHELL</code> 変数を、そのシェルの絶対ファイル名に設定する必要があります。
こうすると、インストール用スクリプトに、シェル登録処理用のフックを追加します。
<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/shells/zsh/README.html" target="_top"><code class="filename">shells/zsh</code></a> から抜粋した例を以下に掲げますので、ご覧ください。</p>
<pre class="programlisting">
PKG_SHELL=      ${PREFIX}/bin/zsh
</pre>
<div class="sect2" title="15.5.1. シェルの登録をしないようにする">
<div class="titlepage"><div><div><h3 class="title">
<a name="shells-disable"></a>15.5.1. シェルの登録をしないようにする</h3></div></div></div>
<p>シェルインタープリターの自動登録は、管理者が
<code class="filename">PKG_REGISTER_SHELLS</code> 環境変数を <code class="literal">NO</code>
に設定すれば、無効化することができます。</p>
</div>
</div>
<div class="sect1" title="15.6. フォント">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="fonts"></a>15.6. フォント</h2></div></div></div>
<p>X11 フォントをインストールするパッケージでは、
各フォントディレクトリー内のフォントの索引であるデータベースファイルを更新することが必要になります。
この更新は、pkginstall の枠組内で簡単におこなうことができます。</p>
<p>パッケージが X11 フォントをインストールする時には、
フォントをインストールするディレクトリーを、
<code class="varname">FONTS_DIRS.<em class="replaceable"><code>type</code></em></code>
変数に列挙する必要があります。この <em class="replaceable"><code>type</code></em>
は、<span class="quote">“<span class="quote">ttf</span>”</span>,
<span class="quote">“<span class="quote">type1</span>”</span>, <span class="quote">“<span class="quote">x11</span>”</span> のいずれかです。
こうすると、指定した各ディレクトリーのフォントデータベースファイルを更新するコマンドを実行するフックが、
インストール用スクリプトに追加されます。
利便のため、このディレクトリーのパスが相対パスで指定した場合は、
パッケージのインストール用プレフィックスからの相対位置として扱われるようになっています。<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/fonts/dbz-ttf/README.html" target="_top"><code class="filename">fonts/dbz-ttf</code></a> から抜粋した例を以下に掲げますので、ご覧ください。</p>
<pre class="programlisting">
FONTS_DIRS.ttf= ${PREFIX}/lib/X11/fonts/TTF
</pre>
<div class="sect2" title="15.6.1. フォントデータベースの自動更新をしないようにする">
<div class="titlepage"><div><div><h3 class="title">
<a name="fonts-disable"></a>15.6.1. フォントデータベースの自動更新をしないようにする</h3></div></div></div>
<p>フォントデータベースの自動更新は、管理者が
<code class="filename">PKG_UPDATE_FONTS_DB</code> 環境変数を <code class="literal">NO</code>
に設定すれば、無効化することができます。</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter 16. オプションの扱い">
<div class="titlepage"><div><div><h2 class="title">
<a name="options"></a>Chapter 16. オプションの扱い</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#global-default-options">16.1. 標準の大域的なオプション</a></span></dt>
<dt><span class="sect1"><a href="#converting-to-options">16.2. パッケージを変換して <code class="filename">bsd.options.mk</code> を使うようにする</a></span></dt>
<dt><span class="sect1"><a href="#option-names">16.3. オプション名</a></span></dt>
<dt><span class="sect1"><a href="#option-build">16.4. 依存パッケージのオプションを判別する</a></span></dt>
</dl>
</div>
<p>多くのパッケージは、対応する機能の組合せを変えて構築することができます。
<code class="filename">bsd.options.mk</code> は pkgsrc における枠組のひとつで、
このようなオプションに応じて異なるパッケージ構築方法の判断を、
汎用的に処理するものです。この枠組のなかで、利用者は、
どのようなオプションの組合せを組み込んでパッケージを構築するかを厳密に指定したり、
大域的な標準状態のオプションの組合せを適用したりすることができます。</p>
<p>パッケージの振舞を、オプションの枠組を使って制御したい状況は、
大きく分けて二つあります。
ひとつは、プログラム自体の構築は常におこなうものの、
そのなかのある機能を有効にするかしないかです
(他のパッケージに依存させるかさせないかによって制御することがよくあります)。
もうひとつは、別のプログラムを、
そのパッケージの一部として追加するかしないかです。
後者は、一般的には、オプションの枠組を使わずに、
パッケージを分割したほうがいいでしょう。
パッケージを分割すれば、
バイナリーパッケージを別々に追加できるようになるからです。
たとえば、foo パッケージには最小限の
(それがないと foo パッケージに何の意味もなくなるような) 依存性を持たせておいたうえで、
別の foo-gfoo パッケージに GTK のフロントエンドプログラム gfoo を入れておくのです。
この方法は、foo パッケージに gfoo を追加する gtk オプションを用意する方法より、
すぐれています。なぜなら、オプションの枠組を使ってしまうと、
このオプションが標準で有効な場合は、
バイナリーパッケージの利用者は gfoo 抜き版の foo を使えず、
また、標準で有効ではない場合は、
バイナリーパッケージの利用者は gfoo を使えないからです。
パッケージを分割すれば、バイナリーパッケージの利用者は、
GTK 抜き版の goo をインストールすることも、
後から gfoo をインストールする (GTK はそのときになってから取り寄せる) こともできます。
また、ソースの利用者にとっても、
foo パッケージの再構築の必要がなくなるという利点があります。</p>
<p>依存性が大きく変化するようなプラグインは、通常は、
オプションではなく分割したほうがよいでしょう。</p>
<p>パッケージを分割すると、保守の手間が増えることがよくあります。
そのパッケージの本家が分割に対応していない場合は特にそうです。
分割するかオプションにするかは、
たくさんのパッケージの細切れや、依存パッケージの大きさや、作業量に対して、
利用者がどう思うであろうか、という見地に立って判断するようにします。</p>
<p>さらに考慮が必要なことは、ライセンスです。フリーではない部品や、
フリーでないもの (特にプラグイン) に依存する部品は、
分割可能な限り分割するのがよいでしょう。</p>
<div class="sect1" title="16.1. 標準の大域的なオプション">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="global-default-options"></a>16.1. 標準の大域的なオプション</h2></div></div></div>
<p>標準の大域的なオプションは、
<code class="varname">PKG_DEFAULT_OPTIONS</code> に列挙します。この値は、
そのオプションに対応しているパッケージすべてに組み込むオプションを並べたものです。
この変数は <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で設定するようにします。</p>
</div>
<div class="sect1" title="16.2. パッケージを変換して bsd.options.mk を使うようにする">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="converting-to-options"></a>16.2. パッケージを変換して <code class="filename">bsd.options.mk</code> を使うようにする</h2></div></div></div>
<p>以下に掲げるのは、<code class="filename">bsd.options.mk</code>
を架空の ``wibble'' パッケージでどのように使うかを示したものです。
パッケージの <code class="filename">Makefile</code> に直接書くか、
別のファイル <code class="filename">options.mk</code> に書いて
<code class="filename">Makefile</code> からインクルードするか、
どちらかの方法をとります。</p>
<pre class="programlisting">
PKG_OPTIONS_VAR=                PKG_OPTIONS.wibble
PKG_SUPPORTED_OPTIONS=          wibble-foo ldap
PKG_OPTIONS_OPTIONAL_GROUPS=    database
PKG_OPTIONS_GROUP.database=     mysql pgsql
PKG_SUGGESTED_OPTIONS=          wibble-foo
PKG_OPTIONS_LEGACY_VARS+=       WIBBLE_USE_OPENLDAP:ldap
PKG_OPTIONS_LEGACY_OPTS+=       foo:wibble-foo

.include "../../mk/bsd.prefs.mk"

# this package was previously named wibble2
.if defined(PKG_OPTIONS.wibble2)
PKG_LEGACY_OPTIONS+=            ${PKG_OPTIONS.wibble2}
PKG_OPTIONS_DEPRECATED_WARNINGS+= \
        "Deprecated variable PKG_OPTIONS.wibble2 used, use ${PKG_OPTIONS_VAR} instead."
.endif

.include "../../mk/bsd.options.mk"

# Package-specific option-handling

###
### FOO support
###
.if !empty(PKG_OPTIONS:Mwibble-foo)
CONFIGURE_ARGS+=    --enable-foo
.endif

###
### LDAP support
###
.if !empty(PKG_OPTIONS:Mldap)
.  include "../../databases/openldap-client/buildlink3.mk"
CONFIGURE_ARGS+=    --enable-ldap=${BUILDLINK_PREFIX.openldap-client}
.endif

###
### database support
###
.if !empty(PKG_OPTIONS:Mmysql)
.  include "../../mk/mysql.buildlink3.mk"
.endif
.if !empty(PKG_OPTIONS:Mpgsql)
.  include "../../mk/pgsql.buildlink3.mk"
.endif
</pre>
<p>最初の節には、
このパッケージがどの構築オプションに対応しているかに関する情報があり、
標準状態を設定する必要があるオプションについてはその設定をしています。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p><code class="varname">PKG_OPTIONS_VAR</code> は、
<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> 変数の名前で、
利用者はその名前の変数を設定して標準のオプションを上書きすることができます。
この変数名は PKG_OPTIONS.<em class="replaceable"><code>pkgbase</code></em> のように設定します。
オプションの処理をする段階では
<code class="varname">PKGBASE</code> は定義されていないので、
PKG_OPTIONS.${PKGBASE} と定義してはいけません。</p></li>
<li class="listitem"><p><code class="varname">PKG_SUPPORTED_OPTIONS</code>
は、このパッケージが対応している構築オプションを並べたリストです。</p></li>
<li class="listitem"><p><code class="varname">PKG_OPTIONS_OPTIONAL_GROUPS</code> は、
互いに排他的なオプションからなるグループの名前を並べたリストです。
各グループに含まれるオプションは、
<code class="varname">PKG_OPTIONS_GROUP.<em class="replaceable"><code>groupname</code></em></code> に列挙します。
ここでは、各グループのオプションのうちもっとも特徴的な設定を先頭に書きます。
各グループに含まれるオプションは、自動的に
<code class="varname">PKG_SUPPORTED_OPTIONS</code> に追加されます。</p></li>
<li class="listitem"><p><code class="varname">PKG_OPTIONS_REQUIRED_GROUPS</code> は、
<code class="varname">PKG_OPTIONS_OPTIONAL_GROUPS</code> に似ていますが、
グループに含まれるオプションをどれも選ばなかった場合には、
パッケージの構築に失敗する点が異なります。</p></li>
<li class="listitem"><p><code class="varname">PKG_OPTIONS_NONEMPTY_SETS</code> は、
オプションの集合の名前を並べたリストです。
各集合からは、少なくともひとつのオプションを設定する必要があります。
各集合に含まれるオプションは、
<code class="varname">PKG_OPTIONS_SET.<em class="replaceable"><code>setname</code></em></code> に列挙します。
各集合に含まれるオプションは、自動的に
<code class="varname">PKG_SUPPORTED_OPTIONS</code> に追加されます。
集合に含まれるオプションをひとつも設定しなかった場合、パッケージの構築に失敗します。</p></li>
<li class="listitem"><p><code class="varname">PKG_SUGGESTED_OPTIONS</code> は、
標準状態で有効となる構築オプションを並べたリストです。</p></li>
<li class="listitem"><p><code class="varname">PKG_OPTIONS_LEGACY_VARS</code> は、
旧式の <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> 変数を同等のオプションに対応づけた
<span class="quote">“<span class="quote"><em class="replaceable"><code>USE_VARIABLE</code></em>:<em class="replaceable"><code>option</code></em></span>”</span>
という組合せを並べたリストです。
この組合せは、旧式の変数の大域的なリストを残すために、
<span class="quote">“<span class="quote">+=</span>”</span> を使って追加するようにします。
利用者が旧式の変数を使った場合には、警告が出ます。</p></li>
<li class="listitem"><p><code class="varname">PKG_OPTIONS_LEGACY_OPTS</code> は、
名前が変更されたオプションを新しいものに対応づけた
<span class="quote">“<span class="quote"><em class="replaceable"><code>old-option</code></em>:<em class="replaceable"><code>new-option</code></em></span>”</span>
という組合せを並べたリストです。
この組合せは、旧名のオプションの大域的なリストを残すために、
<span class="quote">“<span class="quote">+=</span>”</span> を使って追加するようにします。
利用者が旧名のオプションを使った場合には、警告が出ます。</p></li>
<li class="listitem"><p><code class="varname">PKG_LEGACY_OPTIONS</code> は、
廃止された変数用のオプションを並べたリストです。
これは、<code class="varname">PKG_OPTIONS_LEGACY_VARS</code> と
<code class="varname">PKG_OPTIONS_LEGACY_OPTS</code> のどちらでも対処できない場合、
たとえば <code class="varname">PKG_OPTIONS_VAR</code> の名前が変更された場合などに使うものです。</p></li>
<li class="listitem"><p><code class="varname">PKG_OPTIONS_DEPRECATED_WARNINGS</code> は、
廃止された変数やオプションが使われたことと、その代替として何を使うかについての、
警告を並べたリストです。</p></li>
</ol></div>
<p>パッケージ側では <code class="varname">PKG_DEFAULT_OPTIONS</code> や、
<code class="varname">PKG_OPTIONS_VAR</code> による変数名を変えてはいけません。
これらはもっぱら利用者が設定するためのものです。
オプションの標準設定を提案する場合は
<code class="varname">PKG_SUGGESTED_OPTIONS</code> を使います。</p>
<p><code class="varname">PKG_OPTIONS_VAR</code> は、
<code class="filename">bsd.options.mk</code> をインクルードする前に定義する必要があります。
<code class="varname">PKG_SUPPORTED_OPTIONS</code>,
<code class="varname">PKG_OPTIONS_OPTIONAL_GROUPS</code>,
<code class="varname">PKG_OPTIONS_REQUIRED_GROUPS</code> のいずれも定義されていない場合は
(実行対象のプラットフォームが、
プラットフォーム固有のオプションのどれにも対応していない場合に、
これらの影響を受ける可能性があるため)、 <code class="varname">PKG_OPTIONS</code> は空のリストに設定され、
パッケージがオプションの枠組を使わないように保護されます。</p>
<p><code class="filename">bsd.options.mk</code> がインクルードされた後、
変数 <code class="varname">PKG_OPTIONS</code> は、
選択された構築オプションを並べたリスト
(非対応あるいは廃止されたオプションは適切に除去されています)
を値として持っています。</p>
<p>残りの節では、各オプション固有の処理をしています。
あるオプションが <code class="varname">PKG_OPTIONS</code> のリストに含まれているかどうかの確認は、
以下のようにするのが正しい方法です。</p>
<pre class="programlisting">
.if !empty(PKG_OPTIONS:M<em class="replaceable"><code>option</code></em>)
</pre>
</div>
<div class="sect1" title="16.3. オプション名">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="option-names"></a>16.3. オプション名</h2></div></div></div>
<p>異なるパッケージに類似の機能を追加するオプション
(あるライブラリーにオプションで対応するなど) は、
その機能に対応した全パッケージの間で共通の名前 (そのライブラリーの名前など) を使うべきです。
同じ意味のオプションをもつパッケージがすでに存在する場合は、
それと同じ名前を使ってください。</p>
<p>ひとつのパッケージに固有の機能を追加するオプションで、
他の (無関連の) パッケージが同じ (または類似の) オプション機能をもちそうにない場合は、
冒頭に <code class="varname"><em class="replaceable"><code>pkgname</code></em>-</code>
をつけたオプション名を使うようにします。</p>
<p>一群の関連パッケージの間で、
それらに固有のオプション機能を共有している場合は、
<span class="quote">“<span class="quote">主たる</span>”</span>パッケージ名を冒頭につけた形にします
(たとえば <code class="varname">djbware-errno-hack</code>)。</p>
<p>新しいオプションを追加する場合は、
<code class="filename">mk/defaults/options.description</code> にそのオプションの行を追加します。
行は、タブで区切られた二つのフィールドからなります。
最初のフィールドはオプション名、
二つ目はその説明です。この説明は、完全な文章 (大文字ではじまり、ピリオドで終わる)
で、このオプションで何ができるかを説明します。たとえば、<span class="quote">“<span class="quote">Enable ispell
support.</span>”</span> とします。このファイルはオプション名でソートします。</p>
</div>
<div class="sect1" title="16.4. 依存パッケージのオプションを判別する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="option-build"></a>16.4. 依存パッケージのオプションを判別する</h2></div></div></div>
<p><a class="link" href="#buildlink3.mk"><code class="filename">buildlink3.mk</code></a> ファイルを書くときには、
依存パッケージがどのようなオプションで構築されたかによって場合分けして、
異なる依存性を列挙する必要がある場合がよくあります。
このようなオプションの問い合わせには、
<code class="filename">pkgsrc/mk/pkg-build-options.mk</code> ファイルを使うようにします。
通常は、以下のように使います。</p>
<pre class="programlisting">
pkgbase := libpurple
.include "../../mk/pkg-build-options.mk"

.if !empty(PKG_BUILD_OPTIONS.libpurple:Mdbus)
...
.endif
</pre>
<p><code class="filename">pkg-build-options.mk</code> をインクルードしたところで、
<code class="varname">PKG_BUILD_OPTIONS.libpurple</code> 変数に、
libpurple パッケージの構築オプションが設定されます。これにより、
<code class="filename">options.mk</code> における <code class="varname">PKG_OPTIONS</code>
と同様に、オプションを問い合わせることができます。
詳細は、<code class="filename">pkg-build-options.mk</code>
ファイルをご覧ください。
</p>
</div>
</div>
<div class="chapter" title="Chapter 17. 構築の手順">
<div class="titlepage"><div><div><h2 class="title">
<a name="build"></a>Chapter 17. 構築の手順</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#build.intro">17.1. 序</a></span></dt>
<dt><span class="sect1"><a href="#build.prefix">17.2. プログラムの場所</a></span></dt>
<dt><span class="sect1"><a href="#build.builddirs">17.3. 構築の過程で使われるディレクトリー</a></span></dt>
<dt><span class="sect1"><a href="#build.running">17.4. 相の実行</a></span></dt>
<dt><span class="sect1"><a href="#build.fetch">17.5. <span class="emphasis"><em>fetch</em></span> 相</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#build.fetch.what">17.5.1. 何を、どこから取得するか</a></span></dt>
<dt><span class="sect2"><a href="#build.fetch.how">17.5.2. ファイルの取得はどのようにおこなわれるか?</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#build.checksum">17.6. <span class="emphasis"><em>checksum</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.extract">17.7. <span class="emphasis"><em>extract</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.patch">17.8. <span class="emphasis"><em>patch</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.tools">17.9. <span class="emphasis"><em>tools</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.wrapper">17.10. <span class="emphasis"><em>wrapper</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.configure">17.11. <span class="emphasis"><em>configure</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.build">17.12. <span class="emphasis"><em>build</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.test">17.13. <span class="emphasis"><em>test</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.install">17.14. <span class="emphasis"><em>install</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.package">17.15. <span class="emphasis"><em>package</em></span> 相</a></span></dt>
<dt><span class="sect1"><a href="#build.clean">17.16. 掃除をする</a></span></dt>
<dt><span class="sect1"><a href="#build.helpful-targets">17.17. 他の役に立つターゲット</a></span></dt>
</dl>
</div>
<div class="sect1" title="17.1. 序">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.intro"></a>17.1. 序</h2></div></div></div>
<p>本章では、パッケージがどのように構築されるかについて、詳しく説明します。
    パッケージの構築は、複数の<span class="emphasis"><em>相 (phase)</em></span> (たとえば、<code class="varname">fetch</code>,
    <code class="varname">build</code>, <code class="varname">install</code>) にわかれており、
    そのすべてを以下の各節で説明します。それぞれの段階は、<code class="varname">pre-</code>,
    <code class="varname">do-</code>, <code class="varname">post-</code>
    のいずれかが相名の前についた、いわゆる<span class="emphasis"><em>期 (stage)</em></span>
    にわかれます。(たとえば、
    <code class="varname">pre-configure</code>, <code class="varname">post-build</code> などです。)
    実際に何かがおこなわれるのは、ほとんどが <code class="varname">do-*</code> 期においてです。</p>
<p>標準的なターゲット (<code class="varname">fetch</code>
    など) は、決して上書きしないでください。変更する必要がある場合は、
    対応する <code class="varname">do-*</code> ターゲットを上書きしてください。</p>
<p>プログラムを構築するための基本的な手順は常に同じです。最初に、プログラムの
    ソースファイル(<span class="emphasis"><em>distfile</em></span>)をローカルシステムへ持ってきて展開します。
    コンパイルするための pkgsrc 独自のパッチを適用した後に、ソフトウェアを設定
    し、構築(通常、コンパイルすることによって)します。最後に作成されたバイナリー
    等を、システムにインストールします。</p>
<p>それぞれの段階で何が起きているかを、もっと詳しく把握するために、
    <code class="varname">PKG_VERBOSE</code> 変数を設定することができます。
    または、<span class="emphasis"><em>patch</em></span> の段階における詳細に関心があるだけなら、
    <code class="varname">PATCH_DEBUG</code> 変数を設定することもできます。</p>
</div>
<div class="sect1" title="17.2. プログラムの場所">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.prefix"></a>17.2. プログラムの場所</h2></div></div></div>
<p>次のセクションでNetBSDパッケージシステムによって実行される手順の概略を述
    べる前に、プログラムがインストールされる場所、その場所に影響をおよぼす変数
    について簡単に記述します。</p>
<p>自動変数<code class="varname">PREFIX</code>は、最終的にプログラムのすべてのファイルがインストールされる
    場所をしめします。通常、<code class="varname">LOCALBASE</code> (<code class="filename">/usr/pkg</code>)、または<code class="filename">cross</code>カテゴリーの
    パッケージのための<code class="varname">CROSSBASE</code>と同じ場所になっています。
    <code class="varname">PREFIX</code>の値は、プログラムのソース中でこれらのファイルが符号化されるさまざ
    まな場所に使用されるべきです。
    詳細に関しては、<a class="xref" href="#components.patches" title="11.3. patches/*">Section 11.3, “patches/*”</a>および<a class="xref" href="#fixes.libtool" title="19.3.1. 共有ライブラリー - libtool">Section 19.3.1, “共有ライブラリー - libtool”</a>を参照して下さい。</p>
<p>これらの変数のどれかを選択し使用する場合には、
    以下のルールに従ってください。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PREFIX</code>は常に現在のパッケージがインストールされる場所を指します。パッ
	ケージ自身のインストール先のパスを参照する時に、<span class="quote">“<span class="quote">${PREFIX}</span>”</span>を使用してくだ
	さい。</p></li>
<li class="listitem"><p><code class="varname">LOCALBASE</code>は、すべての非X11パッケージがインストールされる場所です。他
	の非X11パッケージによってインストールされたインクルードファイルやライブ
	ラリーの場所をさがすためのコンパイラーの-Iや-Lオプションを指定する場合に、
	<span class="quote">“<span class="quote">${LOCALBASE}</span>”</span>を使用してください。
	<code class="varname">LOCALBASE</code> という変数名は、FreeBSD でパッケージをすべて
	<code class="filename">/usr/local</code> にインストールしていたことに由来します。
	pkgsrc では <code class="filename">/usr/local</code> をシステム管理者のために使わないようにしているので、
	この変数名は間違った名前です。</p></li>
<li class="listitem"><p><code class="varname">X11BASE</code>は、実際に(xsrcなどに由来する)X11ディストリビューションがイン
	ストールされる場所です。
	<span class="emphasis"><em>通常の</em></span>X11のインクルードファイル(パッケージとして
	インストールされていない)をさがす場合、<span class="quote">“<span class="quote">${X11BASE}</span>”</span>を使用してください。</p></li>
<li class="listitem">
<p>X11 ベースのパッケージは特別です。インストールされる場所は、
	<code class="varname">X11BASE</code> と <code class="varname">LOCALBASE</code> のどちらに依存することもありえます。</p>
<p>通常、X11 のパッケージは、できるかぎり <code class="varname">LOCALBASE</code>
	にインストールするものです。X11 のパッケージでは、X11 が必要なことを要求し、
	適切な編集フラグを持つようにするために、
	<code class="filename">../../mk/x11.buildlink3.mk</code>
	をインクルードする必要があります。</p>
<p>しかし、<code class="varname">LOCALBASE</code> 以下にはインストールできないパッケージもあります。
	app-defaults ファイルが附属するようなパッケージが該当します。
	このようなパッケージは例外であり、<code class="varname">X11BASE</code>
	以下にインストールする必要があります。そうするためには、
	パッケージ側で <code class="varname">USE_X11BASE</code> または <code class="varname">USE_IMAKE</code>
	のいずれかを設定します。</p>
<p>註:
	<code class="filename">Makefile</code> で <code class="varname">USE_IMAKE</code> や <code class="varname">USE_X11BASE</code>
	を定義したパッケージによってインストールされたインクルードファイルやライブラリーをさがす場合、
	<code class="filename">${X11BASE}</code> と
	<code class="filename">${LOCALBASE}</code> を<span class="emphasis"><em>両方</em></span>調べる必要があります。
	X11 パッケージをすべて強制的に <code class="varname">LOCALBASE</code> にインストールさせるために、
	<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/xpkgwedge/README.html" target="_top"><code class="filename">pkgtools/xpkgwedge</code></a> パッケージが標準で有効になっています。</p>
</li>
<li class="listitem"><p>X11パッケージのインストール場所を参照する用途には、<code class="varname">X11PREFIX</code>を使って
	ください。<code class="varname">X11PREFIX</code>は、xpkgwedgeがインストールされていない場合は
	<code class="varname">X11BASE</code>となり、xpkgwedgeがインストールされている場合は<code class="varname">LOCALBASE</code>と
	なります。</p></li>
<li class="listitem">
<p>xpkgwedgeがインストールされている場合、パッケージによってインストール先
	が<code class="varname">X11BASE</code>になっていたり<code class="varname">LOCALBASE</code>になっていたりすることがあります。インス
	トールされているパッケージのprefixを決めるために、<code class="varname">EVAL_PREFIX</code>定義を使う
	ことができます。この定義に<span class="quote">“<span class="quote">DIRNAME=&lt;package&gt;</span>”</span>の形式の組を書くと、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a>変
	数<code class="varname">DIRNAME</code>が、インストールされているパッケージ &lt;package&gt;のprefixに設定され
	ます。そのパッケージがインストールされていない場合は<span class="quote">“<span class="quote">${X11PREFIX}</span>”</span>に設定さ
	れます。</p>
<p>例を使って説明するのが一番いいでしょう。</p>
<p>以下は、
	<code class="filename">pkgsrc/wm/scwm/Makefile</code>からの抜粋です。</p>
<pre class="programlisting">
EVAL_PREFIX+=           GTKDIR=gtk+
CONFIGURE_ARGS+=        --with-guile-prefix=${LOCALBASE:Q}
CONFIGURE_ARGS+=        --with-gtk-prefix=${GTKDIR:Q}
CONFIGURE_ARGS+=        --enable-multibyte
</pre>
<p><code class="varname">EVAL_PREFIX</code>を使って評価するパッケージに対して、以下のような定義を使って
	デフォルトを定義することができます。</p>
<pre class="programlisting">
GTKDIR_DEFAULT= ${LOCALBASE}
</pre>
<p>ここで<code class="varname">GTKDIR</code>は、
	<code class="varname">EVAL_PREFIX</code>
	での最初の定義の組に対応します。</p>
</li>
<li class="listitem"><p>パッケージは <code class="filename">${PREFIX}</code> 以下に、
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?hier+7+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">hier</span>(7)</span></a> に準じてファイルをインストールするようにします。
	ただしマニュアルページは例外で、<code class="filename">${PREFIX}/share/man</code>
	ではなく <code class="filename">${PREFIX}/man</code> にインストールします。</p></li>
</ul></div>
</div>
<div class="sect1" title="17.3. 構築の過程で使われるディレクトリー">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.builddirs"></a>17.3. 構築の過程で使われるディレクトリー</h2></div></div></div>
<p>パッケージの構築時には、ソースファイル、一時ファイル、
    pkgsrc 内部ファイルなどを置いておくために、さまざまなディレクトリーが使われます。
    そのようなディレクトリーについて説明します。</p>
<p>ディレクトリーを指す変数のなかには、相対パス名を値に持つものがあります。
    このような相対パス名の基点となるディレクトリーは、おもに二つあります。
    一つは <code class="varname">PKGSRCDIR/PKGPATH</code> で、pkgsrc 特有のディレクトリー用です。
    もう一つは  <code class="varname">WRKSRC</code> で、パッケージそのものの内部にあるディレクトリー用です。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">PKGSRCDIR</code></span></dt>
<dd><p>絶対パス名で、
      pkgsrc のルートディレクトリーを指します。
      通常は、この変数を使う必要はありません。</p></dd>
<dt><span class="term"><code class="varname">PKGDIR</code></span></dt>
<dd><p>当該パッケージを指す
      絶対パス名です。</p></dd>
<dt><span class="term"><code class="varname">PKGPATH</code></span></dt>
<dd><p><code class="varname">PKGSRCDIR</code>
      を基点とした相対パス名で、
      当該パッケージを指します。</p></dd>
<dt><span class="term"><code class="varname">WRKDIR</code></span></dt>
<dd><p>絶対パス名で、全作業がおこなわれるディレクトリーを指します。
      distfile はこのディレクトリーに展開されます。
      一般的に、このディレクトリーには、
      <span class="emphasis"><em>buildlink</em></span> や
      <span class="emphasis"><em>wrappers</em></span> など、
      pkgsrc の各種基盤が使う一時ディレクトリーも含まれます。</p></dd>
<dt><span class="term"><code class="varname">WRKSRC</code></span></dt>
<dd><p>絶対パス名で、distfile が展開されるディレクトリーを指します。
      普通は、<code class="varname">WRKDIR</code> 直下のサブディレクトリーであり、
      多くの場合は、このディレクトリーにおける、
      唯一の隠されていないディレクトリーエントリーです。この変数は、パッケージの
      <code class="filename">Makefile</code> で変更することができます。</p></dd>
</dl></div>
<p><code class="varname">CREATE_WRKDIR_SYMLINK</code> 定義は、
    <span class="emphasis"><em>yes</em></span> または <span class="emphasis"><em>no</em></span> のいずれかの値をとり、
    標準状態では <span class="emphasis"><em>no</em></span> になります。これは、
    pkgsrc の個々のパッケージのディレクトリー内に、
    <code class="varname">WRKDIR</code> へのシンボリックリンクを作成するか否かを示します。
    pkgsrc ツリーを読み取り専用として使いたい場合は、
    <code class="varname">CREATE_WRKDIR_SYMLINK</code> の値を
    <span class="emphasis"><em>no</em></span> にしてください。</p>
</div>
<div class="sect1" title="17.4. 相の実行">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.running"></a>17.4. 相の実行</h2></div></div></div>
<p><span class="command"><strong>make phase</strong></span> (<span class="emphasis"><em>phase</em></span> は相の名前) と打てば、
    その相を実行することができます。
    こうすると、その相のために必要な相をすべて自動的に実行します。
    相を指定しない場合は <code class="varname">build</code> 相になります。つまり、
    あるパッケージのディレクトリーで、引数なしで <span class="command"><strong>make</strong></span>
    を実行すると、パッケージが構築されますが、インストールはされません。</p>
</div>
<div class="sect1" title="17.5. fetch 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.fetch"></a>17.5. <span class="emphasis"><em>fetch</em></span> 相</h2></div></div></div>
<p>パッケージの構築の最初の段階は、配布ファイル (distfiles)
    を、そのファイルを配布しているサイトから取得することです。
    これは <span class="emphasis"><em>fetch</em></span> 相がおこなう仕事です。</p>
<div class="sect2" title="17.5.1. 何を、どこから取得するか">
<div class="titlepage"><div><div><h3 class="title">
<a name="build.fetch.what"></a>17.5.1. 何を、どこから取得するか</h3></div></div></div>
<p>単純な場合では、<code class="varname">MASTER_SITES</code> で
      distfile (distfile のファイル名は <code class="varname">DISTNAME</code> が使われます)
      を取得する URL をすべて定義します。
      これより複雑な場合については、以下で説明します。</p>
<p>変数 <code class="varname">DISTFILES</code> は、取得する必要のある
      distfile を並べたリストを指定します。この値は、標準では
      <code class="literal">${DISTNAME}${EXTRACT_SUFX}</code> になり、
      ほとんどのパッケージではあえて定義する必要がありません。
      <code class="varname">EXTRACT_SUFX</code> は、標準では <code class="literal">.tar.gz</code>
      になりますが、自由に変更することができます。なお、標準で定義される
      distfile に加えて別の distfile が必要な場合は、
      それを <code class="literal">+=</code> 演算子を使って追加することはできません。
      たとえば以下のように書く必要があります。</p>
<pre class="programlisting">
DISTFILES=      ${DISTNAME}${EXTRACT_SUFX} additional-files.tar.gz
</pre>
<p>各 distfile は、通常は <code class="varname">MASTER_SITES</code>
      に並べられたサイトから取得されます。パッケージに複数の
      <code class="varname">DISTFILES</code> または複数の
      <code class="varname">PATCHFILES</code> があり、それらが異なるサイトで配布されている場合は、
      <code class="filename"><em class="replaceable"><code>distfile</code></em></code>
      ファイル (サフィックスを含む) の配布場所の URL を並べたリストを
      <code class="varname">SITES.<em class="replaceable"><code>distfile</code></em></code>
      に設定することができます。</p>
<pre class="programlisting">
DISTFILES=      ${DISTNAME}${EXTRACT_SUFX}
DISTFILES+=     foo-file.tar.gz
SITES.foo-file.tar.gz= \
http://www.somewhere.com/somehow/ \
http://www.somewhereelse.com/mirror/somehow/
</pre>
<p>distfile を実際に取得する際、それらは、
      <code class="varname">MASTER_SITES</code> または
      <code class="varname">SITES.*</code>
      に各 distfile のファイル名をそのまま (間にスラッシュを入れずに)
      つなげた形の URL から取得されます。このため、サイトを定義する変数の値は、
      スラッシュその他の分離記号で終わる必要があります。このため、たとえば
      <code class="varname">MASTER_SITES</code> を、distfile 名を引数としてとる
      CGI スクリプトの URL にすることができます。そうした場合、
      以下のような形で定義することになります。</p>
<pre class="programlisting">
MASTER_SITES=   http://www.example.com/download.cgi?file=
</pre>
<p> 例外は、URL の前にダッシュ (-) がついている場合です。
      この場合、その URL を (distfile とつなげずに) そのまま使って distfile を取得し、
      取得したファイルを distfile の名前で保存します。</p>
<p>パッケージで使うため、<code class="varname">MASTER_SITES</code>
      用にあらかじめ定義された値がいくつか用意されています。
      各変数の意味は、名前から明らかでしょう。</p>
<pre class="programlisting">
${MASTER_SITE_APACHE}
${MASTER_SITE_BACKUP}
${MASTER_SITE_CYGWIN}
${MASTER_SITE_DEBIAN}
${MASTER_SITE_FREEBSD}
${MASTER_SITE_FREEBSD_LOCAL}
${MASTER_SITE_GENTOO}
${MASTER_SITE_GNOME}
${MASTER_SITE_GNU}
${MASTER_SITE_GNUSTEP}
${MASTER_SITE_IFARCHIVE}
${MASTER_SITE_KDE}
${MASTER_SITE_MOZILLA}
${MASTER_SITE_MYSQL}
${MASTER_SITE_OPENOFFICE}
${MASTER_SITE_PERL_CPAN}
${MASTER_SITE_PGSQL}
${MASTER_SITE_R_CRAN}
${MASTER_SITE_SOURCEFORGE}
${MASTER_SITE_SOURCEFORGE_JP}
${MASTER_SITE_SUNSITE}
${MASTER_SITE_SUSE}
${MASTER_SITE_TEX_CTAN}
${MASTER_SITE_XCONTRIB}
${MASTER_SITE_XEMACS}
</pre>
<p>名前から意味がわかりにくいものについて、説明しておきます。
      <code class="varname">MASTER_SITE_BACKUP</code> には、<a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/%24%7BDIST_SUBDIR%7D" target="_top">ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/${DIST_SUBDIR}</a> で保守されている、パッケージのバックアップサイトが含まれます。
      <code class="varname">MASTER_SITE_LOCAL</code> には、<a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/LOCAL_PORTS/" target="_top">ftp://ftp.NetBSD.org/pub/pkgsrc/distfiles/LOCAL_PORTS/</a> で保守されている、パッケージのローカルなソース配布物が含まれます。</p>
<p>もしこれらの予め定義されたサイトの1つを選んだ場合、そのサイトのサブディレク
      トリーを指定することが必要となるかもしれません。これらのマクロは複数の実際
      のサイトに展開されるかもしれませんので、サブディレクトリーを指定する場合は、
      以下の表記を<span class="emphasis"><em>使わなければなりません</em></span>:</p>
<pre class="programlisting">
MASTER_SITES=   ${MASTER_SITE_GNU:=subdirectory/name/}
MASTER_SITES=   ${MASTER_SITE_SOURCEFORGE:=project_name/}
</pre>
<p>サブディレクトリー名の後のスラッシュ/に注意してください。</p>
</div>
<div class="sect2" title="17.5.2. ファイルの取得はどのようにおこなわれるか?">
<div class="titlepage"><div><div><h3 class="title">
<a name="build.fetch.how"></a>17.5.2. ファイルの取得はどのようにおこなわれるか?</h3></div></div></div>
<p><span class="emphasis"><em>fetch</em></span> 相では、distfile
      がすべてローカルディレクトリー (<code class="varname">DISTDIR</code>,
      pkgsrc 利用者が設定可能) に存在する状態にします。
      distfile は以下の形式のコマンドを使って取得されます。</p>
<pre class="programlisting">
${FETCH_CMD} ${FETCH_BEFORE_ARGS} ${site}${file} ${FETCH_AFTER_ARGS}
</pre>
<p>この <code class="literal">${site}</code> には、複数の候補が決まった順序で使われます: 最初に
      <code class="varname">MASTER_SITE_OVERRIDE</code>を試み、次に、<code class="varname">SITES.file</code>が定義されていればそれ
      を、定義されていなければ、<code class="varname">MASTER_SITES</code>か<code class="varname">PATCH_SITES</code>のどちらかを試
      みます。そして、最後に<code class="varname">MASTER_SITE_BACKUP</code>の値を試みます。
      これらのうち最初のものと最後のもの以外の順序は、
      <code class="varname">MASTER_SORT_RANDOM</code> を設定し、かつ
      <code class="varname">MASTER_SORT_AWK</code>か
      <code class="varname">MASTER_SORT_REGEX</code>を設定して、ユーザー
      が入れ換えることができます。</p>
<p> この取得用のコマンドと引数は、
      <code class="varname">FETCH_USING</code> 変数に応じたものが使われます。
      上述の例は、<code class="literal">FETCH_USING=custom</code> とした場合のものです。</p>
<p>the NetBSD Foundation が運営している distfile
      のミラーサイトでは、自由に配布可能な distfile
      をミラーするために <span class="emphasis"><em>mirror-distfiles</em></span>
      ターゲットを使っています。<code class="varname">NO_SRC_ON_FTP</code>
      を (たいていは <span class="quote">“<span class="quote">${RESTRICTED}</span>”</span> に)
      設定しているパッケージの distfile はミラーされません。</p>
</div>
</div>
<div class="sect1" title="17.6. checksum 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.checksum"></a>17.6. <span class="emphasis"><em>checksum</em></span> 相</h2></div></div></div>
<p>distfileを取得した後に、チェックサムを生成し、distinfoファイルに保存され
    たチェックサムと比較します。もし、チェックサムが一致しなければ、構築は中
    断されます。これはパッケージ作成時と同じdistfileが、構築に使用されている
    こと、つまり、悪意や一次配布サイトでの意図的な差し替えやネットワークの損
    失によってdistfileが変更されていないことを保証するためです。</p>
</div>
<div class="sect1" title="17.7. extract 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.extract"></a>17.7. <span class="emphasis"><em>extract</em></span> 相</h2></div></div></div>
<p>distfileがローカルシステム上に存在している場合、
    通常、それらは圧縮アーカイブフォーマットで保存されているので、
    展開する必要があります。</p>
<p>標準では、<code class="varname">DISTFILES</code> はすべて展開されます。
    一部だけを展開する必要がある場合は、
    <code class="varname">EXTRACT_ONLY</code> 変数を、
    展開する必要のあるファイルを並べたリストに設定することができます。</p>
<p>通常、ファイルの展開は <code class="filename">mk/extract/extract</code>
    という小さなプログラムを使っておこなわれます。このプログラムは、
    各種アーカイブ形式の展開方法を知っているので、
    何も変更する必要はないでしょう。それでも変更が必要な場合は、
    以下の変数を使うとよいでしょう。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">EXTRACT_OPTS_{BIN,LHA,PAX,RAR,TAR,ZIP,ZOO}</code></span></dt>
<dd><p>この各変数を使って、展開用のコマンドのオプションを、
      標準のもの (<code class="filename">mk/extract/extract</code>
      で定義されています) から上書きします。</p></dd>
<dt><span class="term"><code class="varname">EXTRACT_USING</code></span></dt>
<dd><p>この変数は、tar アーカイブ展開用のコマンドを設定するもので、
      <code class="literal">bsdtar</code>, <code class="literal">gtar</code>, <code class="literal">nbtar</code>
      (標準状態での値), <code class="literal">pax</code> または、
      コマンドの絶対パス名に設定することができます。
      NetBSD の (tar として使われる) pax でうまく展開できない場合は、
      なるべく gtar より bsdtar を選ぶようにします。</p></dd>
</dl></div>
<p>必要なことが <code class="filename">extract</code>
    プログラムではできない場合は、ファイル展開用のコマンドを保持する
    <code class="varname">EXTRACT_CMD</code> 変数を上書きすることもできます。
    この変数で指定された展開用コマンドは、
    <code class="filename">${WRKSRC}</code> ディレクトリー内で実行されます。
    このコマンドの実行中は、シェル変数 <code class="varname">extract_file</code>
    に、展開中のアーカイブファイルの絶対パス名が保持されます。</p>
<p>これでもなお不十分な場合は、パッケージの Makefile で、
    <code class="varname">do-extract</code>
    ターゲットを上書きすることができます。</p>
</div>
<div class="sect1" title="17.8. patch 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.patch"></a>17.8. <span class="emphasis"><em>patch</em></span> 相</h2></div></div></div>
<p>展開の後で、<code class="varname">PATCHFILES</code>で指定されたパッチとパッケージのpatchesサブディレ
    クトリーに存在するパッチ、さらに、$LOCALPATCHES/$PKGPATH (たとえば
    <code class="filename">/usr/local/patches/graphics/png</code>)に存在するパッチのすべてが適用されます。
    <code class="filename">.Z</code>、あるいは<code class="filename">.gz</code>で終る名前のパッチファイルは、適用する前に伸張されます。
    <code class="filename">.orig</code>、<code class="filename">.rej</code>で終るものは無視されます。<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?patch+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">patch</span>(1)</span></a>のためのいくつかのオプショ
    ンは、<code class="varname">PATCH_DIST_ARGS</code>で指定する事ができます。
    詳細に関しては<a class="xref" href="#components.patches" title="11.3. patches/*">Section 11.3, “patches/*”</a>を参照して下さい。</p>
<p>デフォルトでは、パッチに曖昧さがあった場合には<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?patch+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">patch</span>(1)</span></a>が異常終了するような
    特別な引数が渡されます。パッチを修正(再作成)して、きれいに適用できるよう
    にしてください。そうする理由は、曖昧さがあるパッチが一見うまく適用できても、実は誤った場
    所に適用されていて、深刻な問題を起こす可能性があるからです。</p>
</div>
<div class="sect1" title="17.9. tools 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.tools"></a>17.9. <span class="emphasis"><em>tools</em></span> 相</h2></div></div></div>
<p>この相については<a class="xref" href="#tools" title="Chapter 18. 構築や実行のために必要なツール">Chapter 18, <i>構築や実行のために必要なツール</i></a> で説明しています。
    </p>
</div>
<div class="sect1" title="17.10. wrapper 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.wrapper"></a>17.10. <span class="emphasis"><em>wrapper</em></span> 相</h2></div></div></div>
<p>この相では、コンパイラーとリンカー用のラッパープログラムが作成されます。
    以下の変数を使って、ラッパーに手を加えることができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">ECHO_WRAPPER_MSG</code></span></dt>
<dd><p>経過を表示するためのコマンドです。
      標準状態では何もしません。
      経過を見るには、この変数を <code class="literal">${ECHO}</code>
      に設定します。</p></dd>
<dt><span class="term"><code class="varname">WRAPPER_DEBUG</code></span></dt>
<dd><p>この変数は、
      ラッパーのログファイルにより詳しい情報が必要かどうかに応じて、
      <code class="literal">yes</code> (標準状態の値) または
      <code class="literal">no</code> に設定することができます。</p></dd>
<dt><span class="term"><code class="varname">WRAPPER_UPDATE_CACHE</code></span></dt>
<dd><p>この変数は、
      ラッパーの速度を改善するためキャッシュを使わせるかどうかに応じて、
      <code class="literal">yes</code> または <code class="literal">no</code>
      に設定することができます。標準状態の値は
      <code class="literal">yes</code> ですが、キャッシュに対応していないプラットフォームでは
      強制的に <code class="literal">no</code>
      になります。</p></dd>
<dt><span class="term"><code class="varname">WRAPPER_REORDER_CMDS</code></span></dt>
<dd><p>順序の並び替え用のコマンドを並べたリストです。
      並び替え用のコマンドは、
      <code class="literal">reorder:l:<em class="replaceable"><code>lib1</code></em>:<em class="replaceable"><code>lib2</code></em></code>
      のような形式をしています。これを使うと
      <code class="literal">-l<em class="replaceable"><code>lib1</code></em></code>
      が常に
      <code class="literal">-l<em class="replaceable"><code>lib2</code></em></code> より先に現れるようになります。
      </p></dd>
<dt><span class="term"><code class="varname">WRAPPER_TRANSFORM_CMDS</code></span></dt>
<dd><p>変換用のコマンドを並べたリストです。 [TODO:
      investigate further]</p></dd>
</dl></div>
</div>
<div class="sect1" title="17.11. configure 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.configure"></a>17.11. <span class="emphasis"><em>configure</em></span> 相</h2></div></div></div>
<p>ほとんどのソフトウェアは、実行対象のプラットフォームで利用できるヘッダーファイル、
    システムコール、およびライブラリールーチンについての情報を必要とします。
    この情報の判断はコンフィギュレーションとして知られているプロセスであり、
    通常、自動化されています。
    大抵の場合、スクリプトが配布物と一緒に提供され、
    それを実行することによりヘッダーファイルやMakefile等が生成されます。</p>
<p>パッケージが configure スクリプトを含んでいる場合、<code class="varname">HAS_CONFIGURE</code>
    を <span class="quote">“<span class="quote">yes</span>”</span> に設定することにより、実行することができます。
    もし、その configure スクリプトが GNU の autoconf スクリプトである場合は、
    かわりに、<code class="varname">GNU_CONFIGURE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に指定してください。
    大雑把にいうと、<span class="emphasis"><em>configure</em></span> 相では以下のようなことをしています。</p>
<pre class="programlisting">
.for d in ${CONFIGURE_DIRS}
        cd ${WRKSRC} \
        &amp;&amp; cd ${d} \
        &amp;&amp; env ${CONFIGURE_ENV} ${CONFIGURE_SCRIPT} ${CONFIGURE_ARGS}
.endfor
</pre>
<p><code class="varname">CONFIGURE_DIRS</code> (標準では <span class="quote">“<span class="quote">.</span>”</span>) は、
    <code class="varname">WRKSRC</code> からの相対位置でのパス名を並べたリストです。
    この各ディレクトリー内で、環境変数 <code class="varname">CONFIGURE_ENV</code> および
    引数 <code class="varname">CONFIGURE_ARGS</code> を使って
    configure スクリプトが実行されます。
    <code class="varname">CONFIGURE_ENV</code>, <code class="varname">CONFIGURE_SCRIPT</code>
    (標準では <span class="quote">“<span class="quote">./configure</span>”</span>),
    <code class="varname">CONFIGURE_ARGS</code>
    の各変数は、いずれもパッケージ側で変更することができます。</p>
<p>もし、プログラムがコンフィギュレーションのために <code class="filename">Imakefile</code> を使用するので
    あれば、<code class="varname">USE_IMAKE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定することにより、適切な手順が実行されます。
    (もし、<code class="varname">${X11PREFIX}</code> にインストールされるパッケージが欲しいだけで、xmkmfを実
    行したくない場合、かわりに<code class="varname">USE_X11BASE</code>を使用してください。)
    <code class="varname">SCRIPTS_ENV</code> に変数を設定すると、
    その変数を xmkmf の環境変数に追加することができます。</p>
<p>プログラムがコンフィギュレーションのために <code class="filename">cmake</code>
    を使用するのであれば、
    <code class="varname">USE_CMAKE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定することにより、適切な手順が実行されます。
    <code class="varname">CONFIGURE_ENV</code> に変数を追加すると、
    その変数を cmake の環境変数に追加することができます。
    また、<code class="varname">CMAKE_ARGS</code> 変数に引数を追加すると、
    cmake の引数に追加することができます。
    最上層ディレクトリーを指定する引数は
    <code class="varname">CMAKE_ARG_PATH</code> 変数で与えられるようになっており、
    この変数の標準の値は
    <span class="quote">“<span class="quote">.</span>”</span> (<code class="varname">CONFIGURE_DIRS</code> からの相対位置) です。</p>
<p>configure の段階ですることが何もない場合は、
    <code class="varname">NO_CONFIGURE</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定します。</p>
</div>
<div class="sect1" title="17.12. build 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.build"></a>17.12. <span class="emphasis"><em>build</em></span> 相</h2></div></div></div>
<p>パッケージの構築は、大雑把にいえば、
    以下のコードを実行するのと同じことです。</p>
<pre class="programlisting">
.for d in ${BUILD_DIRS}
        cd ${WRKSRC} \
        &amp;&amp; cd ${d} \
        &amp;&amp; env ${MAKE_ENV} \
            ${MAKE_PROGRAM} ${BUILD_MAKE_FLAGS} \
                -f ${MAKE_FILE} \
                ${BUILD_TARGET}
.endfor
</pre>
<p><code class="varname">BUILD_DIRS</code> (標準では
    <span class="quote">“<span class="quote">.</span>”</span>) は、
    <code class="varname">WRKSRC</code> からの相対位置でのパス名を並べたリストです。
    この各ディレクトリー内で、環境変数
    <code class="varname">MAKE_ENV</code> および引数
    <code class="varname">BUILD_MAKE_FLAGS</code> を使って
    <code class="varname">MAKE_PROGRAM</code> が実行されます。
    <code class="varname">MAKE_ENV</code>,
    <code class="varname">BUILD_MAKE_FLAGS</code>,
    <code class="varname">MAKE_FILE</code>,
    <code class="varname">BUILD_TARGET</code>
    の各変数は、いずれもパッケージ側で変更することができます。</p>
<p><code class="varname">MAKE_PROGRAM</code> の標準の値は、
    <code class="varname">USE_TOOLS</code> に <span class="quote">“<span class="quote">gmake</span>”</span> が含まれている場合は
    <span class="quote">“<span class="quote">gmake</span>”</span>、含まれていない場合は <span class="quote">“<span class="quote">make</span>”</span> です。
    <code class="varname">MAKE_FILE</code> の標準の値は <span class="quote">“<span class="quote">Makefile</span>”</span> であり、
    <code class="varname">BUILD_TARGET</code> の標準の値は <span class="quote">“<span class="quote">all</span>”</span> です。</p>
<p>build の段階ですることが何もない場合は、
    <code class="varname">NO_BUILD</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定します。</p>
</div>
<div class="sect1" title="17.13. test 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.test"></a>17.13. <span class="emphasis"><em>test</em></span> 相</h2></div></div></div>
<p>[TODO]</p>
</div>
<div class="sect1" title="17.14. install 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.install"></a>17.14. <span class="emphasis"><em>install</em></span> 相</h2></div></div></div>
<p>構築の段階が完了すると、ユーザーが構築されたプログラムやファイルを使えるようにするため、ソフトウェアをパブリックなディレ
    クトリーにインストールする必要があります。</p>
<p><span class="emphasis"><em>install</em></span> 相は、大雑把にいえば、
    以下のコードを実行するのと同じことです。これに加えて、
    このコードの前後では、整合性の検査やパッケージの登録などをするため、
    多くの操作がおこなわれます。</p>
<pre class="programlisting">
.for d in ${INSTALL_DIRS}
        cd ${WRKSRC} \
        &amp;&amp; cd ${d} \
        &amp;&amp; env ${MAKE_ENV} \
            ${MAKE_PROGRAM} ${INSTALL_MAKE_FLAGS} \
                -f ${MAKE_FILE} \
                ${INSTALL_TARGET}
.endfor
</pre>
<p>各変数の意味は、<span class="emphasis"><em>build</em></span>
    相のものと同様です。
    <code class="varname">INSTALL_DIRS</code> は標準では
    <code class="varname">BUILD_DIRS</code> です。<code class="varname">INSTALL_TARGET</code>
    は標準では <span class="quote">“<span class="quote">install</span>”</span> ですが、
    <code class="varname">USE_IMAKE</code> が定義されており、かつ
    <code class="varname">NO_INSTALL_MANPAGES</code> が定義されていない場合は、
    <span class="quote">“<span class="quote">install.man</span>”</span>
    が追加されます。</p>
<p><span class="emphasis"><em>install</em></span> 相では、以下の変数が有用です。
    これらはいずれも <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?install+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a> コマンドの変種であり、
    所有者、所有グループ、パーミッションをあらかじめ決めてあるものです。
    <code class="varname">INSTALL</code> は、オプションを何も指定しない install コマンドです。
    用途別に特化した変種には、以下のものがあります。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">INSTALL_PROGRAM_DIR</code></span></dt>
<dd><p>バイナリーを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_SCRIPT_DIR</code></span></dt>
<dd><p>スクリプトを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_LIB_DIR</code></span></dt>
<dd><p>共有静的ライブラリーを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_DATA_DIR</code></span></dt>
<dd><p>データファイルを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_MAN_DIR</code></span></dt>
<dd><p>マニュアルページを含むディレクトリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_PROGRAM</code></span></dt>
<dd><p>デバッグ用シンボルを取り除くことのできるバイナリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_SCRIPT</code></span></dt>
<dd><p>シンボルを取り除くことのできないバイナリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_GAME</code></span></dt>
<dd><p>ゲームのバイナリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_LIB</code></span></dt>
<dd><p>共有静的ライブラリー</p></dd>
<dt><span class="term"><code class="varname">INSTALL_DATA</code></span></dt>
<dd><p>データファイル</p></dd>
<dt><span class="term"><code class="varname">INSTALL_GAME_DATA</code></span></dt>
<dd><p>ゲーム用のデータファイル</p></dd>
<dt><span class="term"><code class="varname">INSTALL_MAN</code></span></dt>
<dd><p>マニュアルページ</p></dd>
</dl></div>
<p>これらのほか、以下の変数があります。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">INSTALLATION_DIRS</code></span></dt>
<dd><p>pkgsrc が <span class="emphasis"><em>install</em></span>
      相の最初に作成するディレクトリーを
      <code class="varname">PREFIX</code> からの相対位置表記で並べたリストです。
      パッケージは、ファイルをインストールする前に、
      必要なディレクトリーをすべて自力で作成することになるので、
      その他のディレクトリーをすべてここに列挙します。
      </p></dd>
</dl></div>
<p>稀な場合として、パッケージが何もインストールしないような場合は、
    <code class="varname">NO_INSTALL</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定します。
    これはほとんどの場合、<code class="filename">regress</code>
    カテゴリーのパッケージに関するものです。</p>
</div>
<div class="sect1" title="17.15. package 相">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.package"></a>17.15. <span class="emphasis"><em>package</em></span> 相</h2></div></div></div>
<p>install 期が完了すると、
    インストールされたファイルからなるバイナリーパッケージを作ることができます。
    このようなバイナリーパッケージは、たとえば
    <span class="command"><strong>make bin-install</strong></span> するか、
    <span class="command"><strong>pkg_add</strong></span> を使って、それまでのコンパイルの過程を踏まずに、
    迅速にインストールすることができます。</p>
<p>標準では、バイナリーパッケージは
    <code class="filename">${PACKAGES}/All</code> に作られ、また、
    <code class="varname">CATEGORIES</code> 変数に設定されたカテゴリーごとに
    <code class="filename">${PACKAGES}/<em class="replaceable"><code>category</code></em></code>
    にシンボリックリンクが作られます。<code class="varname">PACKAGES</code>
    は標準では <code class="filename">pkgsrc/packages</code> になります。</p>
</div>
<div class="sect1" title="17.16. 掃除をする">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.clean"></a>17.16. 掃除をする</h2></div></div></div>
<p>パッケージの作業が終わったら、<span class="command"><strong>make clean</strong></span>
    を実行して作業ディレクトリーを掃除することができます。
    依存パッケージの作業ディレクトリーもすべて掃除したい場合は、
    <span class="command"><strong>make clean-depends</strong></span> を使います。</p>
</div>
<div class="sect1" title="17.17. 他の役に立つターゲット">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="build.helpful-targets"></a>17.17. 他の役に立つターゲット</h2></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term">pre/post-*</span></dt>
<dd><p>前のセクションで述べた主ターゲットのために、二つの補助ターゲットが存在し
	  ます。これは主ターゲットに<span class="quote">“<span class="quote">pre-</span>”</span>や<span class="quote">“<span class="quote">post-</span>”</span>というプレフィックスをつけ
	  たものです。これらのターゲットは、特別な設定やインストール手順のために、
	  主ターゲットが実行される前や後に、パッケージの Makefile から実行されます。例えば、プログラムのコンフィ
	  ギュレーションスクリプトやインストールターゲットが省略された場合に有用で
	  す。</p></dd>
<dt><span class="term">do-*</span></dt>
<dd><p>主なターゲットがおかしな動作をし、それを修正するための変数が存在しない場
	  合、do-*ターゲットを使用することにより、それらを再定義することができます
	  (do-*ターゲットのかわりに、ターゲット自体を再定義してはいけません。pre-*
	  やpost-*ターゲットが実行されなくなってしまいます)。通常、再定義する必要
	  はありません。</p></dd>
<dt><span class="term">reinstall</span></dt>
<dd>
<p>もし、<span class="command"><strong>make install</strong></span>実行後に、いくつかのファイルがきちんとインストール
	  されなかった事に気がついた場合、このターゲットを使い、再びインストールす
	  る事ができます。この場合、<span class="quote">“<span class="quote">インストール済み</span>”</span>フラグは無視されます。</p>
<p>これは、<code class="varname">DEPENDS_TARGET</code>
	  の標準の値です。ただし <span class="command"><strong>make update</strong></span> および <span class="command"><strong>make
	  package</strong></span> の場合は例外であり、これらについてはそれぞれ
	  <span class="quote">“<span class="quote">package</span>”</span> および <span class="quote">“<span class="quote">update</span>”</span>
	  が標準の値になります。</p>
</dd>
<dt><span class="term">deinstall</span></dt>
<dd>
<p>このターゲットは、パッケージをアンインストールするためにカレントディレク
	  トリーで<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>を実行します。動作を制御するために、以下の変数を
	  使用することができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">PKG_VERBOSE</code></span></dt>
<dd><p><a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>コマンドに「-v」オプションを渡します。</p></dd>
<dt><span class="term"><code class="varname">DEINSTALLDEPENDS</code></span></dt>
<dd><p>指定されたパッケージに必要な(依存する)すべてのパッケージを削除します。
		このターゲットは、指定されたパッケージによってインストールされたパッ
		ケージを削除するために使用されます。例えば、<span class="command"><strong>make deinstall
		DEINSTALLDEPENDS=1</strong></span>が<code class="filename">pkgsrc/x11/kde</code>で実行された場合、KDE全体を削除し
		ます。<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a>のコマンドラインに<span class="quote">“<span class="quote">-R</span>”</span>を指定すると設定されます。</p></dd>
</dl></div>
</dd>
<dt><span class="term">bin-install</span></dt>
<dd><p>バイナリーパッケージを、
	  ローカルディスクまたは列挙された FTP サイト
	  (<code class="varname">BINPKG_SITES</code> 変数を参照)
	  からインストールし、
	  利用可能なバイナリーパッケージがどこにもない場合には
	  <span class="command"><strong>make package</strong></span> をおこないます。
	  <span class="command"><strong>pkg_add</strong></span> 用の引数、たとえば饒舌な操作などを
	  <code class="varname">BIN_INSTALL_FLAGS</code>
	  に設定することができます。</p></dd>
<dt><span class="term">update</span></dt>
<dd>
<p>このターゲットは、現在のパッケージを最新のものに更新します。最初にパッケー
	  ジと、それに依存するすべてのパッケージをアンインストールします。それから
	  最新のバージョンのパッケージをコンパイル、インストールします。これは、現
	  在どのパッケージがインストールされているかを調べ、<span class="command"><strong>make deinstall</strong></span>、
	  <span class="command"><strong>make install</strong></span>(または、<code class="varname">UPDATE_TARGET</code>で設定されたターゲット)を続けて実
	  行するのと同じです。</p>
<p>以前に実行した<span class="command"><strong>make
	  update</strong></span>がさまざまな理由で中断された場合、パッケー
	  ジの更新のために、このターゲットを使用することができます。
	  ただし、この場
	  合は、<span class="command"><strong>make clean</strong></span>を実行していない事、あるいは<code class="varname">WRKDIR</code>の依存パッケー
	  ジのリストを削除していない事を確認してください。そうでなければ、インストー
	  ル済みの依存パッケージを使用し、現在のパッケージを自動更新することができ
	  ません。</p>
<p>中断された<span class="command"><strong>make
	  update</strong></span>の再開は、パッケージツリーの他の部分が変更され
	  ていない場合に限って動作します。更新対象のパッケージのソースコードが変更
	  されていた場合は、<span class="command"><strong>make update</strong></span>の再開はきっと失敗するでしょう。</p>
<p><span class="command"><strong>make
	  update</strong></span>の動作を変更するために、以下の変数をコマンドライン、また
	  は<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>で使うことができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">UPDATE_TARGET</code></span></dt>
<dd><p>更新されたパッケージや依存パッケージのために再帰的に使用されるインス
		トールターゲット。
		<span class="command"><strong>make update</strong></span>用のデフォルトは、<code class="varname">DEPENDS_TARGET</code>が
		設定されている場合はその値、それ以外の場合は<span class="quote">“<span class="quote">install</span>”</span>です。
		これら以外のターゲットのよい例としては <span class="quote">“<span class="quote">package</span>”</span> や
		<span class="quote">“<span class="quote">bin-install</span>”</span> があります。
		ここで <span class="quote">“<span class="quote">update</span>”</span> を設定してはいけません
		(無限ループに陥ってしまいます)。</p></dd>
<dt><span class="term"><code class="varname">NOCLEAN</code></span></dt>
<dd><p>更新した後、きれいに掃除をしません。調査やその他の目的のために、更新
		されたパッケージの作業用ソース等をそのままにしておきたい場合に役に立
		ちます。最終的にはソースツリーを掃除してください(以下の
		<span class="quote">“<span class="quote">clean-update</span>”</span>ターゲットを見てください)。そうしなければ、次回の
		<span class="command"><strong>make</strong></span>や<span class="command"><strong>make
		update</strong></span>の時に古いソースコードが残っていることで
		トラブルがおこるかもしれません。</p></dd>
<dt><span class="term"><code class="varname">REINSTALL</code></span></dt>
<dd><p>インストール(make <code class="varname">DEPENDS_TARGET</code>)の前に各パッケージをアンインストー
		ルします。これは、<span class="command"><strong>make
		update</strong></span>の実行中断後に<span class="quote">“<span class="quote">clean-update</span>”</span>ターゲット
		(以下参照)が呼ばれた場合に必要となることがあります。</p></dd>
<dt><span class="term"><code class="varname">DEPENDS_TARGET</code></span></dt>
<dd><p>再帰を無効化し、パッケージのターゲットをハードコードすることができま
		す。updateターゲット用のデフォルトは<span class="quote">“<span class="quote">update</span>”</span>であり、事前に必要なパッ
		ケージを再帰的に更新するようになっています。<code class="varname">DEPENDS_TARGET</code>を設定する
		のは、再帰的な更新を無効化したいときだけにしてください。<span class="command"><strong>make update</strong></span>
		(後述します)の最中にインストールされる各パッケージに対して、特定のター
		ゲットを指定するだけの場合は、これのかわりに<code class="varname">UPDATE_TARGET</code>を使ってく
		ださい。</p></dd>
</dl></div>
</dd>
<dt><span class="term">clean-update</span></dt>
<dd>
<p>カレントディレクトリーで<span class="command"><strong>make update</strong></span>が実行された時に更新されるすべて
	  のパッケージのソースツリーを掃除します。カレントパッケージ(あるいは、依
	  存パッケージ)がすでにアンインストールされている(例えば<span class="command"><strong>make update</strong></span>を実行
	  した後)場合には、このターゲットを使ってはいけません。もし使用すると、更
	  新するつもりのパッケージのいくつかを失う可能性があります。経験的には、初
	  めて<span class="command"><strong>make update</strong></span>を実行する<span class="emphasis"><em>前</em></span>、あるいは汚れたパッケージツリーがある場
	  合(例えば<code class="varname">NOCLEAN</code>を使用した場合)にのみ使用するとよいでしょう。</p>
<p>パッケージのツリーが掃除されているかどうかわからない場合は、ツリーの最上
	  層で<span class="command"><strong>make
	  clean</strong></span>を実行するか、更新しようとしているパッケージのディレクト
	  リーで以下のコマンドをこの順に使うか、どちらかをおこなうことができます。
	  (<span class="command"><strong>make update</strong></span>を初めて実行するより<span class="emphasis"><em>前</em></span>におこなってください。それ以外の場
	  合、更新しようとしているパッケージをすべて失ってしまいます)</p>
<pre class="screen">
<code class="prompt">#</code> <strong class="userinput"><code>make clean-update</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make clean CLEANDEPENDS=YES</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make update</code></strong>
	  </pre>
<p><span class="command"><strong>make
	  clean-update</strong></span>の動作を変更するために、以下の変数をコマンドライン、
	  または<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>で使うことができます。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">CLEAR_DIRLIST</code></span></dt>
<dd><p><span class="command"><strong>make clean</strong></span>の後で、パッケージのためのディレクトリーのリストを再構
		築しません。<span class="command"><strong>make update</strong></span>で、更新したいすべてのパッケージがインストー
		ルされた場合にのみ使用してください。通常、これは<span class="command"><strong>make update</strong></span>で自動
		的に実行されます。ただし、<code class="varname">NOCLEAN</code>変数の設定によって実行されない事もあ
		ります(上を参照してください)。</p></dd>
</dl></div>
</dd>
<dt><span class="term">replace</span></dt>
<dd>
<p>当該パッケージのインストールを更新します。
	  依存するパッケージの置き換えをおこなわないという点で
	  update と異なります。
	  このターゲットを動作させるためには、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_tarup/README.html" target="_top"><code class="filename">pkgtools/pkg_tarup</code></a>
	  をインストールする必要があります。</p>
<p><span class="emphasis"><em>このターゲットは注意して使ってください。
	  </em></span> このターゲットを使って更新した後に、
	  依存するパッケージが動作するという保証はありません。
	  特に、ライブラリーのパッケージで、
	  共有ライブラリーのメジャーバージョンが変わるようなものを
	  <span class="command"><strong>make replace</strong></span>
	  した場合は、ほぼ確実に壊れます。
	  このため、このターゲットは公式にはサポートされておらず、
	  熟練した利用者だけが使うことを推奨します。</p>
</dd>
<dt><span class="term">info</span></dt>
<dd><p>このターゲットは、現在のパッケージに対して<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_info+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_info</span>(1)</span></a>をおこないます。これ
	  を使って、インストールされているパッケージのバージョンを調べる
	  ことができます。</p></dd>
<dt><span class="term">index</span></dt>
<dd>
<p>これは最上層用のコマンド、つまり <code class="filename">pkgsrc</code>
	  ディレクトリーで使うコマンドです。
	  ローカルの pkgsrc ツリー内の全パッケージのデータベースを作成します。
	  このデータベースには、依存性、コメント、メンテナー、
	  その他の有用な情報が含まれます。
	  個々のパッケージのエントリーは、当該パッケージのディレクトリーで
	  <span class="command"><strong>make describe</strong></span> を実行して作成されます。
	  作成された索引ファイルは
	  <code class="filename">pkgsrc/INDEX</code> に保存されます。
	  この索引は、<span class="command"><strong>make
	  print-index</strong></span> を実行すると、饒舌な形式で表示することができます。
	  <span class="command"><strong>make search
	  key=<em class="replaceable"><code>something</code></em></strong></span>
	  を使って、索引を検索することができます。
	  <span class="command"><strong>make show-deps
	  PKG=<em class="replaceable"><code>somepackage</code></em></strong></span>
	  を実行して、特定のパッケージに依存するパッケージをすべて調べることができます。</p>
<p>このコマンドの実行には、非常に長い時間がかかります。
	  速いマシンでも数時間かかるでしょう。</p>
</dd>
<dt><span class="term">readme</span></dt>
<dd>
<p>このターゲットは、
	  <code class="filename">README.html</code>ファイルを作成します。このファイルは <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/firefox/README.html" target="_top"><code class="filename">www/firefox</code></a>や <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/www/links/README.html" target="_top"><code class="filename">www/links</code></a>のようなブラウザー
	  で閲覧することができます。作成されたファイルは、ローカルホストの
	  <code class="varname">PACKAGES</code>ディレクトリーにあるパッケージへの参照を含んでいます。また、
	  <code class="varname">FTP_PKG_URL_HOST</code>と<code class="varname">FTP_PKG_URL_DIR</code>を元にしたURLを参照させることもできます。
	  例えば、ローカルマシン上の<code class="filename">/usr/packages</code>ディレクトリーのバイナリーパッ
	  ケージを参照する<code class="filename">README.html</code>ファイルを作成したい場合、
	  <code class="varname">FTP_PKG_URL_HOST=file://localhost</code>と<code class="varname">FTP_PKG_URL_DIR=/usr/packages</code>をセット
	  してください。<code class="varname">${PACKAGES}</code>ディレクトリーと、そのサブディレクトリーはすべ
	  てのバイナリーパッケージで検索されます。</p>
<p>このターゲットは、最上層またはカテゴリーのディレクトリーで実行することもできます。
	  そうした場合は、配下のパッケージに対して再帰的に実行されます。</p>
</dd>
<dt><span class="term">readme-all</span></dt>
<dd><p>これは最上層用のコマンドであり、<code class="filename">pkgsrc</code> で実行します。
	  このターゲットを使い、<code class="filename">README-all.html</code>を作成することができます。このファ
	  イルはNetBSDパッケージコレクションの中の、現在利用可能なすべてのパッケー
	  ジのリスト、また、それらが属するカテゴリーと簡単な説明を含んでいます。こ
	  のファイルは<code class="filename">pkgsrc/*/README.html</code>から作りだされます。したがって、<span class="command"><strong>make
	  readme</strong></span>
	  の<span class="emphasis"><em>後</em></span>に、このターゲットを実行してください。</p></dd>
<dt><span class="term">cdrom-readme</span></dt>
<dd><p>これは<span class="quote">“<span class="quote">readme</span>”</span>ターゲット(上を見てください)とほとんど同じですが、CD-ROMに焼
	  かれるpkgsrcツリーを作る時に使われます。また、このターゲットは
	  <code class="filename">README.html</code>ファイルを作成し、<code class="varname">CDROM_PKG_URL_HOST</code>と<code class="varname">CDROM_PKG_URL_DIR</code>に基づ
	  くURLへの参照を作ります。</p></dd>
<dt><span class="term">show-distfiles</span></dt>
<dd><p>このターゲットは、パッケージを構築するために、どのdistfileやパッチファイ
	  ルが必要か (<code class="varname">ALLFILES</code>:
	  <code class="varname">DISTFILES</code>および<code class="varname">PATCHFILES</code>をすべて含みますが、
	  <code class="filename">patches/*</code>は含みません) を表示します。</p></dd>
<dt><span class="term">show-downlevel</span></dt>
<dd><p>このターゲットは、パッケージがインストールされていない場合は何も表示しま
	  せん。もし、あるバージョンのパッケージがインストールされているが、現在の
	  pkgsrcのバージョンでインストールされたものでない場合、警告メッセージを表
	  示します。このターゲットは、インストール済みのパッケージが古いバージョン
	  であり、そのバージョンが削除可能で、最新の物が追加されることを表示するた
	  めに使用されます。</p></dd>
<dt><span class="term">show-pkgsrc-dir</span></dt>
<dd><p>当該パッケージの構築とインストールが可能な、パッケージ階層におけるディレ
	  クトリーを表示します。このディレクトリーは、そのパッケージがインストール
	  された際のディレクトリーと同じとは限りません。このターゲットは、単一ホス
	  ト上で多数のパッケージの更新をしたい場合に使うためのもので、pkgsrc の最
	  上層のMakefileから<span class="quote">“<span class="quote">show-host-specific-pkgs</span>”</span>ターゲットで呼び出すことがで
	  きます。</p></dd>
<dt><span class="term">show-installed-depends</span></dt>
<dd><p>このターゲットは、インストールされているパッケージのうち、どれが当該パッ
	  ケージの<code class="varname">DEPENDS</code>と合致するかを表示します。依存関係が古いせいで構築に問題が
	  起きる場合に便利です。</p></dd>
<dt><span class="term">check-shlibs</span></dt>
<dd><p>パッケージのインストール後に、すべてのバイナリーおよび(ELFプラットフォー
	  ムでは) 共有ライブラリーが必要な共有ライブラリーを見つけられるかどうか確
	  認します。<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>で<code class="varname">PKG_DEVELOPER</code>が設定されている場合はデフォルトで
	  実行します。</p></dd>
<dt><span class="term">print-PLIST</span></dt>
<dd>
<p>パッケージを新規に、または更新のために<span class="quote">“<span class="quote">make install</span>”</span>した後、
	  <span class="command"><strong>find -newer
	  work/.extract_done</strong></span>をもとに新しい<code class="filename">PLIST</code>を生成して表示します。PLIST生成は、
	  共有ライブラリーなどに配慮して行われますが、生成した結果を<code class="filename">PLIST</code>に置く前
	  に再確認するよう<span class="emphasis"><em>強く</em></span>おすすめします。パッケージ更新時には、このコマンド
	  の出力と、更新前の<code class="filename">PLIST</code>ファイルとを比較すると便利でしょう。</p>
<p>パッケージが、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?tar+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>その他のファイルのアクセス時刻を更新しない方法を使っ
	  てファイルをインストールする場合は、それらのファイルはこのターゲットで使われる <span class="quote">“<span class="quote">find
	  -newer</span>”</span> コマンドで検
	  出されないので、手で<code class="filename">PLIST</code>に書き足すよう注意してください!</p>
<p>このターゲットに関するさらなる情報は、
	  <a class="xref" href="#print-PLIST" title="13.3. make print-PLIST の出力を細工する">Section 13.3, “<span class="command"><strong>make print-PLIST</strong></span> の出力を細工する”</a>を参照してください。</p>
</dd>
<dt><span class="term">bulk-package</span></dt>
<dd>
<p>バルクビルドの実行に使われます。適切なバイナリーパッケージがすでに存在す
	  る場合は、何もしません。そうでない場合は、コンパイル、インストール、パッ
	  ケージ作成をおこないます
	  (<code class="varname">PKG_DEPENDS</code>が適切に設定されている場合は、依存するパッケージも。<a class="xref" href="#binary.configuration" title="7.3.1. 設定">Section 7.3.1, “設定”</a>参照)。
	  バイナリーパッケージ作成後、ディスクの空き領域
	  を確保するために、ソース、インストールしたばかりのパッケージと依存パッケー
	  ジは削除されます。</p>
<p><span class="emphasis"><em>このターゲットを使うと、
	  システムにインストールされているパッケージをすべてアンインストールすることもあるので、
	  注意してください。</em></span></p>
</dd>
<dt><span class="term">bulk-install</span></dt>
<dd>
<p>依存パッケージ群をインストールするためのバルクインストールで使われます。
	  最新のバイナリーパッケージが利用可能な場合、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a>でそれをインストール
	  します。そうでない場合は、<span class="command"><strong>make bulk-package</strong></span>が実行されますが、インストー
	  ルされたバイナリーは削除されません。</p>
<p>バイナリーパッケージが<span class="quote">“<span class="quote">最新</span>”</span>であるとみなされる (<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_add+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_add</span>(1)</span></a> でインストールされる)
	  条件は、以下のとおりです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>パッケージファイル
	      (<code class="filename">Makefile</code>, ...)が、いずれも構築時から変更されていな
	      いこと。</p></li>
<li class="listitem"><p>そのパッケージが依存している(バイナリー)
	      パッケージが、いずれも構築時から変更されていないこと。</p></li>
</ul></div>
<p><span class="emphasis"><em>このターゲットを使うと、
	  システムにインストールされているパッケージをすべてアンインストールすることもあるので、
	  注意してください。</em></span></p>
</dd>
</dl></div>
</div>
</div>
<div class="chapter" title="Chapter 18. 構築や実行のために必要なツール">
<div class="titlepage"><div><div><h2 class="title">
<a name="tools"></a>Chapter 18. 構築や実行のために必要なツール</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#pkgsrc-tools">18.1. pkgsrc 構築用のツール</a></span></dt>
<dt><span class="sect1"><a href="#package-tools">18.2. パッケージが必要とするツール</a></span></dt>
<dt><span class="sect1"><a href="#platform-tools">18.3. プラットフォーム附属のツール</a></span></dt>
<dt><span class="sect1"><a href="#tools.questions">18.4. ツールに関する質問</a></span></dt>
</dl>
</div>
<p><code class="varname">USE_TOOLS</code> 定義は、
パッケージを構築するためにどのコマンドが必要か (<code class="varname">BUILD_DEPENDS</code> のように)、
あるいは、インストールしたパッケージを実行するためにどのコマンドが必要か (<code class="varname">DEPENDS</code>
のように) を定義するために、
pkgsrc 内部で使われており、また、個々のパッケージ用としても使われています。
適当なツールがシステムに標準で附属していれば、多くの場合は
pkgsrc のパッケージは使われません。</p>
<p>パッケージを構築するときは、実行検索パスの前のほうにあるディレクトリーに、
代替ツールが (シンボリックリンクまたはラッパースクリプトとして) 用意されます。
buildlink システムと同様に、
こうすることで、首尾一貫した構築ができるようになります。</p>
<p>あるツールは、パッケージの構築を補助するために必要となることがあります。
たとえば、perl, GNU make (gmake), yacc はこのために必要になることがあります。</p>
<p>また、あるツールは、たとえば、システム標準附属のツールでは
pkgsrc によるパッケージの構築用としては使い物にならないために、
必要となることがあります。
たとえば、パッケージが GNU awk, (yacc ではなく) bison や、
より優れた sed を必要とすることがあります。</p>
<p>パッケージが使うツールの実体は、
<span class="command"><strong>make show-tools</strong></span> を実行すると一覧表示されます。</p>
<div class="sect1" title="18.1. pkgsrc 構築用のツール">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="pkgsrc-tools"></a>18.1. pkgsrc 構築用のツール</h2></div></div></div>
<p>pkgsrc が標準状態で使うツール一式は、
<code class="filename">bsd.pkg.mk</code> で定義されています。ここには、
<span class="command"><strong>cat</strong></span>, <span class="command"><strong>awk</strong></span>,
<span class="command"><strong>chmod</strong></span>, <span class="command"><strong>test</strong></span>
などのような標準的な Unix のツールが含まれています。
これらは
<span class="command"><strong>make show-var VARNAME=USE_TOOLS</strong></span> を実行すると見ることができます。</p>
<p>個々のパッケージの構築のためにあるプログラムが必要な場合は、
<code class="varname">USE_TOOLS</code> 変数を使って
必要なツールを定義することができます。</p>
</div>
<div class="sect1" title="18.2. パッケージが必要とするツール">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="package-tools"></a>18.2. パッケージが必要とするツール</h2></div></div></div>
<p>以下の例では、:pkgsrc は、構築時依存性として、
ネイティブのバージョンではなく pkgsrc のバージョンを使うことを意味します。
また、:run は、実行時依存性としても使うことを意味します (ので、DEPENDS になります)。
このようなものを付けない場合は、構築時依存性を意味します。これは
:build を明示的に使って設定することもできます。 (このため、以下の例のものは、それぞれ gmake:build
および pkg-config:build と同じことです。)</p>
<pre class="programlisting">
USE_TOOLS+=     mktemp:pkgsrc
USE_TOOLS+=     gmake perl:run pkg-config
</pre>
<p>このツールの枠組を使う時には、
<code class="varname">TOOLS_PATH.foo</code> 変数が、
適切なツールへのフルパスとして定義されます。
たとえば、<code class="varname">TOOLS_PATH.bash</code> は Linux システム上では
<span class="quote">“<span class="quote">/bin/bash</span>”</span> になったりするでしょう。</p>
<p>実行時に常に pkgsrc バージョンのツールが必要となる場合は、
この枠組ではなく、単に <code class="varname">DEPENDS</code> を使ってください。
</p>
</div>
<div class="sect1" title="18.3. プラットフォーム附属のツール">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="platform-tools"></a>18.3. プラットフォーム附属のツール</h2></div></div></div>
<p>pkgsrc の改良、あるいは新プラットフォームへの移植をする時には、
<code class="filename">pkgsrc/mk/tools/tools.${OPSYS}.mk</code> 以下にある、
対象プラットフォーム用の make file の断片を見て (あるいは作って) ください。
このファイルでは、たとえば以下のように、共通的に使うツールの名前を定義しています。</p>
<pre class="programlisting">
.if exists(/usr/bin/bzcat)
TOOLS_PLATFORM.bzcat?=          /usr/bin/bzcat
.elif exists(/usr/bin/bzip2)
TOOLS_PLATFORM.bzcat?=          /usr/bin/bzip2 -cd
.endif

TOOLS_PLATFORM.true?=           true                    # shell builtin
</pre>
</div>
<div class="sect1" title="18.4. ツールに関する質問">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="tools.questions"></a>18.4. ツールに関する質問</h2></div></div></div>
<div class="qandaset" title="Frequently Asked Questions">
<a name="id52017748"></a><dl>
<dt>18.4.1. <a href="#tools.new">新しいツールを追加する方法は?</a>
</dt>
<dt>18.4.2. <a href="#tools.listall">利用可能なツールの全一覧を見る方法は
	?</a>
</dt>
<dt>18.4.3. <a href="#tools.used">あるパッケージの構築に使われているツールの全一覧を見る方法は?
	sed が使われているかどうかを知りたいんだけど。</a>
</dt>
</dl>
<table border="0" width="100%" summary="Q and A Set">
<col align="left" width="1%">
<col>
<tbody>
<tr class="question" title="18.4.1.">
<td align="left" valign="top">
<a name="tools.new"></a><a name="id52017751"></a><p><b>18.4.1.</b></p>
</td>
<td align="left" valign="top"><p>新しいツールを追加する方法は?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p>TODO</p></td>
</tr>
<tr class="question" title="18.4.2.">
<td align="left" valign="top">
<a name="tools.listall"></a><a name="id52017760"></a><p><b>18.4.2.</b></p>
</td>
<td align="left" valign="top"><p>利用可能なツールの全一覧を見る方法は
	?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p>TODO</p></td>
</tr>
<tr class="question" title="18.4.3.">
<td align="left" valign="top">
<a name="tools.used"></a><a name="id52017769"></a><p><b>18.4.3.</b></p>
</td>
<td align="left" valign="top"><p>あるパッケージの構築に使われているツールの全一覧を見る方法は?
	sed が使われているかどうかを知りたいんだけど。</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p>今のところ、できません。 (TODO: が、
	できるようにしたいと考えています。)</p></td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="chapter" title="Chapter 19. パッケージを動くようにする">
<div class="titlepage"><div><div><h2 class="title">
<a name="fixes"></a>Chapter 19. パッケージを動くようにする</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#general-operation">19.1. 一般的な操作</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#portability-of-packages">19.1.1. パッケージの移植性</a></span></dt>
<dt><span class="sect2"><a href="#pulling-vars-from-etc-mk.conf">19.1.2. <code class="filename">mk.conf</code> から利用者が設定可能な変数を捕まえる方法</a></span></dt>
<dt><span class="sect2"><a href="#user-interaction">19.1.3. ユーザーとの対話</a></span></dt>
<dt><span class="sect2"><a href="#handling-licenses">19.1.4. ライセンスの処理</a></span></dt>
<dt><span class="sect2"><a href="#restricted-packages">19.1.5. 制限つきパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#dependencies">19.1.6. 依存性の処理</a></span></dt>
<dt><span class="sect2"><a href="#conflicts">19.1.7. 他のパッケージとの衝突の処理</a></span></dt>
<dt><span class="sect2"><a href="#not-building-packages">19.1.8. 構築することができない、あるいはすべきでないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#undeletable-packages">19.1.9. 一旦インストールしたら削除すべきでないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#security-handling">19.1.10. セキュリティー問題を持つパッケージへの対処</a></span></dt>
<dt><span class="sect2"><a href="#bumping-pkgrevision">19.1.11. 既存パッケージ修正時に、バージョンを上げるにはどうするか</a></span></dt>
<dt><span class="sect2"><a href="#fixes.subst">19.1.12. パッケージのファイル中の各種テキストを置換する (SUBST の枠組)</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.fetch">19.2. <span class="emphasis"><em>fetch</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#no-plain-download">19.2.1. distfileのダウンロードが単純にできないパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#modified-distfiles-same-name">19.2.2. '古い'名前のまま更新されたdistfileの取り扱い</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.configure">19.3. <span class="emphasis"><em>configure</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#fixes.libtool">19.3.1. 共有ライブラリー - libtool</a></span></dt>
<dt><span class="sect2"><a href="#using-libtool">19.3.2. すでにlibtoolをサポートしているGNUパッケージでlibtoolを使う</a></span></dt>
<dt><span class="sect2"><a href="#autoconf-automake">19.3.3. GNU Autoconf/Automake</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#programming-languages">19.4. プログラミング言語</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#basic-programming-languages">19.4.1. C, C++ および Fortran</a></span></dt>
<dt><span class="sect2"><a href="#java-programming-language">19.4.2. Java</a></span></dt>
<dt><span class="sect2"><a href="#perl-scripts">19.4.3. perl スクリプトを含むパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#other-programming-languages">19.4.4. 他のプログラミング言語</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.build">19.5. <span class="emphasis"><em>build</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#fixes.build.cpp">19.5.1. C および C++ のコードの条件つきコンパイル</a></span></dt>
<dt><span class="sect2"><a href="#compiler-bugs">19.5.2. コンパイラーのバグへの対処方法</a></span></dt>
<dt><span class="sect2"><a href="#undefined-reference">19.5.3. undefined reference to <span class="quote">“<span class="quote">...</span>”</span></a></span></dt>
<dt><span class="sect2"><a href="#out-of-memory">19.5.4. メモリーが不足する</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#fixes.install">19.6. <span class="emphasis"><em>install</em></span> 相での問題を修正する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#install-scripts">19.6.1. 必要なディレクトリーを作成する</a></span></dt>
<dt><span class="sect2"><a href="#where-to-install-documentation">19.6.2. ドキュメンテーションのインストール場所</a></span></dt>
<dt><span class="sect2"><a href="#installing-score-files">19.6.3. 最高得点ファイルをインストールする</a></span></dt>
<dt><span class="sect2"><a href="#destdir-support">19.6.4. パッケージを DESTDIR に対応させる</a></span></dt>
<dt><span class="sect2"><a href="#hardcoded-paths">19.6.5. その他のインタープリターへのパスがハードコードされているパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#perl-modules">19.6.6. perl モジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#faq.info-files">19.6.7. infoファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#manpages">19.6.8. マニュアルページをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#gconf-data-files">19.6.9. GConf のデータファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#scrollkeeper-data-files">19.6.10. scrollkeeper/rarian のデータファイルをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#x11-fonts">19.6.11. X11 のフォントをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#gtk2-modules">19.6.12. GTK2 のモジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#sgml-xml-data">19.6.13. SGML または XML のデータをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#mime-database">19.6.14. MIME データベースの拡張をインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#intltool">19.6.15. intltool を使うパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#startup-scripts">19.6.16. 起動スクリプトをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#tex-packages">19.6.17. TeX モジュールをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#emulation-packages">19.6.18. エミュレーションによるバイナリーの実行に対応したパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#hicolor-theme">19.6.19. ハイカラーテーマのアイコンをインストールするパッケージ</a></span></dt>
<dt><span class="sect2"><a href="#desktop-files">19.6.20. デスクトップファイルをインストールするパッケージ</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#punting">19.7. パッケージに問題があるという印をつける</a></span></dt>
</dl>
</div>
<div class="sect1" title="19.1. 一般的な操作">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="general-operation"></a>19.1. 一般的な操作</h2></div></div></div>
<div class="sect2" title="19.1.1. パッケージの移植性">
<div class="titlepage"><div><div><h3 class="title">
<a name="portability-of-packages"></a>19.1.1. パッケージの移植性</h3></div></div></div>
<p>pkgsrc の目玉の一つは、多くのプラットフォームで動作することです。
    そのため、pkgsrc のパッケージの移植性をできるかぎり高めることが重要になります。
    本章では、pkgsrc の作業に際して、
    注意が必要となる具体的な事項を説明します。</p>
</div>
<div class="sect2" title="19.1.2. mk.conf から利用者が設定可能な変数を捕まえる方法">
<div class="titlepage"><div><div><h3 class="title">
<a name="pulling-vars-from-etc-mk.conf"></a>19.1.2. <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> から利用者が設定可能な変数を捕まえる方法</h3></div></div></div>
<p>pkgsrc の利用者は、<code class="varname">MAKECONF</code>
    によって参照されるファイル (標準では <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>)
    でいくつかの変数を上書きして、pkgsrc の設定をすることができます。
    このような変数を <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> のプリプロセッサーディレクティブ
    (たとえば <code class="literal">.if</code> や
    <code class="literal">.for</code>) の内部で使いたい場合は、
    利用者の設定が読み込まれる場所より前で
    <code class="filename">../../mk/bsd.prefs.mk</code> をインクルードする必要があります。</p>
<p>しかし、変数によっては、
    まだ定義されていない変数への参照を含んでいることがあるために、
    <code class="filename">../../mk/bsd.prefs.mk</code>
    をインクルードした後では完全に定義することができないものがあります。
    シェルコマンドの場合は、変数の実態はマクロであり、
    使われるときにしか展開されないので、このことは問題にはなりません。
    ただし、前述したプリプロセッサーディレクティブの内部や、
    依存性を記した行 (<code class="literal">target: dependencies</code> のような形式の行)
    においては、読み込み時に変数が展開されます。</p>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>各変数が読み込み時に使用可能か、
    実行時にのみ使用可能かを網羅した一覧は、現在のところありませんが、
    準備をしているところです。</p>
</div>
</div>
<div class="sect2" title="19.1.3. ユーザーとの対話">
<div class="titlepage"><div><div><h3 class="title">
<a name="user-interaction"></a>19.1.3. ユーザーとの対話</h3></div></div></div>
<p>時々、パッケージがユーザーとの対話を必要とする場合がありますが、
    そのような状況は何通りもありえます:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>distfile の取得時に、パッケージによっては、
	ユーザー名とパスワードの入力や web ページ上のライセンスへの同意のような、
	利用者の対話を必要とするものがあります。</p></li>
<li class="listitem"><p>distfile の展開時に、
	パッケージによってはパスワードを要求することがあります。</p></li>
<li class="listitem"><p>パッケージの構築前の設定の補助</p></li>
<li class="listitem"><p>構築過程の最中の補助</p></li>
<li class="listitem"><p>パッケージのインストール中の補助</p></li>
</ul></div>
<p>どの段階で対話が必要になるかをpkgsrcの機構に知らせるため、
    <code class="varname">INTERACTIVE_STAGE</code> 定義が用意されており、
    パッケージの<code class="filename">Makefile</code>で定義します。
    たとえば以下のようにします。</p>
<pre class="programlisting">
INTERACTIVE_STAGE=      build
    </pre>
<p>複数の段階を指定することもできます:</p>
<pre class="programlisting">
INTERACTIVE_STAGE=      configure install
    </pre>
<p>利用者は、<code class="varname">BATCH</code> 変数を設定して、
    この定義がおこなわれているパッケージをとばすことができます。</p>
</div>
<div class="sect2" title="19.1.4. ライセンスの処理">
<div class="titlepage"><div><div><h3 class="title">
<a name="handling-licenses"></a>19.1.4. ライセンスの処理</h3></div></div></div>
<p>ソフトウェアの作者は、
    そのソフトウェアをどのようなライセンスのもとでコピーすることができるかを、定めることができます。
    これは著作権法にもとづくことであって、ライセンス選択の理由は
    pkgsrc システムの範疇外です。pkgsrc システムでは、
    ライセンスのなかには、従うことに不服だったり、
    従うことが困難あるいは不可能だったりする利用者がいるようなライセンスがたくさんあることを認識しています。
    Free Software Foundation ではいくつかのライセンスに対して、
    それが「自由」なライセンスであると表明していますし、
    Open Source Initiative では「オープンソース」を定義しています。
    pkgsrc では、ライセンスが「自由」あるいは「オープンソース」であるといった目印をパッケージにつけたりはしないという方針をとっています。
    ただし、これらの定義にあてはまらないライセンスをもつパッケージには、
    ライセンスについて記した目印がついています。
    なお、ライセンスでコピーを認めていないパッケージは、
    明らかに、「自由」にも「オープンソース」にも該当しません。</p>
<p>「自由」でも「オープンソース」でもないパッケージについては、
    構築してよいということを、個々のライセンスについて利用者が pkgsrc に指定しておかない限り、
    pkgsrc はパッケージを構築しません。
    なお、このドキュメンテーションでは、「ライセンスに同意する」
    ("accepted the license") という言いまわしを避けています。
    pkgsrc システムは、単に、
    フリーでないライセンスのソフトウェアを誤って構築してしまうことがないようにする仕組みを提供しているだけです。
    判断や責任は、利用者に委ねています。
    (現在のところ、バイナリーパッケージのインストールは、
    この仕組みの対象外です。これはバグです。)</p>
<p>BSD ライセンスと GPL のパッケージだけをインストールし、
    それ以外はインストールしたくない、ということがあるかもしれません。
    標準状態では、フリーなライセンスが
    <code class="varname">ACCEPTABLE_LICENSES</code> 変数に列挙されています。
    <code class="varname">ACCEPTABLE_LICENSES</code> 変数を
    "+=" ではなく "=" を使って設定すれば、
    どのライセンスを許容するかを利用者が上書きできます。
    標準状態で許容されているライセンスは以下のとおりです。
    </p>
<pre class="programlisting">
    public-domain
    gnu-gpl-v2 gnu-lgpl-v2
    gnu-gpl-v3 gnu-lgpl-v3
    original-bsd modified-bsd
    x11
    apache-2.0
    cddl-1.0
    open-font-license
    </pre>
<p>
    </p>
<p>ライセンスの目印の仕組みは、パッケージの構築、インストール、
    および使用にまつわる著作権関連の問題を処理するためのものであって、
    再配布にまつわる問題 (<code class="varname">RESTRICTED</code> および
    <code class="varname">NO_SRC_ON_FTP</code> などを参照) のためのものではありません。
    再配布に制限のあるパッケージには、
    これらの変数を使って再配布に制限があることを示す必要があります。</p>
<p>パッケージのコピーが特殊なライセンスのもとで認められていることを示すには、
    そのライセンスを
    <code class="filename">pkgsrc/licenses</code> に置いたうえで、
    <code class="varname">LICENSE</code> 変数をライセンスを特定する文字列に設定します。
    たとえば、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/graphics/xv/README.html" target="_top"><code class="filename">graphics/xv</code></a> では以下のようになります。</p>
<pre class="programlisting">
LICENSE=        xv-license
    </pre>
<p>構築しようとすると、利用者はそのパッケージに適用されているライセンスが
    <code class="varname">ACCEPTABLE_LICENSES</code>
    変数に設定されていないことを知らされます。</p>
<pre class="programlisting">
<code class="prompt">%</code> <strong class="userinput"><code>make</code></strong>
===&gt; xv-3.10anb9 has an unacceptable license: xv-license.
===&gt;     To view the license, enter "/usr/bin/make show-license".
===&gt;     To indicate acceptance, add this line to your /etc/mk.conf:
===&gt;     ACCEPTABLE_LICENSES+=xv-license
*** Error code 1
    </pre>
<p>ライセンス自体は <span class="command"><strong>make
    show-license</strong></span> すると見ることができます。
    そのライセンスのものを構築してよい場合は、
    pkgsrc が今後はそのライセンスを理由に構築をやめないように、
    上の表示中で指示されている行を <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>
    に追加することができます。</p>
<pre class="programlisting">
ACCEPTABLE_LICENSES+=xv-license
    </pre>
<p>新しいライセンスが適用されているパッケージを追加する場合、
    表示用のライセンスのテキストを <code class="filename">pkgsrc/licenses</code>
    に追加します。既知のライセンスの一覧は、
    このディレクトリーで見ることができます。</p>
<p>ライセンスが (整形以外で) 変更された場合は、
    必ず、新しいライセンスの名前を以前のものと別の名前にします (たとえば、
    バージョン番号があればそれを、なければ日付を末尾につけるなど)。
    これは、前バージョンのライセンスのもとにあるプログラムを構築することを
    pkgsrc に指示している利用者が、
    新しいライセンスのもとにあるプログラムを構築しないようにするためです。
    もっと高度な点でいうと、
    pkgsrc はライセンスの相当性を評価しません。
    すなわち、個々のライセンスのテキストを、二組織のいずれかが
    (「自由」あるいは「オープンソース」であると) 認めているかどうかという、
    機械的な検査をしているだけなのです。</p>
<p><code class="varname">LICENSE=shareware</code> や、
    <code class="varname">LICENSE=no-commercial-use</code> のような言いまわしは、
    ライセンスの文面を特定できないので、
    使わないことになりました。
    また、このような言いまわしを使った場合の別の問題として、
    利用者が pkgsrc に対して、同じ目印のついた複数のパッケージのうち、
    ひとつのパッケージだけは構築を続行するが、
    それ以外のパッケージは構築を続行しない、
    といった指定ができなくなるというものもあります。</p>
</div>
<div class="sect2" title="19.1.5. 制限つきパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="restricted-packages"></a>19.1.5. 制限つきパッケージ</h3></div></div></div>
<p>ライセンスによっては、ソフトウェアの再配布方法に制限があります。
    パッケージが「自由」あるいは「オープンソース」でない限りは、
    ライセンスの目印が必要なので、制限のあるパッケージにはすべてライセンスの目印がついているはずです。
    その制限について記述しておくと、パッケージのツールは、
    自動的に制限されたこと (たとえばバイナリーパッケージを FTP サイトに置くこと)
    を控えたりすることができます。</p>
<p>ソース (distfile) とバイナリーそれぞれについて、
    置いていけないのが FTP サイトか CD-ROM かの組み合わせで、
    4 種類の制限を表現することができます。どのライセンスでも、
    これが厳密な文言となっていることはほとんどないことや、
    フリーでない各ライセンスはお互いに異なる傾向があることから、
    pkgsrc では FTP と CD-ROM を定義しています。
    pkgsrc では、"FTP" を、ソースやバイナリーのファイルを、
    インターネット上で料金を払わずに利用できるようにしてはいけない、
    という意味で使います。
    pkgsrc では、"CD-ROM" を、ソースやバイナリーを、
    配布料金をとるような何らかの種類の媒体に、
    他のソースやバイナリーパッケージと同梱して利用できるようにすることはできない、
    という意味で使います。
    </p>
<p>このような
    制限を表現するため、パッケージシステムでは以下のような制限を設定で
    きる5個のmake変数を定義しています:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p><code class="varname">RESTRICTED</code></p>
<p>なにか制限がある場合は常に、(制限の種類にかかわらず)この変数を設定します。
	この変数を、その制限の理由を含む文字列に設定してください。
	制限を理解しなければならない人は、ライセンスを読む必要がありますし、
	おそらく法的な助言も必要だと考えなければなりません。</p>
</li>
<li class="listitem">
<p><code class="varname">NO_BIN_ON_CDROM</code></p>
<p>バイナリーを、配布料金を取れるようにして、
	他のバイナリーパッケージとともにCD-ROMに収録することができません。
	そのような場合は常に、この変数を<code class="varname">${RESTRICTED}</code>に設定
	してください。</p>
</li>
<li class="listitem">
<p><code class="varname">NO_BIN_ON_FTP</code></p>
<p>バイナリーを、インターネット上で料金を払わずに利用できるようにすることができません。
	そのような場合は常に、この変数を
	<code class="varname">${RESTRICTED}</code>に設定してください。
	この変数を設定すると、バイナリーパッケージは
	ftp.NetBSD.org に置かれません。</p>
</li>
<li class="listitem">
<p><code class="varname">NO_SRC_ON_CDROM</code></p>
<p>distfileを、料金を取れるようにして、
	他のdistfileとともにCD-ROMに収録することができません。
	そのような場合は、この変数を
	<code class="varname">${RESTRICTED}</code>に設定してください。</p>
</li>
<li class="listitem">
<p><code class="varname">NO_SRC_ON_FTP</code></p>
<p>distfileを、インターネット上で料金を払わずに利用できるようにすることができません。
	そのような場合は、この変数を
	<code class="varname">${RESTRICTED}</code>に設定してください。
	この変数を設定すると、distfile は
	ftp.NetBSD.org にミラーされません。</p>
</li>
</ul></div>
</div>
<div class="sect2" title="19.1.6. 依存性の処理">
<div class="titlepage"><div><div><h3 class="title">
<a name="dependencies"></a>19.1.6. 依存性の処理</h3></div></div></div>
<p>パッケージは他のパッケージに依存するかもしれません。そして、この依存性を定
    義するためのいろいろな方法があります。pkgsrc は、<code class="filename">buildlink3.mk</code>を使った依存関
    係 (依存性の処理用としては、こちらが望ましい方法です。
    この方法では以下の各変数を使っています。
    さらなる情報は<a class="xref" href="#buildlink" title="Chapter 14. buildlink 方法論">Chapter 14, <i>buildlink 方法論</i></a>を参照してください)
    のほか、
    <code class="varname">BUILD_DEPENDS</code> および <code class="varname">DEPENDS</code> 定義、
    <code class="varname">USE_TOOLS</code> 定義をサポートしています。</p>
<p>両変数の基本的な差異は、以下の通りです: <code class="varname">DEPENDS</code>定義では、
    その依存性がバイナリーパッケージ内に記録されるので、
    後でバイナリーパッケージをインストールする時に依存性が呼び出されます。
    一方、<code class="varname">BUILD_DEPENDS</code>定義ではバイナリーパッケージにそのような記録はされず、
    パッケージの構築に際して依存性があることが示されているだけです。</p>
<p>つまり、あるパッケージが必要となるのが構築時だけである場合、そのパッケージ
    は<code class="varname">BUILD_DEPENDS</code>として書きます。</p>
<p><code class="varname">BUILD_DEPENDS</code>および
    <code class="varname">DEPENDS</code>定義の書式は以下の通りです:</p>
<pre class="programlisting">
&lt;pre-req-package-name&gt;:../../&lt;category&gt;/&lt;pre-req-package&gt;
    </pre>
<p>なお、この<span class="quote">“<span class="quote">pre-req-package-name</span>”</span> のバージョン番号には、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_info+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_info</span>(1)</span></a> で説明され
    ている各ワイルドカードを含めることができます。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
<p>パッケージを構築または実行するために他のパッケージのバイナリーやライブラリーが必要で、
	そのパッケージに <code class="filename">buildlink3.mk</code> ファイルがある場合は、
	それを使ってください。</p>
<pre class="programlisting">
.include "../../graphics/jpeg/buildlink3.mk"
	</pre>
</li>
<li class="listitem">
<p>パッケージを構築するために、他のパッケージのバイナリーが必要な場合は、
	<code class="varname">BUILD_DEPENDS</code> 定義を使ってください。</p>
<pre class="programlisting">
BUILD_DEPENDS+= scons-[0-9]*:../../devel/scons
	</pre>
</li>
<li class="listitem"><p>パッケージがリンクのためのライブラリーを必要とし、
	そのパッケージに <code class="filename">buildlink3.mk</code> ファイルがない場合は、
	<code class="filename">buildlink3.mk</code> ファイルを作ってください。
	<code class="varname">DEPENDS</code> を使うと、
	インクルードファイルやライブラリーをコンパイラーから隠してしまうので、このような場合には不適切です。</p></li>
<li class="listitem">
<p>パッケージを実行するために、いくつかの実行可能ファイルが必要であり、かつ
	<code class="filename">buildlink3.mk</code> ファイルが存在しない場合は、
	<code class="varname">DEPENDS</code>変数を使ってください。<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/print/lyx/README.html" target="_top"><code class="filename">print/lyx</code></a>パッケージを実行する時には、
	teTeXパッケージ由来のlatex のバイナリーが実行可能でなければなりません。これ
	は、以下のように指定します。</p>
<pre class="programlisting">
DEPENDS+=        teTeX-[0-9]*:../../print/teTeX
	</pre>
</li>
<li class="listitem">
<p>パッケージ依存関係にはワイルドカードを使うことができます。
	ワイルドカード依存関係は、バイナリーパッケージを作る時には保持されること
	に注意してください。依存関係はバイナリーパッケージのインストール時にチェッ
	クされ、パターンにマッチするパッケージが使われます。ワイルドカード依存関係
	は、注意を払って使うよう気を付けてください。</p>
<p><span class="quote">“<span class="quote">tk-postgresql</span>”</span>が<span class="quote">“<span class="quote">tk-*</span>”</span>という
	<code class="varname">DEPENDS</code>にマッチするなどの曖昧なマッチの可能性を排除
	するため、<span class="quote">“<span class="quote">-*</span>”</span>ではなく
	<span class="quote">“<span class="quote">-[0-9]*</span>”</span>を使うことをおすすめします。</p>
<p>ワイルドカードは、
	依存パッケージがあるバージョン以上でないと構築できないことを指定するのにも使えます。</p>
<pre class="programlisting">
DEPENDS+=       ImageMagick&gt;=6.0:../../graphics/ImageMagick
	</pre>
<p>以上のように書いた場合、このパッケージは ImageMagick のバージョン 6.0
	以上を使って構築されることを意味します。このような形式の依存関係は、たとえば、
	依存先のコマンドラインオプションが変更された場合にでも、構築できることを保証することができます。</p>
<p>あるバージョン以上のライブラリーに依存させる必要がある場合は、
	the pkgsrc guide の buildlink の節をご覧ください。</p>
<p>セキュリティー上の修正があった場合は、
	パッケージ脆弱性ファイルを更新してください。
	さらなる情報は、<a class="xref" href="#security-handling" title="19.1.10. セキュリティー問題を持つパッケージへの対処">Section 19.1.10, “セキュリティー問題を持つパッケージへの対処”</a>を参照してください。</p>
</li>
</ol></div>
<p>パッケージの構築用に別のパッケージに含まれるファイルが必要な場合は、
    関連する配布ファイルを
    <code class="varname">DISTFILES</code> に追加して、
    必要なファイルが自動的に展開されるようにします。例としては <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/print/ghostscript/README.html" target="_top"><code class="filename">print/ghostscript</code></a> パッケージをご覧ください。
    (このパッケージは、
    構築の際に jpeg のソースがソースの状態で存在することに依存しています。)</p>
</div>
<div class="sect2" title="19.1.7. 他のパッケージとの衝突の処理">
<div class="titlepage"><div><div><h3 class="title">
<a name="conflicts"></a>19.1.7. 他のパッケージとの衝突の処理</h3></div></div></div>
<p>パッケージは、すでにインストール済みの別のパッケージと衝突する可能性があり
    ます。例えば、パッケージが、pkgsrcの中の別のパッケージと同じファイルをイン
    ストールするような場合です。</p>
<p>この場合、衝突するパッケージ(バージョン文字列を含む)のリストをスペースで区
    切って<code class="varname">CONFLICTS</code>にセットすることができます。</p>
<p>例えば、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/x11/Xaw3d/README.html" target="_top"><code class="filename">x11/Xaw3d</code></a>
    および<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/x11/Xaw-Xpm/README.html" target="_top"><code class="filename">x11/Xaw-Xpm</code></a>は同じ共有ライブラリーをイ
    ンストールします。したがって、<code class="filename">pkgsrc/x11/Xaw3d/Makefile</code>に以下のような設定を
    おこなってください。</p>
<pre class="programlisting">
CONFLICTS=      Xaw-Xpm-[0-9]*
    </pre>
<p>そして、<code class="filename">pkgsrc/x11/Xaw-Xpm/Makefile</code>には以下の設定が必要です。</p>
<pre class="programlisting">
CONFLICTS=      Xaw3d-[0-9]*
    </pre>
<p>パッケージは、名前のプレフィックスが同じで、異なるバージョン文字列をもつ別
    のパッケージと自動的に衝突します。例えば<span class="quote">“<span class="quote">Xaw3d-1.5</span>”</span>は、古いバージョンの
    <span class="quote">“<span class="quote">Xaw3d-1.3</span>”</span>と衝突するでしょう。</p>
</div>
<div class="sect2" title="19.1.8. 構築することができない、あるいはすべきでないパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="not-building-packages"></a>19.1.8. 構築することができない、あるいはすべきでないパッケージ</h3></div></div></div>
<p>環境によってはパッケージを構築しないよう指示するような理由がいくつかありま
    す。パッケージが、ほとんどのプラットフォームで構築および実行できる場合は、
    <code class="varname">NOT_FOR_PLATFORM</code>として例外を記述します。逆に、パッケージが一部のプラットフォー
    ムでしか構築および実行できない場合は、<code class="varname">ONLY_FOR_PLATFORM</code>を設定します。
    <code class="varname">ONLY_FOR_PLATFORM</code> と
    <code class="varname">NOT_FOR_PLATFORM</code> の値はいずれも、OS triples
    (OS-version-platform) であり、
    グロブ形式のワイルドカードを使うことができます。</p>
<p>パッケージのなかには、あるオペレーティングシステムの特定のバージョンに強く依存するものがあります。
    たとえば、LKM や <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/sysutils/lsof/README.html" target="_top"><code class="filename">sysutils/lsof</code></a> などです。
    このようなバイナリーパッケージは、同じ OS の別バージョンと後方互換ではないので、
    FTP サーバーでは対象バージョン専用のディレクトリーにアップロードするようにします。
    <code class="varname">OSVERSION_SPECIFIC</code> を <span class="quote">“<span class="quote">yes</span>”</span> に設定して、
    パッケージに印をつけてください。この変数は、現在のところ、
    パッケージシステム内部のどこでも使われませんが、
    将来は使われることになるかもしれません。</p>
<p>パッケー
    ジをとばすべき場合(たとえば、そのパッケージが提供する機能が、すでにシステム
    で提供されている場合)は、
    <code class="varname">PKG_SKIP_REASON</code>にそのことを説明するメッセージを設
    定します。必要な条件が満たされていないせいでパッケージの構築が失敗するであ
    ろう場合は、<code class="varname">PKG_FAIL_REASON</code>にそのことを説明するメッセージを設定します。</p>
</div>
<div class="sect2" title="19.1.9. 一旦インストールしたら削除すべきでないパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="undeletable-packages"></a>19.1.9. 一旦インストールしたら削除すべきでないパッケージ</h3></div></div></div>
<p>あるパッケージを、一旦インストールしたら削除できないようにするためには、
    そのパッケージの Makefile で <code class="varname">PKG_PRESERVE</code>
    定義を設定します。この定義を設定した
    pkgsrc エントリーから作られたバイナリーパッケージには、その旨が記録されます。
    <span class="quote">“<span class="quote">preserved</span>”</span> 付きのパッケージは、
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_delete+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_delete</span>(1)</span></a> を使っても、
    <span class="quote">“<span class="quote">-f</span>”</span> オプションを付けない限りは削除されません。</p>
</div>
<div class="sect2" title="19.1.10. セキュリティー問題を持つパッケージへの対処">
<div class="titlepage"><div><div><h3 class="title">
<a name="security-handling"></a>19.1.10. セキュリティー問題を持つパッケージへの対処</h3></div></div></div>
<p>脆弱性が発見された場合、そのことを
    <code class="filename">localsrc/security/advisories/pkg-vulnerabilities</code>に記載してcommitしてくださ
    い。このファイルを commit した後、同じディレクトリーで <span class="command"><strong>make upload</strong></span>
    して、ftp.NetBSD.org 上のファイルを更新してください。</p>
<p>脆弱性の修正を、パッチの適用によっておこなった場合は、修正後に
    <code class="varname">PKGREVISION</code> を上げます (もちろん、問題の修正を、
    新しくリリースされたソフトウェアを使っておこなった場合は、
    これは必要ありません)。</p>
<p>また、修正を安定版 pkgsrc 枝に適用したほうがよい場合は、
    pullup 要求を提出してください。</p>
<p>ftp.NetBSD.org 上にすでに置かれているバイナリーパッケージは、
    週次の cron ジョブによって半自動的に対処されます。</p>
</div>
<div class="sect2" title="19.1.11. 既存パッケージ修正時に、バージョンを上げるにはどうするか">
<div class="titlepage"><div><div><h3 class="title">
<a name="bumping-pkgrevision"></a>19.1.11. 既存パッケージ修正時に、バージョンを上げるにはどうするか</h3></div></div></div>
<p>既存のパッケージに修正を加えたときに、<code class="varname">PKGNAME</code>のバージョン番号を変えると便利
    な場合があります。元の作者による将来のバージョンと衝突しないようにするため、
    <code class="varname">PKGREVISION=1</code> (2, ...)を設定して、パッケージのバージョンに
    <span class="quote">“<span class="quote">nb1</span>”</span>, <span class="quote">“<span class="quote">nb2</span>”</span>, ...
    という接尾辞をつけることができます。この<span class="quote">“<span class="quote">nb</span>”</span>は、パッケージのツール群からは<span class="quote">“<span class="quote">.</span>”</span>と
    同様の扱いを受けます。たとえば、</p>
<pre class="programlisting">
DISTNAME=       foo-17.42
PKGREVISION=    9
    </pre>
<p>とすると、<code class="varname">PKGNAME</code>は<span class="quote">“<span class="quote">foo-17.42nb9</span>”</span>になります。
    たとえば <code class="varname">DIST_SUBDIR</code> の設定用などに、
    <code class="varname">PKGNAME</code> に接尾辞 <span class="quote">“<span class="quote">nbX</span>”</span> がつかない、
    元の値を使いたい場合は、<code class="varname">PKGNAME_NOREV</code> を使います。</p>
<p>このパッケージの新しいリリース版が出た際には、
    <code class="varname">PKGREVISION</code>は消してください。
    たとえば、上で例示したパッケージの新しいマイナーリリースに際しては、以下の
    ようにします。</p>
<pre class="programlisting">
DISTNAME=       foo-17.43
    </pre>
<p>バイナリーパッケージに対して自明でない変化をおよぼす場合は、すべて、
    <code class="varname">PKGREVISION</code> を上げるようにします。
    <code class="varname">PKGREVISION</code> を上げないと、
    変更前のバージョンをインストールしている人が、
    そのパッケージが古くなったことを知るすべがなくなってしまいます。
    したがって、<code class="varname">PKGREVISION</code> を上げない変更とは、本質的に
    「誰もアップグレードする必要のない自明な変更」ということであり、
    これが <code class="varname">PKGREVISION</code> を上げるべきか否かを大雑把に判断する方法です。
    <code class="varname">PKGREVISION</code> を上げる意味のない変更には、たとえば以下のようなものがあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">HOMEPAGE</code>,
      <code class="varname">MAINTAINER</code>, <code class="varname">OWNER</code>
      や、Makefile 中のコメントの変更。</p></li>
<li class="listitem"><p>
      構築変数の変更で、作成されるバイナリーパッケージに変化がない場合。</p></li>
<li class="listitem"><p>
      <code class="filename">DESCR</code> の変更。</p></li>
<li class="listitem"><p>
      <code class="varname">PKG_OPTIONS</code> の追加で、標準のオプションに変化がない場合。</p></li>
</ul></div>
<p><code class="varname">PKGREVISION</code> を上げる価値のある変更には、
    たとえば以下のようなものがあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>
      セキュリティーの修正</p></li>
<li class="listitem"><p>
      パッチファイルの変更または追加</p></li>
<li class="listitem"><p>
      <code class="filename">PLIST</code> の変更</p></li>
<li class="listitem"><p>依存性の変更や、依存先パッケージの改称。</p></li>
</ul></div>
<p>依存するパッケージの ABI が変更された場合にも、
    PKGREVISION を上げる必要があります。</p>
</div>
<div class="sect2" title="19.1.12. パッケージのファイル中の各種テキストを置換する (SUBST の枠組)">
<div class="titlepage"><div><div><h3 class="title">
<a name="fixes.subst"></a>19.1.12. パッケージのファイル中の各種テキストを置換する (SUBST の枠組)</h3></div></div></div>
<p>複数のファイルに含まれる同じテキストを置換したい場合や、
    テキストの置換方法を変化させたい場合には、パッチだけでは実現できません。
    そこで SUBST の枠組の出番です。この枠組では、
    ファイル内のテキストを置換するために簡単に使えるインターフェースを用意しています。
    たとえば以下のように使います。</p>
<pre class="programlisting">
SUBST_CLASSES+=                 fix-paths
SUBST_STAGE.fix-paths=          pre-configure
SUBST_MESSAGE.fix-paths=        Fixing absolute paths.
SUBST_FILES.fix-paths=          src/*.c
SUBST_FILES.fix-paths+=         scripts/*.sh
SUBST_SED.fix-paths=            -e 's,"/usr/local,"${PREFIX},g'
SUBST_SED.fix-paths+=           -e 's,"/var/log,"${VARBASE}/log,g'
    </pre>
<p><code class="varname">SUBST_CLASSES</code> は、ここで定義する
    SUBST の塊を区別するための識別子を並べたリストです。
    SUBST の枠組は pkgsrc で多用されているので、この変数には常に
    <code class="literal">+=</code> 演算子を使うことが重要です。
    そうしないと、一部の置換がおこなわれなくなることがあります。</p>
<p>各 SUBST の塊の残りの変数は、
    最初の行の識別子 (この例では <code class="literal">fix-paths</code>)
    を使ってパラメーター化されています。
    これらは、関数呼び出しの引数とみなすことができます。</p>
<p><code class="varname">SUBST_STAGE.*</code> は、
    この置換をどの期におこなうかを指定します。
    実際に使われるものは限られていますが、相の名前と
    <code class="literal">pre-</code>, <code class="literal">do-</code>,
    <code class="literal">post-</code> のあらゆる組合せを使うことができます。
    もっともよく使われるのは <code class="literal">post-patch</code> と
    <code class="literal">pre-configure</code> です。このふたつのうち、
    <code class="literal">pre-configure</code> を使うと、
    <span class="command"><strong>bmake patch</strong></span> を実行することで、
    パッチを適用したほかは一切変更されていない状態にすることができるため、
    こちらのほうが好まれます。このことは、
    新しいパッチを作成するためにパッケージのデバッグをする際に、
    特に便利です。これと同様に、<code class="literal">pre-install</code>
    よりも <code class="literal">post-build</code> のほうが好まれます。
    これは、一般的に install 相は極力簡素なものにするほうがよいからです。
    <code class="literal">post-build</code> を使った場合、
    後にインストールされるものと同じファイルが作業ディレクトリーにできあがるので、
    正しく置換がおこなわれたかを確認することができます。</p>
<p><code class="varname">SUBST_MESSAGE.*</code> は、
    置換がおこなわれる直前に表示するテキストで、省略可能です。</p>
<p><code class="varname">SUBST_FILES.*</code> は、置換の対象となるファイルを、
    シェルのグロブパターンで指定したものを並べたリストです。
    このパターンは、<code class="varname">WRKSRC</code>
    ディレクトリーからの相対位置として解釈されます。</p>
<p><code class="varname">SUBST_SED.*</code> は置換の内容を
    <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?sed+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">sed</span>(1)</span></a> への引数の形で指定したものを並べたリストです。
    各 sed コマンドの前には <code class="literal">-e</code> をつけて、
    SUBST の塊全体が一様に見えるようにします。</p>
<p>以上のほかにも変数がいくつかありますが、
    それらはほとんど使われないものなので、
    <code class="filename">mk/subst.mk</code> ファイル内でのみ文書化されています。</p>
</div>
</div>
<div class="sect1" title="19.2. fetch 相での問題を修正する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="fixes.fetch"></a>19.2. <span class="emphasis"><em>fetch</em></span> 相での問題を修正する</h2></div></div></div>
<div class="sect2" title="19.2.1. distfileのダウンロードが単純にできないパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="no-plain-download"></a>19.2.1. distfileのダウンロードが単純にできないパッケージ</h3></div></div></div>
<p>動的なURLからダウンロードする必要がある場合は、
    <code class="varname">DYNAMIC_MASTER_SITES</code>
    を設定す
    ることができます。すると、<span class="command"><strong>make fetch</strong></span>は、ダウンロードすべき各ファイルを引
    数として<code class="filename">files/getsite.sh</code>を呼び出します。このスクリプトは、ファイルをダウン
    ロードするディレクトリーのURLを出力することが前提となっています。
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/graphics/ns-cult3d/README.html" target="_top"><code class="filename">graphics/ns-cult3d</code></a>が、
    この使い方の例となっています。</p>
<p>パスワード用に個人情報の登録が必要だったり、ソースに代金を払う必要があった
    り、その他もろもろの理由により、ダウンロードが自動化できない場合は、
    <code class="varname">FETCH_MESSAGE</code> を、
    構築中止前にユーザーに表示する説明文を行ごとに並べたリストに設定することができます。
    たとえば以下のようにします。</p>
<pre class="programlisting">
FETCH_MESSAGE=  "Please download the files"
FETCH_MESSAGE+= "    "${DISTFILES:Q}
FETCH_MESSAGE+= "manually from "${MASTER_SITES:Q}"."
    </pre>
</div>
<div class="sect2" title="19.2.2. '古い'名前のまま更新されたdistfileの取り扱い">
<div class="titlepage"><div><div><h3 class="title">
<a name="modified-distfiles-same-name"></a>19.2.2. '古い'名前のまま更新されたdistfileの取り扱い</h3></div></div></div>
<p>時々、ソフトウェアパッケージの作者がソフトウェアのリリース後に変更を加え、
    変更後のdistfileを、バージョン番号を変えずに公開することがあります。このと
    き、pkgsrcにそのパッケージがすでに入っていると、チェックサムが一致しない
    ことになります。distfileの更新が意図されたものであって、
    トロイの木馬などが仕込まれたのではないことを確認するため、
    新しい distfile の内容と変更前の古い distfile の内容と比較してください。
    新旧の distfile を比較したことと、何が変わったのかを、
    commit メッセージに含めてください。
    確認後、この問題の正しい回避策は、<code class="varname">DIST_SUBDIR</code>
    を一意な (普通は <code class="varname">PKGNAME_NOREV</code>
    にもとづく) ディレクトリー名に設定することです。
    これを設定すると、このパッケージの <code class="varname">DISTFILES</code> と
    <code class="varname">PATCHFILES</code> はすべて、
    distfiles ディレクトリー以下の、設定した名前のサブディレクトリーに置かれます。
    (詳細は、<a class="xref" href="#bumping-pkgrevision" title="19.1.11. 既存パッケージ修正時に、バージョンを上げるにはどうするか">Section 19.1.11, “既存パッケージ修正時に、バージョンを上げるにはどうするか”</a>をご覧ください。)
    この問題がよく起きる場合は、ディレクトリー名に
    <code class="varname">PKGNAME</code> を使ったり
    (これにより <code class="filename">nbX</code> サフィックスが含まれる)、
    <code class="varname">${PKGNAME_NOREV}-YYYYMMDD</code> のように日付を付けたりすることができます。
    設定後は、<code class="filename">distinfo</code> ファイルを作り直すのを忘れないでください。
    このファイルでは、ファイル名のなかに <code class="varname">DIST_SUBDIR</code>
    パスが含まれているからです。
    この変更によって、インストールされるパッケージが以前のものと異なるものになる場合は、
    PKGREVISION も上げます。
    さらに、パッケージの正当な作者にメールを出して、
    リリース後に、ファイル名を変えずに
    distfile の内容を変えるのはよろしくないやり方だと伝えてください。</p>
</div>
</div>
<div class="sect1" title="19.3. configure 相での問題を修正する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="fixes.configure"></a>19.3. <span class="emphasis"><em>configure</em></span> 相での問題を修正する</h2></div></div></div>
<div class="sect2" title="19.3.1. 共有ライブラリー - libtool">
<div class="titlepage"><div><div><h3 class="title">
<a name="fixes.libtool"></a>19.3.1. 共有ライブラリー - libtool</h3></div></div></div>
<p>pkgsrcはさまざまな種類のマシンをサポートします。それらはa.outとELFのような
    異なるオブジェクトフォーマットを使い、共有ライブラリー、ダイナミックローディ
    ングの有無すらも異なります。これに対応するためにコマンドそのもの、およびオ
    プションがコンパイラー、リンカーなどに渡される必要があります。すべてのマシ
    ンで正しく動作させることは非常にむずかしく、テストのためにすべてのマシンを
    持っていない場合は特にそうでしょう。
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/libtool/README.html" target="_top"><code class="filename">devel/libtool</code></a>パッケージはこれを助けます。
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/libtool/README.html" target="_top"><code class="filename">devel/libtool</code></a>はプラットフォームによらずに、
    ソースファイルから、静的、動的なライブラリー両方を構築する方法
    を<span class="quote">“<span class="quote">知って</span>”</span>いるからです。</p>
<p>以下に、libtoolをパッケージで使用するための7つの手順を記述します。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p><code class="varname">USE_LIBTOOL=yes</code>をパッケージのMakefileへ追加します。</p></li>
<li class="listitem"><p>ライブラリーオブジェクトのために、<span class="quote">“<span class="quote">${LIBTOOL} --mode=compile ${CC}</span>”</span>を<span class="quote">“<span class="quote">${CC}</span>”</span>
	に設定します。ライブラリーが、提供されたMakefileだけを使用して構築される
	のであれば、<code class="varname">CC</code>の定義にこれを追加するだけです。このコマンドひとつだけで、
	PICと非PICのライブラリーオブジェクトを作成します。したがって、共有ライブ
	ラリーとそうでないライブラリーの構築規則を別々に記述する必要はありません。</p></li>
<li class="listitem">
<p>ライブラリーのリンクのための<span class="quote">“<span class="quote">ar</span>”</span>、<span class="quote">“<span class="quote">ranlib</span>”</span>、<span class="quote">“<span class="quote">ld -Bshareable</span>”</span>コマン
	ドを削除してください。そしてその代わりに以下のコマンドを使用してください。</p>
<pre class="programlisting">
${LIBTOOL} --mode=link \
    ${CC} -o ${.TARGET:.a=.la} \
        ${OBJS:.o=.lo} \
        -rpath ${PREFIX}/lib \
        -version-info major:minor
	</pre>
<p>ライブラリーの拡張子は<code class="filename">.la</code>に、オブジェクトの拡張子は
	<code class="filename">.lo</code>に変更されることに
	注意してください。<code class="varname">OBJS</code>
	を必要に応じて変更してください。このコマンドは、必
	要なものすべて、
	<code class="filename">.a</code>、<code class="filename">.so.major.minor</code>、
	そしてELFのシンボリックリンク(必要
	なら)を自動的にカレントディレクトリーに作成します。特に、メジャー番号と
	マイナー番号がゼロの場合は、<span class="quote">“<span class="quote">-version-info</span>”</span>をかならず含めるようにしてくだ
	さい。そうしないとlibtoolは共有ライブラリーのバージョンを取り除きます。</p>
<p>libtool のマニュアルより:</p>
<pre class="programlisting">
libtool のライブラリーのバージョンは、以下の三つの整数で表されます。

CURRENT
このライブラリーが実装しているインターフェース番号のうち最新のもの。

REVISION
CURRENT インターフェースの実装番号。

AGE
このライブラリーが実装しているインターフェースの最新のものと最古のものの間の差。
すなわち、このライブラリーが実装しているのは、
`CURRENT - AGE' から `CURRENT' までの番号の範囲にある、
すべてのインターフェース番号です。

二つのライブラリーの CURRENT と AGE 番号がいずれも同じ場合、
ダイナミックリンカーは REVISION 番号が大きいほうのライブラリーを選びます。
	</pre>
<p>また、<span class="quote">“<span class="quote">-release</span>”</span>オプションは、ある一つの場合に限って、a.outとELF(シンボ
	リックリンクを除く)との間で異なる結果をもたらします。
	<span class="quote">“<span class="quote">libfoo-release.so.<span class="emphasis"><em>x</em></span>.<span class="emphasis"><em>y</em></span></span>”</span>
	の形式のELFライブラリーは、a.outプラットフォーム上
	では
	<span class="quote">“<span class="quote">libfoo.so.<span class="emphasis"><em>x</em></span>.<span class="emphasis"><em>y</em></span></span>”</span>
	のシンボリックリンクを持ちます。これは自動的に処理され
	ます。</p>
<p><span class="quote">“<span class="quote">-rpath引数</span>”</span>は構築されたライブラリーのインストール先ディレクトリーです。</p>
<p><code class="filename">PLIST</code>には、
	<code class="filename">.la</code> ファイルだけを含めます。
	これ以外のファイルは自動的に追加されます。</p>
</li>
<li class="listitem">
<p>共有オブジェクト(<code class="filename">.so</code>)ファイル(すなわち、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?dlopen+3+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">dlopen</span>(3)</span></a>でロードされるファイル
	であって、共有ライブラリーでは*ありません*)のリンク時には、ファイルにバー
	ジョンが加えられないようにするため、<span class="quote">“<span class="quote">-module -avoid-version</span>”</span>を使ってくだ
	さい。</p>
<p><code class="filename">PLIST</code>ファイルには<code class="filename">foo.so</code>
	の一覧が加わります。</p>
</li>
<li class="listitem">
<p>インストールする<span class="emphasis"><em>前</em></span>のライブラリーに依存するプログラムをリンクする時に、
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?cc+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">cc</span>(1)</span></a>か<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?ld+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">ld</span>(1)</span></a>の前に
	<span class="quote">“<span class="quote">${LIBTOOL} --mode=link</span>”</span>を書いてください。このコマンドは、正
	しいライブラリー(静的、または共有)を見つけます。ただし、libtoolを使う時
	には-Lオプションで相対パスを指定すること(<span class="quote">“<span class="quote">-L../somelib</span>”</span>のように)ができない
	ことに注意してください。引数として<code class="filename">.la</code>ファイルを使うように修正しなければ
	なりません。例えば、</p>
<pre class="programlisting">
${LIBTOOL} --mode=link ${CC} -o someprog -L../somelib -lsomelib
	</pre>
<p>は、以下のように変更する必要があります。</p>
<pre class="programlisting">
${LIBTOOL} --mode=link ${CC} -o <em class="replaceable"><code>someprog</code></em> <em class="replaceable"><code>../somelib/somelib.la</code></em>
	</pre>
<p>これで、ライブラリーを正しく扱う事ができます。</p>
</li>
<li class="listitem">
<p>ライブラリーをインストールするときに、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?install+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">install</span>(1)</span></a>
	あるいは<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?cp+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">cp</span>(1)</span></a>コマンドの前に
	<span class="quote">“<span class="quote">${LIBTOOL} --mode=install</span>”</span>を書いて下さい。そしてライブラリーの名前を
	<code class="filename">.la</code>に変えてください。例えば、以下のように書く必要があります。</p>
<pre class="programlisting">
${LIBTOOL} --mode=install ${BSD_INSTALL_LIB} ${SOMELIB:.a=.la} ${PREFIX}/lib
	</pre>
<p>これは、静的リンクのための<code class="filename">.a</code>、共有ライブラリー、必要なシンボリックリンク
	をインストールし、<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?ldconfig+8+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">ldconfig</span>(8)</span></a>を実行します。</p>
</li>
<li class="listitem"><p><code class="filename">PLIST</code>には、
	<code class="filename">.la</code> ファイルだけを含めます
	(これは、以前のものから変わった点です)。</p></li>
</ol></div>
</div>
<div class="sect2" title="19.3.2. すでにlibtoolをサポートしているGNUパッケージでlibtoolを使う">
<div class="titlepage"><div><div><h3 class="title">
<a name="using-libtool"></a>19.3.2. すでにlibtoolをサポートしているGNUパッケージでlibtoolを使う</h3></div></div></div>
<p><code class="varname">USE_LIBTOOL=yes</code> をパッケージの
    Makefile に追加します。こうするとほとんどの場合、パッケージ固有の
    libtool を無視します。古い libtool を使っているパッケージでは、
    libtool はdo-configureターゲットでltconfigスクリプトにより作られます。<span class="command"><strong>make
    configure; find work*/ -name libtool</strong></span>
    のようにして、libtool スクリプトの場所を確認することができます。</p>
<p><code class="varname">LIBTOOL_OVERRIDE</code> で、どの libtool
    スクリプトを無視するかを、<code class="varname">WRKSRC</code> からの相対位置で指定します。
    指定しなかった場合、<span class="quote">“<span class="quote">libtool */libtool
    */*/libtool</span>”</span> に設定されますので、パッケージ固有の libtool
    スクリプトの場所がこのいずれとも異なる場合は、適宜設定してください。</p>
<p>静的ライブラリー <code class="filename">*.a</code>
    の構築やインストールが必要ない場合は、かわりに
    <code class="varname">SHLIBTOOL_OVERRIDE</code> を使います。</p>
<p>パッケージが動的共有オブジェクトのロードに、libtool (libltdl)のプラットフォー
    ム独立なライブラリーを使う場合は、
    devel/libltdl/buildlink3.mkをインクルードしてください。</p>
<p>パッケージによっては、環境により動作や構築ができなくなるような、正しくない
    libtoolの使い方をしているものがあります。ありがちな間違いは以下のようなもの
    です。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p>実行形式やライブラリーで、共有オブジェクト(-module)を依存ライブラリーと
	してインクルードする。このこと自体は、以下の二つのうちいずれかが行なわれ
	ている場合は、問題になりません。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>その共有オブジェクトが正しく命名されている。すなわち、
	    <code class="filename">libfoo.la</code>ではなく
	    <code class="filename">libfoo.la</code>となっている。</p></li>
<li class="listitem"><p>-dlopenオプションが実行形式のリンク時に使われている。</p></li>
</ol></div>
</li>
<li class="listitem"><p>ルーチンの初期化を適切に呼ばずにlibltdlを使う。関数lt_dlinit()を呼んで、
	マクロ
	<code class="varname">LTDL_SET_PRELOADED_SYMBOLS</code>を実行形式にインクルードするようにしましょ
	う。</p></li>
</ul></div>
</div>
<div class="sect2" title="19.3.3. GNU Autoconf/Automake">
<div class="titlepage"><div><div><h3 class="title">
<a name="autoconf-automake"></a>19.3.3. GNU Autoconf/Automake</h3></div></div></div>
<p>パッケージが、configureスクリプトやmakefileの雛型Makefile.inを再生成するた
    めにGNU autoconfまたはautomakeを実行する必要がある場合、これらの実行は
    pre-configureターゲットでおこないます。</p>
<p>autoconfのみを必要とするパッケージでは以下のようになります:</p>
<pre class="programlisting">
AUTOCONF_REQD=  2.50            # if default version is not good enough
USE_TOOLS+=     autoconf        # use "autoconf213" for autoconf-2.13
...

pre-configure:
        cd ${WRKSRC} &amp;&amp; autoconf

...
    </pre>
<p>また、automakeとautoconfを必要とするパッケージでは以下のようになります:</p>
<pre class="programlisting">
AUTOMAKE_REQD=  1.7.1           # if default version is not good enough
USE_TOOLS+=     automake        # use "automake14" for automake-1.4
...

pre-configure:
        set -e; cd ${WRKSRC}; \
        aclocal; autoheader; automake -a --foreign -i; autoconf

...
    </pre>
<p>GNU Automake を使うパッケージは、ほぼ確実に
    GNU Make を必要とします。</p>
<p>生成されたファイルに対して、configureプロセスがさらに変更を加える時がありま
    すが、この時には構築プロセスが一連のautomakeの手順を再実行しようとします。
    configureの段階でさまざまなファイルに手を加えると、この挙動は止められます。
    この挙動が問題が起こす場合は、そのパッケージのMakefileで
    <code class="varname">AUTOMAKE_OVERRIDE=NO</code>を設定することができます。</p>
</div>
</div>
<div class="sect1" title="19.4. プログラミング言語">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="programming-languages"></a>19.4. プログラミング言語</h2></div></div></div>
<div class="sect2" title="19.4.1. C, C++ および Fortran">
<div class="titlepage"><div><div><h3 class="title">
<a name="basic-programming-languages"></a>19.4.1. C, C++ および Fortran</h3></div></div></div>
<p>C, C++ および Fortran 言語用のコンパイラーは、
    NetBSD の基本システムに附属しています。標準では、
    pkgsrc はパッケージが C で書かれていると仮定し、それ以外のコンパイラーをすべて隠します
    (ラッパーの枠組による。<a class="xref" href="#buildlink" title="Chapter 14. buildlink 方法論">Chapter 14, <i>buildlink 方法論</i></a>参照)。</p>
<p>パッケージがどの言語のコンパイラーを必要としているかを表すには、
    <code class="varname">USE_LANGUAGES</code> 変数を設定します。使うことのできる値は、
    現在のところ、<span class="quote">“<span class="quote">c</span>”</span>, <span class="quote">“<span class="quote">c++</span>”</span>,
    <span class="quote">“<span class="quote">fortran</span>”</span> (および、これらの任意の組合せ) です。標準では
    <span class="quote">“<span class="quote">c</span>”</span> になります。GNU の configure スクリプトを使うパッケージでは、
    C++ で書かれているものであっても、通常は configure 相で
    C コンパイラーを必要とします。</p>
</div>
<div class="sect2" title="19.4.2. Java">
<div class="titlepage"><div><div><h3 class="title">
<a name="java-programming-language"></a>19.4.2. Java</h3></div></div></div>
<p>プログラムが Java で書かれている場合は、pkgsrc における Java
    の枠組を使います。パッケージは
    <code class="filename">../../mk/java-vm.mk</code> をインクルードする必要があります。
    この Makefile の断片は、以下の変数を用意してくれます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">USE_JAVA</code> は、
      JDK への依存性が追加されるかどうかを定義します。
      <code class="varname">USE_JAVA</code> が <span class="quote">“<span class="quote">run</span>”</span> に設定された場合は、
      JDK への実行時依存性があるだけです。標準では <span class="quote">“<span class="quote">yes</span>”</span> となり、
      この場合は JDK への構築時依存性も追加されます。</p></li>
<li class="listitem"><p>パッケージが Java2 の実装を必要とすることを表すため、
      <code class="varname">USE_JAVA2</code> を設定します。この変数が対応している値は、
      <span class="quote">“<span class="quote">yes</span>”</span>, <span class="quote">“<span class="quote">1.4</span>”</span>,
      <span class="quote">“<span class="quote">1.5</span>”</span> です。 <span class="quote">“<span class="quote">yes</span>”</span> は任意の Java2
      の実装を受け入れます。<span class="quote">“<span class="quote">1.4</span>”</span> はバージョン 1.4 以上を要求し、
      <span class="quote">“<span class="quote">1.5</span>”</span> はバージョン 1.5 以上のみを受け入れます。
      この変数は標準では設定されません。</p></li>
<li class="listitem"><p><code class="varname">PKG_JAVA_HOME</code> は、
      依存している Java 実装のランタイムの場所を自動的に設定するものです。
      <code class="varname">JAVA_HOME</code> 変数の定義が必要なプログラムでは、
      この変数に適切な値を設定するために使うことができます。
      </p></li>
</ul></div>
</div>
<div class="sect2" title="19.4.3. perl スクリプトを含むパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="perl-scripts"></a>19.4.3. perl スクリプトを含むパッケージ</h3></div></div></div>
<p>perl スクリプトがパッケージに含まれる場合は、
    <code class="varname">USE_TOOLS</code> 変数に <span class="quote">“<span class="quote">perl</span>”</span> を追加し、
    適切なインタープリターへのパスが設定されるようにするために
    <code class="varname">REPLACE_PERL</code> を設定します。
    <code class="varname">REPLACE_PERL</code> の値には、パスを調節する対象のスクリプトを
    <code class="varname">WRKSRC</code> からの相対位置として並べたリストを含めるようにします。
    対象のスクリプト内に現れる <code class="filename">*/bin/perl</code> はすべて、
    perl の実行ファイルへのフルパスに置き換えられます。</p>
<p>特定のバージョンの perl が必要な場合は、
    <code class="varname">PERL5_REQD</code> 変数をバージョン番号に設定します。
    標準では <span class="quote">“<span class="quote">5.0</span>”</span> になります。</p>
<p>perl モジュールの扱いについては、
    <a class="xref" href="#perl-modules" title="19.6.6. perl モジュールをインストールするパッケージ">Section 19.6.6, “perl モジュールをインストールするパッケージ”</a>をご覧ください。</p>
</div>
<div class="sect2" title="19.4.4. 他のプログラミング言語">
<div class="titlepage"><div><div><h3 class="title">
<a name="other-programming-languages"></a>19.4.4. 他のプログラミング言語</h3></div></div></div>
<p>現在のところ、pkgsrc では、他のプログラミング言語に対する特別な扱いはありません。
    その言語のコンパイラーのパッケージに
    <code class="filename">buildlink3.mk</code> ファイルがある場合は、
    このファイルをインクルードします。このファイルがない場合は、
    適切なコンパイラーのパッケージへの (構築時) 依存性を追加するだけです。</p>
</div>
</div>
<div class="sect1" title="19.5. build 相での問題を修正する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="fixes.build"></a>19.5. <span class="emphasis"><em>build</em></span> 相での問題を修正する</h2></div></div></div>
<p>パッケージ構築時に最もよくある障害は、
	プラットフォームによっては必要なヘッダーファイル、関数やライブラリーがなかったり、
	あるいは、ライブラリーで提供される関数がパッケージ作者の考えているものと違っていたりするものです。
	そのようなことを回避するために、ほとんどの場合は、
	ない関数を使わないようにしたり、代替の関数を提供したりするように
	ソースコードを書き換えることができます。</p>
<div class="sect2" title="19.5.1. C および C++ のコードの条件つきコンパイル">
<div class="titlepage"><div><div><h3 class="title">
<a name="fixes.build.cpp"></a>19.5.1. C および C++ のコードの条件つきコンパイル</h3></div></div></div>
<p>パッケージに最初から GNU configure スクリプトが附属している場合は、
	構築の障害の修正方法としては、コードを変更せずに configure
	スクリプトを変更するのが望ましい方法です。configure スクリプトが附属しない場合は、
	コンパイル対象のオペレーティングシステムやハードウェアアーキテクチャーに応じて必要なマクロを定義している
	C プリプロセッサーを役立てることができます。このマクロは、たとえば
	<code class="varname">#if defined(__i386)</code> のようにして調べることができます。
	ほとんどすべてのオペレーティングシステム、ハードウェアアーキテクチャー、
	およびコンパイラーには、独自のマクロがあります。
	たとえば、<code class="varname">__GNUC__</code>,
	<code class="varname">__i386__</code>, <code class="varname">__NetBSD__</code>
	の各マクロがすべて定義されている場合は、i386 互換 CPU 上の NetBSD を使っていることと、
	コンパイラーが GCC であることがわかります。</p>
<p>以下に列挙するハードウェアおよびオペレーティングシステム用のマクロは、
	使っているコンパイラーに依存します。
	たとえば、Solaris 上でコードを条件付きコンパイルしたい場合、
	<code class="varname">__sun__</code> は
	SunPro コンパイラーでは定義されていないので使ってはいけません。
	かわりに <code class="varname">__sun</code> を使います。</p>
<div class="sect3" title="19.5.1.1. オペレーティングシステムを特定するための C プリプロセッサーマクロ">
<div class="titlepage"><div><div><h4 class="title">
<a name="fixes.build.cpp.os"></a>19.5.1.1. オペレーティングシステムを特定するための C プリプロセッサーマクロ</h4></div></div></div>
<p>4.4 BSD から派生したシステムとそれ以外のシステムを
        見分けるには、以下のコードを使うようにしてください。</p>
<pre class="programlisting">
#include &lt;sys/param.h&gt;
#if (defined(BSD) &amp;&amp; BSD &gt;= 199306)
/* BSD-specific code goes here */
#else
/* non-BSD-specific code goes here */
#endif
</pre>
<p>これでは十分正確でない場合は、
	以下のマクロを検査することもできます。</p>
<pre class="programlisting">
FreeBSD     __FreeBSD__
DragonFly   __DragonFly__
Interix     __INTERIX
IRIX        __sgi (TODO: 出典の確認)
Linux       linux, __linux, __linux__
NetBSD      __NetBSD__
OpenBSD     __OpenBSD__
Solaris     sun, __sun
</pre>
</div>
<div class="sect3" title="19.5.1.2. ハードウェアアーキテクチャーを特定するための C プリプロセッサーマクロ">
<div class="titlepage"><div><div><h4 class="title">
<a name="fixes.build.cpp.arch"></a>19.5.1.2. ハードウェアアーキテクチャーを特定するための C プリプロセッサーマクロ</h4></div></div></div>
<pre class="programlisting">
i386        i386, __i386, __i386__
MIPS        __mips
SPARC       sparc, __sparc
</pre>
</div>
<div class="sect3" title="19.5.1.3. コンパイラーを特定するための C プリプロセッサーマクロ">
<div class="titlepage"><div><div><h4 class="title">
<a name="fixes.build.cpp.compiler"></a>19.5.1.3. コンパイラーを特定するための C プリプロセッサーマクロ</h4></div></div></div>
<pre class="programlisting">
GCC         __GNUC__ (メジャーバージョン), __GNUC_MINOR__
MIPSpro     _COMPILER_VERSION (MIPSpro 7.41 なら 0x741)
SunPro      __SUNPRO_C (Sun C 5.7 なら 0x570)
SunPro C++  __SUNPRO_CC (Sun C++ 5.8 なら 0x580)
</pre>
</div>
</div>
<div class="sect2" title="19.5.2. コンパイラーのバグへの対処方法">
<div class="titlepage"><div><div><h3 class="title">
<a name="compiler-bugs"></a>19.5.2. コンパイラーのバグへの対処方法</h3></div></div></div>
<p>ソースファイルのなかには、コンパイラーのバージョンとアーキテクチャーの組合
        せによって、また、ほとんどの場合は、最適化を有効にしたことも関係して、コン
        パイラーのバグを発現させるものがあります。よくある症状は、gccの内部エラーや、
        ファイルのコンパイルが完了しないというものです。</p>
<p>たいていは、回避策として、<code class="varname">MACHINE_ARCH</code>
        とコンパイラーのバージョンを確認し、
        問題のあるファイル・<code class="varname">MACHINE_ARCH</code>・コンパイラーの組合せに対して最適化を無効に
	し、そのことを<code class="filename">pkgsrc/doc/HACKS</code>に文書化しておくことが必要となります。
	このファイルに多くの例が載っているので、参照してください。</p>
</div>
<div class="sect2" title="19.5.3. undefined reference to “...”">
<div class="titlepage"><div><div><h3 class="title">
<a name="undefined-reference"></a>19.5.3. undefined reference to <span class="quote">“<span class="quote">...</span>”</span>
</h3></div></div></div>
<p>このエラーメッセージは、しばしば、
	パッケージが必要な共有ライブラリーにリンクしていないことを表します。
	以下の関数は、このエラーメッセージを何度も出すことがわかっているものです。</p>
<div class="informaltable">
<a name="undefined-reference-functions"></a><table border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead><tr>
<th>関数</th>
<th>ライブラリー</th>
<th>影響のあるプラットフォーム</th>
</tr></thead>
<tbody>
<tr>
<td>accept, bind, connect</td>
<td>-lsocket</td>
<td>Solaris</td>
</tr>
<tr>
<td>crypt</td>
<td>-lcrypt</td>
<td>DragonFly, NetBSD</td>
</tr>
<tr>
<td>dlopen, dlsym</td>
<td>-ldl</td>
<td>Linux</td>
</tr>
<tr>
<td>gethost*</td>
<td>-lnsl</td>
<td>Solaris</td>
</tr>
<tr>
<td>inet_aton</td>
<td>-lresolv</td>
<td>Solaris</td>
</tr>
<tr>
<td>nanosleep, sem_*, timer_*</td>
<td>-lrt</td>
<td>Solaris</td>
</tr>
<tr>
<td>openpty</td>
<td>-lutil</td>
<td>Linux</td>
</tr>
</tbody>
</table>
</div>
<p>このようなリンカーのエラーの修正は、多くの場合、
    パッケージの <code class="filename">Makefile</code> に
    <code class="literal">LIBS.<em class="replaceable"><code>OperatingSystem</code></em>+=
    -l<em class="replaceable"><code>foo</code></em></code> を追加してから <span class="command"><strong>bmake clean;
    bmake</strong></span> を実行すれば十分です。</p>
<div class="sect3" title="19.5.3.1. 特殊な問題: SunPro コンパイラー">
<div class="titlepage"><div><div><h4 class="title">
<a name="undefined-reference-sunpro"></a>19.5.3.1. 特殊な問題: SunPro コンパイラー</h4></div></div></div>
<p>SunPro コンパイラーを使っている場合は、別の問題の可能性があります。
このコンパイラーは、以下のようなコードを処理することができません。</p>
<pre class="programlisting">
extern int extern_func(int);

static inline int
inline_func(int x)
{
        return extern_func(x);
}

int main(void)
{
        return 0;
}
</pre>
<p>ここからは、<code class="function">inline_func</code> 関数がたとえ使われていなくても、
この関数用のコードが生成され、そのコードから
<code class="function">extern_func</code> が参照されますが、この参照は通常は解決することができません。
この問題を解決するため、
パッケージに関数のインライン化を無効化するよう指示してみることができます。</p>
</div>
</div>
<div class="sect2" title="19.5.4. メモリーが不足する">
<div class="titlepage"><div><div><h3 class="title">
<a name="out-of-memory"></a>19.5.4. メモリーが不足する</h3></div></div></div>
<p>時には、コンパイラーの実行でオペレーティングシステム固有のソフトリミットに達するために、
    パッケージの構築に失敗することがあります。
    <code class="varname">UNLIMIT_RESOURCES</code> 変数を設定して、
    pkgsrc に資源の制限を解除するよう伝えることができます。
    現在のところ、使うことのできる値は、
    <span class="quote">“<span class="quote">datasize</span>”</span> と <span class="quote">“<span class="quote">stacksize</span>”</span> (あるいは両方) です。
    この変数を設定すると、シェル組み込みの <span class="command"><strong>ulimit</strong></span>
    コマンドを実行した場合と同様に、それぞれ、
    データセグメントのサイズとスタックのサイズの上限を、
    ハードリミットまで引き上げます。</p>
</div>
</div>
<div class="sect1" title="19.6. install 相での問題を修正する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="fixes.install"></a>19.6. <span class="emphasis"><em>install</em></span> 相での問題を修正する</h2></div></div></div>
<div class="sect2" title="19.6.1. 必要なディレクトリーを作成する">
<div class="titlepage"><div><div><h3 class="title">
<a name="install-scripts"></a>19.6.1. 必要なディレクトリーを作成する</h3></div></div></div>
<p>一部のプラットフォームに附属する BSD 互換の <span class="command"><strong>install</strong></span> は、
    一度に複数のディレクトリーを作成することができません。
    このため、 <code class="literal">${INSTALL_*_DIR}</code> を使うときは、以下のようにします。</p>
<pre class="programlisting">
${INSTALL_DATA_DIR} ${PREFIX}/dir1
${INSTALL_DATA_DIR} ${PREFIX}/dir2
    </pre>
<p>こうするかわりに、単に <span class="quote">“<span class="quote"><code class="literal">dir1
    dir2</code></span>”</span> を
    <code class="varname">INSTALLATION_DIRS</code> 変数に追加するという方法もあります。
    こうすると、適切な処理が自動的におこなわれます。</p>
</div>
<div class="sect2" title="19.6.2. ドキュメンテーションのインストール場所">
<div class="titlepage"><div><div><h3 class="title">
<a name="where-to-install-documentation"></a>19.6.2. ドキュメンテーションのインストール場所</h3></div></div></div>
<p>一般的には、ドキュメンテーションは
    <code class="filename">${PREFIX}/share/doc/${PKGBASE}</code> または
    <code class="filename">${PREFIX}/share/doc/${PKGNAME}</code> (後者は、
    パッケージのバージョン番号を含んでいます) 以下にインストールします。</p>
<p>GNU autoconf を使っている最近のパッケージの多くは、
    HTML のドキュメンテーションのインストール先を、
    <span class="quote">“<span class="quote">--with-html-dir</span>”</span> オプションを使って設定することができます。
    時には、このフラグを使わないとドキュメンテーションが
    <code class="filename">${PREFIX}/share/doc/html</code> や他の場所にインストールされるために、
    このフラグを使う必要があることがあります。</p>
<p>例外は、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/textproc/gtk-doc/README.html" target="_top"><code class="filename">textproc/gtk-doc</code></a> ツールによって生成される、
    ライブラリーの API のドキュメンテーションです。このドキュメンテーションは、
    専用のブラウザー (devhelp) から使うものであり、ブラウザーが標準で使う場所である
    <code class="filename">${PREFIX}/share/gtk-doc</code> に置くようにします。
    このようなドキュメンテーションは、ファイル名の末尾が
    <code class="filename">.devhelp</code> または
    <code class="filename">.devhelp2</code> であることから区別できます。
    (これらのファイルを
    <code class="filename">${PREFIX}/share/doc/${PKGBASE}</code> または
    <code class="filename">${PREFIX}/share/doc/${PKGNAME}</code>
    にインストールしても使うことができます。この場合、
    これらのディレクトリーの直下に
    <code class="filename">.devhelp*</code> ファイルを置く必要があり、
    サブディレクトリー階層を追加することはできません。通常は、
    <span class="quote">“<span class="quote">--with-html-dir=${PREFIX}/share/doc</span>”</span>
    を使えばそのようにすることができます。
    <code class="filename">${PREFIX}/share/gtk-doc</code>
    のほうが好ましいのですが。)</p>
</div>
<div class="sect2" title="19.6.3. 最高得点ファイルをインストールする">
<div class="titlepage"><div><div><h3 class="title">
<a name="installing-score-files"></a>19.6.3. 最高得点ファイルをインストールする</h3></div></div></div>
<p>パッケージによっては (ほとんどは games カテゴリーのもの)、
    システム上の各ユーザーが最高得点を記録できるように、
    得点ファイルをインストールします。これを実現するために、
    バイナリーは setgid してインストールし、得点ファイルは
    グループとオーナーのいずれかまたは両方を当該グループやオーナー
    (伝統的には "games" ユーザーおよびグループ) の所有とする必要があります。
    <code class="varname">SETGIDGAME</code>,
    <code class="varname">GAMEDATAMODE</code>, <code class="varname">GAMEGRP</code>,
    <code class="varname">GAMEMODE</code>, <code class="varname">GAMEOWN</code>
    の各変数でこの挙動を制御します。詳細は
    <code class="filename">mk/defaults/mk.conf</code> に書かれています。</p>
<p>なお、games に setgid されたインストールは、標準では有効になっていません。
    <code class="varname">SETGIDGAME=YES</code> を設定すると、
    これに応じて他の各変数が設定されます。</p>
<p>このため、パッケージではファイルの所有やアクセス許可属性を決してハードコードせずに、
    <code class="varname">INSTALL_GAME</code> および
    <code class="varname">INSTALL_GAME_DATA</code>
    の設定に応じて適切に設定されるようにします。</p>
</div>
<div class="sect2" title="19.6.4. パッケージを DESTDIR に対応させる">
<div class="titlepage"><div><div><h3 class="title">
<a name="destdir-support"></a>19.6.4. パッケージを DESTDIR に対応させる</h3></div></div></div>
<p>パッケージが <code class="varname">DESTDIR</code> に対応しているというのは、
    ファイルを最終的な置き場所にインストールせずに、
    足場となるディレクトリーにインストールするということです。
    その後、通常の方法でインストール可能なバイナリーパッケージが作成されます。
    この対応には、二つの方法があります。
    パッケージを root としてインストールする必要がある場合
    (<span class="quote">“<span class="quote">destdir</span>”</span>)と、root 以外のユーザーでインストール可能な場合
    (<span class="quote">“<span class="quote">user-destdir</span>”</span>) です。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PKG_DESTDIR_SUPPORT</code> を、
      <span class="quote">“<span class="quote">destdir</span>”</span> または <span class="quote">“<span class="quote">user-destdir</span>”</span> のいずれかに設定する必要があります。
      Makefile で bsd.prefs.mk をインクルードする場合、
      <code class="varname">PKG_DESTDIR_SUPPORT</code> は、
      インクルードの前に設定する必要があります。</p></li>
<li class="listitem"><p>すべてのインストール操作では、インストール先を
      <code class="filename">${DESTDIR}</code> から始まる場所にする必要があります。</p></li>
<li class="listitem"><p>automake は、たいていは、この DESTDIR に対して、
      自動的に対処します。自動化されていない処理や pre/post-install
      では、不適切に処理されることが多いので、修正してください。</p></li>
<li class="listitem"><p>ファイルが、特別な所有者や所有グループでインストールされる場合は、
      <code class="varname">SPECIAL_PERMS</code> を使ってください。</p></li>
<li class="listitem"><p>一般的に、各パッケージは、
      DESTDIR を使えるようにするために、
      <code class="varname">UNPRIVILEGED</code> に対応させるようにしてください。
</p></li>
</ul></div>
</div>
<div class="sect2" title="19.6.5. その他のインタープリターへのパスがハードコードされているパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="hardcoded-paths"></a>19.6.5. その他のインタープリターへのパスがハードコードされているパッケージ</h3></div></div></div>
<p>パッケージには perl 以外のインタープリターへのパスがハードコードされていることもあります。
      スクリプトのインタープリターへのフルパスを適切なものにするため、
      当該パッケージの <code class="filename">Makefile</code> で、
      以下のような定義をする必要があります
    (ここでは例として <span class="command"><strong>tclsh</strong></span> を使います)。</p>
<pre class="programlisting">
REPLACE_INTERPRETER+=   tcl
REPLACE.tcl.old=        .*/bin/tclsh
REPLACE.tcl.new=        ${PREFIX}/bin/tclsh
REPLACE_FILES.tcl=      # パスを修正する必要がある tcl スクリプトを列挙します
# REPLACE_PERL と同様に、${WRKSRC} からの相対位置とします
    </pre>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>2006 年 3 月より前は、この各変数は
    <code class="varname">_REPLACE.*</code> および
    <code class="varname">_REPLACE_FILES.*</code> という名前でした。</p>
</div>
</div>
<div class="sect2" title="19.6.6. perl モジュールをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="perl-modules"></a>19.6.6. perl モジュールをインストールするパッケージ</h3></div></div></div>
<p>perl5モジュールを提供するパッケージでは、MakefileにMakefileの断片
    <code class="filename">../../lang/perl5/module.mk</code>をインクルードしてください。このファイルには、perl5モ
    ジュール用の標準的なperlの構成をする<span class="command"><strong>do-configure</strong></span>ターゲットのほか、その構成
    を調整するためのさまざまなフックが含まれています。詳細は、このファイル中の
    コメントをご覧ください。</p>
<p>perl5 のモジュールがインストールされる場所は、構築プロセスで使われるperl の
    バージョンに応じて変わります。これを扱うために、pkgsrc は、
    インストールされた<code class="filename">.packlist</code>ファイル(ほとんどの perl5 モジュールが生成します)
    に列挙された各ファイルに対応する行を、<code class="filename">PLIST</code> に追加します。これは、packlist
    ファイルへのパスをスペースで区切ったリストを<code class="varname">PERL5_PACKLIST</code>として定義するこ
    とで行なわれるようになります。たとえば以下のように定義します。</p>
<pre class="programlisting">
PERL5_PACKLIST= ${PERL5_SITEARCH}/auto/Pg/.packlist
    </pre>
<p><code class="varname">PERL5_SITELIB</code>, <code class="varname">PERL5_SITEARCH</code>,
    <code class="varname">PERL5_ARCHLIB</code>の各変数は、perl5モジュールがイ
    ンストールされうる三つの場所を表すもので、packlistを持たないperl5パッケージ
    で使うことができます。この3変数の置換は、<code class="filename">PLIST</code>でもおこなわれます。</p>
</div>
<div class="sect2" title="19.6.7. infoファイルをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="faq.info-files"></a>19.6.7. infoファイルをインストールするパッケージ</h3></div></div></div>
<p>パッケージによっては、infoファイルをインストールしたり、<span class="quote">“<span class="quote">makeinfo</span>”</span>または
    <span class="quote">“<span class="quote">install-info</span>”</span>コマンドを使ったりします。
    このようなパッケージでは、パッケージの Makefile で
    <code class="varname">INFO_FILES</code> を定義するようにします。
    これを定義しておくと、info ファイルを
    Info ディレクトリーファイルに登録するために、<code class="filename">INSTALL</code> および
    <code class="filename">DEINSTALL</code> スクリプトが作られるようになります。
    info ファイルの登録用の <span class="quote">“<span class="quote">install-info</span>”</span> コマンドは、
    システム附属のものが使われるか、
    または、必要があればそれ用のパッケージが自動的に追加されて使われます。</p>
<p><code class="varname">PKGINFODIR</code> は
    <code class="filename">${PREFIX}</code> 以下のディレクトリーで、
    info ファイルが置かれる主な場所です。
    <code class="varname">PKGINFODIR</code> は標準では
    <span class="quote">“<span class="quote">info</span>”</span> となっており、利用者が上書きすることができます。</p>
<p>info ファイルは、そのパッケージの <code class="filename">PLIST</code>
    に列挙します。ただし、分割された
    info ファイルは列挙する必要はありません。</p>
<p>構築時に <span class="quote">“<span class="quote">makeinfo</span>”</span> コマンドが必要なパッケージは、
    Makefile で <code class="varname">USE_TOOLS</code> 変数に <span class="quote">“<span class="quote">makeinfo</span>”</span> を追加する必要があります。
    あるバージョン以上の<span class="quote">“<span class="quote">makeinfo</span>”</span>コマンドが必要な場合は、
    パッケージの <code class="filename">Makefile</code> で
    <code class="varname">TEXINFO_REQD</code> 変数を必要な最低バージョンに設定します。
    デフォルトでは、 3.12 が最低限必要なバージョンとなります。
    <span class="command"><strong>makeinfo</strong></span> コマンドがシステムにないか、
    最低限必要なバージョンを満たさない場合は、
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/devel/gtexinfo/README.html" target="_top"><code class="filename">devel/gtexinfo</code></a>
    パッケージへの構築時の依存関係が自動的に追加されます。</p>
<p>パッケージで提供されるソフトウェアの構築やインストールの過程では、
    <span class="command"><strong>install-info</strong></span> コマンドを使ってはいけません。
    info ファイルの登録は <code class="filename">INSTALL</code> スクリプトの仕事であって、
    適切な <span class="command"><strong>makeinfo</strong></span> コマンドを使う必要があるからです。</p>
<p>pkgsrc の基盤は、以上のことを実現するため、
    <code class="varname">PATH</code> のはじめのほうにあるディレクトリーに、
    <span class="command"><strong>install-info</strong></span> や <span class="command"><strong>makeinfo</strong></span>
    を上書きするスクリプトを作成します。</p>
<p><span class="command"><strong>install-info</strong></span> を上書きするスクリプトは、メッセージを記録すること以外、
    何の効果もありません。<span class="command"><strong>makeinfo</strong></span> を上書きするスクリプトは、
    メッセージを記録し、<code class="varname">TEXINFO_REQD</code>
    の値に従って、適切な <span class="command"><strong>makeinfo</strong></span> コマンドを実行するか、
    または異常終了します。</p>
</div>
<div class="sect2" title="19.6.8. マニュアルページをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="manpages"></a>19.6.8. マニュアルページをインストールするパッケージ</h3></div></div></div>
<p>マニュアルページをインストールするパッケージはすべて、
    マニュアルページを同じディレクトリー内にインストールして、
    マニュアルページを共通のひとつの場所から探せるようにします。
    pkgsrc では、この場所は
    <code class="literal">${PREFIX}/${PKGMANDIR}</code> であり、パッケージ内ではこの表記を使うようにします。
    <code class="varname">PKGMANDIR</code> の値は標準では
    <span class="quote">“<span class="quote"><code class="filename">man</code></span>”</span> です。これ以外によく使われる値は、
    <span class="quote">“<span class="quote"><code class="filename">share/man</code></span>”</span> です。</p>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p><code class="varname">PKGMANDIR</code> の独自設定には、
    完全には対応していません。</p>
</div>
<p><code class="filename">PLIST</code> ファイル内では、
    マニュアルページのファイルの最上層ディレクトリーを、
    単に <code class="filename">man/</code> と書くことができます。
    これは pkgsrc の枠組みが必要に応じて変換してくれます。
    これ以外の場所の場合は、正確な
    <code class="varname">PKGMANDIR</code> を使って書く必要があります。</p>
<p><code class="varname">GNU_CONFIGURE</code> が
    <span class="quote">“<span class="quote">yes</span>”</span> に設定されているパッケージでは、
    標準では
    <code class="filename">./configure</code>
    --mandir スイッチを使って、マニュアルページをどこにインストールするかを設定します。
    このパスは <code class="varname">GNU_CONFIGURE_MANDIR</code> で、
    標準では <code class="varname">${PREFIX}/${PKGMANDIR}</code> になります。</p>
<p>パッケージが <code class="varname">GNU_CONFIGURE</code> を使うが、
    --mandir は使わない場合は、<code class="varname">CONFIGURE_HAS_MANDIR</code> を
    <span class="quote">“<span class="quote">no</span>”</span> に設定することができます、
    また、<code class="filename">./configure</code>
    スクリプトが標準的ではない --mandir の使い方をする場合は、
    必要に応じて <code class="varname">GNU_CONFIGURE_MANDIR</code> を設定することができます。</p>
<p>圧縮したマニュアルページのインストールに関する情報は、
    <a class="xref" href="#manpage-compression" title="13.5. マニュアルページの圧縮">Section 13.5, “マニュアルページの圧縮”</a> をご覧ください。</p>
</div>
<div class="sect2" title="19.6.9. GConf のデータファイルをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="gconf-data-files"></a>19.6.9. GConf のデータファイルをインストールするパッケージ</h3></div></div></div>
<p>パッケージが、 GConf が使用する <code class="filename">.schemas</code> または
    <code class="filename">.entries</code> ファイルをインストールする場合は、
    これらが確実にデータベースに登録されるようにするために、
    いくつか特別な手順を踏む必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>GConf の <code class="filename">buildlink3.mk</code> ファイルではなく
	<code class="filename">../../devel/GConf/schemas.mk</code> をインクルードします。
	こうすると、インストールおよびアンインストール時に、 GConf
	のデータベースを再構築し、また、GConf のデータファイルのインストール場所を
	標準的な configure 引数を使ってパッケージに伝えてくれます。
	また、パッケージがデータベースに直接アクセスすることが一切できなくなります。</p></li>
<li class="listitem"><p>パッケージが
	<code class="filename">.schemas</code> ファイルを必ず
	<code class="filename">${PREFIX}/share/gconf/schemas</code> 以下にインストールするようにします。
	<code class="filename">${PREFIX}/etc</code> 以下にインストールするようになっている場合は、
	手作業でパッケージを修正する必要があります。</p></li>
<li class="listitem"><p>PLIST を確認し、etc/gconf ディレクトリー以下の項目をすべて削除します。
	これらは自動的に処理されるものだからです。詳細は
	<a class="xref" href="#faq.conf" title="9.13. 設定ファイルの置き場所を変更する方法は?">Section 9.13, “設定ファイルの置き場所を変更する方法は?”</a>を参照してください。</p></li>
<li class="listitem"><p><code class="filename">Makefile</code> で、
	<code class="varname">GCONF_SCHEMAS</code> 変数を定義します。変数値には
	パッケージがインストールする <code class="filename">.schemas</code>
	ファイルをすべて列挙します。このファイル名にディレクトリーを含めてはいけません。</p></li>
<li class="listitem"><p><code class="filename">Makefile</code> で、
	<code class="varname">GCONF_ENTRIES</code> 変数を定義します。変数値には
	パッケージがインストールする <code class="filename">.entries</code>
	ファイルをすべて列挙します。
	このファイル名にディレクトリーを含めてはいけません。</p></li>
</ol></div>
</div>
<div class="sect2" title="19.6.10. scrollkeeper/rarian のデータファイルをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="scrollkeeper-data-files"></a>19.6.10. scrollkeeper/rarian のデータファイルをインストールするパッケージ</h3></div></div></div>
<p>パッケージが、 scrollkeeper/rarian が使用する <code class="filename">.omf</code>
    ファイルをインストールする場合は、これらが確実にデータベースに登録されるようにするために、
    いくつか特別な手順を踏む必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>rarian の <code class="filename">buildlink3.mk</code> ファイルではなく
	<code class="filename">../../mk/omf-scrollkeeper.mk</code>
	をインクルードします。
	こうすると、インストールおよびアンインストール時に、 scrollkeeper
	のデータベースを再構築してくれます。
	また、パッケージがデータベースに直接アクセスすることが一切できなくなります。</p></li>
<li class="listitem"><p>PLIST を確認し、<code class="filename">libdata/scrollkeeper</code>
	ディレクトリー以下の項目をすべて削除します。
	これらは自動的に処理されるものだからです。</p></li>
<li class="listitem"><p>PLIST から <code class="filename">share/omf</code> ディレクトリーを削除します。
	これは rarian が処理します。(<span class="command"><strong>make
	print-PLIST</strong></span> で自動でおこなえます。)</p></li>
</ol></div>
</div>
<div class="sect2" title="19.6.11. X11 のフォントをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="x11-fonts"></a>19.6.11. X11 のフォントをインストールするパッケージ</h3></div></div></div>
<p>パッケージがフォントファイルをインストールする場合は、
    インストール時とアンインストール時に、
    フォントのインストール先ディレクトリーにあるフォントデータベースを再構築する必要があります。
    この処理は pkginstall の枠組を使って自動的におこなうことができます。</p>
<p>フォントのインストール先ディレクトリーを
    <code class="varname">FONTS_DIRS.<em class="replaceable"><code>type</code></em></code>
    変数に列挙することができます。変数名中の <em class="replaceable"><code>type</code></em> は、
    <span class="quote">“<span class="quote">ttf</span>”</span>, <span class="quote">“<span class="quote">type1</span>”</span>, <span class="quote">“<span class="quote">x11</span>”</span> のいずれかです。
    また、データベースファイル <code class="filename">fonts.dir</code>
    は PLIST に含めてはいけません。</p>
<p>なお、フォント用のディレクトリーを新たに作らないようにしてください。
    X サーバーがフォントを見つけるための設定をユーザーが手動でおこなう必要がないようにするため、
    新しいディレクトリーではなく標準的なディレクトリーを使うようにします。</p>
</div>
<div class="sect2" title="19.6.12. GTK2 のモジュールをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="gtk2-modules"></a>19.6.12. GTK2 のモジュールをインストールするパッケージ</h3></div></div></div>
<p>パッケージが GTK2 の IM モジュールやローダーをインストールする場合は、
    これらが確実に GTK2 のデータベースに登録されるようにするために、
    いくつか特別な手順を踏む必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>gtk2 の <code class="filename">buildlink3.mk</code> ファイルではなく
      <code class="filename">../../x11/gtk2/modules.mk</code> をインクルードします。
      こうすると、インストールおよびアンインストール時に、GTK2
      のデータベースを再構築してくれます。</p></li>
<li class="listitem"><p>GTK2 の IM モジュールをインストールするパッケージでは、
      <code class="varname">GTK2_IMMODULES=YES</code> を設定します。</p></li>
<li class="listitem"><p>GTK2 のローダーをインストールするパッケージでは、
      <code class="varname">GTK2_LOADERS=YES</code> を設定します。</p></li>
<li class="listitem">
<p>パッケージが GTK2 のデータベースディレクトリーを直接いじらないよう修正します。
      データベースは以下のとおりです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="filename">libdata/gtk-2.0/gdk-pixbuf.loaders</code></p></li>
<li class="listitem"><p><code class="filename">libdata/gtk-2.0/gtk.immodules</code></p></li>
</ul></div>
</li>
<li class="listitem"><p><code class="filename">PLIST</code> を確認し、<code class="filename">libdata/gtk-2.0</code>
      ディレクトリー以下の項目をすべて削除します。
      これらは自動的に処理されるものだからです。</p></li>
</ol></div>
</div>
<div class="sect2" title="19.6.13. SGML または XML のデータをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="sgml-xml-data"></a>19.6.13. SGML または XML のデータをインストールするパッケージ</h3></div></div></div>
<p>パッケージが、システム全体で使われるカタログへ登録する必要のある
    SGML または XML のデータファイル (DTD, sub-catalog など) をインストールする場合は、
    いくつか特別な手順を踏む必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>パッケージの <code class="filename">Makefile</code> で
	<code class="filename">../../textproc/xmlcatmgr/catalogs.mk</code> をインクルードします。
	こうすると、インストールおよびアンインストール時に、
	データファイルをシステム全体で使われるカタログに登録してくれます。</p></li>
<li class="listitem"><p><code class="varname">SGML_CATALOGS</code> を、このパッケージがインストールする
	SGML カタログをすべてをフルパス表記にしたものに設定します。</p></li>
<li class="listitem"><p><code class="varname">XML_CATALOGS</code> を、このパッケージがインストールする
	XML カタログをすべてをフルパス表記にしたものに設定します。</p></li>
<li class="listitem"><p><code class="varname">SGML_ENTRIES</code> を、SGML カタログに追加する
	個々のエントリーに設定します。各エントリーは
	3 個の文字列からなります。書き方の詳細は xmlcatmgr(1)
	(特に、'add' アクション用の引数) を参照してください。
	なお、通常はこの変数を使うことはありません。</p></li>
<li class="listitem"><p><code class="varname">XML_ENTRIES</code> を、XML カタログに追加する
	個々のエントリーに設定します。各エントリーは
	3 個の文字列からなります。書き方の詳細は xmlcatmgr(1)
	(特に、'add' アクション用の引数) を参照してください。
	なお、通常はこの変数を使うことはありません。</p></li>
</ol></div>
</div>
<div class="sect2" title="19.6.14. MIME データベースの拡張をインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="mime-database"></a>19.6.14. MIME データベースの拡張をインストールするパッケージ</h3></div></div></div>
<p>パッケージが、<code class="filename">.xml</code> ファイルを
    <code class="filename">${PREFIX}/share/mime/packages</code>
    以下にインストールすることで MIME データベースを拡張する場合は、
    データベースがこの新規ファイルについて確実に整合性を持つようにするために、
    いくつか特別な手順を踏む必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p><code class="filename">../../databases/shared-mime-info/mimedb.mk</code>
	をインクルードします (同じディレクトリーにある <code class="filename">buildlink3.mk</code>
	ファイルは、他の <code class="filename">buildlink3.mk</code>
	ファイルでインクルードするために予約されているので使いません)
	こうすると、インストールおよびアンインストール時に、MIME
	データベースを再構築してくれます。
	また、パッケージがデータベースに直接アクセスすることが一切できなくなります。</p></li>
<li class="listitem"><p>PLIST を確認し、<code class="filename">share/mime</code>
	ディレクトリー以下の項目のうち、
	<code class="filename">share/mime/packages</code> 以下に置かれるファイル
	<span class="emphasis"><em>以外の</em></span>ものをすべて削除します。
	このディレクトリーについては update-mime-database プログラムが自動的に処理しますが、
	除外したファイルはパッケージ依存のファイルなので、
	ファイルをインストールしたパッケージが自分で削除する必要があります。</p></li>
<li class="listitem"><p>PLIST から <code class="filename">share/mime/*</code> ディレクトリーをすべて削除します。
	これらは shared-mime-info プログラムが処理します。</p></li>
</ol></div>
</div>
<div class="sect2" title="19.6.15. intltool を使うパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="intltool"></a>19.6.15. intltool を使うパッケージ</h3></div></div></div>
<p>パッケージが構築時に intltool を使う場合は、
    <code class="literal">intltool</code> を <code class="varname">USE_TOOLS</code>
    に追加します。
    こうすると、パッケージの配布ファイルに附属する intltool ではなく、
    pkgsrc の intltool を強制的に使うようになります。</p>
<p>この仕組みは、intltool 構築時の依存関係を追跡して、
    利用可能な最新版を使います。この方法を使うことで、
    リリース後にできたバグ修正も適用することができます。</p>
</div>
<div class="sect2" title="19.6.16. 起動スクリプトをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="startup-scripts"></a>19.6.16. 起動スクリプトをインストールするパッケージ</h3></div></div></div>
<p>パッケージに rc.d スクリプトが附属する場合、このスクリプトは、
    標準では起動ディレクトリーにコピーされませんが、
    <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> にオプション
    <code class="varname">PKG_RCD_SCRIPTS=YES</code> を追加指定すると、
    パッケージのインストール時に、スクリプトが
    <code class="filename">/etc/rc.d</code> 以下にコピーされます。
    また、パッケージのアンインストール時には、
    自動的にスクリプトが削除されます。</p>
</div>
<div class="sect2" title="19.6.17. TeX モジュールをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="tex-packages"></a>19.6.17. TeX モジュールをインストールするパッケージ</h3></div></div></div>
<p>パッケージが、TeX パッケージを texmf ツリーにインストールする場合は、
    texmf ツリーの <code class="filename">ls-R</code>
    データベースを更新する必要があります。</p>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>kpathsea のような主たる TeX パッケージ以外のパッケージは、
    <code class="varname">${PREFIX}/share/texmf</code>
    ではなく <code class="varname">${PREFIX}/share/texmf-dist</code>
    内にファイルをインストールするようにします。</p>
</div>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>
      <code class="filename">../../print/kpathsea/texmf.mk</code>
      をインクルードします。こうすると、インストール時とアンインストール時に
      <code class="filename">ls-R</code> を再構築してくれます。</p></li>
<li class="listitem">
<p>パッケージが
      <code class="filename">${PREFIX}/share/texmf-dist</code> の texmf ツリー以外の
      texmf ツリーにファイルをインストールする場合は、
      <code class="varname">TEX_TEXMF_DIRS</code> を、データベースの更新が必要となる
      texmf ツリーをすべて並べたリストに設定します。</p>
<p>パッケージが、<span class="command"><strong>updmap</strong></span>
      を使って登録する必要があるフォントマップファイルもインストールする場合は、
      <code class="filename">../../print/texlive-tetex/map.mk</code> をインクルードしたうえで、
      <code class="varname">TEX_MAP_FILES</code> と
      <code class="varname">TEX_MIXEDMAP_FILES</code> のいずれかまたは両方を、
      そのようなフォントマップファイルをすべて並べたリストに設定します。
      こうすると、インストール時とアンインストール時に
      <span class="command"><strong>updmap</strong></span> が自動的に実行され、
      TeX 出力ドライバー用のフォントマップファイルの有効化や無効化をしてくれます。</p>
</li>
<li class="listitem"><p><code class="filename">PLIST</code> には
      <code class="filename">ls-R</code> データベースは一切含めないようにします。
      このデータベースは teTeX-bin パッケージによってのみ削除されるものだからです。</p></li>
</ol></div>
</div>
<div class="sect2" title="19.6.18. エミュレーションによるバイナリーの実行に対応したパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="emulation-packages"></a>19.6.18. エミュレーションによるバイナリーの実行に対応したパッケージ</h3></div></div></div>
<p>パッケージのなかには、あるオペレーティングシステム用のバイナリーを
    (エミュレーションに対応した) 別のオペレーティングシステム上で実行するための、
    ライブラリーや実行ファイルを提供するものがあります。
    例としては、NetBSD 上で Linux のバイナリーを実行するものがあげられます。</p>
<p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/rpm2pkg/README.html" target="_top"><code class="filename">pkgtools/rpm2pkg</code></a>
    は、Linux の rpm パッケージの展開やパッケージ化を補助するものです。</p>
<p><code class="varname">CHECK_SHLIBS</code> を no に設定して、
    インストールされた実行ファイル用のライブラリーを動的リンカーがすべて見つけられることを検査する
    <span class="command"><strong>check-shlibs</strong></span> ターゲットを抑止することができます。
    この検査では標準の動的リンカーを実行するので、
    エミュレーションパッケージに対しては検査が失敗します。
    エミュレーションで使われるライブラリーは、
    標準のディレクトリーには置かれていないからです。</p>
</div>
<div class="sect2" title="19.6.19. ハイカラーテーマのアイコンをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="hicolor-theme"></a>19.6.19. ハイカラーテーマのアイコンをインストールするパッケージ</h3></div></div></div>
<p>パッケージが、
    <code class="filename">share/icons/hicolor</code> 以下に画像をインストールするか
    <code class="filename">share/icons/hicolor/icon-theme.cache</code> データベースを更新するかあるいはその両方をおこなう場合は、
    テーマ用の共有ディレクトリーを適切に扱い、キャッシュデータベースを確実に再構築するために、
    以下の手順を踏む必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p><code class="filename">../../graphics/hicolor-icon-theme/buildlink3.mk</code>
	をインクルードします。</p></li>
<li class="listitem"><p><code class="filename">PLIST</code> を確認し、
	テーマのキャッシュを参照するエントリーを削除します。</p></li>
<li class="listitem"><p>PLIST が <code class="filename">share/icons/hicolor</code>
	  階層からアイコン用の共有ディレクトリーを削除しないようにします。
	  これは自動的に処理されるものだからです。</p></li>
</ol></div>
<p>後の 2 点について、
      PLIST がこれらを守っていることを確認する最良の方法は、
      <span class="command"><strong>make print-PLIST</strong></span> を使って作り直すことです。</p>
</div>
<div class="sect2" title="19.6.20. デスクトップファイルをインストールするパッケージ">
<div class="titlepage"><div><div><h3 class="title">
<a name="desktop-files"></a>19.6.20. デスクトップファイルをインストールするパッケージ</h3></div></div></div>
<p>パッケージが、<code class="filename">.desktop</code> ファイルを
      <code class="filename">share/applications</code> 以下にインストールし、そのファイルに
      MIME 情報が含まれている場合は、それらが MIME データベースに確実に登録されるようにするために、
      以下の手順を踏む必要があります。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p><code class="filename">../../sysutils/desktop-file-utils/desktopdb.mk</code>
	  をインクルードします。</p></li>
<li class="listitem"><p>PLIST を確認し、
	  <code class="filename">share/applications/mimeinfo.cache</code> ファイルを参照するエントリーを削除します。
	  これは自動的に処理されるものだからです。</p></li>
</ol></div>
<p>最後の点について、
      PLIST がこれらを守っていることを確認する最良の方法は、<span class="command"><strong>make
      print-PLIST</strong></span> を使って作り直すことです。</p>
</div>
</div>
<div class="sect1" title="19.7. パッケージに問題があるという印をつける">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="punting"></a>19.7. パッケージに問題があるという印をつける</h2></div></div></div>
<p>場合によっては、パッケージの問題をすぐに解決できないことがあります。
  この場合、パッケージが壊れていることを表すだけの目印をつけることができます。
  これをおこなうには、<code class="varname">BROKEN</code> 変数を、
  (<code class="varname">RESTRICTED</code> 変数と同様に)
  パッケージが壊れている理由に設定するだけです。
  利用者がパッケージを構築しようとすると、
  パッケージはその場でこのメッセージを表示して、
  構築をしないようになります。</p>
<p><code class="varname">BROKEN</code> となったパッケージは、
  不定期的に pkgsrc から削除されます。</p>
</div>
</div>
<div class="chapter" title="Chapter 20. デバッグ">
<div class="titlepage"><div><div><h2 class="title">
<a name="debug"></a>Chapter 20. デバッグ</h2></div></div></div>
<p>パッケージを作成する時に落ちいりやすい間違いをチェックし、パッケージを動作
  させるための手順があります。これは基本的には前のセクションで説明したことと
  同じですが、デバッグを助けるための方法を追加しています。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">PKG_DEVELOPER=yes</code> を <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で設定しておいてください</p></li>
<li class="listitem">
<p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/url2pkg/README.html" target="_top"><code class="filename">pkgtools/url2pkg</code></a>をインストールし、
      デバッグ対象のパッケージ用にディレクトリーを作ってそこに移動してから、
      <span class="command"><strong>url2pkg</strong></span> を実行します。</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>mkdir /usr/pkgsrc/<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>examplepkg</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>cd /usr/pkgsrc/<em class="replaceable"><code>category</code></em>/<em class="replaceable"><code>examplepkg</code></em></code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>url2pkg http://www.example.com/path/to/distfile.tar.gz</code></strong></pre>
</li>
<li class="listitem"><p><code class="filename">Makefile</code>に、必要な編集を加えます。</p></li>
<li class="listitem"><p><code class="filename">DESCR</code>の内容を書きます</p></li>
<li class="listitem"><p><span class="command"><strong>make configure</strong></span> を実行します。</p></li>
<li class="listitem"><p>ドキュメンテーション、
      およびconfigureの段階でわかった依存関係をすべて、
      パッケージの<code class="filename">Makefile</code>に書き加えます。</p></li>
<li class="listitem">
<p>以下を繰り返しおこなって、パッケージを作り上げます</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>make</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>pkgvi ${WRKSRC}/some/file/that/does/not/compile</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>mkpatches</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>patchdiff</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>mv ${WRKDIR}/.newpatches/* patches</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make mps</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>make clean</code></strong></pre>
<p>root以外のユーザーで作業をおこなうと、改変すべきでないファイルは改変され
      ません。特に、構築の段階以外では。
      <span class="command"><strong>mkpatches</strong></span>,
      <span class="command"><strong>patchdiff</strong></span> および <span class="command"><strong>pkgvi</strong></span>
      は、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkgdiff/README.html" target="_top"><code class="filename">pkgtools/pkgdiff</code></a> パッケージに入っています。</p>
</li>
<li class="listitem"><p>必要なら<code class="filename">Makefile</code>を修正してください。
      <a class="xref" href="#components.Makefile" title="11.1. Makefile">Section 11.1, “<code class="filename">Makefile</code>”</a>を参考にしてください。</p></li>
<li class="listitem">
<p><code class="filename">PLIST</code>を作成します:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make print-PLIST &gt;PLIST</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make deinstall</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make deinstall</code></strong></pre>
<p>これは通常、<code class="username">root</code>で実行する必要があります。
      残ったままのファイルがないか調べます:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make print-PLIST</code></strong></pre>
<p>もし、なにかファイルが見つかれば、それらは<code class="filename">PLIST</code>に不足しているので、追加
      してください。</p>
</li>
<li class="listitem">
<p>これで<code class="filename">PLIST</code>の修正ができました。
      パッケージを再度インストールして、バイナリーパッケージを作ります:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make reinstall</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>make package</code></strong></pre>
</li>
<li class="listitem">
<p>インストールしたパッケージを削除します:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_delete <em class="replaceable"><code>examplepkg</code></em></code></strong></pre>
</li>
<li class="listitem">
<p>上記の <span class="command"><strong>make print-PLIST</strong></span> コマンドを繰り返します。
      今度は何も見つからないはずです:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make print-PLIST</code></strong></pre>
</li>
<li class="listitem">
<p>バイナリーパッケージを再インストールします:</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkg_add .../<em class="replaceable"><code>examplepkg</code></em>.tgz</code></strong></pre>
</li>
<li class="listitem"><p>遊んでみてください。すべてが機能することを確認してください。</p></li>
<li class="listitem">
<p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkglint/README.html" target="_top"><code class="filename">pkgtools/pkglint</code></a>に含まれる<span class="command"><strong>pkglint</strong></span>を実行し、
      報告される問題を修正してください。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>pkglint</code></strong></pre>
</li>
<li class="listitem"><p>提出してください(もし cvs アクセス可能であればコミットしてください)。<a class="xref" href="#submit" title="Chapter 21. 提出およびコミット">Chapter 21, <i>提出およびコミット</i></a>が参考になります。</p></li>
</ul></div>
</div>
<div class="chapter" title="Chapter 21. 提出およびコミット">
<div class="titlepage"><div><div><h2 class="title">
<a name="submit"></a>Chapter 21. 提出およびコミット</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#submitting-binary-packages">21.1. バイナリーパッケージの提出</a></span></dt>
<dt><span class="sect1"><a href="#submitting-your-package">21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)</a></span></dt>
<dt><span class="sect1"><a href="#general-notes-for-changes">21.3. パッケージを追加・更新・削除する際の一般的な覚書</a></span></dt>
<dt><span class="sect1"><a href="#committing-importing">21.4. コミット: パッケージのCVSへのインポート</a></span></dt>
<dt><span class="sect1"><a href="#updating-package">21.5. パッケージを新しいバージョンに更新する</a></span></dt>
<dt><span class="sect1"><a href="#renaming-package">21.6. pkgsrc のパッケージの名前を変更する</a></span></dt>
<dt><span class="sect1"><a href="#moving-package">21.7. pkgsrcのパッケージを移動する</a></span></dt>
</dl>
</div>
<div class="sect1" title="21.1. バイナリーパッケージの提出">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="submitting-binary-packages"></a>21.1. バイナリーパッケージの提出</h2></div></div></div>
<p>  我々は、トロイの木馬等を含まないことを保証するために、pkgsrc 開発者からし
	かバイナリーを受け取りません。これは、誰かを排斥するものではなく、
	むしろユーザーを保護するための方針です。しかしながら、あなたの作ったバイ
	ナリーパッケージをどこかに置き、配布することは自由に行なってもかまいま
	せん。NetBSD 開発者がバルクビルドを実行してパッケージをアップロードしたい場合は、
	<a class="xref" href="#bulk-upload" title="7.3.8. バルクビルドの成果をアップロードする">Section 7.3.8, “バルクビルドの成果をアップロードする”</a>を参照してください。</p>
</div>
<div class="sect1" title="21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="submitting-your-package"></a>21.2. ソースパッケージの提出 (NetBSD 開発者以外の方向け)</h2></div></div></div>
<p>最初にパッケージが完全かどうか、コンパイル、実行できるかどうかを確認して
	ください。
	このドキュメントの<a class="xref" href="#debug" title="Chapter 20. デバッグ">Chapter 20, <i>デバッグ</i></a>、その他が参考になるでしょう。次に、
	パッケージを構成するファイルすべてからなる <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?tar+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">tar</span>(1)</span></a>
	アーカイブを作り、gzip して uuencode してください。
	最後に、このパッケージを pkgsrc のバグ追跡システムに送信してください。
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?send-pr+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> コマンドを使って送信するか、このコマンドがない場合は web ページ
	<a class="ulink" href="http://www.NetBSD.org/support/send-pr.html" target="_top">http://www.NetBSD.org/support/send-pr.html</a>
	をご覧ください。この web ページには、説明と、
	パッケージを提出できるフォームへのリンクがあります。
	これらのかわりに、
	<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/sysutils/gtk-send-pr/README.html" target="_top"><code class="filename">sysutils/gtk-send-pr</code></a>
	パッケージを使って提出することもできます。
	</p>
<p>問題報告においては、カテゴリー (category) は
	<span class="quote">“<span class="quote">pkg</span>”</span> とし、問題の概要 (synopsis) にパッケージ名とバージョン番号を含めます。
	また、説明 (description) のフィールドに、パッケージの簡単な説明
	(COMMENT 変数または DESCR ファイルの内容でもOKです)
	を書きます。uuencode したパッケージのデータは
	<span class="quote">“<span class="quote">fix</span>”</span> フィールドに含めます。</p>
<p>複数のパッケージを提出したい場合は、一つのパッケージにつき一つのPRにわけ
	て送ってください。そうすることで、私たちが追跡しやすくなります。</p>
<p>以上のようにするほか、新しいパッケージは pkgsrc-wip
	(<span class="quote">“<span class="quote">pkgsrc work-in-progress</span>”</span>) に入れることもできます。
	詳細は、ホームページ <a class="ulink" href="http://pkgsrc-wip.sourceforge.net/" target="_top">http://pkgsrc-wip.sourceforge.net/</a>
	をご覧ください。</p>
</div>
<div class="sect1" title="21.3. パッケージを追加・更新・削除する際の一般的な覚書">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="general-notes-for-changes"></a>21.3. パッケージを追加・更新・削除する際の一般的な覚書</h2></div></div></div>
<p>パッケージの追加、更新、移動、および削除は、すべて
	<code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code> に書いてください。
	このファイルを、これまでと同じ形式のまま最新の状態に保つことは非常に重要なことです。
	なぜなら、このファイルはスクリプトにより <a class="ulink" href="http://www.NetBSD.org/" target="_top">www.NetBSD.org</a>
	や他のサイトのページを自動的に更新するために使用されているからです。
	また、<code class="filename">pkgsrc/doc/TODO</code> ファイルを確認し、
	今回更新あるいは削除したパッケージのことが書かれている場合は、
	その部分を削除してください。</p>
<p>パッケージの <code class="varname">PKGREVISION</code> を引き上げた時に、
	その変更がセキュリティーに関するものやその他関連のあるものである場合は、
	<code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code> に載せるようにします。
	依存性の更新にともなう大量の引き上げについては、ここには書かないでください。
	これら以外の場合は、書くべきかどうかは開発者が自分で決めることです。</p>
<p>正しい <code class="filename">CHANGES-<em class="replaceable"><code>YYYY</code></em></code>
  の項目を作るのを手伝ってくれる make ターゲット、 <span class="command"><strong>make
  changes-entry</strong></span> があります。このターゲットは <code class="varname">CTYPE</code>
  および <code class="varname">NETBSD_LOGIN_NAME</code> というオプションの変数を使います。
  一般的な使い方は、まず <code class="filename">CHANGES-<em class="replaceable"><code>YYYY</code></em></code>
  ファイルを (あとで衝突して修正する必要が起こらないように)
  最新の状態にした上で、パッケージのディレクトリーに <span class="command"><strong>cd</strong></span>
  します。パッケージを更新した場合は <span class="command"><strong>make changes-entry</strong></span>
  だけで十分です。新規パッケージの追加や、パッケージの移動または削除の場合は、
  コマンドラインで <code class="varname">CTYPE</code> 変数を "Added",
  "Moved" または "Removed" に設定します。ローカルのログイン名が
  NetBSD のログイン名と異なる場合は、<a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a> で
  <code class="varname">NETBSD_LOGIN_NAME</code> を設定することができます。
  また、このターゲットは、<code class="filename">TODO</code> ファイルから、
  当該パッケージの項目を自動的に削除してくれます。最後に、
  <span class="command"><strong>make changes-entry-commit</strong></span> などとして
  <code class="filename">pkgsrc/doc/CHANGES-<em class="replaceable"><code>YYYY</code></em></code> の変更を
  commit するのを忘れないでください。
  なお、cvs.NetBSD.org から直接チェックアウトせずに、
  ローカルにコピーしたリポジトリーを使って作業している場合などは、
  USE_NETBSD_REPO=yes を設定するとよいでしょう。こうすると、
  cvs コマンドでは本家リポジトリーを使うようになります。
  </p>
</div>
<div class="sect1" title="21.4. コミット: パッケージのCVSへのインポート">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="committing-importing"></a>21.4. コミット: パッケージのCVSへのインポート</h2></div></div></div>
<p>このセクションは、pkgsrcリポジトリーへの書き込みアクセス権限を持っ
  ている pkgsrc 開発者にのみ意味があるものです。cvsはカレントディレクトリーから
  の相対位置にファイルをインポートすることと、<span class="command"><strong>cvs import</strong></span>コマンドに渡したパ
  ス名からリポジトリー中のファイルの位置が決まることを忘れないでください。新
  しく作ったパッケージは、<span class="quote">“<span class="quote">TNF</span>”</span>のベンダータグと<span class="quote">“<span class="quote">pkgsrc-base</span>”</span>のリリースタ
  グでインポートしてください。例えば:</p>
<pre class="programlisting">
<code class="prompt">$</code> cd .../pkgsrc/category/pkgname
<code class="prompt">$</code> cvs import pkgsrc/category/pkgname TNF pkgsrc-base
</pre>
<p>また、インポートに使ったディレクトリーは、忘れずに邪魔にならないところに移
  しておいてください。そうしておかないと、ソースツリーを次に<span class="quote">“<span class="quote">cvs
  update</span>”</span>した
  ときにcvsが文句を言います。さらに、この新しいパッケージを、categoryの
  <code class="filename">Makefile</code>に忘れずに追加してください。</p>
<p>初回のインポートでは、コミットメッセージに<code class="filename">DESCR</code>ファイルの内容を含めておき、
  どういうパッケージなのかがメーリングリストの読者にわかるようにしてください。</p>
<p>新しいパッケージを追加する場合は、<span class="quote">“<span class="quote">cvs
  add</span>”</span>ではなく<span class="quote">“<span class="quote">cvs import</span>”</span>を使うように
  してください。"cvs import"なら、単一のコマンドですべて記述することができ、
  また、一貫したタグを打つことができるからです。</p>
</div>
<div class="sect1" title="21.5. パッケージを新しいバージョンに更新する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="updating-package"></a>21.5. パッケージを新しいバージョンに更新する</h2></div></div></div>
<p>パッケージを更新するときは、新旧バージョン間の変更点の簡潔で適切で意味のあ
  る要約を、コミットログに必ず書いてください。そうすべき理由はいろいろありま
  す:</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>URLは不安定なものであり、時間がたつと変わることがあります。完全になくなる
  かもしれませんし、新しい情報に書き換わるかもしれません。</p></li>
<li class="listitem"><p>新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、cvsやanoncvsの
  利用者にとって、非常に便利です。</p></li>
<li class="listitem"><p>新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、pkgsrc-changes
  メーリングリストの読者が、パッケージをいつ更新するかの戦術を立てられるよう
  になり、非常に便利です。</p></li>
</ul></div>
<p>また、あるパッケージに新しいバージョンがリリースされたというだけの理由で、
  CVSリポジトリー上のパッケージを更新しないほうがいいことを認識してください。
  私たちは、pkgsrcに含まれるパッケージに関して保守的であることを好みます。と
  いうのも、開発版やベータ版のパッケージは、pkgsrcが使われる場面のほとんどに
  対して、まったくふさわしくないからです。どのバージョンをpkgsrcに入れるのが
  よいか、分別をもって判断してください。新機能(テストされていない機能があるか
  もしれません)よりも安定性のほうが好ましいことを念頭に置いてください。</p>
</div>
<div class="sect1" title="21.6. pkgsrc のパッケージの名前を変更する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="renaming-package"></a>21.6. pkgsrc のパッケージの名前を変更する</h2></div></div></div>
<p>パッケージ名の変更は、なるべくしないようにしてください。</p>
<p>パッケージ名を変更する際には、かならず、
  他の Makefile やオプションや buildlink などで古い名前を参照している箇所をすべて修正します。</p>
<p>パッケージ名を変更する際には、さらに、
  <code class="varname">SUPERSEDES</code> を旧パッケージのパッケージ名と
  dewey 式のバージョン番号に設定します。
  名前が複数回変わっている場合は、複数並べて設定することができます。
  これで、新しいパッケージで旧名のパッケージを置き換える作業は完了です。
</p>
<p>なお、CHANGES-<em class="replaceable"><code>YYYY</code></em> ファイルにおける
  <span class="quote">“<span class="quote">successor</span>”</span> の記述は、必ずしも、<span class="emphasis"><em>supersedes</em></span>
  の意味ではありません。successor は、厳密な同等品でなくても、
  代替として使えるものを助言するものでもいいからです。</p>
</div>
<div class="sect1" title="21.7. pkgsrcのパッケージを移動する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="moving-package"></a>21.7. pkgsrcのパッケージを移動する</h2></div></div></div>
<p>パッケージの名前の変更や移動は、しないほうがよいのですが、
  それでも必要な場合は、以下の手順でおこないます。
</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem"><p>パッケージのディレクトリーをどこかにコピーします。</p></li>
<li class="listitem">
<p>コピーしたものからCVSディレクトリーをすべて削除します。</p>
<p>手順1,2は、以下のようにすることもできますので、今後の作業にはこちらを使ってください:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs -d user@cvs.NetBSD.org:/cvsroot export -D today pkgsrc/category/package</code></strong></pre>
</li>
<li class="listitem"><p><code class="varname">CATEGORIES</code>を修正します。また、<span class="quote">“<span class="quote">../../category/package</span>”</span>のかわりに単に
<span class="quote">“<span class="quote">../package</span>”</span>とすることができる<code class="varname">DEPENDS</code>のパスをすべて修正します。</p></li>
<li class="listitem"><p>修正後のパッケージの Makefile で、
<code class="varname">PREV_PKGPATH</code> を、移動前のカテゴリー/パッケージのパス名に設定します。
この <code class="varname">PREV_PKGPATH</code> は、
パッケージの更新を pkgsrc の構築によっておこなうツールが使います。
たとえば、そういったツールは <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?pkg_summary+5+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">pkg_summary</span>(5)</span></a> データベースから
(<code class="varname">SUPERSEDES</code> がない場合)
<code class="varname">PREV_PKGPATH</code> を検索して、これをもとにパッケージの移動後の
<code class="varname">PKGPATH</code> を調べることができます。
なお、この検索で複数のパスが見つかることもありえるので、
ツールの側では <code class="varname">PKGBASE</code> もあわせて検査します。
この <code class="varname">PREV_PKGPATH</code> の値を設定するのは、
<code class="varname">SUPERSEDES</code> が設定されない場合
(つまり、<code class="varname">PKGBASE</code> が変わらない場合) です。  </p></li>
<li class="listitem"><p>新しい場所で、修正後のパッケージを<span class="command"><strong>cvs import</strong></span>
します。</p></li>
<li class="listitem">
<p>このパッケージに依存しているパッケージを調べます:
</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cd /usr/pkgsrc</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>grep /package */*/Makefile* */*/buildlink*</code></strong></pre>
</li>
<li class="listitem"><p>手順5で見つかったものに対して、このパッケージへのパスを、新しい場所を指すように修正します。</p></li>
<li class="listitem"><p>古い場所で、移動前のパッケージを<span class="command"><strong>cvs rm (-f)</strong></span>します。</p></li>
<li class="listitem"><p><code class="filename">oldcategory/Makefile</code> からこのパッケージを削除します。</p></li>
<li class="listitem"><p><code class="filename">newcategory/Makefile</code> にこのパッケージを追加します。</p></li>
<li class="listitem">
<p>変更および削除されたファイルを commit します:</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs commit oldcategory/package oldcategory/Makefile newcategory/Makefile</code></strong></pre>
<p>(もちろん、手順5の各パッケージもです)。</p>
</li>
</ol></div>
</div>
</div>
<div class="chapter" title="Chapter 22. よくある質問">
<div class="titlepage"><div><div><h2 class="title">
<a name="devfaq"></a>Chapter 22. よくある質問</h2></div></div></div>
<p>この節では、パッケージ作成中に湧くような疑問と回答を掲載します。
	あなたがお持ちの疑問に対する答がここにない場合は、
	まず、他の節を見てみてください。
	それでも答が見つからなければ、
	<code class="literal">pkgsrc-users</code> メーリングリストで尋ねてください。</p>
<div class="qandaset" title="Frequently Asked Questions">
<a name="id52024065"></a><dl>
<dt>22.1. <a href="#devfaq.makeflags">MAKEFLAGS,
	.MAKEFLAGS, MAKE_FLAGS
	の各変数の違いは?</a>
</dt>
<dt>22.2. <a href="#devfaq.make">MAKE,
	GMAKE, MAKE_PROGRAM
	の各変数の違いは?</a>
</dt>
<dt>22.3. <a href="#devfaq.cc">CC,
	PKG_CC, PKGSRC_COMPILER
	の各変数の違いは?</a>
</dt>
<dt>22.4. <a href="#devfaq.bl3flags">BUILDLINK_LDFLAGS,
	BUILDLINK_LDADD,
	BUILDLINK_LIBS
	の各変数の違いは?</a>
</dt>
<dt>22.5. <a href="#devfaq.bl3prefix">make show-var
	VARNAME=BUILDLINK_PREFIX.foo
	したら、空だといわれるのはなぜ?</a>
</dt>
<dt>22.6. <a href="#devfaq.master_sites">
	${MASTER_SITE_SOURCEFORGE:=package/} ってどういうこと?
	中身の :=
	がわかりません。</a>
</dt>
<dt>22.7. <a href="#devfaq.mailinglists">パッケージ開発者向けの
	メーリングリストはどれ?</a>
</dt>
<dt>22.8. <a href="#devfaq.documentation">pkgsrc
	の資料はどこにある?</a>
</dt>
<dt>22.9. <a href="#devfaq.too-much-time">少し時間があるんだけど、
何をしたらいい?</a>
</dt>
</dl>
<table border="0" width="100%" summary="Q and A Set">
<col align="left" width="1%">
<col>
<tbody>
<tr class="question" title="22.1.">
<td align="left" valign="top">
<a name="devfaq.makeflags"></a><a name="id52024068"></a><p><b>22.1.</b></p>
</td>
<td align="left" valign="top"><p><code class="varname">MAKEFLAGS</code>,
	<code class="varname">.MAKEFLAGS</code>, <code class="varname">MAKE_FLAGS</code>
	の各変数の違いは?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p><code class="varname">MAKEFLAGS</code> は、
	pkgsrc 内部で呼び出される <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> に渡されるフラグであり、
	<code class="varname">MAKE_FLAGS</code> は、パッケージを構築するときに
	<code class="varname">MAKE_PROGRAM</code> に渡されるフラグです。
	[FIXME: What is .MAKEFLAGS for?]</p></td>
</tr>
<tr class="question" title="22.2.">
<td align="left" valign="top">
<a name="devfaq.make"></a><a name="id52024102"></a><p><b>22.2.</b></p>
</td>
<td align="left" valign="top"><p><code class="varname">MAKE</code>,
	<code class="varname">GMAKE</code>, <code class="varname">MAKE_PROGRAM</code>
	の各変数の違いは?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p><code class="varname">MAKE</code> は、 pkgsrc の基盤が使う
	<a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> プログラムへのパスです。<code class="varname">GMAKE</code> は、GNU
	Make へのパスですが、これを使うためには <code class="varname">USE_TOOLS+=gmake</code>
	する必要があります。<code class="varname">MAKE_PROGRAM</code> は、
	パッケージの構築に使われる
	Make プログラムへのパスです。</p></td>
</tr>
<tr class="question" title="22.3.">
<td align="left" valign="top">
<a name="devfaq.cc"></a><a name="id52024139"></a><p><b>22.3.</b></p>
</td>
<td align="left" valign="top"><p><code class="varname">CC</code>,
	<code class="varname">PKG_CC</code>, <code class="varname">PKGSRC_COMPILER</code>
	の各変数の違いは?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p><code class="varname">CC</code> は、本物の C
	コンパイラーへのパスで、pkgsrc の利用者が設定することができます。
	<code class="varname">PKG_CC</code> は、コンパイラーのラッパーへのパスです。
	<code class="varname">PKGSRC_COMPILER</code> は、
	コンパイラーへのパスでは<span class="emphasis"><em>なく</em></span>、使われるコンパイラーの種類です。
	最後の変数に関するさらなる情報は、
	<code class="filename">mk/compiler.mk</code> をご覧ください。</p></td>
</tr>
<tr class="question" title="22.4.">
<td align="left" valign="top">
<a name="devfaq.bl3flags"></a><a name="id52024173"></a><p><b>22.4.</b></p>
</td>
<td align="left" valign="top"><p><code class="varname">BUILDLINK_LDFLAGS</code>,
	<code class="varname">BUILDLINK_LDADD</code>,
	<code class="varname">BUILDLINK_LIBS</code>
	の各変数の違いは?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p>[FIXME]</p></td>
</tr>
<tr class="question" title="22.5.">
<td align="left" valign="top">
<a name="devfaq.bl3prefix"></a><a name="id52024260"></a><p><b>22.5.</b></p>
</td>
<td align="left" valign="top"><p><span class="command"><strong>make show-var
	VARNAME=BUILDLINK_PREFIX.<em class="replaceable"><code>foo</code></em></strong></span>
	したら、空だといわれるのはなぜ?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p>最適化のために、一部の変数は
	<span class="quote">“<span class="quote">wrapper</span>”</span> の段階以降でしか使えません。
	wrapper の段階を<span class="quote">“<span class="quote">シミュレート</span>”</span>するには、
	お尋ねのコマンドに <span class="command"><strong>PKG_PHASE=wrapper</strong></span>
	を付け加えます。</p></td>
</tr>
<tr class="question" title="22.6.">
<td align="left" valign="top">
<a name="devfaq.master_sites"></a><a name="id52024284"></a><p><b>22.6.</b></p>
</td>
<td align="left" valign="top"><p>
	<code class="literal">${MASTER_SITE_SOURCEFORGE:=package/}</code> ってどういうこと?
	中身の <code class="literal">:=</code>
	がわかりません。</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><p><code class="literal">:=</code> は、一見、代入演算子のようですが、
	そうではありません。
	<code class="literal">${LIST:<em class="replaceable"><code>old_string</code></em>=<em class="replaceable"><code>new_string</code></em>}</code>
	という修飾子が <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> マニュアルページに書かれており、
	<code class="literal">${SRCS:.c=.o}</code> というのを見たことがあるかもしれませんが、
	これはこの修飾子の特殊な形です。
	この <code class="varname">MASTER_SITE_*</code> の事例では、
	<em class="replaceable"><code>old_string</code></em> は空の文字列、
	<em class="replaceable"><code>new_string</code></em> は
	<code class="literal">package/</code> です。このため、
	<code class="literal">:</code> と <code class="literal">=</code>
	がくっついているのです。</p></td>
</tr>
<tr class="question" title="22.7.">
<td align="left" valign="top">
<a name="devfaq.mailinglists"></a><a name="id52024353"></a><p><b>22.7.</b></p>
</td>
<td align="left" valign="top"><p>パッケージ開発者向けの
	メーリングリストはどれ?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top"><div class="variablelist"><dl>
<dt><span class="term"><a class="ulink" href="http://www.NetBSD.org/mailinglists/index.html#tech-pkg" target="_top">tech-pkg</a></span></dt>
<dd><p>pkgsrc 開発関連の技術的な議論のためのメーリングリストです。
	たとえば、pkgsrc の基盤の変更を求めるフィードバック、
	新機能の提案、pkgsrc の新しいプラットフォームへの移植に関する質問、
	パッケージ保守のための助言、多数のパッケージに影響のあるパッチ、
	基盤にバグが見つかったために pkgsrc-users
	からここに場を移された助けの要請などです。</p></dd>
<dt><span class="term"><a class="ulink" href="http://www.NetBSD.org/mailinglists/index.html#pkgsrc-bugs" target="_top">pkgsrc-bugs</a></span></dt>
<dd><p><a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?send-pr+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">send-pr</span>(1)</span></a> で送られた
	"pkg" カテゴリーのバグレポートはすべてここに流れます。
	ここへバグの報告を直接しないでください。
	バグの報告には、他のいずれかのメーリングリストを使ってください。</p></dd>
</dl></div></td>
</tr>
<tr class="question" title="22.8.">
<td align="left" valign="top">
<a name="devfaq.documentation"></a><a name="id52024385"></a><p><b>22.8.</b></p>
</td>
<td align="left" valign="top"><p>pkgsrc
	の資料はどこにある?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top">
<p>pkgsrc に関する資料がある場所は、
	たくさんあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p>The pkgsrc guide (この文書) は、数多くある
	pkgsrc の部品について説明した章を集めたものですが、
	内容が古くなりがちな章もあります。どの章がそうなのかは、
	示しにくいのですが。</p></li>
<li class="listitem"><p>メーリングリストのアーカイブ (<a class="ulink" href="http://mail-index.NetBSD.org/" target="_top">http://mail-index.NetBSD.org/</a> 参照) では、
	ある機能に関する議論、pkgsrc の基盤の新しい部品の告知や、
	時にはある機能を廃止することにしたという告知などを見ることができます。
	これの便利なところは、各記事に日付がつけられていることです。</p></li>
<li class="listitem"><p><code class="filename">mk/</code>
	ディレクトリーにあるファイルの多くは、冒頭のコメントで、
	そのファイルの目的と、
	pkgsrc 利用者やパッケージ作者による使用方法を説明しています。
	このドキュメンテーションを簡単に見つける方法は、<span class="command"><strong>bmake
	help</strong></span> を実行することです。</p></li>
<li class="listitem"><p>CVS のログメッセージは豊富な情報源ですが、
	かなり省略して書かれる傾向が
	(特に、頻繁におこなわれる処置に関するログでは) あります。
	何が変わったかを詳細に説明したログもありますが、
	そのようなものは他の pkgsrc 開発者向けのものであって、
	平均的な pkgsrc 利用者向けのものではありません。
	ログメッセージは<span class="emphasis"><em>変更点</em></span>を記録しているだけなので、
	変更前のことを知らない場合は、
	たいして価値がないかもしれません。</p></li>
<li class="listitem"><p>pkgsrc の部品のなかには、<span class="quote">“<span class="quote">暗黙の文書化</span>”</span>、
	つまり、資料はそのコードを書いた開発者の頭の中にあるだけ、
	というものもあります。このようなものの情報を入手するには、
	<span class="command"><strong>cvs annotate</strong></span> コマンドを使ってコードを書いた人を調べて、
	後から他の人が見られるように (前の説明参照)
	<code class="literal">tech-pkg</code> メーリングリストで尋ねてください。
	担当の開発者がメールを確実に読むようにするため、
	その人に CC してもよいでしょう。</p></li>
</ul></div>
</td>
</tr>
<tr class="question" title="22.9.">
<td align="left" valign="top">
<a name="devfaq.too-much-time"></a><a name="id52024440"></a><p><b>22.9.</b></p>
</td>
<td align="left" valign="top"><p>少し時間があるんだけど、
何をしたらいい?</p></td>
</tr>
<tr class="answer">
<td align="left" valign="top"></td>
<td align="left" valign="top">
<p>これは、まだよく尋ねられてはいないのですが、
答えてしまいます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><span class="command"><strong>pkg_chk -N</strong></span> (このコマンドは
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_chk/README.html" target="_top"><code class="filename">pkgtools/pkg_chk</code></a> パッケージにあります) を実行します。
    こうすると、インストールしているパッケージについて、
    もっと新しいバージョンがあるが pkgsrc では更新されていないものを教えてくれます。</p></li>
<li class="listitem"><p><code class="filename">pkgsrc/doc/TODO</code> を見ます
    &mdash; このファイルには、提案されている新しいパッケージの一覧と、
    実現したらよい pkgsrc の整理や拡張の一覧が載っています。</p></li>
<li class="listitem"><p><a class="ulink" href="http://pkgsrc-wip.sourceforge.net/" target="_top">pkgsrc-wip</a> review
    メーリングリストでレビュー依頼が出ているパッケージをレビューします。</p></li>
</ul></div>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="chapter" title="Chapter 23. GNOME のパッケージングおよび移植">
<div class="titlepage"><div><div><h2 class="title">
<a name="gnome"></a>Chapter 23. GNOME のパッケージングおよび移植</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#meta-packages">23.1. メタパッケージ</a></span></dt>
<dt><span class="sect1"><a href="#new-package">23.2. GNOME アプリケーションをパッケージングする</a></span></dt>
<dt><span class="sect1"><a href="#full-update">23.3. GNOME を新バージョンに更新する</a></span></dt>
<dt><span class="sect1"><a href="#patching">23.4. 修正の指針</a></span></dt>
</dl>
</div>
<p><a class="ulink" href="http://www.gnome.org/" target="_top">GNOME の web
サイト</a>によれば、</p>
<div class="blockquote"><blockquote class="blockquote"><p>GNOME プロジェクトでは二つのものを提供します: 一つは、
  利用者にとって直観的で魅力的なデスクトップである GNOME デスクトップ環境です。
  もう一つは、アプリケーション構築用の広範な枠組である GNOME
  開発プラットフォームで、その他のデスクトップに統合されています。</p></blockquote></div>
<p>pkgsrc を使うと、<span class="emphasis"><em>多くのプラットフォームのもとで</em></span>、
完全な GNOME 環境の自動的な構築やインストールを透過的におこなうことができます。
pkgsrc は、buildlink3 技術、ラッパーとツールの枠組や、
設定ファイルの自動処理があることから、
GNOME の構築およびパッケージングシステムとして最も高度なもののひとつであると、
自信を持っていうことができます。
インストールされたソフトウェアの構成要素を、
完全にきれいにアンインストールできるようにするため、
多くの取り組みがおこなわれています。</p>
<p>pkgsrc は <a class="ulink" href="http://www.NetBSD.org/" target="_top">NetBSD</a> の公式パッケージングシステムなので、
上述したことはすなわち、NetBSD のもとで GNOME が機能するようにするために、
多大な取り込みがおこなわれているということです。最近では、<a class="ulink" href="http://www.dragonflybsd.org/" target="_top">DragonFly BSD</a> も
pkgsrc をパッケージングシステムとして採用しており、
同 OS のもとで GNOME の構築やインストールができるようにするため、
移植性に関する修正を数多く寄せてくれています。</p>
<div class="note" title="あなたの力が必要です" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">あなたの力が必要です</h3>
<p>あなたの空き時間を NetBSD のために使っていただけたら、 pkgsrc
  および GNOME は、おもしろげな新機能の導入に注力することができます。まずは<a class="ulink" href="http://www.NetBSD.org/contrib/projects.html#gnome" target="_top">保留中の作業
  </a>の一覧をご覧ください。NetBSD のもとで
  GNOME デスクトップを完全に機能させるまでには、まだ長い道が残っているため、
  あなたの助けが必要なのです。</p>
</div>
<div class="sect1" title="23.1. メタパッケージ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="meta-packages"></a>23.1. メタパッケージ</h2></div></div></div>
<p>pkgsrc には、GNOME 関連のメタパッケージが三つあります。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/gnome-base/README.html" target="_top"><code class="filename">meta-pkgs/gnome-base</code></a>: GNOME
    デスクトップ環境の中核部分を提供します。
    これは GNOME を正常に起動させるために必要なものだけからなっており、
    日々の操作をするうえで重要な機能が足りないかもしれません。
    このパッケージの考え方は、
    末端利用者がこのパッケージの上層で独自の構成をできるようにするためのものであり、
    このメタパッケージをまずインストールして最低限の機能を整えてから、
    個々のアプリケーションを追加するというものです。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/gnome/README.html" target="_top"><code class="filename">meta-pkgs/gnome</code></a>: GNOME
    プロジェクトが定義する GNOME プラットフォームおよびデスクトップの、
    完全なインストールを提供します。これは、GNOME の公式 FTP サーバーの
    <code class="filename">platform/x.y/x.y.z/sources</code> および
    <code class="filename">desktop/x.y/x.y.z/sources</code>
    ディレクトリーで配布されている構成要素にもとづいています。
    このディレクトリーにある開発者専用ツールは、他の構成要素の正常動作のために必要な場合以外は、
    インストールされません。同様に、バインディングセット附属のパッケージ
    (<code class="filename">bindings/x.y/x.y.z/sources</code>)
    も、末端利用者向けの構成要素からの依存により必要な場合以外は、
    含まれません。このパッケージは、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/gnome-base/README.html" target="_top"><code class="filename">meta-pkgs/gnome-base</code></a> を「拡張」するものです。</p></li>
<li class="listitem"><p><a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/gnome-devel/README.html" target="_top"><code class="filename">meta-pkgs/gnome-devel</code></a>:
    GNOME の構成要素を CVS リポジトリーから取得した場合用に、
    その構築のために必要なツールをすべてインストールします。
    これらは
    <span class="command"><strong>autogen.sh</strong></span> スクリプトを正常に動かすために必要なものです。</p></li>
</ul></div>
<p>以上の各パッケージでは、更新を簡単にできるようにするため、
<code class="varname">DEPENDS</code> 行が依存性にもとづく順序で並べられています。
あるパッケージが、それより前に並んでいるパッケージに依存することはできますが、
後に並んでいるパッケージに依存することはできません。この順序を守ることは、
更新を簡単にするために非常に重要なことです。<span class="emphasis"><em>これを、
アルファベット順に並びかえてはいけません。</em></span></p>
</div>
<div class="sect1" title="23.2. GNOME アプリケーションをパッケージングする">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="new-package"></a>23.2. GNOME アプリケーションをパッケージングする</h2></div></div></div>
<p>ほとんどすべての GNOME アプリケーションは C で書かれており、
構築システムとして共通のツール一式を使っています。C 以外の言語 (Python など)
を新たに追加する場合は事情が異なりますが、
最低限必要なツールについては、以下のことが参考になるでしょう。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
<p>ほとんどすべての GNOME アプリケーションは、構築システムとして
    GNU Autotool を使っています。GNOME に限らない一般的な決めごととして、
    このことをパッケージに教えてやる必要があります。</p>
<pre class="programlisting">
GNU_CONFIGURE=yes
USE_LIBTOOL=yes
USE_TOOLS+=gmake
</pre>
</li>
<li class="listitem">
<p>パッケージが pkg-config を使って依存性を決めている場合は、
    必要なユーティリティーのリストに同ツールを追加します。</p>
<pre class="programlisting">USE_TOOLS+=pkg-config</pre>
<p>さらに、構築の過程の最後で
    <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/verifypc/README.html" target="_top"><code class="filename">pkgtools/verifypc</code></a> を使って、
    作ったパッケージのなかで指定した依存性に間違いがなく、
    要求バージョンもすべて正しいことを確認します。</p>
</li>
<li class="listitem"><p>パッケージが intltool を使う場合は、依存性を処理するため、また、
    利用可能な最新バージョンを使うようにするため、かならず
    <code class="literal">intltool</code> を <code class="varname">USE_TOOLS</code>
    に追加します。</p></li>
<li class="listitem">
<p>パッケージが gtk-doc (ドキュメンテーション生成ユーティリティー)
    を使う場合は、依存性を追加しては<span class="emphasis"><em>いけません</em></span>。
    このツールは巨大なものですし、
    パッケージの distfile には生成済みのドキュメンテーションが附属しているはずだからです
    (そうなっていない場合はバグですので、報告してください)。
    このようなパッケージでは、以下のようにして gtk-doc を無効化するようにします
    (標準で無効になっている場合を除く)。</p>
<pre class="programlisting">CONFIGURE_ARGS+=--disable-gtk-doc</pre>
<p>HTML ファイルの標準でのインストール場所
    (<code class="filename">share/gtk-doc/&lt;package-name&gt;</code>) は適切なものなので、
    パッケージが別の場所へのインストールを要求した場合以外は変更しないようにします。
    場所を変更すると、<span class="command"><strong>devhelp</strong></span>
    などのプログラムがファイルを開けなくなってしまいます。
    場所の変更は、以下のようにしておこなうことができます。</p>
<pre class="programlisting">CONFIGURE_ARGS+=--with-html-dir=${PREFIX}/share/gtk-doc/...</pre>
</li>
</ul></div>
<p>GNOME は、インストール用プレフィックスの下に複数の
<span class="emphasis"><em>共有</em></span>ディレクトリーおよびファイルをもっており、
データベースの保守のために使っています。ここでいう共有とは、
同じディレクトリーやファイルを複数の異なるパッケージが使うことであり、
<code class="filename">PLIST</code> の内容の衝突を起こします。
現在、pkgsrc にはもっともありがちな部類の事例を扱うための仕組みがあるので、
ファイルのリストには必ず
<code class="literal">@unexec ${RMDIR}</code> という行を書くようにし、
共有のファイルは書かないようにしてください。
この仕組みを使わずに独自の処理をしてしまうと、
<span class="emphasis"><em>作成したパッケージが、正しくないものになってしまうでしょう</em></span>。</p>
<p>以下の表は、共有ディレクトリーまたはファイルを使うような、
ありがちな状況を挙げたものです。各状況について、適切な処置を示しています。
ここで示した処置を適用した後は、
<span class="command"><strong>make print-PLIST</strong></span> を使って
<span class="emphasis"><em>パッケージのファイルのリストを作り直し</em></span>、
それが正しいことを確認してください。</p>
<div class="table">
<a name="plist-handling"></a><p class="title"><b>Table 23.1. GNOME パッケージ用の PLIST の扱い</b></p>
<div class="table-contents"><table summary="GNOME パッケージ用の PLIST の扱い" border="1">
<colgroup>
<col>
<col>
</colgroup>
<thead><tr>
<th>パッケージの挙動</th>
<th>処置</th>
</tr></thead>
<tbody>
<tr>
<td>
<code class="filename">share/omf</code> 以下に OMF ファイルをインストールする。</td>
<td>
<a class="xref" href="#scrollkeeper-data-files" title="19.6.10. scrollkeeper/rarian のデータファイルをインストールするパッケージ">Section 19.6.10, “scrollkeeper/rarian のデータファイルをインストールするパッケージ”</a>参照。</td>
</tr>
<tr>
<td>
<code class="filename">share/icons/hicolor</code>
        階層以下にアイコンをインストールする、または
        <code class="filename">share/icons/hicolor/icon-theme.cache</code> を更新する。</td>
<td>
<a class="xref" href="#hicolor-theme" title="19.6.19. ハイカラーテーマのアイコンをインストールするパッケージ">Section 19.6.19, “ハイカラーテーマのアイコンをインストールするパッケージ”</a>参照。</td>
</tr>
<tr>
<td>
<code class="filename">share/mime/packages</code>
        以下にファイルをインストールする。</td>
<td>
<a class="xref" href="#mime-database" title="19.6.14. MIME データベースの拡張をインストールするパッケージ">Section 19.6.14, “MIME データベースの拡張をインストールするパッケージ”</a>参照。</td>
</tr>
<tr>
<td>
<code class="filename">share/applications</code> 以下に
        <code class="filename">.desktop</code> ファイルをインストールし、かつそのファイルに MIME
        情報が含まれる。</td>
<td>
<a class="xref" href="#desktop-files" title="19.6.20. デスクトップファイルをインストールするパッケージ">Section 19.6.20, “デスクトップファイルをインストールするパッケージ”</a>参照。</td>
</tr>
</tbody>
</table></div>
</div>
<br class="table-break">
</div>
<div class="sect1" title="23.3. GNOME を新バージョンに更新する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="full-update"></a>23.3. GNOME を新バージョンに更新する</h2></div></div></div>
<p>GNOME を全体として見た場合、
二種類の更新があります。</p>
<div class="variablelist"><dl>
<dt><span class="term">メジャーアップデート</span></dt>
<dd>
<p>GNOME 3 (がいつか登場したとして) への道程は、まだ相当長いものなので、
      ここでは、バージョンが <code class="literal">2.X</code> から <code class="literal">2.Y</code>
      (<code class="literal">Y</code> は <code class="literal">X</code> より大きい偶数)
      に上がることをメジャーアップデートということにします。
      メジャーアップデートでは構成要素のコードに多くの変更がおこなわれており、
      GNOME のほとんどすべての distfile が新しいバージョンに更新されているため、
      更新は面倒な作業になります。変更のなかには、
      以前のバージョン系列との API や ABI の互換性を損なうものがあることもあります。
      このような事情があるので、破損を最小限にするために、
      更新は一度にまとめておこなう必要があります。</p>
<p>通常、メジャーアップデートでは、
      約 80 個のパッケージが更新されるほか、新しいパッケージがいくつか追加されます。</p>
</dd>
<dt><span class="term">マイナーアップデート</span></dt>
<dd>
<p>ここでは、バージョンが <code class="literal">2.A.X</code> から <code class="literal">2.A.Y</code>
      (<code class="literal">Y</code> は <code class="literal">X</code> より大きい数)
      に上がることをマイナーアップデートということにします。
      GNOME の構成要素すべてが更新されるわけではないことや、
      枝内でのバージョン増大に沿った形でおこなうことができ、
      API や ABI の互換性が失われないことなどから、
      更新は簡単におこなうことができます。</p>
<p>マイナーアップデートで更新されるパッケージ数は、
      大きく変動することがありますが、通常は約 50 個です。</p>
</dd>
</dl></div>
<p>pkgsrc の GNOME 構成要素を新しい安定版リリース
(メジャーまたはマイナー) に更新するためには、
以下の手順に沿っておこなうようにします。</p>
<div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">
<p>以下のコマンドを使って、新しいリリースを構成する tarball
    の一覧を作ります。
    こうすると、構成要素の distfile の全一覧が
    <code class="filename">list.txt</code> ファイルに得られます。</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>echo ls "*.tar.bz2" | \
    ftp -V ftp://ftp.gnome.org/pub/gnome/platform/x.y/x.y.z/sources/ | \
    awk '{ print $9 }' &gt;list.txt</code></strong>
<code class="prompt">%</code> <strong class="userinput"><code>echo ls "*.tar.bz2" | \
    ftp -V ftp://ftp.gnome.org/pub/gnome/desktop/x.y/x.y.z/sources/ | \
    awk '{ print $9 }' &gt;&gt;list.txt</code></strong></pre>
</li>
<li class="listitem"><p>各メタパッケージの <code class="filename">Makefile</code> を開き、
    バージョンを更新後のリリースのものに上げます。
    3 個のメタパッケージは常にバージョンに整合性をもたせるようにします。
    <code class="varname">PKGREVISION</code> がある場合は、
    当然、削除します。</p></li>
<li class="listitem">
<p>各メタパッケージについて、
    <code class="varname">DEPENDS</code> 行を更新して、
    前掲のコマンドで得られた最新バージョンと合致するようにします。
    これより新しいバージョンにしては (たとえそれが FTP サーバーにあったとしても)
    <span class="emphasis"><em>いけません</em></span>。このメタパッケージは、
    特定の GNOME リリースを構成するバージョンだけを揃えることを意図したものだからです。
    ただし、統合デスクトップを使用する上での深刻な問題が新しいバージョンで解決する場合には、
    例外的に認められます。これは、たいていの場合、
    GNOME による新しいバージョンは使わずに、
    pkgsrc 内でのリビジョンを上げる形をとります。</p>
<p><code class="filename">list.txt</code> ファイルに現れないパッケージは、
    利用可能な最新バージョンに (pkgsrc にそれがあれば) アップデートするようにします。
    たとえば、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/gnome-devel/README.html" target="_top"><code class="filename">meta-pkgs/gnome-devel</code></a> メタパッケージに含まれるパッケージのうち
    GNU Autotools に依存するパッケージがこれに該当します。</p>
</li>
<li class="listitem">
<p>変更後のメタパッケージからパッチを作り、そこから「新規の」行を抽出します。
    この結果から、pkgsrc のどのパッケージをどの順序でアップデートする必要があるか、
    概要がわかります。</p>
<pre class="screen"><code class="prompt">%</code> <strong class="userinput"><code>cvs diff -u gnome-devel gnome-base gnome | grep '^+D' &gt;todo.txt</code></strong></pre>
</li>
<li class="listitem"><p>デスクトップのメジャーアップデートの場合は、
    インストールされているパッケージをすべて削除し、まっさらな状態から始めることをおすすめします。</p></li>
<li class="listitem"><p>ここが、もっとも長い作業が必要なところです。
    <code class="filename">todo.txt</code> に書き出された各パッケージを、
    並んでいる順序どおりに更新するという作業を繰り返します。
    デスクトップのメジャーアップデートの場合は、
    全パッケージの更新が完了するまで commit してはいけません。
    未更新のパッケージを壊す可能性があるからです。</p></li>
<li class="listitem"><p>パッケージが新しいものになり動作する状態になったら、
    個々のパッケージを一つずつ、適切な log メッセージをつけて commit してゆきます。
    最後に、3 個のメタパッケージの更新と、これらに対応する
    <code class="filename">doc/CHANGES-&lt;YEAR&gt;</code> および
    <a href="http://cvsweb.NetBSD.org/bsdweb.cgi/pkgsrc/doc/TODO?rev=HEAD&amp;content-type=text/x-cvsweb-markup" target="_top"><code class="filename">pkgsrc/doc/TODO</code></a> ファイルの変更を
    commit します。</p></li>
</ol></div>
</div>
<div class="sect1" title="23.4. 修正の指針">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="patching"></a>23.4. 修正の指針</h2></div></div></div>
<p>GNOME は 100 のパッケージを擁する、pkgsrc の大きな構成要素です。
GNOME パッケージに移植性に関する修正を施した場合は、常に、常に、
<span class="strong"><strong>常に</strong></span>、
GNOME 本家の開発者に還元していただくということが重要です (<a class="xref" href="#components.patches.feedback" title="11.3.5. 作者へのフィードバック">Section 11.3.5, “作者へのフィードバック”</a>参照)。
彼らに移植性についての注意を喚起して、将来のバージョンが無修正で
NetBSD で構築できるようにするためには、そうするしかないのです。
pkgsrc 独自のパッチを少なくすればするほど、将来の更新は楽になります。
GNOME のメジャーアップデート対応に取り組む開発者としては、
皆さんにそのようにしていただけるとありがたく思います。</p>
<p>最もありふれたバグの報告先は、<a class="ulink" href="http://bugzilla.gnome.org/" target="_top">GNOME の Bugzilla</a> と <a class="ulink" href="http://bugzilla.freedesktop.org/" target="_top">freedesktop.org の
Bugzilla</a> です。GNOME の構成要素すべてがこれらをバグ追跡用に使っているわけではありませんが、
ほとんどはこれらを使っています。バグ報告に際しては、常に、
現在起きている問題や、移植性を最大限にするためにはどのように改良したらよいかについて、
詳細に説明するようにし、また、可能であれば CVS の head に対するパッチをつけてください。
詳しく書けば書くほど、パッチが採用される可能性が高くなります。</p>
<p>また、プリプロセッサーを使った細工で移植性の問題を修正するようなことはしないでください。
FreeBSD で GNOME に取り組む人たちは、彼らのオペレーティングシステムへの GNOME の移植にあたり大きな仕事をしていますが、
このせいで、公式の GNOME のソースに <code class="varname">__FreeBSD__</code>
や、これと同類のマクロの検査が蔓延してしまっています。これは移植性を損なうものです。
詳細は、私たちのパッチ作成の指針
(<a class="xref" href="#components.patches.guidelines" title="11.3.4. パッチ作成の指針">Section 11.3.4, “パッチ作成の指針”</a>)
をご覧ください。</p>
</div>
</div>
</div>
<div class="part" title="Part III. pkgsrc 基盤の内部">
<div class="titlepage"><div><div><h1 class="title">
<a name="infrastructure"></a>Part III. pkgsrc 基盤の内部</h1></div></div></div>
<div class="partintro" title="pkgsrc 基盤の内部">
<div></div>
<p>この部では、
	開発者向けの手引きに書かれているインターフェースの背後にある基盤に関するあらゆることを扱います。
	パッケージのメンテナーをしているだけの人には、
	この部は必要ないはずです。</p>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="chapter"><a href="#infr.design">24. pkgsrc の基盤の設計</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#infr.vardef">24.1. 変数定義の意図するもの</a></span></dt>
<dt><span class="sect1"><a href="#infr.vardef.problems">24.2. 問題を未然に防ぐ</a></span></dt>
<dt><span class="sect1"><a href="#infr.var">24.3. 変数の評価</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.var.load">24.3.1. 読み込み時</a></span></dt>
<dt><span class="sect2"><a href="#infr.var.run">24.3.2. 実行時</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#infr.varspec">24.4. 変数の仕様を定める方法は?</a></span></dt>
<dt><span class="sect1"><a href="#infr.design.intf">24.5. Makefile の断片のインターフェースを設計する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.design.intf.proc">24.5.1. 引数を伴うプロシージャー</a></span></dt>
<dt><span class="sect2"><a href="#infr.design.intf.action">24.5.2. 引数に応じたアクション</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#infr.order">24.6. ファイルが読み込まれる順序</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.order.prefs">24.6.1. <code class="filename">bsd.prefs.mk</code> での順序</a></span></dt>
<dt><span class="sect2"><a href="#infr.order.pkg">24.6.2. <code class="filename">bsd.pkg.mk</code> での順序</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#regression">25. 退行テスト</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#regression.descr">25.1. 退行テストの枠組</a></span></dt>
<dt><span class="sect1"><a href="#regression.run">25.2. 退行テストを実行する</a></span></dt>
<dt><span class="sect1"><a href="#regression.new">25.3. 新しい退行テストを追加する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#regression.fun.override">25.3.1. 上書き可能な関数</a></span></dt>
<dt><span class="sect2"><a href="#regression.fun.helper">25.3.2. 補助関数</a></span></dt>
</dl></dd>
</dl></dd>
<dt><span class="chapter"><a href="#porting">26. pkgsrc を移植する</a></span></dt>
<dd><dl>
<dt><span class="sect1"><a href="#porting.opsys">26.1. pkgsrc を未対応のオペレーティングシステムに新たに移植する</a></span></dt>
<dt><span class="sect1"><a href="#porting.compiler">26.2. 未対応のコンパイラーに新たに対応させる</a></span></dt>
</dl></dd>
</dl>
</div>
</div>
<div class="chapter" title="Chapter 24. pkgsrc の基盤の設計">
<div class="titlepage"><div><div><h2 class="title">
<a name="infr.design"></a>Chapter 24. pkgsrc の基盤の設計</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#infr.vardef">24.1. 変数定義の意図するもの</a></span></dt>
<dt><span class="sect1"><a href="#infr.vardef.problems">24.2. 問題を未然に防ぐ</a></span></dt>
<dt><span class="sect1"><a href="#infr.var">24.3. 変数の評価</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.var.load">24.3.1. 読み込み時</a></span></dt>
<dt><span class="sect2"><a href="#infr.var.run">24.3.2. 実行時</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#infr.varspec">24.4. 変数の仕様を定める方法は?</a></span></dt>
<dt><span class="sect1"><a href="#infr.design.intf">24.5. Makefile の断片のインターフェースを設計する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.design.intf.proc">24.5.1. 引数を伴うプロシージャー</a></span></dt>
<dt><span class="sect2"><a href="#infr.design.intf.action">24.5.2. 引数に応じたアクション</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#infr.order">24.6. ファイルが読み込まれる順序</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#infr.order.prefs">24.6.1. <code class="filename">bsd.prefs.mk</code> での順序</a></span></dt>
<dt><span class="sect2"><a href="#infr.order.pkg">24.6.2. <code class="filename">bsd.pkg.mk</code> での順序</a></span></dt>
</dl></dd>
</dl>
</div>
<p>pkgsrc の基盤は、Makefile の小さな断片がたくさん集まってできています。
	それぞれの断片に、適切なインターフェースを定義することが必要です。
	本章では、そのようなインターフェースの何たるかを説明します。</p>
<div class="sect1" title="24.1. 変数定義の意図するもの">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="infr.vardef"></a>24.1. 変数定義の意図するもの</h2></div></div></div>
<p>pkgsrc の基盤において変数が定義されている場合、
	変数が定義されている場所や定義の方法自体が、
	その変数の使用目的について多くを語っています。
	また、変数を定義しているファイルの冒頭のコメントや、
	この手引きに、さらなる資料があることもあります。</p>
<p>特別なファイルとして、
	<code class="filename">mk/defaults/mk.conf</code> があります。このファイルには、
	利用者が定義する変数がすべて書かれています。
	これらの変数のなかには <code class="literal">?=</code> 演算子を使って定義されているものもありますが、
	そうでないものは、何かを定義すると <span class="quote">“<span class="quote">yes</span>”</span> を意味することになるため、
	定義されていません。これらの変数はすべて、
	pkgsrc 利用者が <code class="varname">MAKECONF</code>
	ファイルで定義して上書きすることができます。</p>
<p>このファイル以外では、以下のようなならわしとなっています。
	<code class="literal">?=</code> 演算子を使って定義されている変数は、
	個々のパッケージで上書きすることができます。</p>
<p>また、<code class="literal">=</code> 演算子を使って定義されている変数は、
	実行時に読み出し専用で使うことができます。</p>
<p>変数名が下線で始まる変数は、
	pkgsrc の基盤以外からは一切読み書きできません。
	これらは、特記のない限り、変更してもかまいません。</p>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>以上のならわしは、現在のところ、
	pkgsrc の基盤全体に一貫して適用されているわけではありません。</p>
</div>
</div>
<div class="sect1" title="24.2. 問題を未然に防ぐ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="infr.vardef.problems"></a>24.2. 問題を未然に防ぐ</h2></div></div></div>
<p>リストを含む変数はすべて、標準状態では空になっているものです。
	このならわしに従わない変数は、
	<code class="varname">USE_LANGUAGES</code> と
	<code class="varname">DISTFILES</code> の二つです。この二変数は、
	パッケージの <code class="filename">Makefile</code>
	(その他、ここからインクルードされるファイル) において、
	<code class="literal">+=</code> 演算子を使って単純に変更することができません。
	あらかじめ値が設定されているかどうかや、
	何が設定されているかがまったくわからないからです。
	<code class="varname">DISTFILES</code> については、
	パッケージ側で標準の値が<span class="quote">“<span class="quote">わかっている</span>”</span>ので、
	以下の例のように定義するだけですみます。</p>
<pre class="programlisting">
DISTFILES=      ${DISTNAME}${EXTRACT_SUFX} additional-files.tar.gz
</pre>
<p>このような標準の値を使っているために、
	同じ値が多くのパッケージの Makefile に現れます。
	<code class="varname">USE_LANGUAGES</code> についても同様ですが、
	こちらは、標準の値 (<span class="quote">“<span class="quote"><code class="literal">c</code></span>”</span>)
	が非常に短いために目立ちません。
	とはいえ、多くのファイルにこの値が書かれています。</p>
</div>
<div class="sect1" title="24.3. 変数の評価">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="infr.var"></a>24.3. 変数の評価</h2></div></div></div>
<div class="sect2" title="24.3.1. 読み込み時">
<div class="titlepage"><div><div><h3 class="title">
<a name="infr.var.load"></a>24.3.1. 読み込み時</h3></div></div></div>
<p>変数の評価は、変数が使われる文脈によって、
	読み込み時におこなわれる場合と、実行時におこなわれる場合があります。
	変数が読み込み時に評価されるのは、以下のような文脈においてです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="literal">:=</code>
	および <code class="literal">!=</code> 演算子の右辺</p></li>
<li class="listitem"><p><code class="literal">.if</code> や
	<code class="literal">.for</code> のような make ディレクティブ</p></li>
<li class="listitem"><p>(訳註: <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?make+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">make</span>(1)</span></a> の) 依存性を記述した行。</p></li>
</ul></div>
<p>特別な例外として、<code class="literal">.for</code> ループの反復変数があります。
	これは、どの文脈で使われるかにかかわらず、
	インライン展開されます。</p>
<p>変数の値は読み込みによって変わる可能性があるので、
	誤って評価することのないよう注意する必要があります。
	読み込み時に評価してはいけない変数の典型例は、
	<code class="varname">DEPENDS</code> および
	<code class="varname">CONFIGURE_ARGS</code> です。
	評価の結果何が起きるかをわかりやすくするため、
	以下の例を見てください。</p>
<pre class="programlisting">
CONFIGURE_ARGS=         # none
CFLAGS=                 -O
CONFIGURE_ARGS+=        CFLAGS=${CFLAGS:Q}

CONFIGURE_ARGS:=        ${CONFIGURE_ARGS}

CFLAGS+=                -Wall
	</pre>
<p>このコードからわかることは、<code class="literal">:=</code> 演算子を使うと、
	容易に、予期しない結果を生むということです。
	最初の段落はごくふつうのコードです。二つ目の段落では
	<code class="varname">CONFIGURE_ARGS</code> を評価しており、この結果、
	<code class="literal">CFLAGS=-O</code> になります。三つ目の段落では、
	<code class="literal">-Wall</code> を
	<code class="varname">CFLAGS</code> に付け加えていますが、この追加が
	<code class="varname">CONFIGURE_ARGS</code> には反映されません。
	実際のコードではたいてい、
	この三つの段落が完全に無関係のファイルに現れます。</p>
</div>
<div class="sect2" title="24.3.2. 実行時">
<div class="titlepage"><div><div><h3 class="title">
<a name="infr.var.run"></a>24.3.2. 実行時</h3></div></div></div>
<p>ファイルがすべて読み込まれた後は、変数の値は一切変更することができません。
	シェルコマンド内で使われる変数は、
	この時点で展開されます。</p>
</div>
</div>
<div class="sect1" title="24.4. 変数の仕様を定める方法は?">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="infr.varspec"></a>24.4. 変数の仕様を定める方法は?</h2></div></div></div>
<p>バグや (ほとんどは文書化されていない)
	方針への違反を検出するために、
	変数の定義や使い方を制限する方法はたくさんあります。詳細は、
	<code class="literal">pkglint</code> の開発者向けドキュメンテーションをご覧ください。</p>
</div>
<div class="sect1" title="24.5. Makefile の断片のインターフェースを設計する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="infr.design.intf"></a>24.5. Makefile の断片のインターフェースを設計する</h2></div></div></div>
<p>ほとんどの <code class="filename">.mk</code> ファイルは、
	以下の二種類のいずれかに分類されます。
	一つのファイルが複数の種類の性質を持つと、
	見つけにくいバグの原因となることがしばしばあるので、そういうことは避けるようにします。</p>
<div class="sect2" title="24.5.1. 引数を伴うプロシージャー">
<div class="titlepage"><div><div><h3 class="title">
<a name="infr.design.intf.proc"></a>24.5.1. 引数を伴うプロシージャー</h3></div></div></div>
<p>伝統的な命令型プログラミング言語の言葉で説明すると、
	いくつかの <code class="filename">.mk</code> ファイルはプロシージャーということになります。
	プロシージャーは入力引数をとり、&mdash;インクルードされた後に&mdash;
	出力引数を返します。<code class="filename">Makefile</code>
	内の変数はすべて大域的なスコープをもつため、
	すでに別の意味で使われている引数名を使わないよう注意する必要があります。
	たとえば、<code class="varname">PKGNAME</code>
	は、引数名としては不適切なものです。</p>
<p>プロシージャーは、プリプロセッシングの際に完全に評価されます。
	このため、プロシージャーを呼ぶときには、
	入力引数はすべて完全に解決可能である必要があります。たとえば、
	<code class="varname">CONFIGURE_ARGS</code> は、たいていは、
	プロシージャーを呼んだ後にテキストが追加されることから、
	変数の一部しかプロシージャーに渡されないことになるので、
	決して入力引数として使ってはいけません。
	また、他の変数から導かれる値への参照は、
	プロシージャーの呼び出しの後に更新されます。</p>
<p>プロシージャーは、その出力引数を、
	プリプロセッシングディレクティブ内で使うものとして、または、
	実行時のみに利用可能なものとして、いずれかを宣言することができます。
	後者は、他の実行時変数への参照を含む変数用です。</p>
<p>プロシージャーは、複数の呼び出しが可能なように書くものです。
	つまり、ファイルに多重インクルードの防護策を施してはいけません。</p>
<p>プロシージャーの例としては、
	<code class="filename">mk/bsd.options.mk</code> や
	<code class="filename">mk/buildlink3/bsd.builtin.mk</code> があります。
	引数が読み込み時に評価されることを表すため、
	引数は <code class="literal">:=</code> 演算子を使って与えます。
	この演算子は、この目的のためだけに使うようにします。</p>
</div>
<div class="sect2" title="24.5.2. 引数に応じたアクション">
<div class="titlepage"><div><div><h3 class="title">
<a name="infr.design.intf.action"></a>24.5.2. 引数に応じたアクション</h3></div></div></div>
<p>アクションファイルは、入力引数をとり、
	実行時変数を定義することができます。
	読み込み時変数を定義することはできません。
	アクションファイルには
	pkgsrc の基盤によって暗黙のうちにインクルードされるものもありますが、
	そのようなもの以外は明示的にインクルードする必要があります。</p>
<p>アクションファイルの例としては、
	<code class="filename">mk/subst.mk</code> があります。</p>
</div>
</div>
<div class="sect1" title="24.6. ファイルが読み込まれる順序">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="infr.order"></a>24.6. ファイルが読み込まれる順序</h2></div></div></div>
<p>パッケージの <code class="filename">Makefile</code> は、通常、
	一連の変数の定義からできており、最後の行で
	<code class="filename">../../mk/bsd.pkg.mk</code> ファイルをインクルードしています。
	コンパイラーや X11 の実装の種類など、
	特定の機能の有無を問い合わせる必要がある場合は、
	最後のインクルードの前に、これ以外の各種
	<code class="filename">*.mk</code> ファイルをインクルードすることができます。
	<code class="literal">.if</code> や
	<code class="literal">.for</code> のようなプリプロセッサーディレクティブを多用しているので、
	ファイルを読み込む場所と順序が問題になります。</p>
<p>本節では、各種ファイルをどこで読み込むか、
	および、その順序の理由を説明します。</p>
<div class="sect2" title="24.6.1. bsd.prefs.mk での順序">
<div class="titlepage"><div><div><h3 class="title">
<a name="infr.order.prefs"></a>24.6.1. <code class="filename">bsd.prefs.mk</code> での順序</h3></div></div></div>
<p><code class="filename">bsd.prefs.mk</code> で最初におこなわれることは、
	<code class="varname">OPSYS</code>, <code class="varname">OS_VERSION</code>,
	<code class="varname">MACHINE_ARCH</code> など、基本的な変数をいくつか定義することです。</p>
<p>次に、<code class="varname">MAKECONF</code> (通常は <a class="link" href="#mk.conf"><code class="filename">mk.conf</code></a>)
	で指定されているファイルから、ユーザーによる設定が読み込まれます。
	それから、ユーザーによって上書きされたもの以外の変数が
	<code class="filename">mk/defaults/mk.conf</code> から読み込まれます。</p>
<p>ユーザーによる設定の後に、
	システムの設定とプラットフォームの設定が読み込まれます。
	これらはユーザーによる設定を上書きすることがあります。</p>
<p>その後、ツールの定義が読み込まれます。
	この時点では、ツールのラッパーはまだ影響しません。
	ラッパーは、パッケージを構築する時に影響をおよぼします。
	このため、ツール名を直接使うのではなく、適切な変数を使う必要があります。</p>
<p>最後に、ラッパーおよびパッケージシステムのフレーバーから、
	必須の変数がいくつか、
	パッケージ構築過程の初期段階でキャッシュされていた変数とともに、
	読み込まれます。</p>
</div>
<div class="sect2" title="24.6.2. bsd.pkg.mk での順序">
<div class="titlepage"><div><div><h3 class="title">
<a name="infr.order.pkg"></a>24.6.2. <code class="filename">bsd.pkg.mk</code> での順序</h3></div></div></div>
<p>最初に、<code class="filename">bsd.prefs.mk</code> が読み込まれます。</p>
<p>次に、パッケージ側で定義されない変数の標準状態の値を定義している、
	各種の <code class="filename">*-vars.mk</code> ファイルが読み込まれます。
	この変数は、後になって、無関連のファイルで使われる可能性もあります。</p>
<p>その次に、<code class="filename">bsd.pkg.error.mk</code> ファイルから
	<code class="literal">error-check</code> ターゲットが提供されます。
	このターゲットは、
	<code class="varname">DELAYED_ERROR_MSG</code> または
	<code class="varname">DELAYED_WARNING_MSG</code>
	を使う他のターゲットすべてに対して、特別な依存性として追加されます。</p>
<p>その後、<code class="filename">hacks.mk</code> から、
	パッケージ固有のハックがインクルードされます。</p>
<p>そして、他の各種ファイルのインクルードが続きます。
	この段階でインクルードされるファイルのほとんどは、
	インクルードされる順序に関して依存性を持ちませんが、
	なかには依存性を持つものもあります。</p>
<p>ここで、<code class="varname">PKG_FAIL_REASON</code> と
	<code class="varname">PKG_SKIP_REASON</code> を検査するコードが実行されます。
	ここまでの段階でインクルードされるすべてのファイルに対しては、
	この両変数の使用が制限されます。
	これより後にインクルードされるファイルでは、黙って無視されます。</p>
<p>それから、目的のターゲットに対応するファイルが、
	この後で実行される順序でインクルードされますが、
	実際の順序は問題とはならないはずです。</p>
<p>最後に、何ら興味深い変数を設定するものではなく、
	実行される make ターゲットを定義するだけのファイルが、
	さらにいくつかインクルードされます。</p>
</div>
</div>
</div>
<div class="chapter" title="Chapter 25. 退行テスト">
<div class="titlepage"><div><div><h2 class="title">
<a name="regression"></a>Chapter 25. 退行テスト</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#regression.descr">25.1. 退行テストの枠組</a></span></dt>
<dt><span class="sect1"><a href="#regression.run">25.2. 退行テストを実行する</a></span></dt>
<dt><span class="sect1"><a href="#regression.new">25.3. 新しい退行テストを追加する</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#regression.fun.override">25.3.1. 上書き可能な関数</a></span></dt>
<dt><span class="sect2"><a href="#regression.fun.helper">25.3.2. 補助関数</a></span></dt>
</dl></dd>
</dl>
</div>
<p>pkgsrc の基盤は多くのコードベースの集合体であり、
	熟考のすえ作られた各小片の周辺を少し変更しただけで
	pkgsrc が使い物にならなくなるであろう曲り角がたくさんあります。
	ほとんどの変更によって pkgsrc が壊されることを防ぐため、
	pkgsrc の基盤の重要な部分に変更を加える場合は、
	常に一連の退行テストを実行するようにします。
	本章では、pkgsrc において退行テストがどのように機能するか、および、
	新しいテストをどのように追加すればよいかを、説明します。</p>
<div class="sect1" title="25.1. 退行テストの枠組">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="regression.descr"></a>25.1. 退行テストの枠組</h2></div></div></div>
<p></p>
</div>
<div class="sect1" title="25.2. 退行テストを実行する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="regression.run"></a>25.2. 退行テストを実行する</h2></div></div></div>
<p>まず、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkg_regress/README.html" target="_top"><code class="filename">pkgtools/pkg_regress</code></a> パッケージをインストールする必要があります。
	このパッケージには <span class="command"><strong>pkg_regress</strong></span> コマンドが附属しており、
	あとは、このコマンドを実行するだけで、
	<code class="filename">regress</code> カテゴリーにあるテストをすべて実行してくれます。</p>
</div>
<div class="sect1" title="25.3. 新しい退行テストを追加する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="regression.new"></a>25.3. 新しい退行テストを追加する</h2></div></div></div>
<p><code class="filename">regress</code> カテゴリー内のディレクトリーのうち、
	<code class="filename">spec</code> というファイルを含むものは、
	それぞれがひとつの退行テストに対応しています。
	<code class="filename">spec</code> ファイルはシェルプログラムで、
	<span class="command"><strong>pkg_regress</strong></span> コマンドからインクルードされます。
	以下の関数は、必要に応じて上書きすることができます。</p>
<div class="sect2" title="25.3.1. 上書き可能な関数">
<div class="titlepage"><div><div><h3 class="title">
<a name="regression.fun.override"></a>25.3.1. 上書き可能な関数</h3></div></div></div>
<p>各関数は引数をとりません。関数はいずれも、
	<span class="quote">“<span class="quote">set -e</span>”</span> された状態の下で呼ばれるので、
	テストにおいて実行される各コマンドの終了コードを、
	注意して確認してください。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">do_setup()</code></span></dt>
<dd><p>この関数は、テスト用に環境変数を準備します。
	標準では、何もしません。</p></dd>
<dt><span class="term"><code class="varname">do_test()</code></span></dt>
<dd><p>この関数は、テストを実際に実行します。
	標準では、この関数は <code class="varname">TEST_MAKE</code> を
	引数 <code class="varname">MAKEARGS_TEST</code> で呼んで、
	エラーメッセージをはじめとする出力をファイル
	<code class="varname">TEST_OUTFILE</code> に書き込みます。</p></dd>
<dt><span class="term"><code class="varname">check_result()</code></span></dt>
<dd><p>この関数は、テスト実行後に実行するもので、
	ふつうは、実際の出力を予想したものと比較するために使います。
	これにより、次節のようなさまざまな補助関数が使えるようになります。</p></dd>
<dt><span class="term"><code class="varname">do_cleanup()</code></span></dt>
<dd><p>この関数は、テストの実行が終わった後に、
	すべての掃除をします。標準では、何もしません。</p></dd>
</dl></div>
</div>
<div class="sect2" title="25.3.2. 補助関数">
<div class="titlepage"><div><div><h3 class="title">
<a name="regression.fun.helper"></a>25.3.2. 補助関数</h3></div></div></div>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">exit_status(expected)</code></span></dt>
<dd><p>この関数は、<span class="command"><strong>do_test()</strong></span> 関数の終了コードを、
	第一引数と比較します。
	異なる場合は、テストは失敗します。</p></dd>
<dt><span class="term"><code class="varname">output_require(regex...)</code></span></dt>
<dd><p>この関数は、各引数について、
	<span class="command"><strong>do_test()</strong></span>
	の出力が拡張正規表現に一致することを検査します。
	一致しない場合、テストは失敗します。</p></dd>
<dt><span class="term"><code class="varname">output_prohibit(regex...)</code></span></dt>
<dd><p>この関数は、各引数について、
	<span class="command"><strong>do_test()</strong></span>
	の出力が拡張正規表現に一致<span class="emphasis"><em>しない</em></span>ことを検査します。
	いずれかの正規表現に一致する場合、テストは失敗します。</p></dd>
</dl></div>
</div>
</div>
</div>
<div class="chapter" title="Chapter 26. pkgsrc を移植する">
<div class="titlepage"><div><div><h2 class="title">
<a name="porting"></a>Chapter 26. pkgsrc を移植する</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#porting.opsys">26.1. pkgsrc を未対応のオペレーティングシステムに新たに移植する</a></span></dt>
<dt><span class="sect1"><a href="#porting.compiler">26.2. 未対応のコンパイラーに新たに対応させる</a></span></dt>
</dl>
</div>
<p>pkgsrc システムはすでに、多くのオペレーティングシステム、
	ハードウェアアーキテクチャー、およびコンパイラーに移植されています。
	本章では、pkgsrc
	の移植性をさらに高めるために必要な手順を説明します。</p>
<div class="sect1" title="26.1. pkgsrc を未対応のオペレーティングシステムに新たに移植する">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="porting.opsys"></a>26.1. pkgsrc を未対応のオペレーティングシステムに新たに移植する</h2></div></div></div>
<p>pkgsrc を未対応のオペレーティングシステム (以下、
	<code class="literal">MyOS</code> とします) に移植するには、
	以下のファイルを作成あるいは修正する必要があります。</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="filename">pkgtools/bootstrap-mk-files/files/mods/<em class="replaceable"><code>MyOS</code></em>.sys.mk</code></span></dt>
<dd><p>このファイルには、いくつかの基本的な定義、
	たとえば C
	コンパイラーの名前が含まれています。</p></dd>
<dt><span class="term"><code class="filename">mk/bsd.prefs.mk</code></span></dt>
<dd><p><code class="varname">OPSYS</code>, <code class="varname">OS_VERSION</code>,
	<code class="varname">LOWER_OS_VERSION</code>,
	<code class="varname">LOWER_VENDOR</code>,
	<code class="varname">MACHINE_ARCH</code>, <code class="varname">OBJECT_FMT</code>,
	<code class="varname">APPEND_ELF</code> の各変数、
	その他このファイルに書かれている各変数を定義するコードを追加します。</p></dd>
<dt><span class="term"><code class="filename">mk/platform/<em class="replaceable"><code>MyOS</code></em>.mk</code></span></dt>
<dd><p>このファイルには、
	pkgsrc が使用するプラットフォーム固有の定義が含まれています。
	まず他のプラットフォーム用のファイルのいずれかをコピーしてから、
	必要に応じて編集します。</p></dd>
<dt><span class="term"><code class="filename">mk/platform/<em class="replaceable"><code>MyOS</code></em>.pkg.dist</code></span></dt>
<dd><p>このファイルには、ディレクトリーを並べたリストが、
	パーミッションビットと所有権とともに含まれています。
	ここに含まれるディレクトリーは、明示的に <code class="varname">USE_MTREE</code>
	を設定している各パッケージのインストールに際して、
	自動的に作成されます。この機能は、
	廃止が予定されています。</p></dd>
<dt><span class="term"><code class="filename">mk/platform/<em class="replaceable"><code>MyOS</code></em>.x11.dist</code></span></dt>
<dd><p>既存の x11.dist ファイルのいずれかを、
	<code class="filename"><em class="replaceable"><code>MyOS</code></em>.x11.dist</code>
	にコピーするだけです。</p></dd>
<dt><span class="term"><code class="filename">mk/tools/bootstrap.mk</code></span></dt>
<dd><p>プラットフォームによっては、ベースシステム附属のツールが
	pkgsrc で使うには不十分なことがあります。
	たとえば <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?sed+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">sed</span>(1)</span></a> には、
	処理可能な行長が短く制限されているバージョンがたくさんあります。
	したがって、pkgsrc では別途ツールを用意しており、
	このファイルで有効化することができます。</p></dd>
<dt><span class="term"><code class="filename">mk/tools/tools.<em class="replaceable"><code>MyOS</code></em>.mk</code></span></dt>
<dd><p>このファイルでは、
	pkgsrc 自身が必要とするツールおよび、別のツールや
	pkgsrc のパッケージが必要とするツールすべてのパスを定義しています。
	これらのツールが移植対象のプラットフォームではどこにあるかを調べて、
	書き足します。</p></dd>
</dl></div>
<p>これで、<a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/lang/perl5/README.html" target="_top"><code class="filename">lang/perl5</code></a> や <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/shells/bash/README.html" target="_top"><code class="filename">shells/bash</code></a> のような、
	いくつかの基本的なパッケージが構築できるようになったはずです。</p>
</div>
<div class="sect1" title="26.2. 未対応のコンパイラーに新たに対応させる">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="porting.compiler"></a>26.2. 未対応のコンパイラーに新たに対応させる</h2></div></div></div>
<p>TODO</p>
</div>
</div>
</div>
<div class="appendix" title="Appendix A. パッケージの簡単な例: bison">
<div class="titlepage"><div><div><h2 class="title">
<a name="examples"></a>Appendix A. パッケージの簡単な例: bison</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#example-files">A.1. ファイル</a></span></dt>
<dd><dl>
<dt><span class="sect2"><a href="#example-Makefile">A.1.1. Makefile</a></span></dt>
<dt><span class="sect2"><a href="#example-descr">A.1.2. DESCR</a></span></dt>
<dt><span class="sect2"><a href="#example-plist">A.1.3. PLIST</a></span></dt>
<dt><span class="sect2"><a href="#checking-package-with-pkglint">A.1.4. <span class="command"><strong>pkglint</strong></span> でパッケージをチェックする</a></span></dt>
</dl></dd>
<dt><span class="sect1"><a href="#steps-for-b-i-p">A.2. 構築、インストール、パッケージングの手順</a></span></dt>
</dl>
</div>
<p>私たちは、パッケージコレクションにないソフトウェアをさがし、GNU bisonを選びまし
    た。バークレーの<span class="command"><strong>yacc</strong></span>がすでにソースツリーに存在するので、
    <span class="command"><strong>bison</strong></span>を使いたい人は
    いないでしょう。しかし、練習という意味では役にたちます。</p>
<div class="sect1" title="A.1. ファイル">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="example-files"></a>A.1. ファイル</h2></div></div></div>
<div class="sect2" title="A.1.1. Makefile">
<div class="titlepage"><div><div><h3 class="title">
<a name="example-Makefile"></a>A.1.1. Makefile</h3></div></div></div>
<pre class="programlisting">
# $NetBSD$
#

DISTNAME=       bison-1.25
CATEGORIES=     devel
MASTER_SITES=   ${MASTER_SITE_GNU}

MAINTAINER=     thorpej@NetBSD.org
HOMEPAGE=       http://www.gnu.org/software/bison/bison.html
COMMENT=        GNU yacc clone

GNU_CONFIGURE=  yes
INFO_FILES=     bison.info

.include "../../mk/bsd.pkg.mk"
</pre>
</div>
<div class="sect2" title="A.1.2. DESCR">
<div class="titlepage"><div><div><h3 class="title">
<a name="example-descr"></a>A.1.2. DESCR</h3></div></div></div>
<pre class="programlisting">
GNU version of yacc.  Can make re-entrant parsers, and numerous other
improvements.  Why you would want this when Berkeley <a class="citerefentry" href="http://netbsd.gw.com/cgi-bin/man-cgi?yacc+1+NetBSD-5.0.1+i386"><span class="citerefentry"><span class="refentrytitle">yacc</span>(1)</span></a> is part
of the NetBSD source tree is beyond me.
</pre>
</div>
<div class="sect2" title="A.1.3. PLIST">
<div class="titlepage"><div><div><h3 class="title">
<a name="example-plist"></a>A.1.3. PLIST</h3></div></div></div>
<pre class="programlisting">
@comment $NetBSD$
bin/bison
man/man1/bison.1.gz
share/bison.simple
share/bison.hairy
</pre>
</div>
<div class="sect2" title="A.1.4. pkglint でパッケージをチェックする">
<div class="titlepage"><div><div><h3 class="title">
<a name="checking-package-with-pkglint"></a>A.1.4. <span class="command"><strong>pkglint</strong></span> でパッケージをチェックする</h3></div></div></div>
<p>NetBSDパッケージシステムは、
        <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/pkgtools/pkglint/README.html" target="_top"><code class="filename">pkgtools/pkglint</code></a>
	を含んでいます。このツールはこれらのファイルの内
	容をチェックするのを助けてくれます。一度インストールしてしまえば、このツー
	ルは非常に簡単に使うことができます。検査したいパッケージのディレクトリーに
	移動し、<span class="command"><strong>pkglint</strong></span>を実行するだけです。</p>
<pre class="screen"><code class="prompt">$</code> <strong class="userinput"><code>pkglint</code></strong>
looks fine.</pre>
<p>指定されたコマンド行の引数(pkglint(1)を見てください)によっては、
	より多くのチェックがおこなわれます。例えば <span class="command"><strong>pkglint -Call
	-Wall</strong></span> は、非常に徹底したチェックをおこないます。</p>
</div>
</div>
<div class="sect1" title="A.2. 構築、インストール、パッケージングの手順">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="steps-for-b-i-p"></a>A.2. 構築、インストール、パッケージングの手順</h2></div></div></div>
<p>パッケージのためのディレクトリーと、
      いくつかの追加のディレクトリーを作成します。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>cd /usr/pkgsrc/lang</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir bison</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>cd bison</code></strong>
<code class="prompt">#</code> <strong class="userinput"><code>mkdir patches</code></strong></pre>
<p><code class="filename">Makefile</code>、<code class="filename">DESCR</code>および<code class="filename">PLIST</code>を作り
      (<a class="xref" href="#components" title="Chapter 11. パッケージコンポーネント - ファイル、ディレクトリー、およびコンテンツ">Chapter 11, <i>パッケージコンポーネント - ファイル、ディレクトリー、およびコンテンツ</i></a>参照)、distfile を取得しま
      す。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make fetch</code></strong>
&gt;&gt; bison-1.25.tar.gz doesn't seem to exist on this system.
&gt;&gt; Attempting to fetch from ftp://prep.ai.mit.edu/pub/gnu//.
Requesting ftp://prep.ai.mit.edu/pub/gnu//bison-1.25.tar.gz (via ftp://orpheus.amdahl.com:80/)
ftp: Error retrieving file: 500 Internal error

&gt;&gt; Attempting to fetch from ftp://wuarchive.wustl.edu/systems/gnu//.
Requesting ftp://wuarchive.wustl.edu/systems/gnu//bison-1.25.tar.gz (via ftp://orpheus.amdahl.com:80/)
ftp: Error retrieving file: 500 Internal error

&gt;&gt; Attempting to fetch from ftp://ftp.freebsd.org/pub/FreeBSD/distfiles//.
Requesting ftp://ftp.freebsd.org/pub/FreeBSD/distfiles//bison-1.25.tar.gz (via ftp://orpheus.amdahl.com:80/)
Successfully retrieved file.</pre>
<p>distfileのチェックサムを
      <code class="filename">distinfo</code>へ作成します。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make makedistinfo</code></strong></pre>
<p>コンパイルします。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
&gt;&gt; Checksum OK for bison-1.25.tar.gz.
===&gt;  Extracting for bison-1.25
===&gt;  Patching for bison-1.25
===&gt;   Ignoring empty patch directory
===&gt;  Configuring for bison-1.25
creating cache ./config.cache
checking for gcc... cc
checking whether we are using GNU C... yes
checking for a BSD compatible install... /usr/bin/install -c -o bin -g bin
checking how to run the C preprocessor... cc -E
checking for minix/config.h... no
checking for POSIXized ISC... no
checking whether cross-compiling... no
checking for ANSI C header files... yes
checking for string.h... yes
checking for stdlib.h... yes
checking for memory.h... yes
checking for working const... yes
checking for working alloca.h... no
checking for alloca... yes
checking for strerror... yes
updating cache ./config.cache
creating ./config.status
creating Makefile
===&gt;  Building for bison-1.25
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g LR0.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g allocate.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g closure.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g conflicts.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g derives.c
cc -c -DXPFILE=\"/usr/pkg/share/bison.simple\"  -DXPFILE1=\"/usr/pkg/share/bison.hairy\" -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1  -g  ./files.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g getargs.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g gram.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g lalr.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g lex.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g main.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g nullable.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g output.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g print.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g reader.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g reduce.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g symtab.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g warshall.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g version.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g getopt.c
cc -c -DSTDC_HEADERS=1 -DHAVE_STRING_H=1 -DHAVE_STDLIB_H=1 -DHAVE_MEMORY_H=1 -DHAVE_ALLOCA=1 -DHAVE_STRERROR=1 -I./../include  -g getopt1.c
cc  -g -o bison LR0.o allocate.o closure.o conflicts.o derives.o files.o         getargs.o gram.o lalr.o lex.o                                   main.o nullable.o output.o print.o reader.o reduce.o symtab.o   warshall.o version.o getopt.o getopt1.o
./files.c:240: warning: mktemp() possibly used unsafely, consider using mkstemp()
rm -f bison.s1
sed -e "/^#line/ s|bison|/usr/pkg/share/bison|" &lt; ./bison.simple &gt; bison.s1</pre>
<p>すべてOKのようなので、ファイルをインストールします。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
&gt;&gt; Checksum OK for bison-1.25.tar.gz.
===&gt;  Installing for bison-1.25
sh ./mkinstalldirs /usr/pkg/bin /usr/pkg/share  /usr/pkg/info /usr/pkg/man/man1
rm -f /usr/pkg/bin/bison
cd /usr/pkg/share; rm -f bison.simple bison.hairy
rm -f /usr/pkg/man/man1/bison.1 /usr/pkg/info/bison.info*
install -c  -o bin -g bin -m 555 bison /usr/pkg/bin/bison
/usr/bin/install -c -o bin -g bin -m 644 bison.s1 /usr/pkg/share/bison.simple
/usr/bin/install -c -o bin -g bin -m 644 ./bison.hairy /usr/pkg/share/bison.hairy
cd .; for f in bison.info*;  do /usr/bin/install -c -o bin -g bin -m 644 $f /usr/pkg/info/$f; done
/usr/bin/install -c -o bin -g bin -m 644 ./bison.1 /usr/pkg/man/man1/bison.1
===&gt;  Registering installation for bison-1.25</pre>
<p>これでbisonを使用することができます。そして、<span class="command"><strong>pkg_delete bison</strong></span>を実
      行することでbisonを削除することもできます。もし、バイナリーパッケージが欲
      しければ、以下のようにしてください。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make package</code></strong>
&gt;&gt; Checksum OK for bison-1.25.tar.gz.
===&gt;  Building package for bison-1.25
Creating package bison-1.25.tgz
Registering depends:.
Creating gzip'd tar ball in '/u/pkgsrc/lang/bison/bison-1.25.tgz'</pre>
<p>もし、ソースやオブジェクトファイルが必要ないのであれば、
      掃除してください。</p>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make clean</code></strong>
===&gt;  Cleaning for bison-1.25</pre>
</div>
</div>
<div class="appendix" title="Appendix B. 構築のログ">
<div class="titlepage"><div><div><h2 class="title">
<a name="logs"></a>Appendix B. 構築のログ</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#logs.building">B.1. figletの構築</a></span></dt>
<dt><span class="sect1"><a href="#logs.package">B.2. figlet のパッケージング</a></span></dt>
</dl>
</div>
<div class="sect1" title="B.1. figletの構築">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="logs.building"></a>B.1. figletの構築</h2></div></div></div>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make</code></strong>
===&gt; Checking for vulnerabilities in figlet-2.2.1nb2
=&gt; figlet221.tar.gz doesn't seem to exist on this system.
=&gt; Attempting to fetch figlet221.tar.gz from ftp://ftp.figlet.org/pub/figlet/program/unix/.
=&gt; [172219 bytes]
Connected to ftp.plig.net.
220 ftp.plig.org NcFTPd Server (licensed copy) ready.
331 Guest login ok, send your complete e-mail address as password.
230-You are user #5 of 500 simultaneous users allowed.
230-
230-  ___ _             _ _
230- |  _| |_ ___   ___| |_|___   ___ ___ ___
230- |  _|  _| . |_| . | | | . |_| . |  _| . |
230- |_| |_| |  _|_|  _|_|_|_  |_|___|_| |_  |
230-         |_|   |_|     |___|         |___|
230-
230-** Welcome to ftp.plig.org **
230-
230-Please note that all transfers from this FTP site are logged. If you
230-do not like this, please disconnect now.
230-
230-This archive is available via
230-
230-HTTP:  http://ftp.plig.org/
230-FTP:   ftp://ftp.plig.org/     (max 500 connections)
230-RSYNC: rsync://ftp.plig.org/   (max  30 connections)
230-
230-Please email comments, bug reports and requests for packages to be
230-mirrored to ftp-admin@plig.org.
230-
230-
230 Logged in anonymously.
Remote system type is UNIX.
Using binary mode to transfer files.
200 Type okay.
250 "/pub" is new cwd.
250-"/pub/figlet" is new cwd.
250-
250-Welcome to the figlet archive at ftp.figlet.org
250-
250-	ftp://ftp.figlet.org/pub/figlet/
250-
250-The official FIGlet web page is:
250-	http://www.figlet.org/
250-
250-If you have questions, please mailto:info@figlet.org. If you want to
250-contribute a font or something else, you can email us.
250
250 "/pub/figlet/program" is new cwd.
250 "/pub/figlet/program/unix" is new cwd.
local: figlet221.tar.gz remote: figlet221.tar.gz
502 Unimplemented command.
227 Entering Passive Mode (195,40,6,41,246,104)
150 Data connection accepted from 84.128.86.72:65131; transfer starting for figlet221.tar.gz (172219 bytes).
38% |**************                       | 65800      64.16 KB/s    00:01 ETA
226 Transfer completed.
172219 bytes received in 00:02 (75.99 KB/s)
221 Goodbye.
=&gt; Checksum OK for figlet221.tar.gz.
===&gt; Extracting for figlet-2.2.1nb2
===&gt; Required installed package ccache-[0-9]*: ccache-2.3nb1 found
===&gt; Patching for figlet-2.2.1nb2
===&gt; Applying pkgsrc patches for figlet-2.2.1nb2
===&gt; Overriding tools for figlet-2.2.1nb2
===&gt; Creating toolchain wrappers for figlet-2.2.1nb2
===&gt; Configuring for figlet-2.2.1nb2
===&gt; Building for figlet-2.2.1nb2
gcc -O2 -DDEFAULTFONTDIR=\"/usr/pkg/share/figlet\"  -DDEFAULTFONTFILE=\"standard.flf\"  figlet.c zipio.c crc.c inflate.c -o figlet
chmod a+x figlet
gcc -O2 -o chkfont chkfont.c
=&gt; Unwrapping files-to-be-installed.
<code class="prompt">#</code>
<code class="prompt">#</code> <strong class="userinput"><code>make install</code></strong>
===&gt; Checking for vulnerabilities in figlet-2.2.1nb2
===&gt; Installing for figlet-2.2.1nb2
install -d -o root -g wheel -m 755 /usr/pkg/bin
install -d -o root -g wheel -m 755 /usr/pkg/man/man6
mkdir -p /usr/pkg/share/figlet
cp figlet /usr/pkg/bin
cp chkfont /usr/pkg/bin
chmod 555 figlist showfigfonts
cp figlist /usr/pkg/bin
cp showfigfonts /usr/pkg/bin
cp fonts/*.flf /usr/pkg/share/figlet
cp fonts/*.flc /usr/pkg/share/figlet
cp figlet.6 /usr/pkg/man/man6
===&gt; Registering installation for figlet-2.2.1nb2
<code class="prompt">#</code></pre>
</div>
<div class="sect1" title="B.2. figlet のパッケージング">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="logs.package"></a>B.2. figlet のパッケージング</h2></div></div></div>
<pre class="screen"><code class="prompt">#</code> <strong class="userinput"><code>make package</code></strong>
===&gt; Checking for vulnerabilities in figlet-2.2.1nb2
===&gt; Packaging figlet-2.2.1nb2
===&gt; Building binary package for figlet-2.2.1nb2
Creating package /home/cvs/pkgsrc/packages/i386/All/figlet-2.2.1nb2.tgz
Using SrcDir value of /usr/pkg
Registering depends:.
<code class="prompt">#</code></pre>
</div>
</div>
<div class="appendix" title="Appendix C. pkgsrc FTP サーバーのディレクトリー配置">
<div class="titlepage"><div><div><h2 class="title">
<a name="ftp-layout"></a>Appendix C. pkgsrc FTP サーバーのディレクトリー配置</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#ftp-distfiles">C.1. <code class="filename">distfiles</code>: ソースファイルの配布物</a></span></dt>
<dt><span class="sect1"><a href="#ftp-misc">C.2. <code class="filename">misc</code>: 種々雑多なもの</a></span></dt>
<dt><span class="sect1"><a href="#ftp-packages">C.3. <code class="filename">packages</code>: バイナリーパッケージ</a></span></dt>
<dt><span class="sect1"><a href="#ftp-reports">C.4. <code class="filename">reports</code>: バルクビルドの結果報告</a></span></dt>
<dt><span class="sect1"><a href="#ftp-source">C.5. <code class="filename">current</code>,
<code class="filename">pkgsrc-20<em class="replaceable"><code>xx</code></em>Q<em class="replaceable"><code>y</code></em></code>:
ソースパッケージ</a></span></dt>
</dl>
</div>
<p>他の大規模プロジェクトと同様に、初心者の方にとって
	pkgsrc のディレクトリー配置は非常に複雑なものです。
	<code class="filename">ftp.NetBSD.org</code> での基点ディレクトリーは <a class="ulink" href="ftp://ftp.NetBSD.org/pub/pkgsrc/" target="_top"><code class="filename">/pub/pkgsrc/</code></a> です。
	他のサーバーでは、基点ディレクトリーの場所は異なるかもしれませんが、
	基点ディレクトリー以下の内容はどのサーバーでもすべて同じはずです。
	このディレクトリーには、以下で説明するような、
	いくつかのサブディレクトリーがあります。</p>
<div class="sect1" title="C.1. distfiles: ソースファイルの配布物">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="ftp-distfiles"></a>C.1. <code class="filename">distfiles</code>: ソースファイルの配布物</h2></div></div></div>
<p><code class="filename">distfiles</code> ディレクトリーは、
	pkgsrc の各パッケージのアーカイブファイルのうち、
	このサーバーにミラーされているものを多数含んでいます。
	配布ファイルのファイル名にバージョン番号が明示的に含まれていなかったり、
	一般的すぎる名前 (たとえば <code class="filename">release.tar.gz</code>)
	だったりする場合には、パッケージ名を冠したサブディレクトリーが使われます。</p>
</div>
<div class="sect1" title="C.2. misc: 種々雑多なもの">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="ftp-misc"></a>C.2. <code class="filename">misc</code>: 種々雑多なもの</h2></div></div></div>
<p>このディレクトリーは、
	個々の pkgsrc 開発者がサーバーに置いておく価値があると判断したものを含んでいます。</p>
</div>
<div class="sect1" title="C.3. packages: バイナリーパッケージ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="ftp-packages"></a>C.3. <code class="filename">packages</code>: バイナリーパッケージ</h2></div></div></div>
<p>このディレクトリーは、
	pkgsrc が対応している各種プラットフォーム用のバイナリーパッケージを含んでいます。
	各プラットフォーム用のサブディレクトリーは <em class="replaceable"><code>OPSYS</code></em>/<em class="replaceable"><code>ARCH</code></em>/<em class="replaceable"><code>OSVERSION_TAG</code></em> のような形式になっています。これらの意味は以下のとおりです。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="varname">OPSYS</code> は、
	当該パッケージが構築された対象のオペレーティングシステム名です。
	この名前は <span class="command"><strong>uname</strong></span> コマンドの出力に合わせているので、
	ふだん聞き慣れた名前とは違う名前になっていることがあります。</p></li>
<li class="listitem"><p><code class="varname">ARCH</code> は、
	当該パッケージが構築された対象のプラットフォームのハードウェアアーキテクチャー名です。
	<code class="varname">ABI</code> (Application
	Binary Interface) が複数あるプラットフォームでは、
	<code class="varname">ABI</code> も含めた名称になっています。</p></li>
<li class="listitem"><p><code class="varname">OSVERSION</code> は、
	オペレーティングシステムのバージョンです。バージョン番号が頻繁に変わる場合
	(たとえば NetBSD-current) は、たとえば
	<code class="literal">4.99.x</code> のように、頻繁に変わる部分を
	<code class="literal">x</code> に置き換えています。</p></li>
<li class="listitem"><p><code class="varname">TAG</code> は、安定版の枝の場合は
	<code class="literal">20<em class="replaceable"><code>xx</code></em>Q<em class="replaceable"><code>y</code></em></code>、
	HEAD の場合は <code class="literal">head</code> です。後者は、
	パッケージが定期的に更新されるものである場合にのみ使います。
	そうでない場合は、たとえば <code class="literal">head_20071015</code> のように、
	pkgsrc のチェックアウト日を付け加えた形にします。</p></li>
</ul></div>
<p>このような方式となっている理由は、pkgsrc の利用者がバイナリーパッケージを探すときに、
	サーバー上のディレクトリーを辿って、
	自分のマシンに最適なバイナリーパッケージを簡単に見つけられるからです。
	利用者はたいてい、オペレーティングシステムとハードウェアアーキテクチャーを知っているので、
	OPSYS と ARCH を最初にしています。これらを選べば、
	OSVERSION と TAG の最適な組合せを選ぶことができます。
	通常の場合、オペレーティングシステムのバージョンが違っても、
	パッケージには互換性があるからです。</p>
<p>これらの各ディレクトリーには、
	当該プラットフォーム用のバイナリーパッケージ全体が置かれています。
	<code class="filename">All</code> というディレクトリーがあり、
	ここにすべてのバイナリーパッケージを含んでいます。
	このほか、カテゴリー別のディレクトリーがあり、
	バイナリーパッケージの実体へのシンボリックリンクを含んでいます。</p>
</div>
<div class="sect1" title="C.4. reports: バルクビルドの結果報告">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="ftp-reports"></a>C.4. <code class="filename">reports</code>: バルクビルドの結果報告</h2></div></div></div>
<p>ここには、構築できないプラットフォームがあるパッケージを修正したい方向けに、
	バルクビルドの結果の報告が置いてあります。
	サブディレクトリーの構造は<a class="xref" href="#ftp-packages" title="C.3. packages: バイナリーパッケージ">Section C.3, “<code class="filename">packages</code>: バイナリーパッケージ”</a>と同じです。</p>
</div>
<div class="sect1" title="C.5. current, pkgsrc-20xxQy: ソースパッケージ">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="ftp-source"></a>C.5. <code class="filename">current</code>,
<code class="filename">pkgsrc-20<em class="replaceable"><code>xx</code></em>Q<em class="replaceable"><code>y</code></em></code>:
ソースパッケージ</h2></div></div></div>
<p>このディレクトリーは pkgsrc <span class="quote">“<span class="quote">そのもの</span>”</span>、つまり、
	ソースアーカイブからバイナリーパッケージを作る方法を定義したファイル一式を含んでいます。</p>
<p><code class="filename">pkgsrc</code> ディレクトリーは、
	CVS リポジトリーのスナップショットを含んでおり、定期的に更新されます。
	<code class="filename">pkgsrc.tar.gz</code> ファイルは、
	このディレクトリーと同じ内容を含んでおり、
	全体をダウンロードできるようになっています。</p>
<p>四半期ごとの枝用のディレクトリーには、
	さらに
	<code class="filename">pkgsrc-20<em class="replaceable"><code>xx</code></em>Q<em class="replaceable"><code>y</code></em>.tar.gz</code>
	というファイルがあります。
	これは、枝が分岐した時点の状態の pkgsrc を含んでいます。</p>
</div>
</div>
<div class="appendix" title="Appendix D. the pkgsrc guide 編集の指針">
<div class="titlepage"><div><div><h2 class="title">
<a name="editing"></a>Appendix D. the pkgsrc guide 編集の指針</h2></div></div></div>
<div class="toc">
<p><b>Table of Contents</b></p>
<dl>
<dt><span class="sect1"><a href="#targets">D.1. make ターゲット</a></span></dt>
<dt><span class="sect1"><a href="#procedure">D.2. 編集手順</a></span></dt>
</dl>
</div>
<p>本節では、この the pkgsrc guide
	そのものの編集に関する情報を掲載します。</p>
<div class="sect1" title="D.1. make ターゲット">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="targets"></a>D.1. make ターゲット</h2></div></div></div>
<p>the pkgsrc guide のソースコードは
	<code class="filename">pkgsrc/doc/guide/files</code> 以下に置かれており、
	これをもとに、以下のような数々のファイルが生成されます。</p>
<div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem"><p><code class="filename">pkgsrc/doc/pkgsrc.txt</code></p></li>
<li class="listitem"><p><code class="filename">pkgsrc/doc/pkgsrc.html</code></p></li>
<li class="listitem"><p><a class="ulink" href="http://www.NetBSD.org/docs/pkgsrc/" target="_top">http://www.NetBSD.org/docs/pkgsrc/</a></p></li>
<li class="listitem"><p><a class="ulink" href="http://www.NetBSD.org/docs/pkgsrc/pkgsrc.pdf" target="_top">http://www.NetBSD.org/docs/pkgsrc/pkgsrc.pdf</a>:
	the pkgsrc guide の PDF 版。</p></li>
<li class="listitem"><p><a class="ulink" href="http://www.NetBSD.org/docs/pkgsrc/pkgsrc.ps" target="_top">http://www.NetBSD.org/docs/pkgsrc/pkgsrc.ps</a>:
	the pkgsrc guide の PostScript 版。</p></li>
</ul></div>
</div>
<div class="sect1" title="D.2. 編集手順">
<div class="titlepage"><div><div><h2 class="title" style="clear: both">
<a name="procedure"></a>D.2. 編集手順</h2></div></div></div>
<p>the pkgsrc guide の編集手順は、以下のとおりです。</p>
<div class="procedure"><ol class="procedure" type="1">
<li class="step" title="Step 1"><p>the pkgsrc guide (と、XML にもとづくその他の
	NetBSD ドキュメンテーション)
	の再生成に必要なパッケージがインストールされていることを確認します。
	ASCII および HTML 版の生成に必要なのは <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/netbsd-doc/README.html" target="_top"><code class="filename">meta-pkgs/netbsd-doc</code></a>、
	PostScript および PDF 版の生成に必要なのは <a href="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc/meta-pkgs/netbsd-doc-print/README.html" target="_top"><code class="filename">meta-pkgs/netbsd-doc-print</code></a> です。
	各形式のドキュメンテーションの一貫性を保つために、
	いずれのパッケージもインストールする必要があります。</p></li>
<li class="step" title="Step 2"><p><span class="command"><strong>cd doc/guide</strong></span> を実行して、
	適切なディレクトリーに移動します。これ以降の手順は、
	すべてこの場所でおこないます。</p></li>
<li class="step" title="Step 3"><p><code class="filename">files/</code> 以下にある
	XML ファイルを編集します。</p></li>
<li class="step" title="Step 4"><p><span class="command"><strong>bmake</strong></span> を実行して、the pkgsrc
	guide が妥当な XML であることを確認し、最終的な出力ファイルを構築します。
	何かエラーが出た場合は、元のファイルを編集するだけで結構です。
	作業ディレクトリーには、<code class="filename">files/</code>
	以下のファイルを指すシンボリックリンクがあるだけだからです。</p></li>
<li class="step" title="Step 5"><p><span class="command"><strong>(cd files &amp;&amp; cvs
	commit)</strong></span></p></li>
<li class="step" title="Step 6"><p><span class="command"><strong>bmake clean &amp;&amp; bmake</strong></span>
	を実行して、適切な RCS
	Id を含んだ出力ファイルを作り直します。</p></li>
<li class="step" title="Step 7">
<p><span class="command"><strong>bmake regen</strong></span> を実行して、
	<code class="filename">pkgsrc/doc</code> および
	<code class="filename">htdocs</code> 以下にそれぞれファイルをインストールして commit します。</p>
<div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
<h3 class="title">Note</h3>
<p>章の追加、削除、または改名をした場合は、
	htdocs ディレクトリー以下で <span class="command"><strong>cvs add</strong></span> や
	<span class="command"><strong>cvs delete</strong></span> を使って、
	元のファイルとの対応を揃える必要があります。</p>
</div>
</li>
</ol></div>
</div>
</div>
</div></body>
</html>
