<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Website XSL Stylesheet V2.6.0">
<link rel="home" href="../../../." title="Welcome to The NetBSD Project: Of course it runs NetBSD.">
<link rel="up" href="../../../ja/docs/kernel/." title="NetBSD ドキュメンテーション: カーネル">
<link rel="previous" href="../../../ja/docs/kernel/porting-freebsd-net.html" title="FreeBSD のネットワークドライバーを NetBSD に移植するためのメモ">
<link rel="next" href="../../../ja/docs/mirror.html" title="NetBSD ミラー FAQ">
<link rel="first" href="../../../ja/docs/kernel/lazyfpu.html" title="NetBSD ドキュメンテーション: どのように lazy FPU コンテキストスイッチは動作するのか">
<link rel="stylesheet" href="../../../global.css" type="text/css">



<title>NetBSD ドキュメンテーション: ベンダー特有の ELF 記号要素(Note Elements)</title>
</head>
<body class="website"><div class="webpage">
<a name="ja-docs-kernel-elf-notes"></a><div id="top"><a href="#mainContent" class="doNotDisplay doNotPrint">本文へ飛ぶ。</a></div>
<div id="header">
<div class="topNavigation">
<span>» </span><a href="../../../docs/guide/en/">
	  ガイド</a> |
	<a href="http://man.NetBSD.org/">マニュアルページ</a> |
	<a href="../../../ja/mailinglists/">
	  メーリングリスト</a>と
	<a href="http://mail-index.NetBSD.org/">記事</a> |
	<a href="http://cvsweb.NetBSD.org/">CVS リポジトリー</a> |
	バグの<a href="http://www.NetBSD.org/cgi-bin/sendpr.cgi?gndb=netbsd">報告</a>
	と
	<a href="../../../ja/support/query-pr.html">
	 照会</a> |
	<a href="../../../ja/docs/software/packages.html">
	  ソフトウェアパッケージ
	</a>
</div>
<div class="centralHeader">
<a href="../../../ja/"><img alt='NetBSD プロジェクト "Of course it runs NetBSD"' width="506" height="90" src="../../../images/NetBSD-headerlogo.png"></a><div class="headerTools"><div id="headerSearch"><form method="get" action="http://www.google.com/custom">
<input class="whiteOnBlack" type="text" name="q" onfocus="if(this.value==this.defaultValue ) this.value='';" size="12" maxlength="255" value="Search"><input type="hidden" name="cof" value="L:http://www.NetBSD.org/images/NetBSD-smaller.png;LH:200;LW:200;AH:center;AWFID:4f6b0499f0f58d2c;"><input type="hidden" name="domains" value="NetBSD.org"><input type="hidden" name="sitesearch" value="www.NetBSD.org"><input type="submit" value="検索">
</form></div></div>
</div>
<div class="navBar">
<span class="doNotDisplay">
	  案内:
	</span><a href="../../../ja/">
	  ホーム</a> | 
	<a href="../../../ja/about/">
	  概要</a> | 
	<a href="../../../ja/gallery/">
	  展示室</a> | 
	<a href="../../../ja/releases/">
	  ダウンロード</a> | 
	<a href="../../../ja/docs/">
	  ドキュメンテーション</a> | 
	<a href="../../../ja/support/">
	  サポート</a> | 
	<a href="../../../ja/community/">
	  コミュニティー</a> | 
	<a href="../../../ja/ports/">
	  機種</a>
</div>
</div>
<div id="content"><div class="fullWidth"><div class="rowOfBoxes">
<h1>NetBSD ドキュメンテーション: ベンダー特有の ELF 記号要素(Note Elements)</h1>
<h3 class="title"><a name="introduction"></a></h3>
<ul>
<li><a href="#introduction-sub">序</a></li>
<li><a href="#note-format">ELF Note Element のフォーマット</a></li>
<li><a href="#note-names">知られている ELF 記号名</a></li>
<li><a href="#note-contents">ベンダー特有 ELF 記号</a></li>
<li><a href="#note-creation">ELF PT_NOTE セクションの作成</a></li>
<li><a href="#netbsd-note">NetBSD ELF PT_NOTE セクションの作成</a></li>
</ul>
<hr>
<h3 class="title"></h3>
    <h4 class="title">
<a name="introduction-sub"></a>序 (<a href="#introduction">top</a>)
  </h4>
      <p>
	さまざまなオペレーティングシステムベンダーが
	異なるシステムコールインターフェースを要求する ELF バイナリー
	を出荷しています。
	オペレーティングシステムが ELF プログラムが実行できるかどうか、
	どうやって実行するか(例えば どの OS エミュレーションを使うのか)を
	正しく決定する手助けのために、
	いくつかのオペレーティングシステムのベンダーは
	ELF バイナリーの <code class="constant">PT_NOTE</code> セクションにベンダー特有の記号要素 (note elements) 
	を付け始めました。
      </p>
      <p>
	このページは、バイナリーの <code class="constant">PT_NOTE</code> セクションで
	オペレーティングシステムの識別のために使われているベンダー特有の記号要素
	についての知識の宝庫にしようと思います。
      </p>

      <p>
	もし、あなたのオペレーティングシステムが
	ベンダー特有記号要素
	をバイナリーのマークに使っていて、ここの一覧に載っていないなら、
	<a class="ulink" href="mailto:cgd@NetBSD.org" target="_top">Chris Demetriou</a>
	まで、その記号の情報をメールしてください。(訳注:たぶん英文で)
      </p>
    
      <h4 class="title">
<a name="note-format"></a>ELF Note Element のフォーマット (<a href="#introduction">top</a>)
  </h4>

      <p>
	全ての ELF Note Element は同じ基本構造を持っていて:
	</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">Name Size</code></span></dt>
<dd>4 bytes (整数)</dd>
<dt><span class="term"><code class="varname">Desc Size</code></span></dt>
<dd>4 bytes (整数)</dd>
<dt><span class="term"><code class="varname">Type</code></span></dt>
<dd>4 bytes (たいてい整数として解釈されます)</dd>
<dt><span class="term"><code class="varname">Name</code></span></dt>
<dd>可変長, 4 byte 境界で詰め物をされた</dd>
<dt><span class="term"><code class="varname">Desc</code></span></dt>
<dd>可変長, 4 byte 境界で詰め物をされた</dd>
</dl></div>
<p>
      </p>
      
      <p>
	"Name" , "Desc" 各フィールドの(詰め物を除いた)サイズの決定をする 
	"Name Size" , "Desc Size" 各フィールドは
	整数型 (バイトオーダーはバイナリーの ELF ヘッダーに指定されています)です。
      </p>
    
      <p>
	Name field は ベンダー が記号のフォーマットに基づいて指定します。
	一般的に、 ベンダーはプロジェクトや会社名に関連した名前を使います。
	例えば、 GNU project はその名前に "GNU" を使います。
	ELF Note Name は、note の意味を解釈しようという時混乱するといけないので、
	どの 2つの ベンダーも同じ物を使わないようにするべきです。
      </p>
      
      <p>
	"Type" フィールドはベンダー特有ですが、記号の特定において、
	たいてい整数型として扱われます。
      </p>
      
      <p>
	"Desc" フィールドはベンダー特有で、
	たいてい記号の型に依存するデータが含まれています。
      </p>
    
      <h4 class="title">
<a name="note-names"></a>知られている ELF 記号名 (<a href="#introduction">top</a>)
  </h4>

      <p>
	下記は ELF 記号名として使われている事が知られている文字列と
	それを使っている組織です。
	記号名の語長が 4 の倍数で無いものは 詰め物で埋められますが、
	与えられた長さだけを調べるようにするべきです。
      </p>
      
      <div class="segmentedlist"><table border="0">
<thead><tr class="segtitle">
<th>Note Name 文字列</th>
<th>文字列のバイト毎のエンコーディング</th>
<th>語長</th>
<th>組織</th>
</tr></thead>
<tbody>
<tr class="seglistitem">
	  <td class="seg"><code class="code">"NetBSD\0"</code></td>
	  <td class="seg"><code class="code">0x4e 0x65 0x74 0x42 0x53 0x44 0x00</code></td>
	  <td class="seg">7</td>
	  <td class="seg"><a class="xref" href="#note-contents-netbsd" title="The NetBSD Project">The NetBSD Project</a></td>
	</tr>
<tr class="seglistitem">
	  <td class="seg"><code class="code">"GNU\0"</code></td>
	  <td class="seg"><code class="code">0x47 0x4e 0x55 0x00</code></td>
	  <td class="seg">4</td>
	  <td class="seg"><a class="xref" href="#note-contents-gnu" title="The GNU Project">The GNU Project</a></td>
	</tr>
</tbody>
</table></div>
    
    <h4 class="title">
<a name="note-contents"></a>ベンダー特有 ELF 記号 (<a href="#introduction">top</a>)
  </h4>
      
    <p>
      この節にはベンダーが <code class="constant">PT_NOTE</code> セクションで使っていて、 
      ベンダー別に異なっている ELF 記号のフォーマットに関する情報が含まれています。
    </p>

    <div class="sect4" title="The NetBSD Project">
<div class="titlepage"><div><div><h5 class="title">
<a name="note-contents-netbsd"></a>The NetBSD Project</h5></div></div></div>
      
      
      <p>
	NetBSD には2つの ベンダー特有の ELF 記号があって、
	OS バージョン記号とエミュレーション Name 記号です。
	前者は、どの OS バージョンの native バイナリーかを示すのに使われ、
	native バイナリーを識別するのにも使えます。
	後者は、実行時にどのエミュレーションコードセットを使えば良いかを示す名前と共に、
	バイナリーを (native と 非-native の)マークするのに使われます。
      </p>
      <p>
	NetBSD OS バージョン 記号 のフォーマットは:
	
	</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">Name Size</code></span></dt>
<dd>7</dd>
<dt><span class="term"><code class="varname">Desc Size</code></span></dt>
<dd>4</dd>
<dt><span class="term"><code class="varname">Type</code></span></dt>
<dd>4-byte 整数 <code class="code">0x01</code> という値が入っている</dd>
<dt><span class="term"><code class="varname">Name</code></span></dt>
<dd>
<code class="code">"NetBSD\0"</code> (8 byte に合わせて詰め物がされています)</dd>
<dt><span class="term"><code class="varname">Desc</code></span></dt>
<dd>4-byte 整数 NetBSD OS バージョン定数が入っている</dd>
</dl></div>
<p>
      </p>

      <p>
	NetBSD エミュレーション Name 記号 のフォーマットは:
	</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">Name Size</code></span></dt>
<dd>7</dd>
<dt><span class="term"><code class="varname">Desc Size</code></span></dt>
<dd>variable</dd>
<dt><span class="term"><code class="varname">Type</code></span></dt>
<dd>4-byte 整数 <code class="code">0x02</code> という値が入っている</dd>
<dt><span class="term"><code class="varname">Name</code></span></dt>
<dd>
<code class="code">"NetBSD\0"</code> (8 byte に合わせて詰め物がされています)</dd>
<dt><span class="term"><code class="varname">Desc</code></span></dt>
<dd>バイナリーを実行するのに使うエミュレーションを表す、
	    ナル (<code class="code">NUL</code>) 文字で終わる文字列
	    (次の4バイト境界まで詰め物された)</dd>
</dl></div>
<p>
      </p>
    </div>

    <div class="sect4" title="The GNU Project">
<div class="titlepage"><div><div><h5 class="title">
<a name="note-contents-gnu"></a>The GNU Project</h5></div></div></div>
      

      <p>
	glibc 2.1 以降では、 GNU project は 
	GNU オペレーティングシステム とどのバージョンのシステムで構築されたバイナリーか
	を示すのに、単一の ELF Note を使い、
	そのフォーマットは:
	</p>
<div class="variablelist"><dl>
<dt><span class="term"><code class="varname">Name Size</code></span></dt>
<dd>4</dd>
<dt><span class="term"><code class="varname">Desc Size</code></span></dt>
<dd>16</dd>
<dt><span class="term"><code class="varname">Type</code></span></dt>
<dd>4-byte 整数 <code class="code">0x01</code> という値が入っている</dd>
<dt><span class="term"><code class="varname">Name</code></span></dt>
<dd><code class="code">"GNU\0"</code></dd>
<dt><span class="term"><code class="varname">Desc</code></span></dt>
<dd>
	      4 個の 4-byte 整数。順序は以下のとおり:
	      <div class="orderedlist"><ol class="orderedlist" type="1">
<li class="listitem">OS (0 = Linux, 1 = Hurd, 2 = Solaris)</li>
<li class="listitem">Major</li>
<li class="listitem">Minor</li>
<li class="listitem">Teeny</li>
</ol></div>
	      major, minor, teeny は、この ABI をサポートする OS バージョンで最も古いもののバージョン。
	    </dd>
</dl></div>
<p>
      </p>

      <p>
	GNU C ライブラリーでの ELF notes の使い方について、さらなるドキュメンテーションは、
	<a class="ulink" href="http://sources.redhat.com/cgi-bin/cvsweb.cgi/libc/abi-tags?cvsroot=glibc" target="_top">abi-tags</a>
	および
	<a class="ulink" href="http://sources.redhat.com/cgi-bin/cvsweb.cgi/libc/csu/abi-note.S?cvsroot=glibc" target="_top">csu/abi-note.S</a>
	のソースを調べてください。
      </p>
    </div>
  
      <h4 class="title">
<a name="note-creation"></a>ELF <code class="constant">PT_NOTE</code> セクションの作成 (<a href="#introduction">top</a>)
  </h4>

      <p>
	バイナリーを作るために、 GNU binutils 2.8 かそれ以降を使っていれば、
	最終版のオブジェクトファイルに <code class="constant">PT_NOTE</code> セクションを生成することができます。
	<code class="constant">PT_NOTE</code> セクションを作るには、
	オブジェクトファイルの一つ
	(デフォルトで <code class="constant">PT_NOTE</code> エントリーを生成するシステムでは、
	これは一般的にランタイムのスタートアップコードです) に
	名前が ".note" で始まり "allocate" 属性セットを持つセクションをつくります。
	このセクションに、 ELF Note エントリーを適切な形で書きます。
	最終的なリンクが終わったとき、 ".note" で始まる名前をもち、かつ
	"allocate" とマークされた全セクションは、
	最終オブジェクトファイルにおいて、
	<code class="constant">PT_NOTE</code> セクション内に配置されるでしょう。
      </p>
      <p>
	GNU アセンブラーの例では、
	最終リンク時に <code class="constant">PT_NOTE</code> セクションを作る入力物は:
      </p>
<pre class="programlisting">
    .section ".note.ident", "a"
    .p2align 2
    .long 1f - 0f           # name サイズ (詰め物含まず)
    .long 3f - 2f           # desc サイズ (詰め物含まず)
    .long 0x01234567        # type
0:  .asciz "NaMe"	    # name
1:  .p2align 2
2:  .long 0x76543210        # desc
    .long 0x89abcdef
3:  .p2align 2
</pre>

<p>
  この例では ".note.ident" と呼ばれ、 "allocate" とマークされた、
  (最終リンク時に <code class="constant">PT_NOTE</code> セクションと変わる)
  1つの note を含むセクションを作るでしょう。
  この note は <code class="varname">type</code> が
  <code class="code">0x012345678</code> (訳注9桁???)、 <code class="varname">name</code> が
  <code class="code">"NaMe\0"</code> で、
  <code class="varname">desc</code> 値は、2つの 4-byte 整数、<code class="code">0x76543210</code> と
  <code class="code">0x89abcdef</code> です。
</p>
    
      <h4 class="title">
<a name="netbsd-note"></a>NetBSD ELF <code class="constant">PT_NOTE</code> セクションの作成 (<a href="#introduction">top</a>)
  </h4>
      
      <p>
	NetBSD カーネルは、 ELF バイナリー中に <code class="constant">PT_NOTE</code> セクションが見つからない場合に
	ENOEXEC を返します。通常、ネイティブ NetBSD アプリケーション用の
	PT_NOTE セクションは <code class="filename">crtbegin.c</code>
	に含まれています。以下に示す例は、  NetBSD/sparc でこのセクションを作成するものです。
	(他のポート、たとえば arm では @ はコメントの開始を意味するために %note を使うなど、
	アセンブラーの文法が若干異なることがありますが、
	エンディアンの違いを除けば、個々の断片はすべて同じです)
      </p>
<pre class="programlisting">
        .section ".note.netbsd.ident", "", @note
        .long   2f-1f
        .long   4f-3f
        .long   1
1:      .asciz "NetBSD"
2:      .p2align 2
3:      .long   499003600
4:      .p2align 2
</pre>
    </div></div></div>
<div class="navfoot"></div>
<div id="footer"><center>
<span class="footfeed"><a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">
	  連絡</a> |
      </span><span class="footcopy"><a href="../../../ja/about/disclaimer.html">
      免責事項</a> |

      <span class="copyright">Copyright © 1994-2011 The NetBSD Foundation, Inc. </span>ALL RIGHTS RESERVED.<br>NetBSD<sup>®</sup> は The NetBSD
	Foundation, Inc. の登録商標です。</span>
</center></div>
</div></body>
</html>
