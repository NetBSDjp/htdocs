<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="Website XSL Stylesheet V2.6.0">
<link rel="stylesheet" href="global.css" type="text/css">

<title>FreeBSD のネットワークドライバーを NetBSD に移植するためのメモ</title>
</head>
<body class="website"><div class="webpage">
<a name="ja-docs-kernel-porting-freebsd-net"></a><div id="top"><a href="#mainContent" class="doNotDisplay doNotPrint">本文へ飛ぶ。</a></div>
<div id="header">
<div class="topNavigation">
<span>» </span><a href="../../../docs/guide/en/">
	  ガイド</a> |
	<a href="http://man.NetBSD.org/">マニュアルページ</a> |
	<a href="../../../ja/mailinglists/">
	  メーリングリスト</a>と
	<a href="http://mail-index.NetBSD.org/">記事</a> |
	<a href="http://cvsweb.NetBSD.org/">CVS リポジトリー</a> |
	バグの<a href="http://www.NetBSD.org/cgi-bin/sendpr.cgi?gndb=netbsd">報告</a>
	と
	<a href="../../../ja/support/query-pr.html">
	 照会</a> |
	<a href="../../../ja/docs/software/packages.html">
	  ソフトウェアパッケージ
	</a>
</div>
<div class="centralHeader">
<a href="../../../ja/"><img alt='NetBSD プロジェクト "Of course it runs NetBSD"' width="506" height="90" src="../../../images/NetBSD-headerlogo.png"></a><div class="headerTools"><div id="headerSearch"><form method="get" action="http://www.google.com/custom">
<input class="whiteOnBlack" type="text" name="q" onfocus="if(this.value==this.defaultValue ) this.value='';" size="12" maxlength="255" value="Search"><input type="hidden" name="cof" value="L:http://www.NetBSD.org/images/NetBSD-smaller.png;LH:200;LW:200;AH:center;AWFID:4f6b0499f0f58d2c;"><input type="hidden" name="domains" value="NetBSD.org"><input type="hidden" name="sitesearch" value="www.NetBSD.org"><input type="submit" value="検索">
</form></div></div>
</div>
<div class="navBar">
<span class="doNotDisplay">
	  案内:
	</span><a href="../../../ja/">
	  ホーム</a> | 
	<a href="../../../ja/about/">
	  概要</a> | 
	<a href="../../../ja/gallery/">
	  展示室</a> | 
	<a href="../../../ja/releases/">
	  ダウンロード</a> | 
	<a href="../../../ja/docs/">
	  ドキュメンテーション</a> | 
	<a href="../../../ja/support/">
	  サポート</a> | 
	<a href="../../../ja/community/">
	  コミュニティー</a> | 
	<a href="../../../ja/ports/">
	  機種</a>
</div>
</div>
<div id="content"><div class="fullWidth"><div class="rowOfBoxes">
<h1>FreeBSD のネットワークドライバーを NetBSD に移植するためのメモ</h1>
<h3 class="title"><a name="all"></a></h3>
<ul>
<li><a href="#intro">概要</a></li>
<li><a href="#includes-and-defs">基本的なインクルードファイルや定義要素</a></li>
<li><a href="#framework">ネットワーク固有でないフレームワーク</a></li>
<li><a href="#njetwork">ネットワーク関連</a></li>
</ul>
<hr>
<h3 class="title"></h3>
  <h4 class="title">
<a name="intro"></a>概要 (<a href="#all">top</a>)
  </h4>
    <p>
      Matthias Drochner は、FreeBSD のネットワークドライバーを NetBSD に
      移植する時に見つけた相異点をまとめています。
      これが役に立つことを願っています。
    </p>

  <h4 class="title">
<a name="includes-and-defs"></a>基本的なインクルードファイルや定義要素 (<a href="#all">top</a>)
  </h4>
  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>
	#include ファイル名 / 場所は、思ったより異なっています。
      </p>
    </li>
<li class="listitem">
      <p>
	パケットフィルター: FreeBSD では "BPF", NetBSD では "BPFILTER" です。
	[理由は無い様に見受けられますが、多くの OS 間で異なっている様です。(DEC: "packetfilter")]
      </p>
      </li>
<li class="listitem">
	<p>
	  NetBSD では、"opt_inet.h" と "opt_ns.h" をインクルードする必要が有ります。
	</p>
      </li>
<li class="listitem">
	<p>
	  NetBSD には、グローバル変数 "bootverbose" が存在しません。
	</p>
      </li>
<li class="listitem">
	<p>
	  NetBSD は、集中管理された PCI ID データベースと PCI レジスターの定義を持っています。
	</p>
      </li>
<li class="listitem">
	<p>
	  if_media: FreeBSD: IFM_1000_SX, NetBSD: IFM_1000_FX
	  [1000_FX と言う物は存在しません。- NetBSD が間違っています。]
	</p>
      </li>
<li class="listitem">
	<p>
	  &lt;sys/queue.h&gt; の中の要素の違い
	  (NetBSD には SLIST の様な物は存在しません。
	  名前の違いに理由は有りません。しかし、SLIST の様な物は(SIMPLEQ よりオーバーヘッドが少ないので)
	   NetBSD にとっても有用です)。
	</p>
      </li>
</ul></div>

  <h4 class="title">
<a name="framework"></a>ネットワーク固有でないフレームワーク (<a href="#all">top</a>)
  </h4>
  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>
	オートコンフィギュレーションのフレームワークが異なります。
      </p>
    </li>
<li class="listitem">
      <p>
	デバイス名の表示: FreeBSD では name:unit, NetBSD では xname です。
	("struct ifnet" も同様です。)
      </p>
    </li>
<li class="listitem">
      <p>
	割り込み用のハンドラーが、FreeBSD では void、NetBSD では int です。
	[stray interrupts の検出???]
      </p>
    </li>
<li class="listitem">
      <p>
	bus.h: マップされた範囲の仮想アドレスへのアクセス
	(全てのハードウェアがサポートしているわけではないので、
	一般的にはリニアーマッピングは避けた方が良いです。しかし、どうしても必要なら
	BUS_SPACE_MAP_LINEAR がこれを提供すべきです。)
	[NetBSD の bus_space フレームワークには存在しません。移植性を低下させる原因なので、
	可能なら bus_space_xxx を使いましょう。]
      </p>
    </li>
<li class="listitem">
      <p>
	bus_dma 関係(FreeBSD は、まだ古い機能を使っています。)
      </p>
    </li>
</ul></div>

  <h4 class="title">
<a name="njetwork"></a>ネットワーク関連 (<a href="#all">top</a>)
  </h4>
  <div class="itemizedlist"><ul class="itemizedlist" type="disc">
<li class="listitem">
      <p>
	外部 mbuf ストレージ処理:
	FreeBSD では xxxfree() への引数は有りません。
	ドライバーがリファレンスカウントを与えます。
	NetBSD では xxxfree() への引数がはっきりしません。
	リファレンスカウントは自動的におこないます。
      </p>
    </li>
<li class="listitem">
      <p>
	FreeBSD は汎用の ether_ioctl() を持っています。
	[良い - 汎用のコードを削除する。]
      </p>
    </li>
<li class="listitem">
      <p>
	アドレスバイトのための "struct ether_addr" のメンバー:
	FreeBSD では "octet" を使い、
	NetBSD では "ether_addr_octet" を持っています。
	[理由は無い]
      </p>
    </li>
<li class="listitem">
      <p>
	softc の "ethercom" 対 "arpcom"
	[技術的には、 NetBSD が正しい。]
      </p>
    </li>
<li class="listitem">
      <p>
	イーサネットアドレスへのアクセス:
	FreeBSD: "arpcom" の中でアクセスされる。
	NetBSD: ether_ifattach() へ渡され、ifp を経由してアクセスされる。
	(LLADDR() - アライメント問題の監視!)
	[NetBSD では実行中のアドレス変更を扱うことが出来ません。]
      </p>
    </li>
<li class="listitem">
      <p>
	マルチキャストアドレスのリスト:
	FreeBSD では ifp-&gt;if_multiaddrs の、そのままのリスト、
	NetBSD では "struct ethercom" の一部と言う、特別なフレームワークです。
      </p>
    </li>
<li class="listitem">
      <p>
	"struct ifnet" のメンバーが異っており、
	異なる初期化 (if_attach、ether_ifattach) を行う。
	xname 対 name:unit、
	FreeBSD では xxxinit() が ether_ioctl() によって使われる、
	イーサネットアドレス。
      </p>
    </li>
<li class="listitem">
      <p>
	bpf 関数の引数: 
	FreeBSD では ipf, 
	NetBSD では ifp-&gt;if_bpf
      </p>
    </li>
<li class="listitem">
      <p>
	受信パケットの上位レイヤーへの引渡し:
	FreeBSD では ether_input()に、イーサネットヘッダーを分離して渡す。
	NetBSD では全てのパケットを、 ifp-&gt;ifp_input と間接的に経由して渡す。
      </p>
    </li>
<li class="listitem">
      <p>
	NetBSD は MII フレームワークを持っており、ドライバーはレジスターへのアクセスを提供するだけです。
      </p>
    </li>
</ul></div>
<hr>
<em><a href="./">NetBSD ドキュメンテーション: カーネル</a></em> に戻る</div></div></div>
<div class="navfoot"></div>
<div id="footer"><center>
<span class="footfeed"><a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">
	  連絡</a> |
      </span><span class="footcopy"><a href="../../../ja/about/disclaimer.html">
      免責事項</a> |

      <span class="copyright">Copyright © 1994-2011 The NetBSD Foundation, Inc. </span>ALL RIGHTS RESERVED.<br>NetBSD<sup>®</sup> は The NetBSD
	Foundation, Inc. の登録商標です。</span>
</center></div>
</div></body>
</html>
