<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html lang="ja">
<head>
<!-- Copyright (c) 1994-2004
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<meta http-equiv="Content-Type" content="text/html; charset=ISO-2022-JP">
<link rev="made" href="mailto:www@jp.NetBSD.org">
<link rel="shortcut icon" href="../../../favicon.ico" origlink="/favicon.ico" type="image/x-icon">
<title>The NetBSD Networks FAQ</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<HEADING>NetBSD ネットワーキングの基礎

このページは作成中ですので、
<a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">コメントや提案</a>を歓迎します。

<LIST>
<h2>Other links</h2>
<!--
If you add entries here, please add them to ../index.html as well.
Note that the relative URL path needs to be modified.
-->
<ul>
  <li><a href="../../../guide/en/chap-inetd.html" origlink="../../guide/en/chap-inetd.html">インターネットスーパーサーバー (inetd)</a>
  <li><a href="nsps/">NetBSD Security Processes and Services</a>
  <li><a href="wavelan.html">Lucent WaveLAN を用いたワイヤレスネットワーキング</a>
  <li><a href="netboot/">HOWTO ディスクレスマシンのネットブート</a>
  <li><a href="isdn/">ISDN での接続手順</a>
  <li><a href="gprs.html">GPRS / CDPD を使った接続手順</a>
  <li><a href="pppoe/">PPPoE (DSL) 経由の接続手順</a>
  <li><a href="http://coombs.anu.edu.au/~avalon/ip-filter.html">IP-Filter</a> を
      用いた<a href="http://www.static.net/~armenb/ipnat.html">ネットワーク
      アドレス変換 (Network Address Translation, NAT) FAQ</a>
  <li><a href="dhcp.html">DHCP クライアントとサーバー設定の HOWTO</a>
  <li><a href="http://www.feyrer.de/NetBSD/NWF/">
      NetBSD/amiga のためのネットワーキング FAQ ガイド</a>
  <li><a href="ipv6/">IPv6 ネットワーキング FAQ</a>
  <li><a href="ipsec/">IPsec FAQ</a>
  <li><a href="http://www.macbsd.com/macbsd/howto/index.html">
      PPP、クロスコンパイル、その他の HOWTO</a>
  <li><a href="http://www.obfuscation.org/ipf/ipf-howto.txt">IP Filter ベースの防火壁 HOWTO</a>

<!--  XXX: BSDToday.com disappeared, so let's comment these links -->

<!--
  <li>Network Flight Instructions, Part I: <a
      href="http://www.bsdtoday.com/2001/February/Features401.html">Digital
      Subscriber Line - 概観と設定</a>: NetBSD での
      DSL 使用の概観
  <li>Network Flight Instructions, Part II: <a
      href="http://www.bsdtoday.com/2001/February/Features409.html">インターネット
      ゲートウェイの設定 &amp; 基本的なオンラインセキュリティールール</a>
-->

	<!-- XXX: Who is "I"?  We can put the article up now! -->
	<!--
           - I have the source of the NFI articles, and we can put them
           - up on www.NetBSD.org after the BSDtoday privilege to publish
           - expires on May 13th 2001
          -->

  <li> The <a href="ftp://ftp.csl.sony.co.jp/pub/kjc/papers/altq98.ps.gz">AltQ Paper</a>
  <li> <a href="http://caunter.ca/nsupdate.txt">nsupdate HOWTO</a></li>
</ul>

<SECTION>Networking FAQ

<ENTRY>getting_started 始めよう
NetBSD のインストール手順は基本的なネットワークの設定を含んでおり、
標準的なワークステーション構成の設定を行います。
この設定は NetBSD の多くのネットワークの機能を利用するために拡張することができます。
<ul>
  <li><h3>参考:</h3>
      <ul>
        <li><a href="http://www.cis.ohio-state.edu/cgi-bin/rfc/rfc1918.htmlRFC">RFC 1918</a>
	   (<a href="ftp://ftp.nic.ad.jp/jpdoc/rfc-jp/rfc1918-jp.txt">和訳</a>)
             - プライベート・インターネットのアドレス割り当て
      </ul>
</ul>

<ENTRY>configuration_files  ネットワーク設定ファイル
ネットワークの設定は、テキスト形式の設定ファイルによって
設定します。
<ul>
  <li>/etc/rc.conf - rc.conf(5) 
      システムの初期化時に、ネットワークサービスを含む
      システムサービスを自動的に開始するための設定。
  <li>/etc/hosts - hosts(5) もっとも基本的なホスト名とIPアドレスの対応表。
  <li>/etc/myname - そのホストの FQDN (ドメイン名のついたホスト名) (/etc/rc.conf で
      <tt>hostname</tt> を設定していない場合に使われる)。
  <li>/etc/mygate - デフォルトゲートウェイ。通常は /etc/rc.conf に
      <tt>defaultroute</tt> として記述する方がよい。また、
      routed(8) を使用することもできる。
  <li>/etc/ifconfig.{<em>IF</em>}. - 
      ネットワークインターフェース <em>IF</em> の設定。
      システムの初期化時、ネットワークインターフェースを
      設定するために <em>/etc/rc.d/network</em>で用いられる。 ifconfig.if(5) 参照。
      /etc/rc.conf で <tt>ifconfig_IF="..."</tt> のように設定することもできる。
  <li>/etc/ifaliases - ifaliases(5)
      一つのインターフェースには一つ以上の IP アドレス (alias) を割り当て
      ることができる。
      ここで記述された alias は、システムの初期化時に <em>/etc/rc.d/network</em>
      で用いられる。
  <li>/etc/resolv.conf - resolv.conf(5) は、数値 IP アドレスからホスト名への
      名前解決方法を指定します。たいていの場合、探索用のドメインを指定する行と、
      問い合わせ先ネームサーバーの IP アドレス (1 行または複数) を書いておきます:
<p>
<pre>
search subdomain.yourdomain.tld yourdomain.tld
nameserver 192.168.253.10
nameserver 192.168.253.11
</pre>

      このファイルは dhclient(8) が上書きすることに注意してください!
</ul>
<ul>
  <li><h3>参考:</h3>
      <ul>
        <li>hostname(7)</li>
      </ul>
</ul>


<ENTRY>configuration_programs  ネットワーク設定プログラム

二つの重要なネットワーク設定プログラムがネットワークスタートアップスクリプト
(/etc/rc.d/network) で使われています。
これらは使用中のネットワークの設定を手動で変更するのに使うこともできます。
<p>

<ul>
  <li>ifconfig(8) - ネットワークインターフェースの設定を変更、参照する。
  <li>route(8) - ネットワークルーティングテーブルを操作する。
</ul>

<ul>
  <li><h3>参考:</h3>
      <ul>
	<li>domainname(1)</li>
        <li>hostname(1), hostname(7)</li>
      </ul>
</ul>


<ENTRY>adding_a_host  ネットワークに新しいホストを追加する

そのネットワークが DHCP を使うように設定されている場合、必要なのは
/etc/rc.conf で "<tt>dhclient=yes</tt>" と設定することだけです。すると、
ブート時に DHCP クライアントが起動して、マシンの IP アドレス、ホスト名、
デフォルトルーター、ネームサーバー、ドメイン名を自動的に設定します。
DHCP に関するさらなる情報は、<a href="dhcp.html">ここ</a>を参照してください。
<p>

DHCP が使えない場合、新たにネットワークに接続するホストでは、インターフェースを、
そのローカル・ネットワーク上のアドレスに設定することが最低限必要です。
NetBSD のインストール中にネットワークの情報を与えると、
新しいホストはすぐにネットワークに接続され、
その IP アドレスでアクセスできるようになります。
<p>

ネットワークの設定の簡単な例を以下に示します。ネットワークインターフェースは
<em>ex</em>で、 IP アドレスを 192.168.253.2 に設定し、デフォルトルーターは
192.168.253.1 を使うものとします:
<p>

<pre>
  # ifconfig lo0 127.0.0.1
  # ifconfig ex0 192.168.253.2 netmask 255.255.255.0
  # route add default 192.168.253.1
</pre>


<ENTRY>naming_a_host  ネットワークの新しいホストを名づける

IP アドレスと同じようにホスト名でのアクセスを可能にするには、
新しいホスト名とその IP アドレスをネットワーク設定ファイルに
追加します。それにはいくつかの方法があります;

<ol>
  <li>/etc/hosts: hosts(5) 
      少数のホストからなる小さなネットワークでは、
      ホスト名と IP の対応を、各ホストの /etc/hosts ファイルに
      手でコピーすることができるでしょう。
      <p>
      <em>/etc/hosts:</em><br>
      <samp>
      192.168.1.2  host2.mydomain.org.au host2<br>
      </samp>
      <p>

  <li>NIS (Network Information Service、以前は Yellow Pages
      (YP) という名前でした) を使うと
      /etc/hosts ファイルと同等な情報を、ネットワーク上で
      自動的に共有できるようになります。(hosts にある情報だけではなく
      passwd や group など、他のファイルにある情報も共有できます)。
      さらなる情報は、
      rc.conf(5) の <tt>ypbind</tt> および <tt>domainname</tt>
      変数と、 domainname(1), ypinit(8), yp(8) を参照してください。
      <p>

  <li>DNS: ホスト名の対応をネームサーバー named(8)
      経由でアクセスするゾーンファイルで集中管理します。
      (DNS ファイルの設定や管理についての多くのドキュメントが
      <a href="http://www.dns.net/dnsrd/docs/">www.dns.net</a>
      にあります)。
      <p>

      <em>正引きゾーンファイルのエントリー</em><br>
      <samp>
      host2  IN A     192.168.1.2
      </samp>
      <p>

      <em>逆引きゾーンファイルのエントリー</em><br>
      <samp>
      2      IN PTR   host2.mydomain.org.au.
      </samp>
</ol>
<ul>
  <li><h3>参考:</h3>
      <ul>
        <li>named.conf(5)</li>
	<li>nsswitch.conf(5)</li>
      </ul>
</ul>


<ENTRY>internetworking  インターネットワーキング

あなたのネットワーク (一つのホストから成るかもしれません) を
他のネットワークにつなぐ場合、少なくとも一つのホストを
二つのネットワーク間のゲートウェイとして動作させなくてはなりません。
ゲートウェイホストは二つのネットワークインターフェースを持っており、
それぞれを各ネットワークについて設定します。
<p>

<ul>
  <li>二つ目のイーサネットのインターフェース設定ファイルを作成する
      (/etc/ifconfig.{<em>interface</em>}) 。
      <p>
      <em>/etc/ifconfig.we1</em><br>
      <samp>
      192.168.2.30 netmask 0xffffff00 media 10base2/BNC
      </samp>
      <p>

      こうするかわりに、以下の行を /etc/rc.conf に書き足す方法もあります :
      <p>

      <samp>
      ifconfig_we1="192.168.2.30 netmask 0xffffff00 media 10base2/BNC"
      </samp>

  <li>新しいインターフェースを有効にする為にリブートする。
  <li>必要ならば IP パケットフォワーディングを有効にします。カーネルを
      "options GATEWAY" をつけて compile してもいいですし、
      ブートのたびに "<tt>sysctl -w
      net.inet.ip.forwarding=1</tt>" を実行するか、 /etc/sysctl.conf に
      "<tt>net.inet.ip.forwarding=1</tt>" を書いておいてもいいでしょう。
</ul>
<ul>
  <li><h3>参考:</h3>
      <ul>
        <li>ipnat(5),ipnat(8)</li>
	<li>ipf.conf(5),ipf(8)</li>
	<li>sysctl.conf(5),sysctl(8)</li>
      </ul>
</ul>

<ENTRY>ppp  PPPによるインターネットワーキング
pppd(8)
を用いるとシリアルポート (モデムの有無にかかわらず) 上に特殊な
ネットワークインターフェースを作成できます。

<p>

PPP のセットアップには多くの方法があります。あなたの ISP に接続するのに
適した一つの簡単な方法は;
<ol>
  <li>ピアーオプションファイルを作成する
      <p>
      <em>/etc/ppp/peers/myisp</em><br>
      <samp>
      # Example pppd options <br>
      # Specific for myisp <br>
      /dev/tty01<br>
      local_IP_address:remote_IP_address<br>
      connect '/usr/sbin/chat -v -f /etc/ppp/peers/myisp.chat'<br>
      defaultroute<br>
      persist<br>
      ipparam myisp<br>
      asyncmap 0<br>
      noauth
      </samp>
      <p>
  <li>デバイスオプションファイルを作成する
      <p>
      <em>/etc/ppp/options.{ttyname}</em><br>
      <samp>
      # Example pppd options <br>
      # Specific for ttyname <br>
      lock<br>
      crtscts<br>
      57600<br>
      modem<br>
      </samp>
      <p>
  <li>チャットファイルを作成する
      <p>
      <em>/etc/ppp/peers/myisp.chat</em><br>
      <samp>
      # Example chat file <br>
      # Specific for myisp<br>
      ABORT BUSY ABORT 'NO CARRIER' ""<br>
      \da\ptz0 OK<br>
      \da\ptdt8887776655 CONNECT<br>
      </samp>
      <p>
  <li>コネクションを確立する;
      <p>
      <samp>
      pppd call myisp
      </samp>
      <p>
  <li>変数をセットする
      <p>
      <samp>
      ppp_peers="myisp"
      </samp>
      を /etc/rc.conf rc.conf(5)
      に書いておくとブート時に自動的にコネクションが確立するようになります。
</ol>

イーサネットインターフェースと異なり、<em>/etc/ifconfig.{interface}</em>
ファイルを PPP インターフェースに作成する必要はありません。
<p>
デマンドダイアル ppp を使用していて、特定のトラフィック(例えば xntpd(8) の
ntp のトラフィック)でリンクが確立されないようにしたいならば、
pppd.conf ファイル中で <tt>active-filter</tt> を使うことができます:
<pre>	active-filter   'not udp port ntp'</pre>

<ul>
  <li><h3>参考:</h3>
      <ul>
        <li>chat(8) - Automated conversational script
        <!-- http://www.macbsd.com/macbsd/howto/pppnat
             How to setup PPP for multiple ISPs, including
             IP-NAT and DNS setup. -->
      </ul>
</ul>

<ENTRY>pppleased 専用線を用いた pppd の設定
専用線とは固定された2点間 link の事です。
この場合、NetBSD での設定は非常に簡単です。
サーバーで次のような <em>/etc/ppp/options</em> を作成します:
<p>
     <blockquote>
     /dev/tty00<br>
     57600<br>
     noauth<br>
     crtscts<br>
     passive<br>
     &lt;local_IP_address&gt;:&lt;remote_IP_address&gt;<br>
     debug<br>
     netmask 255.255.255.255<br>
     proxyarp<br>
     </blockquote>
<p>
&lt;local_IP_address&gt; と &lt;remote_IP_address&gt; は使用するネットワーク上の
適切なものに変更する必要があります。(&lt;local_IP_address&gt; は
イーサネットと同じでも構いませんが、&lt;remote_IP_address&gt; は
イーサネットのセグメントで有効なアドレスである必要があります)。
<p>
クライアントで次のような <em>/etc/ppp/options</em> を作成します:
<p>
     <blockquote>
     /dev/tty00<br>
     57600<br>
     noauth<br>
     crtscts<br>
     defaultroute<br>
     debug<br>
     </blockquote>
<p>
両方の設定中にあらわれる /dev/tty00 は適切なシリアルポート名に変更して下さい。

<ENTRY>isdn-ta ISDN モデム (ターミナルアダプター、 TA) の使い方は?

NetBSD からは TA は普通のモデムに見えます。また、 TA は適切なモードに
切り替えれば asynchronous PPP をしゃべります。お使いの ISP
によっては、以下のモードから選べるかもしれません:
<P>

<ul>
<li> sync-to-async-HDLC conversion: 同期 HDLC フレームを非同期 HDLCフレームに
	変換します。お使いのプロバイダーが、昨今での標準である、 B チャネル上直接の
	"本物の" PPP over HDLC を推奨している場合はこれを使ってください。
<li> X75: X.25 over ISDN B-channel
<li> V120: 遅いコンピューター端末線用に狭い帯域のモデムを
	シミュレートするためのもの; しかし、残念なことに ISDN
	線の帯域をいくらか浪費しますが
<li> V110: V120 の古いバージョン
</ul>
<P>

TA のモードは Hayes "AT" モデムコマンドで設定します。正確なコマンドは
モデムのマニュアルを調べてください。さらに、これら "AT" コマンドに、
"普通の" (アナログ) でやっているようにして、いつも使う PPP 接続先用に
チャットスクリプトを追加することができます。
<P>


<ENTRY>isdn4bsd	ISDN カードを用いたインターネットワーキング
<a href="isdn/">ここ</a>をご覧ください。


<ENTRY>pppoe DSL / PPPoE を用いたインターネットワーキング

DSL/ PPPoE 全般の説明は、<a href="pppoe/">ここ</a>をご覧ください。
ドイツの ISP T-Online 利用者向けの<a href="pppoe/#t-online">追加説明</a>
もあります。


<ENTRY>gprs Inter-networking with GPRS / CDPD を用いたインターネットワーキング
<a href="gprs.html">ここ</a>をご覧ください。


<ENTRY>simplenat	簡単な NAT ("IP Masquerading") の設定

ローカルネットワーク(例えば 10.0.0.0/24) に接続されているホストから
NetBSD マシンをルーターとして使用するために、ネットワークアドレス変換
(Network Address Translation, NAT、よそでは "IP Masquerading" とも呼ばれる)
を設定するには、次のようにすればいいでしょう: <P>

<OL>
<LI>クライアントでは、NAT マシンをデフォルトルーターとして指定します。
        (NetBSD を使用しているならば、/etc/rc.conf に
	<TT>defaultroute="<I>a.b.c.d</I>"</TT> を加えてください。
        ここで、<TT><I>a.b.c.d</I></TT> は内部向の IP アドレス
        (つまり、10.0.0.0 ネットワークのアドレス) を意味します)。
<LI>NAT マシンで、まずカーネルが ipfilter オプションが有効になっているかを
        確認してください (最新の GENERIC カーネルではデフォルトで有効になっています。):
<PRE>
options         PFIL_HOOKS    	        # pfil(9) packet filter hooks
pseudo-device   ipfilter                # IP filter (firewall) and NAT
</PRE>

<LI>以下の内容を /etc/ipf.conf(5) に書きます:
<PRE>
pass in from any to any
pass out from any to any
</PRE>

<LI>以下の内容を /etc/ipnat.conf(5) に書きます:
<PRE>
map ppp0 10.0.0.0/24 -> 0/32 proxy port ftp ftp/tcp
map ppp0 10.0.0.0/24 -> 0/32 portmap tcp/udp 40000:60000
map ppp0 10.0.0.0/24 -> 0/32
</PRE>

<LI> /etc/rc.conf で設定を有効にします:
<PRE>
ipfilter=YES                                    # uses /etc/ipf.conf
ipnat=YES                                       # uses /etc/ipnat.conf
</PRE>

<LI> /etc/sysctl.conf で ipv4 パケットフォワーディングを有効にします:
<PRE>
net.inet.ip.forwarding=1
</PRE>

<LI> リブートします。

<LI> デバッグには ping(8) 、 tcpdump(1) 、 ipfstat(8)、 ipnat(8) を使って下さい。
</OL>
<p>

PPPoE 接続上で (DSL 接続で通常はそうしますが) NAT を使いたい場合は、
<a href="pppoe/#clamping">MSS の調整</a>もしておく必要があるかもしれません。
<p>

<ENTRY>maintenance  メンテナンス
<ul>
  <li>監視 - 便利なツール
      <ul>
        <li>ifconfig(8) - ネットワークインターフェースのパラメーターの設定と表示
        <li>route(8) - ルーティングテーブルの操作
        <li>ping(8) - ICMP ECHO_REQUEST パケットをネットワークホストに送る
        <li>traceroute(8) - パケットがネットワークホストに到達するルートを表示
        <li>tcpdump(1) - ネットワークインターフェース上のトラフィックを選択して表示
        <li>netstat(1) - ネットワーク状態の表示
        <li>systat(8) 'systat netstat' - ネットワーク接続を動的に表示
      </ul>
</ul>
<ul>
  <li><h3>参考:</h3>
      <ul>
        <li><PKGSRC>net/mrtg - パッケージコレクションにあるこのユーティリティーで、
			ネットワークの状態を視覚的に監視できるようになります。
      </ul>
</ul>

<ENTRY>security  セキュリティー
<ul>
  <li>/etc/hosts.{allow,deny}: 
      tcp-wrappers (hosts_access(5))
      の設定ファイル。マスターデーモン
      inetd(8)
      に組み込まれている。
  <li>もし、ネットワークアドレス変換 (NAT 、ときには IP マスカレードとも呼ばれます)
      も含んだ完全な防火壁が必要ならば、NetBSD 付属の IPfilter を
      使用して下さい。
      IP filter の <a href="http://coombs.anu.edu.au/ipfilter/">ホームページ</a>を
      参照してください。
      NetBSD での設定ファイルについては ipf.conf(5), ipf6.conf(5),
      ipnat.conf(5) を、コマンドおよび有用なマニュアルページとしては ipf(4),
      ipf(8), ipfs(8), ipfstat(8) を参照してください。
</ul>
<ul>
  <li><h3>参考:</h3>
      <ul>
        <li><a href="http://www.cert.org/">CERT* Coordination Center</a>
            は、インターネットのセキュリティー脆弱性を研究しています。
        <li><a href="http://www.cert.org/tech_tips/root_compromise.html">
            UNIX の Root 権限奪取からの復旧手順</a>
        <li><a href="http://www.obfuscation.org/ipf/ipf-howto.txt">IP Filter
            による防火壁 HOWTO</a>
      </ul>
</ul>

<ENTRY>appletalk  Appletalk を使う
NetBSD は unix マシンと appletalk マシンをイーサネット (localtalk では
ありません) で通信を可能にする '<PKGSRC>net/netatalk' をサポートしています。
これは MacOS マシンが NetBSD マシンを介してファイルシステムを読んだり
プリンターを用いたり、NetBSD マシンが appletalk プリンターに印刷したり
することができます。必要なソースは NetBSD の<a href="../software/packages.html">Packages
Collection</a>から利用可能です。


<ENTRY>kerberos Kerberos
Kerberos は、秘密鍵暗号を使用してクライアント/サーバー型アプリケーションに
強力な認証を提供するネットワーク認証システムです。
<p>
NetBSD には KTH Heimdal Kerberos 5 の実装が附属しています。
<p>
ここでは、 NetBSD システムで Kerberos を使うための設定について
簡単に説明します。 Kerberos 初心者にとっては、この文書は基本的な
手引きとなります。 Kerberos 熟練者にとっては、すでに使っているかもしれない
他のシステム上の Kerberos と、 NetBSD の Kerberos との違いを示すものに
なるかもしれません。
<p>
この説明では、あなたの DNS ドメイン名を "foo.com" であるとします。
また、 foo.com ドメインには 2 台のマシンがあって、その名前は
<i>mach1.foo.com</i> と <i>mach2.foo.com</i> であるとします。
<p>
Kerberos で管理される domain を <b>realm</b> といいます。
realm は好きなように名付けることができますが、ここでは、
組織の DNS ドメイン名を大文字にしたものを使うことにします。つまり、
ドメインの例 "foo.com" に対しては、 Kerberos realm は "FOO.COM" になります。
<p>
Kerberos で識別されるものを <b>principal</b> といいます。ユーザー、
ホスト、さらにはホスト上の個々のサービスまで、すべて principal です。
principal は "name@REALM" という形をしています。 "@REALM" を省略すると、
デフォルトの realm が仮定されます。サービスの principal は
"service/hostname@REALM" という形をしています。ここで hostname はホストの
完全修飾名にしてください。すべてのホストは、 "host/..."
というサービス principal を持っています。この "host/..." principal は、
一般的にログインプログラム (たとえば telnetd(8)、 sshd(8)) や、
その他ホストが他の principal の認証をする必要のある場合
(たとえばいくつかの IPsec 鍵管理プロトコル) に使われます。
<p>
Kerberos の信任状インスタンスは<b>チケット</b>と呼ばれます。チケットには、
<b>ticket granting ticket</b> (チケット保障チケット) すなわち TGT
と呼ばれる特別なチケットがあります。 TGT は信任状の初期設定で、
ユーザーが login(1) プログラムを使うか kinit(1) を実行してログイン
したときに得られます。 TGT は、 Kerberos で認証をおこなうサービスを
利用するために必要なサービスチケットを取得するために使われます。チケットは、
<b>信任状キャッシュ</b>と呼ばれる専用のデータベースに保持されます。
ログインセッションでは、信任状キャッシュは通常は /tmp 以下のファイルに
保持されます。信任状キャッシュは、 kdestroy(1) コマンドによるログアウト時に
破棄されます。<b>信任状キャッシュを安全な状態にしておくことが重要です!</b>
そうでないと、誰かがあなたの信任状を使って信任状の必要なサービスにアクセス
することができるようになってしまいます。
<p>
信任状は <b>Key Distribution Center</b> (鍵配布センター) すなわち KDC
で集中管理されます。 KDC によるユーザー認証は、 TGT 取得時にパスワードを
提供することで行われます。 KDC によるサービス認証も同様の仕組みを使いますが、
<b>key table</b> すなわち keytab からサービスの "パスワード" が提供され、
ホストに保持されます。
<p>
Kerberos では、 realm 内の全ホストの時刻が同期している必要があることに
注意してください。そのようにするための最良の方法は、このネットワークで
NTP を使うことです。
<p>
以下、ネットワークで Kerberos を使うための設定を、
順序立てて説明します。
<p>
<ol>
<li> Kerberos KDC となるシステムを決めます。このシステムは安全でなければ
     なりません; KDC が危険に晒されると、すべての principal に被害が及びます。
     この例では、この役目を <i>mach1.foo.com</i> に与えることにします。
     <p>
     KDC システムはまた、 Kerberos 管理サーバーや Kerberos
     パスワード変更サーバーといった役割も演じます。
     <p>
     KDC に関する情報を提供するためのもっとも簡単な方法は、 DNS の SRV
     レコードを使うことです。この場合、 FOO.COM realm でのエントリーの例は、
     次のようになります:
     <p>
     <pre><samp>
     _kerberos._udp      IN  SRV     01 00 88 mach1.foo.com.
     _kerberos._tcp      IN  SRV     01 00 88 mach1.foo.com.
     _kpasswd._udp       IN  SRV     01 00 464 mach1.foo.com.
     _kerberos-adm._tcp  IN  SRV     01 00 749 mach1.foo.com.
     _kerberos           IN  TXT     FOO.COM
     </samp></pre>
     <p>
     SRV レコードの書式については、 RFC 2782 を参照してください。
     DNS による方法を使いたくなければ、この情報を realm 内の各ホストで
     手動で設定することができることに注意してください。
     <p>
<li> realm 内の各システムの /etc/krb5.conf を設定します。このファイルで
     デフォルトの realm を指定する必要があります。 注意: Kerberos
     の実装によっては、これが必要ない (Kerberos が DNS の TXT レコード
     "_kerberos" からデフォルトの realm を知ることができる) ものもありますが、
     NetBSD の Kerberos では /etc/krb5.conf ファイルが存在しないと
     有効にはなりませんので、ここで設定しておくのがよいでしょう。
     <p>
     <pre><samp>
     # cat > /etc/krb5.conf
     [libdefaults]
             default_realm = FOO.COM
     ^D
     #
     </samp></pre>
     <p>
     realm の設定に DNS SRV レコードを使って<i>いない</i>場合は、
     /etc/krb5.conf に以下のような KDC、 kadmin および kpasswd
     サーバーのリストも必要です:
     <p>
     <pre><samp>
     # cat >> /etc/krb5.conf
     [realms]
             FOO.COM = {
                     kdc = mach1.foo.com
                     admin_server = mach1.foo.com
                     # optional, defaults to admin_server
                     kpasswd_server = mach1.foo.com
             }
     ^D
     #
     </samp></pre>
     <p>
     モバイルホストを、そのホストが参加している別の realm に持ち込んだ場合、
     /etc/krb5.conf ファイルのデフォルト realm は DNS の _kerberos TXT
     レコードで上書きされます。
     <p>
<li> KDC システムには /var/heimdal ディレクトリーが必ず存在するようにします。
     これは root:wheel の所有にして、モードを 0755 にするよう推奨します。
     <p>
     <pre><samp>
     mach1# ls -ld /var/heimdal
     1 drwxr-xr-x  2 root  wheel  512 Nov 30 15:21 /var/heimdal/
     mach1#
     </samp></pre>
     <p>
<li> マスターキーを作ります。これを使って KDC データベースに蓄積される
     principal キーを暗号化します。
     <p>
     <pre><samp>
     mach1# kstash
     Master key:
     Verifying password - Master key:
     mach1#
     </samp></pre>
     <p>
<li> kadmin(8) を使って、 KDC のデータベースを作ります。これには
     "local database" オプションが必要です。
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> init FOO.COM
     Realm max ticket life [unlimited]:
     Realm max renewable ticket life [unlimited]:
     kadmin>
     </samp></pre>
     <p>
<li> KDC が動いているシステム用の principal を作ります。
     <p>
     <pre><samp>
     kadmin> add --random-key host/mach1.foo.com
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     kadmin>
     </samp></pre>
     <p>
     これで principal が作られましたが、これのキーを KDC システムの
     keytab に展開するよう推奨します。
     <p>
     <pre><samp>
     kadmin> ext -k /etc/krb5.keytab host/mach1.foo.com
     kadmin>
     </samp></pre>
     <p>
     ktutil(8) コマンドで、 keytab 中のキーを列挙できます:
     <p>
     <pre><samp>
     mach1# ktutil list
     Vno  Type           Principal
       1  des-cbc-crc    host/mach1.foo.com
       1  des-cbc-md4    host/mach1.foo.com
       1  des-cbc-md5    host/mach1.foo.com
       1  des3-cbc-sha1  host/mach1.foo.com
     </samp></pre>
     <p>
<li> Kerberos を使って認証したいユーザーの principal を
     作ります。
     <p>
     <pre><samp>
     kadmin> add joe
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Attributes []:
     joe@FOO.COM's Password:
     Verifying password - joe@FOO.COM's Password:
     kadmin>
     </samp></pre>
     <p>
<li> KDC がブート時に起動するよう設定し、 KDC を起動します。
     <p>
     <pre><samp>
     mach1# echo "kdc=YES" >> /etc/rc.conf
     mach1# /etc/rc.d/kdc start
     Starting kdc.
     mach1#
     </samp></pre>
     <p>
<li> kadmin (Kerberos administration) と kpasswd (Kerberos password change)
     サーバーを起動するよう inetd を設定します。 KDC システムの
     /etc/inetd.conf に、下記の各行が存在するようにします:
     <p>
     <pre><samp>
     kerberos-adm stream tcp  nowait root /usr/libexec/kadmind  kadmind
     kerberos-adm stream tcp6 nowait root /usr/libexec/kadmind  kadmind
     kpasswd      dgram  udp  wait   root /usr/libexec/kpasswdd kpasswdd
     kpasswd      dgram  udp6 wait   root /usr/libexec/kpasswdd kpasswdd
     </samp></pre>
     <p>
     inetd(8) に設定を読み直させます。
     <p>
     <pre><samp>
     mach1# /etc/rc.d/inetd reload
     Reloading inetd config files.
     mach1#
     </samp></pre>
     <p>
<li> KDC をテストします。 Kerberos を使って TGT を取得し、
     KDC システムに自分自身からログインしてみます。
     <p>
     <pre><samp>
     mach1:joe$ kinit
     joe@FOO.COM's Password:
     joe$ klist
     Credentials cache: FILE:/tmp/krb5cc_100
             Principal: joe@FOO.COM

       Issued           Expires          Principal
     Nov 30 14:10:16  Dec  1 00:10:16  krbtgt/FOO.COM@FOO.COM
     Nov 30 14:10:16  Dec  1 00:10:16  krbtgt/FOO.COM@FOO.COM
     mach1:joe$ telnet -ax mach1.foo.com
     Trying 10.0.0.1
     Connected to mach1.foo.com.
     Escape character is '^]'.
     [ Trying KERBEROS5 ... ]
     [ Kerberos V5 accepts you as ``joe@FOO.COM'' ]
     Last login: Thu Nov 30 14:08:33 2000 from mach1
     ...
     mach1:joe$ exit
     Connection closed by foreign host.
     mach1:joe$
     </samp></pre>
     <p>
<li> うまく機能していることが確認できたら、 Kerberos realm
     に参加させる他のホストの principals も追加します。
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> add --random-key host/mach2.foo.com
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     kadmin>
     </samp></pre>
     <p>
<li> ここでシステム管理者用の "admin" principal を追加するというのは
     よい考えです。偽装される可能性があるので、 Kerberos の管理をすべて
     root として行うつもりならば "root/admin" principal
     だけを追加します。
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> add root/admin
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     root/admin@FOO.COM's Password:
     Verifying password - root/admin@FOO.COM's Password:
     kadmin>
     </samp></pre>
     <p>
     この principal は必ず kadmind ACL に追加しておいてください:
     <p>
     <pre><samp>
     mach1# echo "root/admin@FOO.COM all" >> /var/heimdal/kadmind.acl
     mach1#
     </samp></pre>
     <p>
<li> これで "admin" principal ができ、 host/... という principal
     を、そのホスト群が通信するマシン群の keytab に簡単に展開することが
     できます。
     <p>
     <pre><samp>
     mach2# kadmin
     kadmin> ext -k /etc/krb5.keytab host/mach2.foo.com
     root/admin@FOO.COM's Password:
     kadmin>
     </samp></pre>
     <p>
     Kerberos を使ってマシンにログインして試してみます。
     <p>
     <pre><samp>
     mach1:joe$ telnet -ax mach2.foo.com
     Trying 10.0.0.2
     Connected to mach2.foo.com.
     Escape character is '^]'.
     [ Trying KERBEROS5 ... ]
     [ Kerberos V5 accepts you as ``joe@FOO.COM'' ]
     Last login: Thu Nov 30 16:26:51 2000 from mach1
     ...
     mach2:joe$ exit
     Connection closed by foreign host.
     mach1:joe$
     </samp></pre>
</ol>
おめでとうございます! これで Kerberos realm で作業ができるようになりました!
<p>

<ENTRY>win2k Windows 2000 に対する認証

Windows 2000 を使っている場合でも、 NetBSD KDC を Windows 2000
ホストに対する認証サーバーとして使うことができます。 Windows 2000 は
Kerberos を Windows ドメインログインの認証に使っています。 NetBSD は
Windows 2000 ドメインコントローラーになることはできませんが、
Samba を使うことでワークグループサーバーになることができます。
<p>

この説明では、サーバー上で Samba がすでに設定済であるものとし、
また、 Windows 2000 ホストはそのサーバーを使うよう設定済で
あるものとします。
<ol>
<li> Windows 2000 システムに <i>Supplemental Tools</i> を
     インストールしておいてください。これは Windows 2000
     配布メディアに含まれています。
     <p>
<li> KDC で、 Windows 2000 ホスト用の host principal を追加します:
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> add host/win2k.foo.com
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     host/win2k.foo.com@FOO.COM's Password: 
     Verifying password - host/win2k.foo.com@FOO.COM's Password: 
     kadmin> 
     </samp></pre>
     <p>
     <b>*入力したパスワードを覚えておいてください!*</b> このパスワードは、
     あとで Windows 2000 ホストで再度入力しなければなりません。
     <p>
<li> Windows 2000 ホストで、 <i>ksetup</i> コマンドを使って realm、
     KDC と <i>machine password</i> エントリーを設定します:
     <p>
     <pre><samp>
     C:> ksetup /setdomain FOO.COM
     C:> ksetup /addkdc FOO.COM mach1.foo.com
     C:> ksetup /setmachpassword <i>password</i>
     </samp></pre>
     <p>
<li> Windows 2000 システムをリブートします。
     <p>
<li> <i>ksetup</i> コマンドを使って、 Windows 2000 システムの
     ローカルユーザーを Kerberos principals に対応づけます:
     <p>
     <pre><samp>
     C:> ksetup /mapuser * *
     </samp></pre>
     <p>
     以下のようにして、特定のユーザーを特定の Kerberos principals
     に対応させることもできます:
     <p>
     <pre><samp>
     C:> ksetup /mapuser user@FOO.COM localuser
     </samp></pre>
     <p>
<li> Windows 2000 システムをリブートします。
</ol>
<p>
以上のようにすることで、 Windows 2000 システムへのログイン時に
Kerberos realm へのログインができるようになります。ユーザーが
透過的に使えるよう、 Samba パスワードはユーザーの Kerberos
パスワードと同期させておくようにするよう注意してください。
<p>
Kerberos に関してより詳しい情報は、下記のリンクを参照してください:
<p>
<ul>
<li><a href="http://web.mit.edu/kerberos/www/">MIT Kerberos</a>
<li><a href="http://www.pdc.kth.se/kth-krb/">KTH Kerberos</a>
<li><a href="http://www.nrl.navy.mil/CCS/people/kenh/kerberos-faq.html">Kerberos FAQ</a>
<li><a href="http://members.nbci.com/_XMCM/jtruitt/ferret/kerberos.html">Meta information (Links)</a>
</ul>

<SECTION>Network の問題

<ENTRY>unable-to-ping 他のホスト名に ping できない
    もし、他のマシンに IP アドレスで ping ("<tt><b>ping
    -n <em>W.X.Y.Z</em></b></tt>") できるのに、ホスト名ではできないのならば、
    resolv.conf(5) に問題がある可能性があります。nameserver が正しく
    設定されているか、サーバーからの応答があるかどうかを確認してください。

<ENTRY>connection-delays 接続に 30秒くらいかかる
    これは通常以下の理由によります。
    <ol>
    <li>resolv.conf(5) の設定が間違っているために、指定したネームサーバーからの
        レスポンスがなく、ホスト名探索がタイムアウトを起こしている。
    <li>リモートのメールサーバーが、あなたのマシン上の identd(8) に
        接続しようとしているのに、 tcp の 113 番ポートへの
        パケットがレスポンスすることなく落されるように ipf(8) が
        設定されている。
    </ol>

</LIST>

	<DOCLINK>

	<hr>
	<address>
	  <small>
  (連絡先 - <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">英語</a>,
       <a href="mailto:www@jp.NetBSD.org">日本語:
       www@jp.NetBSD.org</a>)<br>
	  $NetBSD: index.list,v 1.80 2004/12/10 22:45:53 daniel Exp $<br>
	  <!-- based on english translation: -->
	  <!-- NetBSD: index.list,v 1.80 2004/12/10 22:45:53 daniel Exp   -->
	  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
	    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
	  </small>
	</address>

	</body>
</html>
