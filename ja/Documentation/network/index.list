<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<!-- Copyright (c) 1994-2002
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<title>The NetBSD Networks FAQ</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<HEADING>Basic NetBSD Networking

This page is developing, and we welcome any
<a href="../../Misc/feedback.html">comments or suggestions</a>.

<LIST>
<h2>Other links</h2>
<!--
If you add entries here, please add them to ../index.html as well.
Note that the relative URL path needs to be modified.
-->
<ul>
  <li><a href="inetd/">The Internet Super Server (inetd)</a>
  <li><a href="nsps/">NetBSD Security Processes and Services</a>
  <li><a href="wavelan.html">Wireless networking using the Lucent WaveLAN</a>
  <li><a href="netboot/">HOWTO Netboot a diskless machine</a>
  <li><a href="isdn/">Steps to connect via ISDN</a>
  <li><a href="gprs.html">Steps to connect via GPRS / CDPD</a>
  <li><a href="pppoe/">Steps to connect via PPPoE (DSL)</a>
  <li><a href="http://www.static.net/~armenb/ipnat.html">Network
      Address Translation (NAT) FAQ</a>, using
      <a href="http://coombs.anu.edu.au/~avalon/ip-filter.html">IP-Filter</a>
  <li><a href="dhcp.html">HOWTO setup DHCP clients and servers</a>
  <li><a href="http://www.feyrer.de/NetBSD/NWF/">
      NetBSD/amiga Guide to Networking FAQ</a>
  <li><a href="ipv6/">IPv6 Networking FAQ</a>
  <li><a href="ipsec/">IPsec FAQ</a>
  <li><a href="http://www.macbsd.com/macbsd/howto/index.html">
      PPP, cross compiling, and other HOW-TOs</a>
  <li><a href="http://www.obfuscation.org/ipf/ipf-howto.txt">IP Filter Based Firewalls HOWTO</a>

  <li>Network Flight Instructions, Part I: <a
      href="http://www.bsdtoday.com/2001/February/Features401.html">Digital
      Subscriber Line - Overview and Configuration</a>: Overview of using
      DSL under NetBSD
  <li>Network Flight Instructions, Part II: <a
      href="http://www.bsdtoday.com/2001/February/Features409.html">Internet
      gateway configuration &amp; basic online security rules</a>
	<!--
           - I have the source of the NFI articles, and we can put them
           - up on www.netbsd.org after the BSDtoday privilege to publish
           - expires on May 13th 2001
          -->
  <li> The <a href="ftp://ftp.csl.sony.co.jp/pub/kjc/papers/altq98.ps.gz">AltQ Paper</a>
</ul>

<SECTION>Networking FAQ

<ENTRY>getting_started Getting Started
The NetBSD install process includes basic network configuration, which
implements a standard workstation setup. This configuration can be
extended to take advantage of NetBSD's many networking features.
<ul>
  <li><h3>See also:</h3>
      <ul>
        <li><a href="http://www.cis.ohio-state.edu/cgi-bin/rfc/rfc1918.htmlRFC">RFC 1918</a>
            - Address Allocation for Private Internets
      </ul>
</ul>

<ENTRY>configuration_files  Network Configuration Files
The network configuration is defined in a set of text
configuration files.
<ul>
  <li>/etc/rc.conf - rc.conf(5) specifies system services,
      including the network services, to be automatically
      started at system initialisation.
  <li>/etc/hosts - hosts(5) the most basic hostname/IP map.
  <li>/etc/myname - the fully qualified hostname.
  <li>/etc/mygate - default gateway. Usually better put in /etc/rc.conf, or
      you can run routed(8).
  <li>/etc/ifconfig.{<em>IF</em>}. - the definition of
      network interface <em>IF</em>, used by
      <em>/etc/netstart</em> at system initialisation, to configure
     a network interface. See ifconfig.if(5).
  <li>/etc/ifaliases - ifaliases(5) a single interface can be aliased to more
      than one IP number. The aliases are specified here, and used by
      <em>/etc/netstart</em> at system initialisation.
  <li>/etc/resolv.conf - resolv.conf(5) specifies how to resolve IP numbers to
      their hostnames.  Most commonly, this contains a line specifying the
      domains to search and one or more IPs of the nameservers to query:
<p>
<pre>
search subdomain.yourdomain.tld yourdomain.tld
nameserver 192.168.253.10
nameserver 192.168.253.11
</pre>
</ul>
<ul>
  <li><h3>See also:</h3>
      <ul>
        <li>hostname(7)</li>
      </ul>
</ul>

<ENTRY>configuration_programs  Network Configuration Programs
Two important network configuration programs are used in the network startup script
(/etc/netstart), and can be used to manually configure an active network.

<ul>
  <li>ifconfig(8) - change or view the characteristics of a network interface.
  <li>route(8) - manipulate the network routing tables.
</ul>
<ul>
  <li><h3>See also:</h3>
      <ul>
	<li>domainname(1)</li>
        <li>hostname(1), hostname(7)</li>
      </ul>
</ul>

<ENTRY>adding_a_host  Adding a New Host to the Network
The minimum software requirement for a host to be added to a network
is a configured interface with an address on the local network. If
you provide network information during the NetBSD installation
process, the new host can be immediately connected to the network and
accessed by its IP number.
<p>
The following is a simple example of how to configure networking, assuming
that you have one <em>ex</em> network interface and want your IP to be
192.168.253.2, using a default route of 192.168.253.1:
<p>
<pre>
  # ifconfig lo0 127.0.0.1
  # ifconfig ex0 192.168.253.2 netmask 255.255.255.0
  # route add default 192.168.253.1
</pre>

<ENTRY>naming_a_host  Naming a New Host on the Network
To allow access by hostname as well as by IP number, the new hostname
and its IP number are added to the network configuration files. There
are a number of ways to manage this;

<ol>
  <li>/etc/hosts: hosts(5) For small networks of a few hosts, the
      hostname/IP maps can be manually duplicated in the /etc/hosts
      files of each host.
      <p>
      <em>/etc/hosts:</em><br>
      <samp>
      192.168.1.2  host2.mydomain.org.au host2<br>
      </samp>
      <p>
  <li>yp(8) enables the /etc/hosts files on the network to be
      automatically
      synchronised (along with other configuration files).
  <li>DNS: The hostname maps can be centralised into zone-files which
      are accessed by the name-server, named(8).
      (there are many documents at
      <a href="http://www.dns.net/dnsrd/docs/">www.dns.net</a>
      dealing with setting up and maintaining DNS files).
      <p>
      <em>Forward zone file entry</em><br>
      <samp>
      host2  A     192.168.1.2
      </samp>
      <p>
      <em>Reverse zone file entry</em><br>
      <samp>
      2      PTR   host2.mydomain.org.au.
      </samp>
</ol>
<ul>
  <li><h3>See also:</h3>
      <ul>
        <li>named.conf(5)</li>
	<li>nsswitch.conf(5)</li>
      </ul>
</ul>

<ENTRY>internetworking  Inter-networking
Connecting your network (which may consist of a single host) to
another network requires that at least one host acts as a gateway between the two
networks. The gateway host has two network interfaces - one
configured for each network.

<ul>
  <li>Create an interface configuration file (/etc/ifconfig.{<em>interface</em>})
      for the second ethernet interface.
      <p>
      <em>/etc/ifconfig.we1</em><br>
      <samp>
      192.168.2.30 netmask 0xffffff00 media 10base2/BNC
      </samp>
      <p>
  <li>Reboot your computer to activate the new interface.
  <li>Enable IP packet forwarding.  You can either compile a kernel
      with "options GATEWAY", or you can "sysctl -w
      net.inet.ip.forwarding=1" each time your machine boots, e.g.,
      from /etc/rc.local.
</ul>
<ul>
  <li><h3>See also:</h3>
      <ul>
        <li>ipnat(5),ipnat(8)</li>
	<li>ipf.conf(5),ipf(8)</li>
      </ul>
</ul>

<ENTRY>ppp  Inter-networking with PPP
A special type of network interface can be created on a serial port (with
or without a modem attached) using pppd(8).

<p>

There are many ways to setup PPP. One simple method, suitable for
connecting to your ISP is;
<ol>
  <li>Create a peer options file
      <p>
      <em>/etc/ppp/peers/myisp</em><br>
      <samp>
      # Example pppd options <br>
      # Specific for myisp <br>
      /dev/tty01<br>
      local_IP_address:remote_IP_address<br>
      connect '/usr/sbin/chat -v -f /etc/ppp/peers/myisp.chat'<br>
      defaultroute<br>
      persist<br>
      ipparam myisp<br>
      asyncmap 0<br>
      noauth
      </samp>
      <p>
  <li>Create a device options file
      <p>
      <em>/etc/ppp/options.{ttyname}</em><br>
      <samp>
      # Example pppd options <br>
      # Specific for ttyname <br>
      lock<br>
      crtscts<br>
      57600<br>
      modem<br>
      </samp>
      <p>
  <li>Create a chat file
      <p>
      <em>/etc/ppp/peers/myisp.chat</em><br>
      <samp>
      # Example chat file <br>
      # Specific for myisp<br>
      ABORT BUSY ABORT 'NO CARRIER' ""<br>
      \da\ptz0 OK<br>
      \da\ptdt8887776655 CONNECT<br>
      </samp>
      <p>
  <li>Establish the connection with;
      <p>
      <samp>
      pppd call myisp
      </samp>
      <p>
  <li>Set the variable
      <p>
      <samp>
      ppp_peers="myisp"
      </samp>
      in /etc/rc.conf rc.conf(5).
      and the connection will be established automatically at boot-time.
</ol>

Unlike an ethernet interface, you do not need to create a
<em>/etc/ifconfig.{interface}</em> file for a PPP interface.
<p>
If you are using demand dial ppp and do not wish certain traffic to
bring up the link (for example xntpd(8) ntp traffic), you can use
<tt>active-filter</tt> in your ppd.conf file:
<pre>	active-filter   'not udp port ntp'</pre>

<ul>
  <li><h3>See also:</h3>
      <ul>
        <li>chat(8) - Automated conversational script
        <!-- http://www.macbsd.com/macbsd/howto/pppnat
             How to setup PPP for multiple ISP's, including
             IP-NAT and DNS setup. -->
      </ul>
</ul>

<ENTRY>pppleased Setting up pppd to use a leased line
A leased line is a fixed point-to-point link.  Setting this up under NetBSD is
a very simple process.  On the server build an <em>/etc/ppp/options</em> like
this:
<p>
     <blockquote>
     /dev/tty00<br>
     57600<br>
     noauth<br>
     crtscts<br>
     passive<br>
     &lt;local_IP_address&gt;:&lt;remote_IP_address&gt;<br>
     debug<br>
     netmask 255.255.255.255<br>
     proxyarp<br>
     </blockquote>
<p>
You need to change &lt;local_IP_address&gt; and &lt;remote_IP_address&gt; to
the appropriate values for your network (&lt;local_IP_address&gt; can be the
same as your ethernet, &lt;remote_IP_address&gt; must be one valid addr for
your ethernet segment).
<p>
On the client build an <em>/etc/ppp/options</em> with:
<p>
     <blockquote>
     /dev/tty00<br>
     57600<br>
     noauth<br>
     crtscts<br>
     defaultroute<br>
     debug<br>
     </blockquote>
<p>
On both sides adjust /dev/tty00 to the name of your serial port.

<ENTRY>isdn-ta How to use a ISDN modem (terminal adapter, TA)?

To NetBSD, the TA will look like a normal modem, and it will speak
asynchronous PPP if you switch it to the right mode.  Depending on
your ISP, you may can choose from the following modes:
<P>

<ul>
<li> sync-to-async-HDLC conversion: Translates synchronous HDLC frames into
        async-HDLC frames. Use this if your provider offers "real" PPP over
	HDLC on the B-Channel directly, which is the standard nowadays.
<li> X75: X.25 over ISDN B-channel
<li> V120: which is intended to simulate lower bandwidth modems to slow
	computer terminal lines; unfortunately this wastes some of the
	bandwidth of your ISDN line, though
<li> V110: which is an old version of V120
</ul>
<P>

You set the TA's mode with some Hayes "AT" modem commands, please
consult your manual for the exact commands. You can then add these
"AT" commands to your chat script used for your usual PPP dialing, as
you do with a "normal" (analog) modem.
<P>


<ENTRY>isdn4bsd	Inter-networking with ISDN cards
The <a href="http://www.freebsd-support.de/i4b/">isdn4bsd</a> package enables
<a href="../../Ports/alpha/">NetBSD/alpha</a>,
<a href="../../Ports/amiga/">NetBSD/amiga</a>,
<a href="../../Ports/atari/">NetBSD/atari</a> and
<a href="../../Ports/i386/">NetBSD/i386</a>
to use ISDN networking cards connected to DSS1 (European protocol)
exchanges.  For this, you need to patch your kernel sources according
to the instructions that come with the package, build a new kernel
with the ISDN support compiled in and also build some control
programs.
<p>Note that this package is still considered to be in the beta test
phase.
<p>Also note that this is about ISDN cards, not about ISDN modems. The latter
should be usable <a href="#ppp">like normal modems.</a>

<ENTRY>simplenat	A simple NAT ("IP Masquerading") setup

To allow hosts that you have on a local private network (say:
10.0.0.0/24) use your NetBSD machine as router, and setup Network
Address Translation (NAT, also called "IP Masquerading" in another
universe), do the following: <P>

<OL>
<LI> On your clients, use the NAT machine as default router (put
	<TT>defaultrouter="<I>a.b.c.d</I>"</TT> into their /etc/rc.conf if
	they run NetBSD, where <TT><I>a.b.c.d</I></TT> is the internal
	IP number (from the 10.0.0.0 net, i.e.)).
<LI> On your NAT machine, first make sure your kernel has ipfilter
	enabled (Most recently compiled GENERIC kernels include this by default.):
<PRE>
options         PFIL_HOOKS    	        # pfil(9) packet filter hooks
pseudo-device   ipfilter                # IP filter (firewall) and NAT
</PRE>

<LI> Put this into your /etc/ipf.conf(5):
<PRE>
pass in from any to any
pass out from any to any
</PRE>

<LI> Put this into your /etc/ipnat.conf(5):
<PRE>
map ppp0 10.0.0.0/24 -> 0/32 proxy port ftp ftp/tcp
map ppp0 10.0.0.0/24 -> 0/32 portmap tcp/udp 40000:60000
map ppp0 10.0.0.0/24 -> 0/32
</PRE>

<LI> Enable everything in your /etc/rc.conf:
<PRE>
ipfilter=YES                                    # uses /etc/ipf.conf
ipnat=YES                                       # uses /etc/ipnat.conf
</PRE>

<LI> Turn on IPv4 packet forwarding in /etc/sysctl.conf:
<PRE>
net.inet.ip.forwarding=1
</PRE>

<LI> Reboot.

<LI> Use ping(8), tcpdump(1), ipfstat(8) and ipnat(8) to debug.
</OL>

<ENTRY>maintenance  Maintenance
<ul>
  <li>Monitoring activity - useful tools
      <ul>
        <li>ifconfig(8) - configure and display network interface parameters.
        <li>route(8) - manipulate the routing tables.
        <li>ping(8) - send ICMP ECHO_REQUEST packets to network hosts
        <li>traceroute(8) - print the route packets take to reach a network host
        <li>tcpdump(1) - selectively view traffic on a network interface
        <li>netstat(1) - show network status
        <li>systat(8) 'systat netstat' - dynamically display network connections
      </ul>
</ul>
<ul>
  <li><h3>See also:</h3>
      <ul>
        <li><PKGSRC>net/mrtg - This utility from the packages collection
			lets you monitor your network activity graphically.
      </ul>
</ul>

<ENTRY>security  Security
<ul>
  <li>/etc/hosts.{allow,deny}: The configuration files for
      tcp-wrappers (hosts_access(5))
      which is built into the master daemon inetd(8).
  <li>If you want a full-featured firewall that also does
      Network Address Translation (NAT, sometimes called IP
      masquerading), use IPfilter, which comes with NetBSD.
      Check out its <a href="http://coombs.anu.edu.au/ipfilter/">homepage</a>.
</ul>
<ul>
  <li><h3>See also:</h3>
      <ul>
        <li>The <a href="http://www.cert.org/">CERT* Coordination Center</a>
            studies Internet security vulnerabilities.
        <li><a href="http://www.cert.org/tech_tips/root_compromise.html">
            Steps for Recovering from a UNIX Root Compromise</a>
        <li><a href="http://www.obfuscation.org/ipf/ipf-howto.txt">IP Filter
            Based Firewalls HOWTO</a>
      </ul>
</ul>

<ENTRY>appletalk  Running Appletalk
NetBSD supports '<PKGSRC>net/netatalk', which enables unix machines
to communicate with appletalk machines over ethernet (but not
localtalk). This allows MacOS machines to read filesystems and
print to printers via a NetBSD machine, and for the NetBSD machine
to print to AppleTalk printers.  The necessary source is available
via the NetBSD <a href="../software/packages.html">Packages
Collection</a>.

<ENTRY>new_bind  Converting to BIND version 8
As of NetBSD 1.4, we are now using BIND version 8, which has a
different configuration file format.  The primary named config file
has changed names from named.boot to named.conf.  You can convert your
old configuration files like this:
<p>
<samp>
/usr/sbin/named-bootconf &lt; named.boot &gt; named.conf
</samp>
<p>
Also, along with BIND being integrated with NetBSD <a
href="../../Releases/formal.html">formal releases</a>, the 8.x
and 9.x families of releases are available in the <a
href="../software/packages.html">NetBSD Packages Collection</a>.
See the <PKGSRC>net/bind8 and <PKGSRC>net/bind9 packages
respectively.
<p>
At this point, BIND 4 has been deprecated, and it is strongly recommended
that you upgrade.  If you <em>have</em> to continue to use the old 4.x
releases of BIND, there is a <PKGSRC>net/bind4 package.

<ENTRY>kerberos Kerberos
Kerberos is a network authentication system designed to provide strong
authentication for client/server applications by using secret-key
cryptography.
<p>
NetBSD 1.5 and later ship with the KTH Heimdal Kerberos 5 implementation.
<p>
This section provides some simple instructions to get your NetBSD systems
configured to use Kerberos.  For those not familiar with Kerberos, this
serves as a basic how-to.  For those of you familar with Kerberos, it may
document some differences between NetBSD's Kerberos and the Kerberos on
other systems you may have used in the past.
<p>
For the purpose of these instructions, let's assume your DNS domain name
is "foo.com".  Let's also assume that there are two machines in the foo.com
domain, called <i>mach1.foo.com</i> and <i>mach2.foo.com</i>.
<p>
A Kerberos administrative domain is called a <b>realm</b>.  A realm can
be named anything you like, although the convention is to use the
organization's DNS domain name in upper-case letters.  So, for your example
domain of "foo.com", the Kerberos realm would be called "FOO.COM".
<p>
An identity in Kerberos is called a <b>principal</b>.  Users, hosts, and
even individual services on hosts are all principals.  Principal names have
the form "name@REALM".  If the "@REALM" portion is omitted, the default
realm is assumed.  Service principal names have the form
"service/hostname@REALM".  The hostname should be the fully-qualified name
of the host.  All hosts have a "host/..." service principal.  The "host/..."
principal is generally used by login programs (e.g. telnetd(8), sshd(8))
and other things that want to authenticate the host to another principal
(e.g. certain IPsec key management protocols).
<p>
An instance of a Kerberos credential is called a <b>ticket</b>.  There
is a special kind of ticked called a <b>ticket granting ticket</b>, or
TGT.  The TGT is your initial set of credentials, acquired for you when
you log in using the login(1) program, or by running kinit(1).  The TGT
is used to acquire service tickets that allow you to use services that
use Kerberos for authentication.  Tickets are stored in a special database
called a <b>credential cache</b>.  For login sessions, the credential cache
is generally stored in a file in /tmp.  The credential cache should be
destroyed when you log out by the kdestroy(1) command.  <b>It is important
to keep your credential cache safe!</b>  If you don't someone else could
use your credentials to gain access to services they might not otherwise
have.
<p>
Credentials are centrally managed by the <b>Key Distribution Center</b>,
or KDC.  A user authenticates with the KDC by providing a password when
acquiring a TGT.  Services authenticate with the KDC using a similar
mechanism, although the service's "password" comes from a <b>key table</b>,
or keytab, stored on the host.
<p>
Note that Kerberos requires that all hosts within a realm have
synchronized time.  The best way to achieve this is to use NTP on
your network.
<p>
The following is a step-by-step description of how to get your network
configured to use Kerberos.
<p>
<ol>
<li> Select a system to be the Kerberos KDC.  This system must be
     secure; if the KDC is compromised, all principals are compromised.
     For our example, we will give this task to <i>mach1.foo.com</i>.
     <p>
     The KDC system will also play the role of the Kerberos administration
     server and the Kerberos password change server.
     <p>
     The easiest way to provide information about the KDC is through
     DNS SRV records.  If you wish to do this, these are the entries
     that would be required for our sample FOO.COM realm:
     <p>
     <pre><samp>
     _kerberos._udp      IN  SRV     01 00 88 mach1.foo.com.
     _kerberos._tcp      IN  SRV     01 00 88 mach1.foo.com.
     _kpasswd._udp       IN  SRV     01 00 464 mach1.foo.com.
     _kerberos-adm._tcp  IN  SRV     01 00 749 mach1.foo.com.
     _kerberos           IN  TXT     FOO.COM
     </samp></pre>
     <p>
     To understand the format of the SRV record, look at RFC 2782.
     Note that you can configure this information manually on each
     host in the realm if you don't wish to use the DNS method.
     <p>
<li> Configure /etc/krb5.conf on each system in the realm.  You will want
     to specify the default realm in this file.  NOTE: With some Kerberos
     implementations, you don't need to do this (Kerberos can find it by
     looking up the TXT record "_kerberos" in DNS), but NetBSD's Kerberos
     is disabled unless the /etc/krb5.conf file exists, so you might as
     well configure it there.
     <p>
     <pre><samp>
     # cat > /etc/krb5.conf
     [libdefaults]
             default_realm = FOO.COM
     ^D
     #
     </samp></pre>
     <p>
     If you are <i>not</i> using DNS SRV records to configure your
     realm, you must also list the KDC, kadmin, and kpasswd servers
     in your /etc/krb5.conf, like so:
     <p>
     <pre><samp>
     # cat >> /etc/krb5.conf
     [realms]
             FOO.COM = {
                     kdc = mach1.foo.com
                     admin_server = mach1.foo.com
                     # optional, defaults to admin_server
                     kpasswd_server = mach1.foo.com
             }
     ^D
     #
     </samp></pre>
     <p>
     Note that if you bring a mobile host into another realm in which it
     participates, the _kerberos TXT record from DNS will override the
     default realm in the /etc/krb5.conf file.
     <p>
<li> Ensure the /var/heimdal directory exists on the KDC system.  It
     should be owned by root:wheel, and be mode 0755.
     <p>
     <pre><samp>
     mach1# ls -ld /var/heimdal
     1 drwxr-xr-x  2 root  wheel  512 Nov 30 15:21 /var/heimdal/
     mach1#
     </samp></pre>
     <p>
<li> Create the master key that will encrypt the principal keys stored
     in the KDC database.
     <p>
     <pre><samp>
     mach1# kstash
     Master key:
     Verifying password - Master key:
     mach1#
     </samp></pre>
     <p>
<li> Create the KDC's database using kadmin(8).  You must use the "local
     database" option in order to do this.
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> init FOO.COM
     Realm max ticket life [unlimited]:
     Realm max renewable ticket life [unlimited]:
     kadmin>
     </samp></pre>
     <p>
<li> Create a principal for the system the KDC is running on.
     <p>
     <pre><samp>
     kadmin> add --random-key host/mach1.foo.com
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     kadmin>
     </samp></pre>
     <p>
     Now that the principal has been created, you should extract its
     key into the KDC system's keytab.
     <p>
     <pre><samp>
     kadmin> ext -k /etc/krb5.keytab host/mach1.foo.com
     kadmin>
     </samp></pre>
     <p>
     You can list the keys in the keytab using the ktutil(8) command:
     <p>
     <pre><samp>
     mach1# ktutil list
     Vno  Type           Principal
       1  des-cbc-crc    host/mach1.foo.com
       1  des-cbc-md4    host/mach1.foo.com
       1  des-cbc-md5    host/mach1.foo.com
       1  des3-cbc-sha1  host/mach1.foo.com
     </samp></pre>
     <p>
<li> Create principals for the users you wish to authenticate using
     Kerberos.
     <p>
     <pre><samp>
     kadmin> add joe
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Attributes []:
     joe@FOO.COM's Password:
     Verifying password - joe@FOO.COM's Password:
     kadmin>
     </samp></pre>
     <p>
<li> Configure the KDC to start at boot time and start it.
     <p>
     <pre><samp>
     mach1# echo "kdc=YES" >> /etc/rc.conf
     mach1# /etc/rc.d/kdc start
     Starting kdc.
     mach1#
     </samp></pre>
     <p>
<li> Configure inetd to start the kadmin (Kerberos administration) and
     kpasswd (Kerberos password change) servers.  Do this by making sure
     the following lines exist in /etc/inetd.conf on the KDC system:
     <p>
     <pre><samp>
     kerberos-adm stream tcp  nowait root /usr/libexec/kadmind  kadmind
     kerberos-adm stream tcp6 nowait root /usr/libexec/kadmind  kadmind
     kpasswd      dgram  udp  wait   root /usr/libexec/kpasswdd kpasswdd
     kpasswd      dgram  udp6 wait   root /usr/libexec/kpasswdd kpasswdd
     </samp></pre>
     <p>
     Make inetd(8) reload it's configuration.
     <p>
     <pre><samp>
     mach1# /etc/rc.d/inetd reload
     Reloading inetd config files.
     mach1#
     </samp></pre>
     <p>
<li> Test your KDC by obtaining a TGT and attempting to log in to the KDC
     system from itself, using Kerberos.
     <p>
     <pre><samp>
     mach1:joe$ kinit
     joe@FOO.COM's Password:
     joe$ klist
     Credentials cache: FILE:/tmp/krb5cc_100
             Principal: joe@FOO.COM

       Issued           Expires          Principal
     Nov 30 14:10:16  Dec  1 00:10:16  krbtgt/FOO.COM@FOO.COM
     Nov 30 14:10:16  Dec  1 00:10:16  krbtgt/FOO.COM@FOO.COM
     mach1:joe$ telnet -ax mach1.foo.com
     Trying 10.0.0.1
     Connected to mach1.foo.com.
     Escape character is '^]'.
     [ Trying KERBEROS5 ... ]
     [ Kerberos V5 accepts you as ``joe@FOO.COM'' ]
     Last login: Thu Nov 30 14:08:33 2000 from mach1
     ...
     mach1:joe$ exit
     Connection closed by foreign host.
     mach1:joe$
     </samp></pre>
     <p>
<li> Now that you've verified that things are working, add principals for
     the other hosts you wish to participate in the Kerberos realm.
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> add --random-key host/mach2.foo.com
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     kadmin>
     </samp></pre>
     <p>
<li> It would now be a good idea to add "admin" principals for the system
     administrator(s).  You can be cheat, and only add a "root/admin"
     principal if you plan on doing all of your Kerberos administration as
     root.
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> add root/admin
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     root/admin@FOO.COM's Password:
     Verifying password - root/admin@FOO.COM's Password:
     kadmin>
     </samp></pre>
     <p>
     Make sure you add the principal to the kadmind ACL:
     <p>
     <pre><samp>
     mach1# echo "root/admin@FOO.COM all" >> /var/heimdal/kadmind.acl
     mach1#
     </samp></pre>
     <p>
<li> Now that you have an "admin" principal, you can easily extract the
     host/... principals into the keytabs on the machines they correspond
     to.
     <p>
     <pre><samp>
     mach2# kadmin
     kadmin> ext -k /etc/krb5.keytab host/mach2.foo.com
     root/admin@FOO.COM's Password:
     kadmin>
     </samp></pre>
     <p>
     Test this by attempting to log into the machine using Kerberos.
     <p>
     <pre><samp>
     mach1:joe$ telnet -ax mach2.foo.com
     Trying 10.0.0.2
     Connected to mach2.foo.com.
     Escape character is '^]'.
     [ Trying KERBEROS5 ... ]
     [ Kerberos V5 accepts you as ``joe@FOO.COM'' ]
     Last login: Thu Nov 30 16:26:51 2000 from mach1
     ...
     mach2:joe$ exit
     Connection closed by foreign host.
     mach1:joe$
     </samp></pre>
</ol>
Congratulations!  You now have a working Kerberos realm!
<p>
For those of you using Windows 2000, it is also possible to use
your NetBSD KDC has an authentication server for your Windows 2000
hosts.  Windows 2000 uses Kerberos to authenticate Windows Domain
logins.  NetBSD cannot act as a Windows 2000 Domain Controller,
but using Samba, it can act as a Workgroup server.
<p>
For the purpose of these instructions, we assume you have already
configured Samba on your server, and configured your Windows 2000
hosts to use it.
<ol>
<li> Make sure the <i>Supplemental Tools</i> are installed on
     the Windows 2000 system.  These can be found on the
     Windows 2000 distribution media.
     <p>
<li> On the KDC, add a host principal for the Windows 2000 host:
     <p>
     <pre><samp>
     mach1# kadmin -l
     kadmin> add host/win2k.foo.com
     Max ticket life [1 day]:
     Max renewable life [1 week]:
     Principal expiration time [never]:
     Password expiration time [never]:
     Attributes []:
     host/win2k.shagadelic.org@SHAGADELIC.ORG's Password: 
     Verifying password - host/win2k.shagadelic.org@SHAGADELIC.ORG's Password: 
     kadmin> 
     </samp></pre>
     <p>
     <b>REMEMBER THE PASSWORD YOU ENTER!</b>  You must type this password
     in again later on the Windows 2000 host.
     <p>
<li> On the Windows 2000 host, configure the realm, KDC, and <i>machine
     password</i> entries using the <i>ksetup</i> command:
     <p>
     <pre><samp>
     C:> ksetup /setdomain FOO.COM
     C:> ksetup /addkdc FOO.COM mach1.foo.com
     C:> ksetup /setmachpassword <i>password</i>
     </samp></pre>
     <p>
<li> Reboot your Windows 2000 system.
     <p>
<li> Map local users on the Windows 2000 system to Kerberos principals
     using the <i>ksetup</i> command:
     <p>
     <pre><samp>
     C:> ksetup /mapuser * *
     </pre></samp>
     <p>
     You may also map specific users to specific Kerberos principals
     like so:
     <p>
     <pre><samp>
     C:> ksetup /mapuser user@FOO.COM localuser
     </pre></samp>
     <p>
<li> Reboot your Windows 2000 system.
</ol>
<p>
Using these steps, you will now be able to select to log into a
Kerberos realm when logging into your Windows 2000 system.  Note
that for the most seamless user experience, the Samba password
should be kept in-sync with the user's Kerberos password.
<p>
For more information about Kerberos, refer to these links:
<p>
<ul>
<li><a href="http://web.mit.edu/kerberos/www/">MIT Kerberos</a>
<li><a href="http://www.pdc.kth.se/kth-krb/">KTH Kerberos</a>
<li><a href="http://www.nrl.navy.mil/CCS/people/kenh/kerberos-faq.html">Kerberos FAQ</a>
<li><a href="http://members.nbci.com/_XMCM/jtruitt/ferret/kerberos.html">Meta information (Links)</a>
</ul>

<SECTION>Network problems

<ENTRY>unable-to-ping Unable to ping other hostnames
    If you can ping(8) another machine by IP address ("<tt><b>ping
    -n <em>W.X.Y.Z</em></b></tt>"), but not by hostname, then there
    is probably a problem with your resolv.conf(5) file. Check your
    nameservers are set correctly and responding.

<ENTRY>connection-delays Connections seem to have a 30 second delay
    This is usually either:
    <ol>
    <li>Incorrect resolv.conf(5) causing hostname lookups to timeout
	against non responding nameservers,
    <li>Remote mail servers attempting to connect back to your local
	hosts identd(8) while ipf(8) has been configured to drop packets
	to tcp port 113 without sending any response.
    </ol>

<ENTRY>t-online Gotchas for german ISP T-Online
	If you want to dial-in into the german ISP T-Online, the
	two most tricky things are getting the correct username, and
	using a proper chat-script. See <a href="#ppp">above</a> for a
	general description of how to set up PPP.
	<p>

	<ol>
	<li> Your login name at T-Online consists of three parts,
	     glued together:
	     <p>

	     <ol>
	     <li> Anschlu&szlig;kennung: 12 digit number
   	          (<i>AAAAAAAAAAAA</i>), e.g. 000120123456
	     <li> T-Online Nr: 12 digit number (<i>TTTTTTTTTTTT</i>),
   	          e.g. 3200123456. Often
	          starts with "32"; if yours is less than 12 digits,
	          add a '#')
	     <li> Mitbenutzer-Nummer, usually "0001" (<i>MMMM</i>),
   	          e.g. 0001
             </ol>
	     <p>
             Your login is now all three parts put in a row, with no
	     seperator ("<i>AAAAAAAAAAAATTTTTTTTTTTTMMMM</i>"),
  	     e.g. 0001201234563200123456#0001. Use this for
	     the "<tt>user</tt>"-line in your PPP options file.
	     <p>
	<li> In the chat-script, you need to pay attention to send a
	     "<tt>.</tt>" after the modem reported a <tt>CONNECT</tt>:

<pre>
ABORT BUSY    '' AT
              OK ATZ
              OK ATL1
              OK ATD0191011
              CONNECT <u>'.'</u>
</pre>
	     Without this trailing dot, you may be disconnected
	     immediately without an answer from the T-Online dialin
	     server after your side has sent out the first LCP
	     ConfReq frame.
             <p>
	</ol>

	Here are some (german language) links with more information
	(don't let yourself distract that most of them are not
	for NetBSD - being just another Unix-like operating
	system, these tips usually apply to NetBSD as well):
	<p>

	<ul>
        <li> <a href="http://www.albert-rommel.de/ppp.htm">PPP-Zugang
   	          zu <font color="#FF00FF">T</font>-Online</a>
        <li> <a href="http://home.t-online.de/home/Diedrich.Ehlerding/besonderheiten.html">Netzzugang bei <font color="#FF00FF">T</font>-Online: esonderheiten und Einschränkungen</a>
	<li> <a href="http://sdb.suse.de/sdb/de/html/toppp.html">SuSE:
	     T-Online Zugang mit PPP</a>
	<li> <a
	     href="http://sdb.suse.de/sdb/de/html/t_online3.html">SuSE:
	     T-Online: Verbindung wird nicht aufgebaut</a>
	<li> <a
   	          href="http://sdb.suse.de/sdb/de/html/toppp_files.html">SuSE: PPP-Files für T-Online</a>
	</ul>

</LIST>

<DOCLINK>

<hr>
<address>
  <small>
  <a href="../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: index.list,v 1.61 2002/10/30 09:53:10 grant Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2002
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
