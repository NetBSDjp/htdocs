<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<title>Setting up the dhcpd server, Diskless NetBSD HOW-TO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

Previous |
<a href="tftpd.html">Next</a> |
<a href="./">Table of Contents</a>

<hr>

<h1>Setting up the <tt>dhcpd</tt> server, Diskless NetBSD HOW-TO</h1>

The Internet Dynamic Host Configuration Protocol is used by the boot ROM
in some
workstations to request IP addresses and boot loader filenames.  
<tt>dhcd</tt> typically runs as a standalone daemon (i.e. 
launched from <tt>/etc/rc.local</tt> or equivalent).
<p>

Many DHCP servers will handle BOOTP requests. If you find your bootpd
causing trouble, <tt>dhcpd</tt> will serve in its stead.
<p>

There are two common dhcp packages, one from 
<a href="http://www.isc.org/products/DHCP/">
ISC</a> and from <a href="http://www.cmu.edu/">CMU</a>.  We recommend
ISC versions 2 and 3, since it is actively supported and runs on a wide
variety of OSes.  Many OSes ship with this server pre-installed.
<p>

The <tt>/etc/dhcpd.conf</tt> file has a standard format across all
platforms.  The formatting is very flexible.  We provide a simple version
that functions for serving a client with a fixed
(i.e. pre-determined) address.  For a more thorough understanding of how
to configure the ISC <tt>dhcpd</tt> we suggest reading the man pages: <a
href="http://www.tac.eu.org/cgi-bin/man-cgi?dhcpd+8+NetBSD-current">dhcpd(8)</a>,
<a href="http://www.tac.eu.org/cgi-bin/man-cgi?dhcpd.conf+5+NetBSD-current">dhpcpd.conf(5)</a>,
and <a href="http://www.tac.eu.org/cgi-bin/man-cgi?dhcp-options+5+NetBSD-current">dhcpd-options(5)</a>.
You might also want to read the 
<a href="../dhcp.html">NetBSD DHCP HOW-TO</a>.  You might also want to
poke around the official ISC <a href="http://www.isc.org/products/DHCP/">
DHCP</a> website.
<p>

Be careful when using <tt>next-server</tt> directive when using tftp as
the next stage of bootloading.  The client will assume that this 
<tt>next-server</tt> handles both <tt>tftp</tt> <b>and</b> <tt>nfs</tt>.
<p>

The sample <tt><a href="dhcpd.conf">dhcpd.conf</a></tt> includes
comments.  We suggest you save this into your <tt>/etc</tt> directory and
modify the addresses for your site.  Not all of the options listed in this
file are necessary for most clients, however, it is best if you leave them
in and remove the options if they get in the way.
<p>

Setting up dhcpd, <a href="#netbsd">NetBSD</a><br>
Setting up dhcpd, <a href="#isc">ISC's DHCPD</a> (NetBSD, OpenBSD,
FreeBSD, Linux, MacOS X, SunOS, Solaris, NEXTSTEP, HP-UX, BSD/OS, OSF/1, and Ultrix)<br>
Setting up dhcpd, <a href="#cmu">CMU's DHCPD</a> (older versions of
SunOS, Solaris, HP-UX, IRIX, and AIX)<br>
Setting up dhcpd, <a href="#solaris">Solaris</a><br>
<p>

[<em>If you have details for any other platform, <a
href="../../../Misc/feedback.html">please let us know</a></em>]
<p>

If your OS isn't listed here, you can try compiling it from one of these
source packages:
<ul>
<li><a href="ftp://ftp.net.cmu.edu/pub/old/dhcp/">
  CMU's <tt>dhcp</tt></a>, known to work on SunOS, Solaris, IRIX, HPUX,
and  AIX
<li><a href="http://www.isc.org/products/DHCP/">Internet Software
Consortium's 
  <tt>dhcp</tt></a>
</ul>
<p>

<hr>

<h3><a name="netbsd">NetBSD</a></h3>
<dl><dt><dd>
Note that NetBSD 1.4.2 and earlier ship with <tt>dhcpd-2.0b1pl25+</tt>
which is not current.  This version works fine with all but the
JavaStation-10.  You should
install <tt>dhcpd-2.0pl3</tt> or later from <a
href="http://www.isc.org/products/DHCP/dhcp-v2.html">ISC.org</a> if you're
running 1.4.2 or earlier.
<p>

If you have your own kernel, make sure you have the following in your
config file:
<pre>pseudo-device   bpfilter       4</pre>
The GENERIC kernel distributed with NetBSD has this compiled in.
<p>

<ol>
<li><tt># <b>touch /var/db/dhcpd.leases</b></tt><br>
   dhcpd complains if there is no existing file to store lease information in.
<p>

<li>If you don't already have an <tt>/etc/dhcpd.conf</tt>, install the
sample <a href="dhcpd.conf"><tt>dhcpd.conf</tt></a> and edit it for your
site.
<p>

<li><tt># <b>ps -aux | grep dhcpd</b></tt><br>
   <tt>kill</tt> that process.
   Note that <tt>kill -HUP</tt> does <i>not</i> force dhcpd 2 to re-read
   its configuration file.
<p>

<li><tt># <b>/usr/sbin/dhcpd -d -f</b></tt>
</ol>
<p>

This will start dhcpd in debugging mode.  When dhcpd gets a request, it
will print the following message:

<pre>BOOTREQUEST from CC:CC:CC:CC:CC:CC via le0 (non-rfc1048)
BOOTREPLY for 192.168.1.10 to client.test.net
(CC:CC:CC:CC:CC:CC) via le0
DHCPDISCOVER from CC:CC:CC:CC:CC:CC via le0
DHCPOFFER on 192.168.1.10 to CC:CC:CC:CC:CC:CC via le0
DHCPREQUEST for 192.168.1.10 from CC:CC:CC:CC:CC:CC via le0
DHCPACK on 192.168.1.10 to CC:CC:CC:CC:CC:CC via le0</pre>

The bootloaders typically do not give any feedback, but when the kernel is
looking for a root filesystem, it will print the following message:
<pre>boot device: &lt;unknown&gt;
nfs_boot: trying DHCP/BOOTP
nfs_boot: DHCP server: 0xC0A80105
nfs_boot: my_name=client
nfs_boot: my_domain=test.net
nfs_boot: my_addr=0xC0A8010A
nfs_boot: my_mask=0xffffff00
nfs_boot: gateway=0xC0A80101
root on :/export/client/root</pre>
<p>

Continue on to setting up <a href="tftpd.html"><tt>tftpd</tt></a>.
</dd></dl>

<hr>

<h3><a name="isc">Compiling and installing the ISC DHCPD</a></h3>
<dl><dt><dd>
The ISC DHCPD supports the following platforms:<br>
NetBSD, OpenBSD, FreeBSD, Linux, MacOS X, SunOS, Solaris, NEXTSTEP, HP-UX,
BSD/OS, OSF/1, and Ultrix
<p>

Some platforms ship with the ISC DHCPD pre-installed (such as NetBSD,
OpenBSD, FreeBSD, and Linux).  You should check to see if it's
pre-installed on your system and use that version instead of compiling
a new version from scratch.  The setup procedure is essentially the same,
and the configuration file is identical.
<p>

<ol>
<li>Download <tt>dhcpd-2.0pl3</tt> or later from <a
href="http://www.isc.org/products/DHCP/dhcp-v2.html">ISC.org</a>.
<p>

<li>Follow the directions in the README file, taking note of the limits
of your platform.  Briefly, the procedure is:<br>
<tt># <b>./configure</b></tt><br>
<tt># <b>make</b></tt><br>
<tt># <b>make install</b></tt><br>
If you get compilation errors be certain that <tt>cc</tt> is actually
<tt>gcc</tt>, as many of the commercial unices ship with broken C
compilers.
<p>

<li><tt># <b>touch /var/db/dhcpd.leases</b></tt><br>
   dhcpd complains if there is no existing file to store lease information in.
   Depending on your platform, dhcpd looks for the lease file in different
   locations.
<p>

<li>If you don't already have an <tt>/etc/dhcpd.conf</tt>, install the
sample <a href="dhcpd.conf"><tt>dhcpd.conf</tt></a> and edit it for your
site.
<p>

<li><tt># <b>ps -aux | grep dhcpd</b></tt><br>
   <tt>kill</tt> that process.
   Note that <tt>kill -HUP</tt> does <i>not</i> force dhcpd 2 to re-read
   its configuration file.
<p>

<li><tt># <b>/usr/sbin/dhcpd -d -f</b></tt><br>
   or wherever <tt>make install</tt> placed dhcpd.
</ol>
<p>

This will start dhcpd in debugging mode.  When dhcpd gets a request, it
will print the following message:

<pre>BOOTREQUEST from CC:CC:CC:CC:CC:CC via le0 (non-rfc1048)
BOOTREPLY for 192.168.1.10 to client.test.net
(CC:CC:CC:CC:CC:CC) via le0
DHCPDISCOVER from CC:CC:CC:CC:CC:CC via le0
DHCPOFFER on 192.168.1.10 to CC:CC:CC:CC:CC:CC via le0
DHCPREQUEST for 192.168.1.10 from CC:CC:CC:CC:CC:CC via le0
DHCPACK on 192.168.1.10 to CC:CC:CC:CC:CC:CC via le0</pre>

The bootloaders typically do not give any feedback, but when the kernel is
looking for a root filesystem, it will print the following message:
<pre>boot device: &lt;unknown&gt;
nfs_boot: trying DHCP/BOOTP
nfs_boot: DHCP server: 0xC0A80105
nfs_boot: my_name=client
nfs_boot: my_domain=test.net
nfs_boot: my_addr=0xC0A8010A
nfs_boot: my_mask=0xffffff00
nfs_boot: gateway=0xC0A80101
root on :/export/client/root</pre>
<p>

Continue on to setting up <a href="tftpd.html"><tt>tftpd</tt></a>.
</dd></dl>

<hr>

<h3><a name="cmu">CMU's DHCPD</a></h3>
<dl><dt><dd>CMU's <tt>dhcp</tt> is known to work on older versions of SunOS,
Solaris, IRIX, HPUX, and  AIX.  I failed to get it to compile on Solaris
2.6 and HP-UX 10.20.
<p>

<ol>
<li>download and extract into its own directory 
<a href="ftp://ftp.net.cmu.edu/pub/old/dhcp/">dhcp-3.3.7.tar.gz</a>
<p>

<li><tt># <b>./configure</b></tt>
<p>

<li><tt># <b>make</b></tt>
<p>

<li><tt># <b>make install</b></tt>
<p>

<li>You're on your own here, as far as setting it up.
</ol>
<p>

The bootloaders typically do not give any feedback, but when the kernel is
looking for a root filesystem, it will print the following message:
<pre>boot device: &lt;unknown&gt;
nfs_boot: trying DHCP/BOOTP
nfs_boot: DHCP server: 0xC0A80105
nfs_boot: my_name=client
nfs_boot: my_domain=test.net
nfs_boot: my_addr=0xC0A8010A
nfs_boot: my_mask=0xffffff00
nfs_boot: gateway=0xC0A80101
root on :/export/client/root</pre>
<p>

Continue on to setting up <a href="tftpd.html"><tt>tftpd</tt></a>.
</dd></dl>

<hr>

<h3><a name="solaris">Solaris</a></h3>
<dl><dt><dd>
Solaris 2.6 and later have a native <tt>dhcpd</tt>.
For earlier versions, you'll need to compile 
<a href="#isc"><tt>dhcpd</tt></a> from sources.
<!-- 
/var/dhcp/dhcptab macro definitions for groups of config
parameters.  consults hosts database

/etc/default/dhcp (config file)

in.dhcpd -b manual

-b manual handles bootp requests
-d -v 	foreground with verbose
kill -HUP rereads config file
-->
<p>

<ol>
<li>Coming soon.<br>
For now, follow the directions in the 
<a href="http://www.ibiblio.org/pub/Linux/docs/HOWTO/other-formats/html_single/JavaStation-HOWTO.html#SOLARISDHCPFAQSECTION">
Linux on the Sun JavaStation NC HOWTO</a>
</ol>
<p>

Continue on to setting up <a href="tftpd.html"><tt>tftpd</tt></a>.
</dd></dl>
<p>

<hr>

Previous |
<a href="tftpd.html">Next</a> |
<a href="./">Table of Contents</a>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../../"><img
        src="../../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a> 
  </td><td>
    <a href="../../../"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td> 
    <a href="../../../Documentation/"><img
        src="../../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../../Documentation/"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="../../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: dhcpd.html,v 1.13 2002/03/06 06:19:18 mbw Exp $<br>
  <a href="../../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
