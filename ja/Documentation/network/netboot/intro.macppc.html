<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@JP.NetBSD.ORG">
<title>Diskless NetBSD HOW-TO 序説 (macppc に特有な部分)</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<a href="intro.html">戻る</a> |
<a href="bootpd.html">進む</a> |
<a href="./">目次</a>

<hr>

<h1>Diskless NetBSD HOW-TO 序説 (macppc に特有な部分)</h1>

iMac 向けの簡潔な netboot ページとしては、 Mitchell Spector 氏の
<a href="http://www.enchantedlearning.com/tech/netbsd_imac.shtml">
How to Run NetBSD on an iMac</a> を見てください。

<h2>Power Macintosh Open Firmware 手順</h2>
<dl><dt><dd>
<big><b>どの Power Macintosh マシンが netboot 可能か</b></big>
<p>

NetBSD が対応している Power Mac は、
いずれも内蔵ネットワークインターフェース経由でのブートが可能です。
PCI、 Cardbus、 SCSI、 Airport ネットワークインターフェース経由での
ネットブートができたという報告はありません。
<p>

サポートされている macppc マシンに搭載された Open Firmware には
三つのメジャーバージョンがあります。これらはそれぞれ異なる方法でブートします。
OF バージョン 1.0.5 と 2.X は BOOTP のみに対応しており、
XCOFF ブートローダーをロードするようになっています。
OF バージョン 3.X は DHCP のみに対応しており、
ELF ブートローダーまたは直接 ELF カーネルをロードするようになっています。
<p>

NetBSD/macppc の配布では、XCOFF ブートローダーは <tt>ofwboot.xcf</tt>
という名前で、これはすべてのスナップショットで提供されるとは限りません。
ELF ブートローダーは <tt>ofwboot.elf</tt> という名前です。
<p>

OpenFirmware のバージョンは、 OF に入った時に表示されます。
不明な点があれば macppc <a href="../../../Ports/macppc/faq.html">FAQ</a>
を見てください。
<p>


<big><b>実行時に起こりうる傾向/問題</b></big>
<p>

いくつかの OF 1.0.5 の機種では、
ネットブートが全くできないとの報告があります。

この症状は、 <tt>ofwboot.xcf</tt> が nfs サーバーからの
カーネルのマウントに失敗し、ファイル名のない何かに対し tftp を試みます
("TFTP timeout" とのメッセージが出続けます) 。

私の経験について、詳しくは<a
href="http://mail-index.netbsd.org/port-macppc/2000/02/20/0007.html">port-macppc メーリングリストの記事</a>を見てください。
<p>

いくつかの OF 2.X の機種についても、 BOOTP サーバーからすべての適切な情報を
得られないとの報告がありますが、
それでも DHCP サーバーは BOOTP の要求に応えます。
このことを覚えておいてください。
<p>

初代 iMac (ボンダイブルー) は、オリジナルのファームウェアに
DHCP に関する問題があることが知られています。
iMac 用の新しいファームウェアをダウンロードすべきです。
他の初期の OF 3.X の機種にも同様の問題がある可能性がありますので、
もし DHCP に関して問題があったら、
ファームウェア更新のため <a href="http://asu.info.apple.com/">Apple Software
Updates</a> のサイトを確認する ("firmware" を探すだけです) ようおすすめします。
<p>

<big><b>IP アドレスの取得とブートローダーのダウンロード</b></big>
<p>

Power Macintosh ワークステーションは、まず、その OF バージョンによって
Internet Bootstrap Protocol (BOOTP) または Dynamic Host Configuration
protocol (DHCP) を使って IP アドレスを得ようとします。
bootpd や dhcpd サーバーは、クライアントのイーサネットアドレスをもとに
IP アドレスとブートローダーのファイル名を割り当てます。
このリクエストが成功すると、 Open Firmware は
<a href="tftpd.html">TFTP プロトコル</a> を使って
2 段階目のブートプログラムをダウンロードする体制に入ります。
これは、 BOOTP や DHCP のリクエストに応えたサーバーに TFTP コネクションを張り、
サーバーから教えられたファイル名のファイルを要求することで行なわれます。
2 段階目のブートプログラムは、 BOOTP や DHCP で得られたサーバとパスを元に
NFS を使ってカーネルをロードします。
<p>

<tt>ofwboot.xcf</tt> と <tt>ofwboot.elf</tt> は、
gzip で圧縮されたカーネルをロードすることができ、
カーネルのダウンロードが大幅にスピードアップできます。
<p>

また、 OF 3.X の機種では、若干融通がきかなくなりますが、
ブートローダーの過程を経ずに、
gzip で圧縮されたカーネルをダウンロードするよう設定することもできます。
<p>

最初期の PCI PowerMacintoshe (初期の OF 1.0.5 の機種) では、
マザーボードのエラーにより、イーサネットアドレスを逆に
(たとえば <tt>00:a0:40:0b:77:2c</tt> 、本来は <tt>00:05:02:d0:ee:34</tt>)
宣言するので注意してください。
MacOS ユーティリティーを確実に使うことで、これを修正できます。
ネットブートが突然失敗する場合は、イーサネットアドレスが修正されたか、
また PRAM クリアによってこの修正が無効になっていないか、再確認してください。
<p>
OF が BOOTP/DHCP リクエストで使う MAC アドレスを確定するため、
次のコマンドをタイプします:
<pre>0 &gt; <b> dev enet .properties</b>
[...]
    local-mac-address CCCCCCCC CCCC
[...]</pre>
</dd></dl>

<h2>Open Firmware のコマンド</h2>
<dl><dt><dd>
OF 3.X の機種 (つまりトランスルーセントの機種) では、
起動の際 "N" キーを押し続ければ OF に入ることなくネットブートできます。
<p>

それ以外の機種では
(また、マシンをデフォルトでネットブートするよう設定したい場合は) 、
Open Firmware からブートすることができます。
ブート時に Open Firmware プロンプトに入るようにする方法について、詳しくは <a
href="../../../Ports/macppc/faq.html#ofw-access">NetBSD/macppc
FAQ</a> を見てください。
<p>

ネットブート用のコマンドは、 Open Firmware のバージョンによって異なります。
OF 1.0.5 and 2.X では、次のいずれかをタイプします:
<pre>0 &gt; <b>boot enet</b>
0 &gt; <b>boot enet enet:,netbsd.alternate</b>     # "netbsd" 以外のカーネルを指定する場合</pre>
<p>

OF 3 では、次のいずれかをタイプします:
<pre>0 &gt; <b>boot enet:0</b>
0 &gt; <b>boot enet:0,ofwboot.elf enet:0,netbsd.alternate</b>    # "netbsd" 以外のカーネルを指定する場合</pre>

DHCP での自分についての情報の送信について問題があるとの報告が
いくつかのユーザーからあります。このため、
コマンドラインでカーネル名を指定する必要があることがわかりました。
<p>

他の引数は、コマンドラインの最後で指定する
(例: <tt>boot&nbsp;enet&nbsp;-a</tt>)
ことで、ブートローダーやカーネルに渡すことができます。
<p>

デフォルトでネットワーク経由でブートさせるためには、
<tt><b>setenv boot-command enet[:0]</b></tt>
とタイプします。
</dd></dl>

<h2>設定を始める (次の順番に読むのが良いでしょう):</h2>
<dl><dt><dd>
<ol>
<li><a href="bootpd.html"><tt>bootpd</tt></a> (OF 1 と 2) または
    <a href="dhcpd.html"><tt>dhcpd</tt></a> (OF 3)
<li><a href="tftpd.html"><tt>tftpd</tt></a>
<li><a href="nfs.html"><tt>nfs</tt></a>
<li><a href="files.html">クライアントのファイルシステム</a>
<li><a href="finish.html">終了</a>
</ol>
</dd></dl>

<hr>

<a href="intro.html">戻る</a> |
<a href="bootpd.html">進む</a> |
<a href="./">目次</a>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../../"><img
        src="../../../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a> 
  </td><td>
    <a href="../../../"><img
        src="../../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">ホームページ</a>
  </td></tr></table>
</td><td>
  <table><tr><td> 
    <a href="../../../Documentation/"><img
        src="../../../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../../Documentation/"><img
        src="../../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="../../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: intro.macppc.html,v 1.12 2000/10/26 03:20:46 mbw Exp $<br>
  <a href="../../../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
