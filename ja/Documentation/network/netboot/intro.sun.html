<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<title>Introduction (sparc and sun3 specific), Diskless NetBSD HOW-TO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<a href="intro.html">Previous</a> |
<a href="rarp.html">Next</a> |
<a href="./">Table of Contents</a>

<hr>

<h1>Introduction (sparc- and sun3-specific), Diskless NetBSD HOW-TO</h1>

<h2>Sun Firmware procedures</h2>
<dl><dt><dd>
<big><b>Which Sun machines can netboot</b></big>
<p>

All sparc and sun3 workstations and servers are capable of booting
over a network interface. A network boot-strap procedure can be
started by entering the appropriate <em>PROM</em> command. The
exact format of the PROM command that must be used is dependent on
the PROM's version (see below).
<p>

There are currently two supported JavaStation models, the JavaStation-1 and
the JavaStation-10.  Some JavaStation-1 units have OpenBoot PROM 2, and
you should follow the directions below.  Some JavaStation-1 and all 
JavaStation-10 units have Open Firmware.  You should read this separate
page on <a href="intro.javastation.html">Open Firmware-based 
JavaStation</a> Diskless NetBSD HOW-TO.
<p>

<big><b>Determining your ethernet hardware address</b></big>
<p>
When you power on your machine, it will print out its MAC address.  If it
claims your ethernet address is <tt>ff:ff:ff:ff:ff:ff</tt>, then your
NVRAM battery is dead.  See the 
<a href="http://www.squirrel.com/squirrel/sun-nvram-hostid.faq.html">Sun
NVRAM/Hostid FAQ</a>.  Your system will not netboot without a working NVRAM.
<p>

<big><b>Obtaining an IP address via RARP</b></big>
<p>

When instructed to boot "over the net", your workstation will first
try to acquire an IP address by using the Reverse ARP (or RARP)
protocol. Thus you need to run a <a href="rarp.html">RARP server</a>
somewhere in the same network broadcast domain as your
workstation. The ethernet address of the machine (needed when setting up the
RARP server) should be displayed in the banner when it is powered on or reset.
<p>

Sometimes the arp entry gets corrupt on the <tt>rarpd</tt> server.  If this
happens, you may need to run (on the <tt>rarpd</tt> server):
<pre># <b>arp -s client.test.net CC:CC:CC:CC:CC:CC temp</b></pre>
<p>

Note:  if the client doesn't detect a <tt>rarpd</tt> server, it will patiently
wait for one and will not display any error messages (as described in
the <tt>rarpd</tt> pages).
<p>

<big><b>Downloading the boot loader</b></big>
<p>

If the RARP phase is completed successfully, the firmware in the
workstation expects to be able to download a program via the <a
href="tftpd.html">TFTP protocol</a>. It will do this by setting up a
TFTP connection to the server that answered the earlier RARP request
, and asking for a file named based on the machine's IP address and
architectural class.
<p>

<big><b><a name="naming">Naming the boot loader</a></b></big>
<p>

The netbooting machine will ask via tftp for a file named as follows:
<ul>
<li>The first eight characters are obtained by converting the four
    octets of the IP address into hexadecimal representation.
<li>For a sparc and newer sun3 machines, a dot (`.') is appended, followed
    by the machine's architectural class, in uppercase. 
</ul>
You can use bc(1) to calculate this name as follows:
<pre>$ <b>bc</b>
<b>obase=16</b>
<b>192</b>
C0
<b>168</b>
A8
<b>1</b>
1
<b>10</b>
A
<b>quit</b></pre>
Thus, a sun4c machine which has been assigned IP address
192.168.1.10, will make an TFTP request for
`<tt>C0A8010A.SUN4C</tt>'.
<p>

Normally, it is arranged on the TFTP server that this file is a symbolic
link to an appropriate second-stage boot program, which should of course
be located in a place where the TFTP daemon can find it (remember, many
TFTP daemons run in a chroot'ed environment).
You can find a suitable second-stage boot program in `/usr/mdec/boot.net'
in the NetBSD/sparc or NetBSD/sun3 distribution.
<p>

[ Note that the only difference between `/usr/mdec/boot.net' and
  `/usr/mdec/boot' is in the a.out header, which has been magically
  transformed in a way that makes it usable on all versions of
  Sparc PROMs.
]

</dd></dl>

<h2>Firmware commands</h2>
<dl><dt><dd>
These depend on the version of the Openboot firmware.
<ul>
<li>Version 1 usually has a '<tt><b>&gt;</b></tt>' prompt, and
<li>Version 2 usually responds with an '<tt><b>ok</b></tt>' prompt
</ul>
The kernel to load and other arguments can be passed to the boot loader by
specifying them on the end of the command line.
<p>

<big><b>Version 1 Openboot firmware</b></big>
<p>

Uses the following syntax to initiate a a boot-strap procedure on a
network device:
<p>

<ul>
<li>`<tt><b>b <em>xx</em>()</b></tt>' where <tt><b><em>xx</em></b></tt> is a
two-letter device specifier, e.g. `<tt><b>b le</b>(,,)</tt>' or `<tt><b>b ie(0,0,0)</b></tt>'
</ul>
<p>

The complete syntax is:
<p>

<ul>
<li>`<tt><b>b [[!][[<em>device</em>([<em>controller</em>],[<em>unit</em>],[<em>partition</em>])<em>pgm</em>
	[<em>arg1,...,arg7</em>]]]/?]</b></tt>'
  Boot <em>pgm</em>
  using a default boot sequence device, an EEPROM-specified device or a
  user-specified device or, view the list of available boot devices
  ?").  If argument '!' is present, the system won't be reset prior
  to booting.  Up to seven optional arguments will then be passed to the 
  booting program.<br>
    The
    <tt><b>(<em>controller</em>,<em>unit</em>,<em>partition</em>)</b></tt>
    arguments can be used to specify an TFTP server (???) [<em>If
    anyone has more details on this, <a
    href="../../../Misc/feedback.html">please let us know</a></em>]
</ul>
<p>

<big><b>Version 2 Openboot firmware</b></big>
<p>

Uses a generalized syntax to specify the boot device for use with
the `<tt>boot</tt>' command:
<p>

<ul>
<li>`<tt><b>boot net</b></tt>'; this will most likely work in all cases
    where there is a single network interface on the machine. In this
    case `<tt>net</tt>' will have been setup by the firmware as an
    alias to the full pathname of the network device.

<li>You may also need to be explicit about the network device you want
    to use, e.g. because there's more than one interface in the
    machine, possibly connected to different subnets. In this case, use
    the full device path name in the boot command, for instance:

<li>`<tt><b>boot /iommu/sbus/lebuffer@2,40000/le@2,60000</b></tt>';
    would select the `<tt>le</tt>' interface located on an "FSBE/S"
    board in Sbus slot 2; while

<li>`<tt><b>boot /iommu/sbus/ledma:tpe/le</b></tt>'; selects the
    on-board network interface in twisted-pair mode.
</ul>
</dd></dl>

<h2>Begin setting things up (suggested order):</h2>
<dl><dt><dd>
Get <tt>/usr/mdec/boot.net</tt> from <tt>base.tgz</tt> in the NetBSD
distribution.  This is what is sent by TFTP.  Copy this file to an
appropriately named file in <tt>/tftpboot</tt>, as described above in the
<a href="#naming">Naming the boot loader</a> section.
<p>

<ol>
<li><a href="rarp.html"><tt>rarp</tt></a>
<li><a href="bootparams.html"><tt>bootparams</tt></a>
<li><a href="tftpd.html"><tt>tftpd</tt></a>
<li><a href="nfs.html"><tt>nfs</tt></a>
<li><a href="files.html">client filesystem</a>
<li><a href="finish.html">finishing up</a>
</ol>
</dd></dl>

<hr>

<a href="intro.html">Previous</a> |
<a href="rarp.html">Next</a> |
<a href="./">Table of Contents</a>

<hr> 

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../../"><img
        src="../../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a> 
  </td><td>
    <a href="../../../"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td> 
    <a href="../../../Documentation/"><img
        src="../../../images/NetBSD-flag.gif" border="0"
        width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../../Documentation/"><img
        src="../../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="../../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: intro.sun.html,v 1.18 2002/04/29 23:29:11 mbw Exp $<br>
  <a href="../../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
