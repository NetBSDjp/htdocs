<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@JP.NetBSD.ORG">
<title>NetBSD DHCP HOWTO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">
<HEADING>DHCP How-To

<LIST>

<SECTION>DHCP について

<ENTRY>introduction 紹介と目的

このドキュメントの目的は、DHCPのクライアントとサーバーを NetBSDオペ
レーティングシステムにおいて設定する方法を説明することです。


<ENTRY>what_is_dhcp DHCPとは何か
   

DHCPはDynamic Host Configuration Protocolの略です。
それによって、ホストコンピューターの
ネットワーク設定を動的に行うことがで
きます。
基本的なアイディアは以下の通り:
<ul>
<li>DHCPクライアントが起動された時、そのコンピューターには最初はIPアドレスが割当てられていない。
<li>クライアントはそのネットワーク上の任意のDHCPサーバーに対してブロードキャストメッセージを発行する。
<li>やりとりが行われ、DHCPサーバーはクライアントにIPアドレスを割当てる。
サーバーはまた、その他の重要なネットワーク設定パラメーター(例えば、ネームサーバーのアドレスなど)も通知する。
</ul>

<ENTRY>who_needs_dhcp DHCPはどのような人にとって有用か

多くのインターネット・サービス・プロバイダ (ISP) は ISP が
動的に IP アドレスを割り振り、またその他の情報を通知できるようにする
ために、顧客に対して DHCP クライアントを使用するように要求します。
別の使い道は、一つ以上のネットワークに接続する可能性のあるラップトップコンピューターです。
例えば、ラップトップはオフィスと自宅の両方でネットワークに接続されることがあります。
この場合、異なる2つのネットワークに接続するために手動で設定を変更し直す必要がないので、
DHCPを使うのがぴったりと言えます。この場合は、オフィスと自宅の両方に DHCP サーバが
存在し、ラップトップは DHCP のクライアントである事が必要です。

<ENTRY>more_info_sources より詳細な情報の所在

一般的な DHCP に関するより詳細な情報は、
<a href="http://www.cis.ohio-state.edu/cgi-bin/rfc/rfc1541.html"><b>RFC 1541</b></a>, 
Request for Comments document for the Dynamic Host Configuration Protocol (DHCP)
を参照して下さい。
また、包括的な
<a href="http://www.dhcp-handbook.com/dhcp_faq.html">DHCP FAQ</a>
もあります。

<SECTION>DHCP クライアントの設定

この節では、NetBSDにおけるDHCPクライアントの設定方法について説明します。
このドキュメントは NetBSD-1.3 と NetBSD-1.4 について書かれています。

<ENTRY>configure_dhcp DHCP のコンフィギュレーション

DHCP のクライアントの設定は <code>/etc/dhclient.conf</code> ファイルに記述します。
もし、このファイルがなければ作成してください。
このファイルはカスタマイズすることが必要です。
特に、ホスト名やイーサネットインターフェースを変更することを忘れないようにしてください。
詳細は <tt>dhclient.conf(5)</tt> と <tt>dhcp-options(5)</tt> を
参照して下さい。
典型的な <code>/etc/dhclient.conf</code> を以下に示します。

<pre>
Send host-name "myname.my.domain";                 &lt;=== ここに
                                                        ホスト名を書く
send dhcp-client-identifier "myident";             &lt;=== ここにホスト
                                                        識別子を書く
							(これは myname と同じ
							 であることが多い).
request subnet-mask, broadcast-address, routers,
    domain-name-servers;

timeout 30;
retry 60;
select-timeout 5;

script "/etc/dhclient-script";

lease {
  interface "sn0";                               &lt;=== ここにインターフェース
                                                      デバイスを書く
  option host-name "myname.my.domain";           &lt;=== ここに
                                                      ホスト名を書く
  option subnet-mask 255.255.255.0;
  option domain-name "my.domain";                &lt;=== ここに
                                                      ドメイン名を書く
  option domain-name-servers 127.0.0.1;
  renew 2 2000/1/12 00:00:01;
  rebind 2 2000/1/12 00:00:01;
  expire 2 2000/1/12 00:00:01;
}
</pre>

<ENTRY>update_dhclient dhclient-script の更新 (NetBSD-1.3 のみ)

ネットワークカードが二つ以上あるなら、大きなログファイルができてしまうバグ
を回避するために<code>/etc/dhclient-script</code> を編集する必要があります。
基本的な方針は、DHCPが走っていないネットワークカードについて呼ばれた時は、
dhclient-script を何もしないで終了させることです。
このバグは NetBSD-1.4 以降では修正されています。

例として、筆者のマシンには2枚のネットワークカードがあります。
<code>ae1</code> ネットワークカードにはDHCPを走らせ、
<code>ae0</code>には走らせていません。 
この例では、以下の数行を<code>/etc/dhclient-script</code> ファイルの先頭にある 
<code>#!/bin/sh</code> の直後に追加します。

<pre>
  # don't run DHCP on ae0 
  if [ $interface = "ae0" ]; then
    exit 0
  fi
</pre>

<ENTRY>enable_dhcp DHCP を有効にする。

<h3>NetBSD-1.3 以前の場合</h3>

<code>/etc/netstart.local</code> を編集して、'<code>dhclient
<em>interface</em></code>'の行を追加します。ここで<code><em>interface</em></code>
はネットワークインターフェース、 
例えば、NetBSD/mac68k では <code>ae1</code> や <code>sn0</code>、
NetBSD/i386 では <code>ep0</code> などです。
あなたがどのドライバーを持っているかは、ブートシーケンスか
<code>dmesg</code>の出力を見ることによってわかります。
これで、ブートシーケンス中にDHCPクライアントのソフトウェアが自動的に起動されます。

<h3>NetBSD-1.4</h3>

<code>/etc/rc.conf</code> を編集し、'<code>dhclient</code>' 行を
'<code>dhclient=YES</code>' となるように変更します。また
'<code>dhclient_flags</code>' 行に DHCP 設定をおこなう
ネットワークインターフェースのリストを追加します。例えば
'<code>dhclient_flags="ae1"</code>'
とします。

次回のリブート時にマシンは自動的に DHCP クライアントとして設定されます。
リブートせずに DHCP を有効にするには、コマンド
'<code>dhclient <em>interface</em></code>' を実行して下さい。
ここで <code><em>interface</em></code> はネットワークインターフェースを
意味します。

<SECTION>DHCP サーバーの設定

この節では NetBSD-1.4 ファミリーのリリースにおける DHCP
サーバーの設定方法について説明します。
あなたの LAN で動的にアドレスを割り当てたい場合にのみ DHCP サーバーが
必要であることに注意して下さい。
詳細は <tt>dhcpd(8)</tt>, <tt>dhcpd.conf(5)</tt>, 
<tt>dhcp-options(5)</tt> を参照して下さい。

<ENTRY>configure_dhcpd DHCPD のコンフィギュレーション

DHCP サーバーの設定は <code>/etc/dhcpd.conf</code> ファイルに記述します。
もし、このファイルがなければ作成して下さい。
このファイルはカスタマイズすることが必要です。
特に、ホスト名やイーサネットインターフェースを変更することを忘れないようにしてください。
典型的な <code>/etc/dhcpd.conf</code> を以下に示します。 この例では、7つの
アドレスが、DHCP クライアント用に確保されます。確保されるアドレスは 192.168.0.2 から
192.168.0.8 です。DHCP サーバーはクライアントに対して、使用すべき IP アドレス、ネットマスク、
ルーター、ネームサーバー とドメイン名を通知します。

<pre>
# Setting DHCPD global parameters
allow unknown-clients;

# Set parameters for the 192.168.0.0/24 subnet.
subnet 192.168.0.0 netmask 255.255.255.0 {
range 192.168.0.2 192.168.0.8;                &lt;=== ここに割り当て可能な
                                                   IP アドレスの範囲を書く
default-lease-time 604800;                    &lt;=== デフォルトの貸与時間(単位は秒)。
                                                   クライアントが明示的に要求してこない
                                                   場合に用いられます。
max-lease-time 604800;                        &lt;=== 最大貸与時間
option subnet-mask 255.255.255.0;             &lt;=== クライアントに通知するネットマスク
option domain-name-servers 1.2.3.4, 1.2.3.5;  &lt;=== ネームサーバーの IP アドレスの
                                                   リストをここに書く
option domain-name "your.domain.name";
option routers 192.168.0.1;                   &lt;=== クライアントが使用すべきルーターの
                                                   リスト
}
</pre>

<ENTRY>enable_dhcpd DHCPD を有効にする
<h3>NetBSD-1.4</h3>

<code>/etc/rc.conf</code> を編集し、'<code>dhcpd</code>' 行を
'<code>dhcpd=YES</code>' となるように変更します。また、
'<code>dhcpd_flags</code>'行に DHCPD が動作する
ネットワークインターフェースのリストを追加します。例えば
'<code>dhcpd_flags="-q ae1"</code>'
とします。

<ENTRY>touch dhcpd.leases ファイルの作成
dhcpd は /var/db/dhcpd.leases ファイルを必要とします。 'touch /var/db/dhcpd.leases' してファイルを作ります。

</LIST>

<a href="./"><em>NetBSD ドキュメンテーション: ネットワーク</em></a>へ戻る
<hr>

<DOCLINK>

<hr>
<address>
  <small>
  (連絡先 - <a href="../../Misc/feedback.html">英語</a>,
       <a href="mailto:www@JP.NetBSD.ORG">日本語:
       www@JP.NetBSD.ORG</a>)<br>
  $NetBSD: dhcp.list,v 1.9 2001/05/18 01:11:20 dent Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
