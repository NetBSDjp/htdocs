<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<!-- Copyright (c) 1998, 1999, 2000
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<title>NetBSD DHCP HOWTO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">
<HEADING>DHCP How-To

<LIST>

<SECTION>DHCP Overview

<ENTRY>introduction Introduction and Purpose

This document attempts to explain how to setup DHCP clients and
servers for the NetBSD operating system.


<ENTRY>what_is_dhcp What is DHCP?
   

DHCP stands for Dynamic Host Configuration Protocol.  It allows dynamic
configuration of the network configuration of a host computer.  The basic
idea is this:  When a DHCP client is turned on, it initially doesn't have
an IP address assigned to it.  It issues a broadcast message to any DHCP
servers which are on the network.  An exchange takes place during which the
DHCP server assigns an IP address to the client and tells the client certain
key network configuration parameters (such as name server addresses for
example).

<ENTRY>who_needs_dhcp Who needs to use DHCP?

Many internet service providers (ISP's) require that their customers
use a DHCP client so the ISP may dynamically assign IP addresses and
control other network settings.
Another use is for laptop computers which may be connected to more
than one network.  For example a laptop may be connected to a network
in the office and also at home.  This is an ideal use for DHCP as the
laptop doesn't need to be manually reconfigured for use in the 2
different networks.  In this case there needs to be a DHCP server both 
on the office network and the home network and the laptop needs a
DHCP client.

<ENTRY>more_info_sources Sources of More Detailed Information

For more information about DHCP in general, please refer to
<a href="http://www.cis.ohio-state.edu/cgi-bin/rfc/rfc1541.html"><b>RFC 1541</b></a>, 
Request for Comments document for the Dynamic Host Configuration Protocol (DHCP).
In addition there is a comprehensive 
<a href="http://www.dhcp-handbook.com/dhcp_faq.html">DHCP FAQ</a>.

<SECTION>DHCP Client Setup

This section attempts to explain how to setup DHCP clients
under NetBSD.  This document includes information for both NetBSD-1.3
and NetBSD-1.4.

<ENTRY>configure_dhcp Configure DHCP

The DHCP client configuration is contained in the file <code>/etc/dhclient.conf</code>.
You will need to create this file if it does not already exist on your system.
Remember to customize this as needed, in particular be sure to change the hostname stuff
and the ethernet interface.  See <tt>dhclient.conf(5)</tt> and <tt>dhcp-options(5)</tt>
for more detailed information. A typical <code>/etc/dhclient.conf</code> is shown below.

<pre>
Send host-name "myname.my.domain";                 &lt;=== Put your
                                                        hostname here.
send dhcp-client-identifier "myident";             &lt;=== Put your host
                                                        identifier here.
							(this is often times
							 the same as myname).
request subnet-mask, broadcast-address, routers,
    domain-name-servers;

timeout 30;
retry 60;
select-timeout 5;

script "/etc/dhclient-script";

lease {
  interface "sn0";                               &lt;=== put your interface
                                                      device here.
  option host-name "myname.my.domain";           &lt;=== put your 
                                                      hostname here
  option subnet-mask 255.255.255.0;
  option domain-name "my.domain";                &lt;=== put your
                                                      domain name here
  option domain-name-servers 127.0.0.1;
  renew 2 2000/1/12 00:00:01;
  rebind 2 2000/1/12 00:00:01;
  expire 2 2000/1/12 00:00:01;
}
</pre>

<ENTRY>update_dhclient Update dhclient-script (NetBSD-1.3 only)

If you have more than 1 network card in your machine, you need to
edit the <code>/etc/dhclient-script</code> file to avoid a bug which
generates a large log file.  Basically, the idea is to make 
dhclient-script exit without doing anything when called on the network
card which doesn't have DHCP running on it.  Note that this bug has
been fixed in NetBSD-1.4 and later.

For example, on my machine, I have two network cards.  I run DHCP on 
the <code>ae1</code> network card and do not run DHCP on 
<code>ae0</code>.  For this example, add the following lines to
<code>/etc/dhclient-script</code> immediately after the 
<code>#!/bin/sh</code> line at the beginning of the file.

<pre>
  # don't run DHCP on ae0 
  if [ $interface = "ae0" ]; then
    exit 0
  fi
</pre>

<ENTRY>enable_dhcp Enable DHCP

<h3>NetBSD-1.3 and earlier</h3>

Edit <code>/etc/netstart.local</code> and add the line '<code>dhclient
<em>interface</em></code>', where <code><em>interface</em></code>
is your network interface, such as <code>ae1</code> or <code>sn0</code>
under NetBSD/mac68k or <code>ep0</code> under NetBSD/i386.
You should be able to see what driver you
have during the NetBSD boot sequence or by looking at the output
of <code>dmesg</code>.  This causes the DHCP client software to be
automatically started during the boot sequence.

<h3>NetBSD-1.4</h3>

Edit <code>/etc/rc.conf</code> and edit the '<code>dhclient</code>'
line to read '<code>dhclient=YES</code>'.  Add a list of network
interfaces which should be configured with DHCP to the
'<code>dhclient_flags</code>' line.  For example,
'<code>dhclient_flags="ae1"</code>'.

The next time you reboot your machine it will configure itself as a DHCP client.
To enable DHCP without rebooting, run the command '<code>dhclient <em>interface</em></code>'
where <code><em>interface</em></code> your network interface.

<SECTION>DHCP Server Setup

This section shows how to setup a DHCP server under the NetBSD-1.4 family of
releases.
Note that you do not need to set up a DHCP server unless you want to dynamically
assign addresses for computers on your LAN.
For more detailed information see <tt>dhcpd(8)</tt>, <tt>dhcpd.conf(5)</tt>, 
and <tt>dhcp-options(5)</tt>.

<ENTRY>configure_dhcpd Configure DHCPD

The DHCP server configuration is contained in the file <code>/etc/dhcpd.conf</code>.
If this file does not exist on your system, you will have to create it.
Remember to customize this as needed, ie: change the hostname stuff and the ethernet interface. 
A typical <code>/etc/dhcpd.conf</code> is shown below.  In the example, 7 addresses
are made available for use by DHCP clients.  These addresses are 192.168.0.2 through
192.168.0.8.  The DHCP server will tell the clients what IP address, netmask, routers, name
servers, and domain name to use.

<pre>
# Setting DHCPD global parameters
allow unknown-clients;

# Set parameters for the 192.168.0.0/24 subnet.
subnet 192.168.0.0 netmask 255.255.255.0 {
range 192.168.0.2 192.168.0.8;                &lt;=== Range of IP addresses
                                                   available for assignment.
default-lease-time 604800;                    &lt;=== Default lease time in 
                                                   seconds.  This is the time
                                                   assigned if the client doesn't
                                                   request one.
max-lease-time 604800;                        &lt;=== Maximum time a lease will be 
                                                   given.
option subnet-mask 255.255.255.0;             &lt;=== subnetmask given to clients
option domain-name-servers 1.2.3.4, 1.2.3.5;  &lt;=== put a list of name server IP
                                                   addresses here.
option domain-name "your.domain.name";
option routers 192.168.0.1;                   &lt;=== list of routers the clients should
                                                   use
}
</pre>

<ENTRY>enable_dhcpd Enable DHCPD
<h3>NetBSD-1.4</h3>

Edit <code>/etc/rc.conf</code> and edit the '<code>dhcpd</code>'
line to read '<code>dhcpd=YES</code>'.  Add a list of network
interfaces on which DHCPD should run to the
'<code>dhcpd_flags</code>' line.  For example,
'<code>dhcpd_flags="-q ae1"</code>'.

<ENTRY>touch Create a dhcpd.leases file
dhcpd wants a /var/db/dhcpd.leases file to exist. Create it by running 'touch /var/db/dhcpd.leases'.

</LIST>

<a href="./">Up to <em>NetBSD Documentation: Network</em></a>
<hr>

<DOCLINK>

<hr>
<address>
  <small>
  <a href="../../Misc/feedback.html">(Contact us)</a>
  $NetBSD: dhcp.list,v 1.9 2001/05/18 01:11:20 dent Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy;
    1998, 1999, 2000
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
