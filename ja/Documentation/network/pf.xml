<?xml version="1.0" encoding="ISO-2022-JP"?>
<!DOCTYPE webpage
 PUBLIC "-//NetBSD//DTD Website-based NetBSD Extension//EN"
        "http://www.NetBSD.org/XML/htdocs/lang/share/xml/website-netbsd.dtd">

<webpage id="ja-Documentation-network-pf">
<config param="desc" value=""/>
<config param="cvstag" value="$NetBSD: pf.xml,v 1.2 2006/01/12 06:26:49 reed Exp $"/>
<!-- Based on english version: -->
<!-- NetBSD: pf.xml,v 1.2 2006/01/12 06:26:49 reed Exp   -->
<config param="rcsdate" value="$Date: 2006/01/12 06:26:49 $"/>

<head>
<!-- Copyright (c) 1994-2006
The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<title>NetBSD Packet Filter 情報</title>
</head>

<para>
<ulink url="http://www.benzedrine.cx/pf.html">OpenBSD Packet Filter</ulink> (PF)
は、 2004 年 7 月以来 NetBSD に統合されており、リリース版としては
<ulink url="../../Releases/formal-3/NetBSD-3.0.html">NetBSD 3.0</ulink>
で初めて対応しました。
NetBSD での PF の使い方は、基本的に OpenBSD と同じですが、若干の違いがあります。
このページでは、その違いについて説明するとともに、
PF の NetBSD への移植と統合に関する追加情報を提供します。
</para>

<sect1 role="toc">

<sect2 id="overview">
<title>情報</title>

<sect3 id="availability">
<title>可用性</title>
<para>
NetBSD -current には、 OpenBSD 3.7 由来の PF に 3.7 枝由来の修正がおこなわれたものが附属します。
</para>

<para>
NetBSD 3.0 は PF に公式に対応した最初のリリース版です。
NetBSD 3.0 には、 OpenBSD 3.6 由来の PF に 3.6 枝由来の修正がおこなわれたものが附属します。
</para>

<para>
NetBSD 2.x のベースシステムは PF に対応していませんが、
pkgsrc に LKM (<ulink url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/security/pflkm/README.html">security/pflkm</ulink>)
があり、これにより PF に対応できます。
さらなる情報については、
<ulink url="http://nedbsd.nl/~ppostma/pf/">PF loadable kernel module for NetBSD 2</ulink>
のページをご覧ください。
</para>

<para>
NetBSD 1.6 以前は、 PF に対応していません。
</para>
</sect3>

<sect3 id="kernel">
<title>カーネルオプション</title>
<para>
PF を使うためにカーネルのコンパイルは必要ありません。 LKM <filename>/usr/lkm/pf.o</filename>
を使うことができます。 &man.modload.8; を使ってこの LKM をロードします。
<screen>
# modload /usr/lkm/pf.o
</screen>
しかし、 PF をカーネル内に組み込んでおきたい場合は、
少なくとも以下のオプションを有効にする必要があります。
<screen>
options 	PFIL_HOOKS	# &man.pfil.9; packet filter hooks
</screen>
このオプションは、GENERIC カーネルでデフォルトで有効になっているはずです。
カーネル内で PF を有効にするためには、
以下の擬似デバイスをカーネルコンフィギュレーションに追加しておきます。
<screen>
pseudo-device	pf		# PF packet filter
pseudo-device	pflog		# PF log interface
</screen>
PF を使ったパケットのロギングに興味がなければ、
pflog デバイスは外してもよいでしょう。
</para>

<para>
以上の設定を有効にするため、カーネルを再コンパイルしてインストールする必要があります。
</para>
</sect3>

<sect3 id="enable">
<title>PF を有効化する</title>
<para>
ブート時に PF を有効化するには、<filename>/etc/rc.conf</filename> で
<userinput>pf=YES</userinput> を設定します。

なお、 PF の設定ファイルが存在しない場合、
ブート手続きは中断します。
(<ulink url="#configuration">設定</ulink>もご覧ください)。

PF の手動での起動、停止、再起動、再読み込みには、rc.d スクリプト
<filename>/etc/rc.d/pf</filename> を使えます。
</para>

<para>
ブート時に &man.pflogd.8; (pf ロギングデーモン) を有効化するには、
<filename>/etc/rc.conf</filename> で <userinput>pflogd=YES</userinput> を設定します。
&man.pflogd.8; の手動での起動、停止、再起動には、rc.d スクリプト
<filename>/etc/rc.d/pflogd</filename> を使えます。
</para>

<para>
ブート時に LKM をロードするには、 <filename>/etc/rc.conf</filename> で
<userinput>lkm=YES</userinput> を設定し、以下の行を
<filename>/etc/lkm.conf</filename> に追加する必要があります。
<screen>
/usr/lkm/pf.o - - - - AFTERMOUNT
</screen>

</para>
</sect3>

<sect3 id="configuration">
<title>設定</title>
<para>
デフォルトの設定ファイルは <filename>/etc/pf.conf</filename> です。
これは、 <filename>/etc/rc.conf</filename> で変数 <userinput>pf_rules</userinput>
を設定して変えることができます。
</para>

<para>
初期設定ファイルは
<filename>/etc/defaults/pf.boot.conf</filename> です。この設定は、
ネットワーク設定をしている最中にマシンを攻撃から防御するためだけのものです。
このデフォルト設定は、 <filename>/etc/pf.boot.conf</filename> というファイルを作ることで
上書きすることができますが、ほとんどの場合は必要ないはずです。
このファイルに関するさらなる情報は、 &man.pf.boot.conf.5; をご覧ください。
</para>

<para>
両設定ファイルの書式は、
&man.pf.conf.5; マニュアルページで説明されています。
</para>
</sect3>

<sect3 id="bridge">
<title>ブリッジにおける PF の設定</title>
<para>
PF はブリッジングモードに対応していますが、ブリッジ上でのパケットフィルタリングを有効化するには、
カーネルを再コンパイルする必要があります。
以下の行をカーネルコンフィギュレーションに追加します。
<screen>
options         BRIDGE_IPF	# bridge uses IP/IPv6 pfil hooks too
</screen>
<ulink url="../../../guide/en/chap-net-misc.html#chap-net-misc-bridge" origlink="../../guide/en/chap-net-misc.html#chap-net-misc-bridge">NetBSD Guide</ulink> で説明されているとおり、
ブリッジを設定します。
次に、 &man.brconfig.8; コマンドを使ってブリッジ上でパケットフィルタリングを有効化します。
<screen>
# brconfig bridgeN ipf
</screen>
"ipf" オプションは PF に対しても適用されます。このオプションは実際には
&man.pfil.9; インターフェースを有効にするものだからです。
これで、ブリッジとして設定されたインターフェース上のパケットを
PF がフィルターできるようになったはずです。なお、
同じデータが両インターフェースを通過するので、
フィルターする必要があるのは片方のインターフェース上だけです。
</para>
</sect3>

<sect3 id="differences">
<title>OpenBSD との差異</title>
<para>
NetBSD 用の PF は、OpenBSD のものとくらべ若干の違いがあります。
違いのほとんどは、機能の欠如です。

<itemizedlist>
<listitem>
<ulink url="http://www.openbsd.org/cgi-bin/man.cgi?query=pfsync">pfsync(4)</ulink>
には対応していません (プロトコル番号の割り当ての問題のため)。
うまくいけば将来のリリースで解決するでしょう。
</listitem>
<listitem>
ALTQ には対応していません。カーネルで ALTQ を有効化すると、コンパイルでエラーとなります。
PF を LKM として使い、カーネル内で ALTQ を有効化する場合に限り、
ALTQ を使うことができます。まともな ALTQ API を作って
PF がその API を使うようにするための作業が進行中です。
</listitem>
<listitem>
<ulink url="http://www.openbsd.org/cgi-bin/man.cgi?query=carp">carp(4)</ulink>
には対応していません(これは本当は pf の一部ではありません)。
</listitem>
<listitem>
'group' キーワードは何もしません。
NetBSD は GID を uidinfo 構造体に保持しないからです。
おそらく、将来のリリースでは解決するでしょう。
</listitem>
<listitem>
ルートラベルにもとづくフィルタリングは機能しません。 NetBSD は
経路用のラベルを持ちません。将来のリリースで対応するかどうかは、
わかりません。
</listitem>
<listitem>
初期設定ファイル &man.pf.boot.conf.5; は NetBSD 特有のファイルです。
OpenBSD は  PF の初期設定を /etc/rc から読み込みますが、
このファイルは変更が必要なときの扱いが面倒です。
このため、 NetBSD では PF の初期設定用に新しいファイルを追加しています。
</listitem>
<listitem>
<ulink url="http://www.openbsd.org/cgi-bin/man.cgi?query=spamd">spamd</ulink>
は最初は NetBSD に導入されましたが、 3.0 のリリース前に削除されました。
これは PF の一部とはされず、 pkgsrc で利用可能になっています
(<ulink url="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/mail/spamd/README.html">mail/spamd</ulink>)。
</listitem>
</itemizedlist>
</para>
</sect3>

</sect2>

<sect2 id="links">
<title>リンク</title>

<sect3 id="misclinks">
<title>雑多なリンク</title>
<itemizedlist>
<listitem>
<ulink url="http://www.openbsd.org/faq/pf/index.html">OpenBSD PF User's Guide</ulink>
</listitem>
<listitem>
<ulink url="http://www.bgnett.no/~peter/pf/">Peter N. M. Hansteen's Firewalling with PF</ulink>
</listitem>
<listitem>
<ulink url="http://nedbsd.nl/~ppostma/pf/">PF loadable kernel module for NetBSD 2</ulink>
</listitem>
<listitem>
<ulink url="http://nedbsd.nl/~ppostma/pf/altq.html">ALTQ patches for NetBSD</ulink>
</listitem>
</itemizedlist>
</sect3>

<sect3 id="manpages">
<title>マニュアルページ</title>
<itemizedlist>
<listitem>&man.pf.4; - パケットフィルター</listitem>
<listitem>&man.pflog.4; - パケットフィルターロギングインターフェース</listitem>
<listitem>&man.pf.boot.conf.5; - パケットフィルターの初期設定</listitem>
<listitem>&man.pf.conf.5; - パケットフィルターの設定ファイル</listitem>
<listitem>&man.pf.os.5; - オペレーティングシステムの指紋ファイルの形式</listitem>
<listitem>&man.authpf.8; - 認証ゲートウェイユーザーシェル</listitem>
<listitem>&man.ftp-proxy.8; - インターネットファイル転送プロトコルのプロキシーサーバー</listitem>
<listitem>&man.pfctl.8; - パケットフィルター (PF) およびネットワークアドレス変換 (NAT) デバイスの制御</listitem>
<listitem>&man.pflogd.8; - パケットフィルターロギングデーモン</listitem>
</itemizedlist>
</sect3>

</sect2>

</sect1>

<parentsec url="./" text="ネットワーキングドキュメンテーション"/>
</webpage>
