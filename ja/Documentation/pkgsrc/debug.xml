<!-- $NetBSD: debug.xml,v 1.1 2004/06/06 13:31:53 grant Exp $ -->
<!-- Based on english version: -->
<!-- NetBSD: debug.xml,v 1.1 2004/06/06 13:31:53 grant Exp   -->

<chapter id="debug">
  <title>デバッグ</title>

  <para>パッケージを作成する時に落ちいりやすい間違いをチェックし、パッケージを動作
    させるための手順があります。これは基本的には前のセクションで説明したことと
    同じですが、デバッグを助けるための方法を追加しています。</para>

  <itemizedlist>
    <listitem>
      <para><varname>PKG_DEVELOPER=1</varname> を
	<filename>/etc/mk.conf</filename> で設定しておいてください</para>
    </listitem>

    <listitem>
      <para><pkg>pkgtools/url2pkg</pkg> をインストールして、以下を実行します</para>

      <screen>&rprompt; <userinput>url2pkg http://www.example.com/path/to/distfile.tar.gz</userinput></screen>
    </listitem>

    <listitem>
      <para><filename>Makefile</filename>に、必要な編集を加えます。</para>
    </listitem>

    <listitem>
      <para><filename>DESCR</filename>の内容を書きます</para>
    </listitem>

    <listitem>
      <para><command>make configure</command> を実行します。
      </para>
    </listitem>

    <listitem>
      <para>configureの段階でわかった依存関係をすべて、
	パッケージの<filename>Makefile</filename>に書き加えます。</para>
    </listitem>

    <listitem>
      <para>以下を繰り返しおこなって、パッケージを作り上げます</para>

      <screen>&rprompt; <userinput>make</userinput>
&rprompt; <userinput>pkgvi ${WRKSRC}/some/file/that/does/not/compile</userinput>
&rprompt; <userinput>mkpatches</userinput>
&rprompt; <userinput>patchdiff</userinput>
&rprompt; <userinput>mv ${WRKDIR}/.newpatches/* patches</userinput>
&rprompt; <userinput>make mps</userinput>
&rprompt; <userinput>make clean</userinput></screen>

      <para>root以外のユーザーで作業をおこなうと、改変すべきでないファイルは改変され
	ません。特に、構築の段階以外では。</para>
    </listitem>

    <listitem>
      <para>必要なら<filename>Makefile</filename>を修正してください。
	<xref linkend="components.Makefile"/>を参考にしてください。</para>
    </listitem>

    <listitem>
      <para><filename>PLIST</filename>を作成します:</para>

      <screen>&rprompt; <userinput>make install</userinput>
&rprompt; <userinput>make print-PLIST &gt; PLIST</userinput>
&rprompt; <userinput>make deinstall</userinput>
&rprompt; <userinput>make install</userinput>
&rprompt; <userinput>make deinstall</userinput></screen>

      <para>これは通常、<username>root</username>で実行する必要があります。
	残ったままのファイルがないか調べます:</para>

      <screen>&rprompt; <userinput>make print-PLIST</userinput></screen>

      <para>もし、なにかファイルが見つかれば、それらは<filename>PLIST</filename>に不足しているので、追加
	してください。</para>
    </listitem>

    <listitem>
      <para>これで<filename>PLIST</filename>の修正ができました。
	パッケージを再度インストールして、バイナリーパッケージを作ります:</para>

      <screen>&rprompt; <userinput>make reinstall &amp;&amp; make package</userinput></screen>
    </listitem>

    <listitem>
      <para>インストールしたパッケージを削除します:</para>

      <screen>&rprompt; <userinput>pkg_delete blub</userinput></screen>
    </listitem>

    <listitem>
      <para>上記のfindコマンドを繰り返します。
	今度は何も見つからないはずです:</para>

      <screen>&rprompt; <userinput>make print-PLIST</userinput></screen>
    </listitem>

    <listitem>
      <para>バイナリーパッケージを再インストールします:</para>

      <screen>&rprompt; <userinput>pkgadd .../blub.tgz</userinput></screen>
    </listitem>

    <listitem>
      <para>遊んでみてください。すべてが機能することを確認してください。</para>
    </listitem>

    <listitem>
      <para><pkg>pkgtools/pkglint</pkg>に含まれる<command>pkglint</command>を実行し、
	報告される問題を修正してください。</para>

      <screen>&rprompt; <userinput>pkglint</userinput></screen>
    </listitem>

    <listitem>
      <para>提出してください(もし cvs アクセス可能であればコミットしてください)。
	<xref linkend="submit"/>が参考になります。</para>
    </listitem>
  </itemizedlist>
</chapter>
