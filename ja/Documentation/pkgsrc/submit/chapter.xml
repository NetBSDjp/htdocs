<!-- $NetBSD: chapter.xml,v 1.4 2003/06/23 07:03:05 grant Exp $ -->
<!-- Based on english version: -->
<!-- NetBSD: chapter.xml,v 1.4 2003/06/23 07:03:05 grant Exp   -->

<chapter id="submit"> <?dbhtml filename="submit.html"?>
<title>提出およびコミット</title>

<sect1>
<title>あなたが作ったパッケージの提出</title>
<para>
ここでは、バイナリーパッケージと<quote>通常の</quote>(ソース)パッケージとを区別する必要
があります:
</para>

<itemizedlist>
<listitem>
<para>コンパイル済みのバイナリーパッケージ</para>
<para>
  我々は、トロイの木馬等を含まないことを保証するために、NetBSD開発者からし
  かバイナリーを受け取りません。これは、誰かを糞ったれ扱いするものではなく、
  むしろユーザーを保護するための方針です。しかしながら、あなたの作ったバイ
  ナリーパッケージをどこかに置き、配布することは自由に行なってもかまいま
  せん。
</para>
</listitem>

<listitem>
<para>パッケージ</para>
<para>
  最初にパッケージが完全かどうか、コンパイル、実行できるかどうかを確認して
  ください。
  このドキュメントの<xref linkend="debug"/>、その他が参考になるでしょう。次に、
  パッケージに必要なすべてのファイルのgzipされたtarファイルを作成してくださ
  い。これは、すべてのファイルをひとつのディレクトリーにおきたいためです。
  次に、そのtarファイルを、パッケージのメンテナーがFTPかHTTP (WWW)を使用し
  て取得できる場所においてください。最後に、パッケージの名前とバージョンを
  含む概要、簡単な説明(<varname>COMMENT</varname>変数の内容でもOKです)、そしてtarファイルのURL
  を書き、<quote>pkg</quote>カテゴリーで<command>send-pr</command> (問題報告)をおこなってください。
</para>

<para>
  問題報告が処理されたら、あなたに連絡がいきます。そうすれば、tarファイルを
  削除してもかまいません。
</para>

<para>
  複数のパッケージを提出したい場合は、一つのパッケージにつき一つのPRにわけ
  て送ってください。そうすることで、私たちが追跡しやすくなります。
</para>
</listitem>
</itemizedlist>

</sect1>

<sect1>
<title>コミット: パッケージのCVSへのインポート</title>
<para>
  このセクションは、NetBSDのpkgsrcリポジトリーへの書き込みアクセス権限を持っ
  ているNetBSD開発者にのみ意味があるものです。cvsはカレントディレクトリーから
  の相対位置にファイルをインポートすることと、<command>cvs import</command>コマンドに渡したパ
  ス名からリポジトリー中のファイルの位置が決まることを忘れないでください。新
  しく作ったパッケージは、<quote>TNF</quote>のベンダータグと<quote>pkgsrc-base</quote>のリリースタ
  グでインポートしてください。例えば:
</para>

<screen><prompt>%</prompt> <userinput>cd
.../pkgsrc/&lt;category&gt;/&lt;pkgname&gt;</userinput>
<prompt>%</prompt> <userinput>cvs import pkgsrc/&lt;category&gt;/&lt;pkgname&gt; TNF pkgsrc-base</userinput></screen>

<para>
  また、インポートに使ったディレクトリーは、忘れずに邪魔にならないところに移
  しておいてください。そうしておかないと、ソースツリーを次に<quote>cvs
  update</quote>した
  ときにcvsが文句を言います。さらに、この新しいパッケージを、categoryの
  <filename>Makefile</filename>に忘れずに追加してください。
</para>

<para>
  初回のインポートでは、コミットメッセージに<filename>DESCR</filename>ファイルの内容を含めておき、
  どういうパッケージなのかがメーリングリストの読者にわかるようにしてください。
</para>

<para>
  すべてのパッケージの変更や追加を、<filename>pkgsrc/doc/CHANGES</filename>に記述してください。こ
  のファイルを、これまでと同じ形式のまま最新の状態に保つことは非常に重要なこ
  とです。なぜなら、このファイルはスクリプトにより<ulink url="http://www.NetBSD.org/">www.NetBSD.org</ulink>や他のサイト
  のページを自動的に更新するために使用されているからです。
</para>

<para>
  新しいパッケージを追加する場合は、<quote>cvs
  add</quote>ではなく<quote>cvs import</quote>を使うように
  してください。"cvs import"なら、単一のコマンドですべて記述することができ、
  また、一貫したタグを打つことができるからです。
</para>

</sect1>

<sect1>
<title>パッケージを新しいバージョンに更新する</title>
<para>
  パッケージを更新するときは、新旧バージョン間の変更点の簡潔で適切で意味のあ
  る要約を、コミットログに必ず書いてください。そうすべき理由はいろいろありま
  す:
</para>

<itemizedlist>
<listitem>
<para>
  URLは不安定なものであり、時間がたつと変わることがあります。完全になくなる
  かもしれませんし、新しい情報に書き換わるかもしれません。
</para>
</listitem>

<listitem>
<para>
  新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、cvsやanoncvsの
  利用者にとって、非常に便利です。
</para>
</listitem>

<listitem>
<para>
  新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、pkgsrc-changes
  メーリングリストの読者が、パッケージをいつ更新するかの戦術を立てられるよう
  になり、非常に便利です。
</para>
</listitem>
</itemizedlist>

<para>
  また、あるパッケージに新しいバージョンがリリースされたというだけの理由で、
  CVSリポジトリー上のパッケージを更新しないほうがいいことを認識してください。
  私たちは、pkgsrcに含まれるパッケージに関して保守的であることを好みます。と
  いうのも、開発版やベータ版のパッケージは、pkgsrcが使われる場面のほとんどに
  対して、まったくふさわしくないからです。どのバージョンをpkgsrcに入れるのが
  よいか、分別をもって判断してください。新機能(テストされていない機能があるか
  もしれません)よりも安定性のほうが好ましいことを念頭に置いてください。
</para>

</sect1>

<sect1>
<title>pkgsrcのパッケージを移動する</title>

<orderedlist>
<listitem>パッケージのディレクトリーをどこかにコピーします。</listitem>

<listitem><para>コピーしたものからCVSディレクトリーをすべて削除します。</para>
<para>
  手順1,2は、以下のようにすることもできますので、今後の作業にはこちらを使ってください:
</para>
<screen><prompt>%</prompt> <userinput>cvs -d user@cvs.NetBSD.org:/cvsroot export -D today pkgsrc/category/package</userinput></screen>
</listitem>

<listitem><varname>CATEGORIES</varname>を修正します。また、<quote>../../category/package</quote>のかわりに単に
<quote>../package</quote>とすることができる<varname>DEPENDS</varname>のパスをすべて修正します。
</listitem>

<listitem>新しい場所で、修正後のパッケージを<command>cvs import</command>
します。</listitem>

<listitem><para>このパッケージに依存しているパッケージを調べます:
<screen><prompt>%</prompt> <userinput>cd /usr/pkgsrc</userinput>
<prompt>%</prompt> <userinput>grep /package */*/Makefile* */*/buildlink*</userinput></screen>
</para>
</listitem>

<listitem>手順5で見つかったものに対して、このパッケージへのパスを、新しい場所を指すように修正します。</listitem>

<listitem>古い場所で、移動前のパッケージを<command>cvs rm (-f)</command>します。</listitem>

<listitem><filename>oldcategory/Makefile</filename>からこのパッケージを削除します。</listitem>

<listitem><filename>newcategory/Makefile</filename>にこのパッケージを追加します。</listitem>
<listitem><para>変更および削除されたファイルを commit します:</para>
<screen><prompt>%</prompt> <userinput>cvs commit oldcategory/package oldcategory/Makefile newcategory/Makefile</userinput></screen>
<para>
  (もちろん、手順5の各パッケージもです)。
</para>
</listitem>
</orderedlist>

</sect1>

</chapter>
