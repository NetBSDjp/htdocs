<!-- $NetBSD: chapter.xml,v 1.1 2003/04/07 15:39:41 grant Exp $ -->
<!-- based on english translation: -->
<!-- NetBSD: chapter.xml,v 1.1 2003/04/07 15:39:41 grant Exp   -->

<chapter id="debug"> <?dbhtml filename="debug.html"?>
<title>デバッグ</title>
<para>
パッケージを作成する時に落ちいりやすい間違いをチェックし、パッケージを動作
させるための手順があります。これは基本的には前のセクションで説明したことと
同じですが、デバッグを助けるための方法を追加しています。
</para>

<itemizedlist>
<listitem>
<para>
<varname>PKG_DEVELOPER=1</varname> を <filename>/etc/mk.conf</filename> で設定しておいてください
</para>
</listitem>

<listitem>
<para>
<pkg>pkgtools/url2pkg</pkg> をインストールして、以下を実行します
</para>

<programlisting># url2pkg http://www.example.com/path/to/distfile.tar.gz</programlisting>
</listitem>

<listitem>
<para>
Makefileに、必要な編集を加えます。
</para>
</listitem>

<listitem>
<para>DESCRの内容を書きます
</para>
</listitem>

<listitem>
<para>
<command>make configure</command>
</para>
</listitem>

<listitem>
<para>
configureの段階でわかった依存関係をすべて、パッケージのMakefileに書き加
えます。
</para>
</listitem>

<listitem>
<para>
以下を繰り返しおこなって、パッケージを作り上げます
</para>

<programlisting># make
# pkgvi ${WRKSRC}/some/file/that/does/not/compile
# mkpatches
# patchdiff
# mv ${WRKDIR}/.newpatches/* patches
# make mps
# make clean</programlisting>

<para>
root以外のユーザーで作業をおこなうと、改変すべきでないファイルは改変され
ません。特に、構築の段階以外では。
</para>
</listitem>
<listitem>
<para>
必要ならMakefileを修正してください。セクション4.1を参考にしてください。 XXX
</para>
</listitem>

<listitem>
<para>
PLISTを作成します:
</para>

<programlisting># make install
# make print-PLIST > PLIST
# make deinstall
# make install
# make deinstall</programlisting>

<para>
これは通常、rootで実行する必要があります。
残ったままのファイルがないか調べます:
</para>

<programlisting># make print-PLIST</programlisting>

<para>
もし、なにかファイルが見つかれば、それらはPLISTに不足しているので、追加
してください。
</para>
</listitem>

<listitem>
<para>
これでPLISTの修正ができました。パッケージを再度インストールして、バイナ
リーパッケージを作ります:
</para>

<programlisting># make reinstall &amp;&amp; make package</programlisting>
</listitem>

<listitem>
<para>
インストールしたパッケージを削除します:
</para>
 
<programlisting># pkg_delete blub</programlisting>
</listitem>

<listitem>
<para>
上記のfindコマンドを繰り返します。今度は何も見つからないはずです:
</para>

<programlisting># make print-PLIST</programlisting>

</listitem>
<listitem>
<para>
バイナリーパッケージを再インストールします:
</para>
 
<programlisting># pkg_add .../blub.tgz</programlisting>
</listitem>

<listitem>
<para>
遊んでみてください。すべてが機能することを確認してください。
</para>
</listitem>

<listitem>
<para>
<pkg>pkgtools/pkglint</pkg>に含まれる<command>pkglint</command>を実行し、報告される問題を修正し
てください。
</para>

<programlisting># pkglint</programlisting>
</listitem>

<listitem>
<para>
提出してください(もし cvs アクセス可能であればコミットしてください)。
セクション 11 が参考になります。XXX
</para>
</listitem>
</itemizedlist>

</chapter>
