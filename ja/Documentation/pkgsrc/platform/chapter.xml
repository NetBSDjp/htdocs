<!-- $NetBSD: chapter.xml,v 1.4 2003/06/19 17:32:58 grant Exp $ -->
<!-- Based on english version: -->
<!-- NetBSD: chapter.xml,v 1.4 2003/06/19 17:32:58 grant Exp   -->

<chapter id="platforms"> <?dbhtml filename="platforms.html"?>
<title>NetBSD 以外のシステムで pkgsrc を使う</title>

<sect1>
<title>pkgsrc を使う準備をする</title>
<para>
NetBSD 以外のオペレーティングシステム用に、必要なツールを構築して pkgsrc を使えるようにするため、
ブートストラップキットを提供しています。
pkgsrc とブートストラップキットは、
ネイティブの NetBSD のほか、以下のオペレーティングシステムに対応しています。
</para>

<itemizedlist>
<listitem>Darwin (MacOS X)</listitem>
<listitem>FreeBSD</listitem>
<listitem>IRIX</listitem>
<listitem>Linux</listitem>
<listitem>OpenBSD</listitem>
<listitem>Solaris</listitem>
</itemizedlist>

<para>
その他のプラットフォームへの対応は、開発中です。
</para>

<para>
ブートストラップキットは、以下のようにして簡単にインストールすることができます。
</para>

<programlisting>cvs checkout othersrc/bootstrap-pkgsrc
cd othersrc/bootstrap-pkgsrc
./bootstrap</programlisting>

<para>
この例では、 <emphasis>prefix</emphasis> をデフォルトの
<filename>/usr/pkg</filename> とし、
パッケージデータベースのディレクトリーを <filename>/var/db/pkg</filename> とします。
これらをコマンドライン引数で設定することもできます。
</para>

<para>
対応プラットフォーム用に、 pkgsrc のツールと初期導入パッケージ一式を
バイナリーパッケージにしたものを用意してあります。
最新の一覧は <ulink url="../../software/packages.html">www.pkgsrc.org</ulink> にあります。
</para>

</sect1>

<sect1>
<title>プラットフォーム別の覚書</title>
<para>
いくつかのプラットフォームについては、以下のことを知っておくとよいでしょう。
</para>

<sect2>
<title>Darwin</title>
<para>
対応は、 Darwin 5.x および 6.x に対しておこなわれています。
Mac OS X で pkgsrc を使う方法としては、<link linkend="platform.osx-image">ディスクイメージ
</link>を使う方法と<link linkend="platform.osx-ufs">UFS
パーティション</link>を使う方法の二種類があります。
</para>

<para>
UFS パーティションがすでにある場合、または、
UFS でフォーマット可能な未使用のパーティションがある場合は、
ディスクイメージではなくそれを使うことをおすすめします。
多少速くなりますし、ブート時に自動的にマウントすることができます
(ディスクイメージは手動でマウントすることが必要です)。
</para>

<para>
なぜ、既存の HFS+ ファイルシステムを使えないのでしょうか?
それは、 pkgsrc は現在のところ、大文字と小文字を区別するファイルシステム上にあることを必要とするのですが、
HFS+ は大文字と小文字を区別しないからです。
</para>

<sect3 id="platform.osx-image">
<title>ディスクイメージを使う</title>
<para>
ディスクイメージを作ります。
</para>

<programlisting># cd bootstrap-pkgsrc
# ./ufsdiskimage create ~/Documents/NetBSD 512  # megabytes - season to taste
# ./ufsdiskimage mount ~/Documents/NetBSD
# sudo chown `id -u`:`id -g` /Volumes/NetBSD
</programlisting>

<para>
これで、できあがりです。
</para>
</sect3>

<sect3 id="platform.osx-ufs">
<title>UFS パーティションを使う</title>
<para>
ほとんどの Mac にはディスクが一つしかありませんので、
そこに pkgsrc 用の UFS パーティションを用意したい場合は、
ちょっとした細工が必要です。
</para>

<para>
問題は、ディスクツールではブートに使ったディスクを変更できないことです。
たとえば、30Gb のドライブを、Classic/OS9 用に 4Gb、pkgsrc 用に 4Gb、
残りを OS X 用の HFS+、のように分割しているとします。
この場合、pkgsrc 用のパーティションをアンマウントすることはできますが、
たとえこのパーティションを newfs したとしても、
パーティションマップ上は Apple_UFS (こちらであることが automounter には必要)
ではなく Apple_HFS とされます。
このため、 newfs すると、このパーティションは自動マウントされず、
手動でマウントしても Finder では見られません。
</para>

<para>
OS X Installation (User) CD からブートする必要があります。
インストールプログラムが起動したら、メニューから Disk
Utility を選択します。これで、 UFS にしたいパーティションを選んで
Apple UFS でフォーマットすることができます。
</para>

<para>
以上が完了したら、 Disk Utility を終了し、インストーラーを終了します
……するとコンピューターが再起動します。これで、新しい UFS
パーティションが見られますが、パーミッションが root に設定されているので、
書き込みができません。マウントポイント (<filename>/Volumes/whatever</filename>)
を自分のものに chown する必要があります。
</para>

<para>
この覚書は 10.2 (Jaguar) にもとづくもので、これより前のバージョンも該当します。
うまくいけば、Apple は 10.3 (Panther) で Disk Utility を修正してくれるでしょう。
</para>
</sect3>
</sect2>

<sect2>
<title>FreeBSD</title>
<para>
確認および対応は、 FreeBSD 4.7 および 5.0 に対しておこなわれています。
これら以外のバージョンでも動くかもしれません。
</para>

<para>
ブートストラップキットのインストールに際しては、
FreeBSD のユーザーランドのツールと衝突することがないように注意を払ってください。以下のような複数の事項があります。
</para>

<orderedlist>
<listitem>
<para>
FreeBSD の ports は、 <filename>/var/db/pkg</filename>
以下にパッケージデータベースを置きます。このため、
ブートストラップスクリプトの --pkgdbdir オプションで、
別の場所 (たとえば <filename>/usr/pkgdb</filename>)
を指定することをおすすめします。
</para>
</listitem>

<listitem>
<para>
FreeBSD ports のツールを使う予定がない場合は、混同を避けるために、
それらを移動してしまってもいいかもしれません。たとえば以下のようにします。
</para>

<programlisting>cd /usr/sbin
mv pkg_add pkg_add.orig
mv pkg_create pkg_create.orig
mv pkg_delete pkg_delete.orig
mv pkg_info pkg_info.orig</programlisting>
</listitem>

<listitem>
<para>
ブートストラップスクリプトを使った際、 
mk.conf ファイルの例は
<filename>mk.conf.example</filename> ファイルに置かれます。
</para>
</listitem>
</orderedlist>

</sect2>

<sect2>
<title>IRIX</title>
<para>
確認および対応は、 IRIX 6.5 に対しておこなわれています。これ以外のバージョンでも動くかもしれません。
</para>

<para>
機能する C コンパイラー、つまり、 gcc または SGI の MIPS
および MIPSpro コンパイラー (cc/c89) が必要です。 <varname>CC</varname> 環境変数を、
使用するコンパイラーに応じて設定してください。
</para>

<para>
環境変数または <filename>/etc/mk.conf</filename> の
<varname>CFLAGS</varname> が衝突しないようにしてください。
特に、 n32 オブジェクトファイルに lib64 を、また、その逆の組合せを、
リンクしないようにしてください。
<filename>/etc/compiler.defaults</filename> を確認してください。
</para>

</sect2>

<!--
<sect2>
<title>Linux</title>
<para>
... XXX
</para>
</sect2>
-->

<sect2>
<title>OpenBSD</title>
<para>
確認および対応は、 OpenBSD 3.0 および 3.2 に対しておこなわれています。
</para>

<para>
ブートストラップキットのインストールに際しては、
OpenBSD のユーザーランドのツールと衝突することがないように注意を払ってください。以下のような複数の事項があります。
</para>

<orderedlist>
<listitem>
<para>
OpenBSD の ports は、 <filename>/var/db/pkg</filename>
以下にパッケージデータベースを置きます。このため、
ブートストラップスクリプトの --pkgdbdir オプションで、
別の場所 (たとえば <filename>/usr/pkgdb</filename>)
を指定することをおすすめします。
</para>
</listitem>

<listitem>
<para>
OpenBSD ports のツールを使う予定がない場合は、混同を避けるために、
それらを移動してしまってもいいかもしれません。たとえば以下のようにします。
</para>

<programlisting>cd /usr/sbin
mv pkg_add pkg_add.orig
mv pkg_create pkg_create.orig
mv pkg_delete pkg_delete.orig
mv pkg_info pkg_info.orig</programlisting>
</listitem>

<listitem>
<para>
3. ブートストラップスクリプトを使った際、 
mk.conf ファイルの例は
<filename>mk.conf.example</filename> ファイルに置かれます。
OpenBSD の make プログラムは
<filename>/etc/mk.conf</filename> も使います。
このファイル中の pkgsrc 特有の記述を以下のように括ることで、
回避することができます。
</para>

<programlisting>.ifdef BSD_PKG_MK
# pkgsrc の記述。たとえば bsd.pkg.defaults.mk の挿入など
.else
# OpenBSD の記述
.endif</programlisting>
</listitem>
</orderedlist>

</sect2>

<sect2>
<title>Solaris</title>
<para>
対応は Solaris 2.6 から 9 までに対しておこなわれています。
機能する C コンパイラーが必要です。 gcc 2.95.3 および Sun WorkShop 5 の両者で確認がおこなわれています。
</para>

<para>
Solaris 8 でのブートストラップ過程およびパッケージの構築では、
以下の各パッケージが必要になります。
</para>

<itemizedlist>
<listitem>SUNWsprot</listitem>
<listitem>SUNWarc</listitem>
<listitem>SUNWbtool</listitem>
<listitem>SUNWtoo</listitem>
<listitem>SUNWlibm</listitem>
</itemizedlist>

<para>
なお、 Solaris 上では GNU binutils
はサポートされて<emphasis>いません</emphasis>。
</para>

<sect3>
<title>gcc を使う場合</title>
<para>
どのパッケージの構築にも同じ gcc だけを使うようにすると、
話が簡単になります。
</para>

<para>
外部から導入した gcc を使うのはブートストラップの時だけにして、
その後は gcc を<pkg>lang/gcc</pkg> から構築するかバイナリーパッケージをインストールして、
ブートストラップで使った gcc は削除することをおすすめします。
</para>
</sect3>

<sect3>
<title>Sun WorkShop を使う場合</title>
<para>
少なくとも、以下の各パッケージを (WorkShop 5.0 から)
インストールしておく必要があります。
</para>

<itemizedlist>
<listitem>SPROcc - Sun WorkShop Compiler C 5.0</listitem>
<listitem>SPROcpl - Sun WorkShop Compiler C++ 5.0</listitem>
<listitem>SPROild - Sun WorkShop Incremental Linker</listitem>
<listitem>SPROlang - Sun WorkShop Compilers common components</listitem>
</itemizedlist>

<para>
<filename>/etc/mk.conf</filename> で <varname>CC</varname> および <varname>CXX</varname>
を設定します。<varname>CPP</varname> もここで設定して結構です。
たとえば以下のようにします。
</para>

<programlisting>CC=	cc
CXX=	CC
CPP=	/usr/ccs/lib/cpp</programlisting>

<para>
64 ビットバイナリーを構築したい場合は、以下のようにします。
</para>

<programlisting>CFLAGS=	-xtarget=ultra -xarch=v9</programlisting>
</sect3>

<para>
どのコンパイラーを使うにせよ、コンパイラーのツールと
$prefix が <varname>PATH</varname> にあることを確認してください。
これは <filename>/usr/ccs/{bin,lib}</filename> と、
たとえば <filename>/usr/pkg/{bin,sbin}</filename> などです。
</para>
</sect2>
</sect1>

</chapter>
