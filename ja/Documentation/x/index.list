<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<!-- Copyright (c) 1994-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.org">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<title>NetBSD Documentation: The X Window System</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<HEADING>The X Window System

<LIST>

<SECTION>Running X

<ENTRY>wsmouse How to get the mouse working with XFree?
<p> Assuming you're using the default wscons console driver, make sure
you adjust the mouse protocol and device properly in the XF86Config file's
"Pointer" section:
</p>
    
<PRE>
Section "Pointer"
   ###Protocol       "PS/2"                    # Linux
   ###Device         "/dev/mouse"              # Linux
   ##Protocol        "busmouse"                # NetBSD 1.4.x
   ##Device          "/dev/pms0"               # NetBSD 1.4.x
   Protocol          "wsmouse"                 # NetBSD 1.5 or later
   Device            "/dev/wsmouse"            # NetBSD 1.5 or later
EndSection
</PRE>

<p>If you don't use wscons (as is the default on 1.4.x systems), use /dev/pms0
and the "busmouse" protocol for a PS/2 mouse.</p>

<p>Protocol "PS/2" is still supported for older kernels, you'll have
to use Device "/dev/pms0" with the opms mouse driver in the kernel
for that, though. Useful for X-Servers that don't support the
wscons protocol (like XFree V4 or Linux/FreeBSD X server binaries).
</p>



<ENTRY>x-keyboard-maps Changing the keyboard mapping from 'US' under X
	XFree 3.x maps the keyboard with an english map per default. To
	change this to e.g. german, make sure the following is in your
	XF86Config file:

<PRE>
#       XkbDisable
#       XkbKeymap   "xfree86(us)"

        XkbModel        "pc102"
        XkbLayout       "de" XkbVariant      "nodeadkeys"
</PRE>

	To get e.g. a german keyboard in XFree 4.x, put the following into
	your XF86Config's "InputDevices" section:

<pre>
	Options		"XkbLayout"	"de"
</pre>

	Configuring the keyboard for the console under wscons is described
	<a href="../wscons/#keyboard-maps">elsewhere</a>.

<ENTRY>x-keyboard-nocaps How do I make the Caps key another Control key

	For XFree 3.x (as shipped with NetBSD 1.l5), add ``<TT>XkbOptions
        "ctrl:nocaps"</TT>'' if you want the caps-lock
	key become a second control-key. If you want to use the "Windows"
	keys on your keyboard, you can get some useful keysyms for them by
	using ``<TT>XkbModel "pc105"</TT>'' instead.
	<P>

	XFree 4.x uses a different config file format. For it, put

<pre>
	Option "XkbOptions" "ctrl:nocaps"
</pre>

	into the "InputDevice" section of your XF86Config file.
	<p>
	
<ENTRY>xf86_corrupts_on_rage_128 XF86_SVGA corrupts glyphs on Rage 128 if accelerated
To fix this make sure you have xsrc of at least 2000-01-13 (otherwise you will
have to also apply the patch in PR
<a href="http://www.NetBSD.org/cgi-bin/query-pr-single.pl?number=9171">xsrc/9171</a>).
 Then use <blockquote>Option "xaa_no_color_exp"</blockquote>
in the Device section of your XF86Config.

<ENTRY>slow_when_compiling X is very slow when compiling under NetBSD 1.3.x
A <a href="ftp://ftp.NetBSD.org/pub/NetBSD/misc/patches/1.3schedpatch">patch</a>
for the NetBSD 1.3 series is available which will significantly improve the
interactive performance under X while compiling or performing other tasks.

<ENTRY>bypassing_xdm How to bypass xdm
If xdm(1) is enabled but you are unable to login for some reason,
possibly because there is no root password, and you do not have virtual
consoles enabled (or they are not yet supported on your port), you can
either press ^C at the immediately after the boot messages indicate xdm
is starting, or:
<ul>
<li>Boot to single user mode<br>
    Usually this is accomplished by passing '-s' at the end of the boot command.
<li>Start the shell<br>
    Press <tt>ENTER</tt> when prompted for the shell.
<li>Check and mount the disks using fsck(8) and mount(8)<br>
    <tt>fsck -p ; mount -vat ffs</tt>
<li>Set term terminal type<br>
    <tt>TERM=<em>vt100</em> ; export TERM</tt><br>
    Note: you may need to use a different terminal type such as 'pc3' or 'sun'.
<li>Fix problem<br>
    Edit /etc/rc.conf to disable xdm, run '<tt>passwd</tt>' to set root's
    password, or take whatever other corrective action is needed
</ul>

<ENTRY>startx_not_found When I type '<b><tt>startx</tt></b>' I get the message: <tt>startx: Command not found.</tt> What's wrong?
You need to add the location of the X binaries to your shell's <tt>path</tt>
variable.  For <tt>csh</tt> and its derivatives, add <tt>/usr/X11R6/bin</tt>
to the line in your <tt>.cshrc</tt> file which sets the <tt>path</tt>
variable. For <tt>sh</tt> and its derivatives, you'll need to modify you
<tt>.profile</tt> instead. 

<ENTRY>xinit_not_found Unable to run X - '<b>xinit: not found</b>'
You need /usr/X11R6/bin in your path. As root add
'<b><tt>set path = ( $path /usr/X11R6/bin )</tt></b>' to
<tt>/etc/csh.cshrc</tt>, and start a new shell.

<ENTRY>startx_fails startx fails -'<b>X connection to: 0.0 broken</b>'
To see the error messages in this case, run:
<ul>
<li>If your shell is csh(1) or <PKGSRC>shells/tcsh:
<pre>	startx &gt;& ~/x.log</pre>
<li>If your shell is sh(1), ksh(1), or similar:
<pre>	startx &gt; ~/x.log 2&gt;&amp;1</pre>
</ul>
Then view ~/x.log

<ENTRY>xconsole Console output (such as from 'su') garbles X display.
The system is outputting a line to the console indicating something has
happened (such as 'su'). You should really run xconsole(1) or
one 'xterm -C' to capture this console output.
<p>
You may need to ensure your kernel is compiled with the following enabled:
<pre>	options  UCONSOLE  # allow anyone to steal the virtual console</pre>
See <a href="../kernel/#how_to_build_a_kernel">How to build a
kernel</a> for details on how to build your own kernels.
<p>
If you're logged in as root, and get annoying <tt>portmap</tt> notices,
you may wish to look at the <a href="../misc/#portmap-messup">FAQ entry</a>
on how to turn those messages off.

<ENTRY>wheel-mouse How do I get my mouse wheel to work?
If you use a Microsoft IntelliMouse,
Logitech Wheel Mouse (cordless our not) or something similar that has a 
scroll wheel, and you want to use the wheel under NetBSD, first make
a kernel that includes the "pmsi" driver, and make sure "wsmouse" uses
it. Something like this should occur in your dmesg(1) output:
<pre>
pmsi0 at pckbc0 (aux slot)
wsmouse0 at pmsi0
</pre>
If you are running XFree86 3.x (as shipped with NetBSD 1.5.2 and earlier),
ensure your <tt>/etc/XF86Config</tt> contains:
<pre>
Section "Pointer"
    Protocol    "wsmouse"
    Device      "/dev/wsmouse"
    ZAxisMapping 4 5
EndSection
</pre>
If you are running XFree86 4.x, ensure your <tt>/etc/X11/XF86Config</tt>
contains:
<pre>
Section "InputDevice"
    Identifier  "Mouse0"
    Driver      "mouse"
    Option      "Protocol"      "wsmouse"
    Option      "Device"        "/dev/wsmouse"
    Option      "Buttons"       "5"
    Option      "ZAxisMapping"  "4 5"
EndSection
</pre>
That's enough to make xterms scroll. For other apps, you'll need to
edit your ~/.Xdefaults. See 
<a href="http://koala.ilog.fr/colas/mouse-wheel-scroll/">Colas Nahaboo X mouse wheel scroll page</a>
for details on a lot of applications that can be made working.

<ENTRYLINK>http://www.xfree86.org/sos/resources.html XFree86 Documentation

<ENTRY>which_version Which version of XFree86 am I running?
To quickly tell which version of the X server you are running, you
can use xdpyinfo(1). E.g.:
<pre>
$ xdpyinfo | grep release
vendor release number:    335
</pre>
In the case of XFree86, this tells us that the server version is 3.3.5.

<ENTRY>anti_aliased How to setup anti-aliased fonts on NetBSD with XFree86 4

<b>NOTE</b>: The paths below should be adjusted appropriately if using xpkgwedge
<p>
<ol>
<li>Install the following packages from <a href="../software/packages.html">pkgsrc</a>:
	<ul>
		<li><PKGSRC>fonts/ms-ttf</li>
		<li><PKGSRC>fonts/mkfontscale</li>
                <li><PKGSRC>fonts/fontconfig</li>
	</ul>
</li>
<li>Setup the font hints:
	<ul>
		<li><tt>mkfontscale /usr/X11R6/lib/X11/fonts/TrueType</tt></li>
		<li><tt>mkfontdir /usr/X11R6/lib/X11/fonts/TrueType</tt></li>
	</ul>
	There should now be a 'fonts.dir' and 'fonts.scale' in the
	TrueType font directory.
</li>
<li>Configure the X server:
	<ul>
		<li>In the "Module" section, make sure that the following exists:
<pre><tt>
		Load "type1"
		Load "freetype"
</tt></pre>
		</li>
		<li>In the "Files" section, verify the order of the font paths.
               Verify that the TrueType and Type1 font paths are before
               the rest:
<pre><tt>
		FontPath   "/usr/X11R6/lib/X11/fonts/local/"
		FontPath   "/usr/X11R6/lib/X11/fonts/TrueType/"
		FontPath   "/usr/X11R6/lib/X11/fonts/Type1/"
		FontPath   "/usr/X11R6/lib/X11/fonts/misc/"
		FontPath   "/usr/X11R6/lib/X11/fonts/75dpi/:unscaled"
		FontPath   "/usr/X11R6/lib/X11/fonts/100dpi/:unscaled"
		FontPath   "/usr/X11R6/lib/X11/fonts/75dpi/"
		FontPath   "/usr/X11R6/lib/X11/fonts/100dpi/"

</tt></pre>
		</li>
	</ul>
</li>
<li>Configure Xft -- an example /usr/X11R6/lib/X11/XftConfig follows:
<pre><tt>
##### Example XftConfig
dir "/usr/X11R6/lib/X11/fonts/TrueType"
dir "/usr/X11R6/lib/X11/fonts/Type1"
# Uncomment the following line if using an LCD display
#match edit rgba = rgb;
match any family == "fixed"             edit family =+ "mono";
includeif       "~/.xftconfig"
match any family == "Times"             edit family += "Times New Roman";
match any family == "Helvetica"         edit family += "Verdana";
match any family == "Courier"           edit family += "Courier New";
match any family == "serif"             edit family += "Times New Roman";
match any family == "sans"              edit family += "Verdana";
match
        any family == "mono"
        all slant == roman
        all weight < bold
edit
        family += "monotype.com";
match any family == "mono"              edit family += "Courier New";
match any family == "Charter"           edit family += "Bitstream Charter";
match any family == "Bitstream Charter" edit family =+ "Charter";
match any family == "Lucidux Serif"     edit family += "LuciduxSerif";
match any family == "LuciduxSerif"      edit family =+ "Lucidux Serif";
match any family == "Lucidux Sans"      edit family += "LuciduxSans";
match any family == "LuciduxSans"       edit family =+ "Lucidux Sans";
match any family == "Lucidux Mono"      edit family += "LuciduxMono";
match any family == "LuciduxMono"       edit family =+ "Lucidux Mono";
match any family == "Comic Sans"        edit family += "Comic Sans MS";
match any family == "Comic Sans MS"     edit family =+ "Comic Sans";
match any family == "Trebuchet"         edit family += "Trebuchet MS";
match any family == "Trebuchet MS"      edit family =+ "Trebuchet";
match any family == "Monotype"          edit family =+ "Monotype.com";
match any family == "Andale Mono"       edit family += "Monotype.com";
match any family == "Monotype.com"      edit family =+ "Andale Mono";
##### End of XftConfig

</tt></pre>
</li>
<li>Rebuild the font cache for applications that use fontconfig:
<pre><tt>
	fc-cache -v
</tt></pre>
This will take a very long time (~20 minutes on a PII 366),
so be patient.
</li>
<li>That's it! Restart the X server, and test the configuration:
<pre><tt>
	xterm -ls -fg gray -bg black -ls -fa "Courier New Bold" -fs 10
</tt></pre>
</li>
</ol>
This Anti-Aliased-Fonts-Mini-Howto was written by Jared D. McNeill.

<ENTRY>fc-cache Xft using applications eat CPU cycles, but don't appear to do anything!

It is possible that the application in question is computing the font
information that should have been prepared by fc-cache -- re-run '<tt>fc-cache
-v</tt>' to make sure the information in the cache is up-to-date.

<ENTRY>font-error 'No fonts found' - what does this mean?
<p>
<pre><tt>
No fonts found; this probably means that the fontconfig                                                                   
library is not correctly configured. You may need to                                                                      
edit the fonts.conf configuration file. More information                                                                  
about fontconfig can be found in the fontconfig(3) manual                                                                 
page and on <URL>http://fontconfig.org
</tt></pre>
<p>
You haven't run '<tt>fc-cache -v</tt>' like the <PKGSRC>fonts/fontconfig
<a href="ftp://ftp.NetBSD.org/pub/NetBSD/packages/pkgsrc/fonts/fontconfig/MESSAGE">MESSAGE</a>
suggests during installation.  For details, see
'<tt>pkg_info -D fontconfig</tt>' and <a href="#anti_aliased">above</a>.

<ENTRY>x_wm How do I change the default window manager?

<p>First thing to do is to install the window manager you prefer. You
can find a lot of them, ready to install, in pkgsrc's <PKGSRC>wm
category. After a successful installation, figure out how is the
binary named. It will usually match package's name.</p>

<p>Once you know how to execute the window manager, you have to
configure your X session to start it up. We will be using twm in our
examples (which comes with X), whose binary is named <tt>twm</tt>:</p>

<ul>
  <li>If you are using startx(1), edit the <tt>~/.xinitrc</tt> file and
  append the following line to it:
  <pre>
    exec twm
  </pre>
  </li>

  <li>If you are using xdm(1), edit the <tt>~/.xsession</tt> file and
  append the following line to it:
  <pre>
    exec twm
  </pre>
  </li>
</ul>

<p>You can see that the content for each file is the same, so you may
want to create a link between them.</p>


<SECTION>Compiling programs

<ENTRY>compile_fails_xm Compile fails - 'unable to locate libXm'
Xm does not come with the standard X11 environment. It is part of 
<a href="http://www.opengroup.org/desktop/motif/">Motif</a>, which
is a commercial graphical user interface.<p>
A freeware implementation of Motif called
<a href="http://www.lesstif.org/">Lesstif</a> is also available.
It is available as part of the <a
href="../software/packages.html">NetBSD packages collection</a>, under
x11/<PKGSRC>x11/lesstif.

<ENTRY>compile_fails_xpm Compile fails - 'unable to locate xpm.h', or '-lXpm: no match'
xpm.h is part of the X PixMap library, used by many programs to allow more
multi (than two) colour icons.
It is available as part of the <a
href="../software/packages.html">NetBSD packages collection</a>, under 
graphics/<PKGSRC>graphics/xpm

<ENTRY>compile_basic Compile fails to link: Undefined symbol '_XOpenDisplay'
If it is a third party item of software, you should check if a version
is available via the <a href="../software/packages.html">NetBSD
packages collection</a>. If you are writing you own code you need to
ensure you link against the necessary X libraries. In this case, add
<code>-L/usr/X11R6 -lX11</code> to the end of your link line.

</LIST>

<DOCLINK>

<hr>
<address>
  <small>
  <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">(Contact us)</a>
  $NetBSD: index.list,v 1.43 2004/10/13 15:24:33 reed Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
