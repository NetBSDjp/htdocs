<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>

<!-- DO NOT EDIT THIS FILE. EDIT 'index.list' AND RUN 'make' -->

<!-- Copyright (c) 1994-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@JP.NetBSD.ORG">
<link rel="shortcut icon" href="../../../favicon.ico" origlink="/favicon.ico" type="image/x-icon">
    <title>Cross-building NetBSD</title>
  </head>

<body bgcolor="#FFFFFF" text="#000000">

<table><tr><td>
    <a href="../../Misc/disclaimer.html#bsd-daemon"><img
     align="middle" src="../../../images/BSD-daemon.jpg" origlink="../../images/BSD-daemon.jpg" border="0"
     width=146 height=129 alt="BSD daemon"></a>
  </td><td align=center>
    <h1>NetBSD ドキュメンテーション:</h1>
    <h1>NetBSD のクロス構築</h1>
</td></tr></table>
<p>

<h2><a name="top">繰り返される質問</a></h2>
<ul>
<li>
<a href="#terminology">用語</a></li>
<li>
<a href="#why">どうしてクロス構築?  クロス構築が必要なのはいつ?</a></li>
</ul>
<h2>道のり</h2>
<ul>
<li>
<a href="#host-system">ホストシステムの選択</a></li>
<li>
<a href="#build-tree">build tree を用意する</a></li>
<li>
<a href="#create-toolchain">クロスコンパイラー toolchain を作る</a></li>
<li>
<a href="#compile-kernel">クロスコンパイルの実際 - カーネル</a></li>
<li>
<a href="#compile-userland">クロスコンパイルの実際 - ユーザーランド</a></li>
</ul>
<h2>一般的な問題</h2>
<ul>
<li>
<a href="#compiler-issue">コンパイラーが内部エラーか同じような何らかの原因でお亡くなりになります。</a></li>
</ul>


<h2>他の情報源</h2>
<ul>
<li><a href="../current/">NetBSD-currentの追跡</a>
<li><a href="../../Documentation/">総合的な NetBSD ドキュメンテーション</a>
    - クロス構築だけに限らない疑問について。
</ul>

<hr>
<h2>繰り返される質問</h2><hr>
<p><h3>
<a name="terminology">用語</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
<ul>
<li>ホストシステム: クロス構築で、作業そのものを行おうとするシステム。

<li>ターゲットシステム: クロス構築の作業結果を動かそうとするシステム。

<li>クロス構築: ターゲットシステムとホストシステムが異なる場合に行うのがクロス構築。

<li>セルフ構築: ターゲットシステムとホストシステムが同じ場合、セルフ構築。
</ul>

 NetBSD/i386 上で、 NetBSD/sh3 のバイナリーを構築するなら、
 クロス構築 をします。
NetBSD/i386 が "ホストシステム" で、 NetBSD/sh3 が "ターゲットシステム" です。

</dd></dl>
<p><h3>
<a name="why">どうしてクロス構築?  クロス構築が必要なのはいつ?</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
クロス構築をする理由はいくつもあります:
<ul>
<li>NetBSD は<A HREF="../../Ports/">非常に多くのアーキテクチャー</A> を
サポートします。
それらのいくつかは、他の現代的アーキテクチャーに比べ性能は低いです。
古いアーキテクチャー向けに何度も構築作業を行うなら、
クロス構築は良い解決法です。

<li>もし、 ターゲットシステムが(携帯電話のような)組み込みシステム製品で、
それに、 NetBSD を移植しようとするなら、
 ターゲットシステム上で セルフ構築 をできないかもしれません。

<li>もし何らかの理由で、 NetBSD ではないホストシステム でNetBSD バイナリーを
構築する必要があるなら、 クロス構築する必要があります。

<li> NetBSD を新しいアーキテクチャーに移植しようとするなら、
クロスコンパイルだけが、唯一の選択肢です。
</ul>

</dd></dl>
<hr>
<h2>道のり</h2><hr>
<p><h3>
<a name="host-system">ホストシステムの選択</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
特別な理由がなければ、ホストシステムには、
 NetBSD(多分 最新のリリース または NetBSD-current)  を使うことを勧めます。
NetBSD 以外のプラットフォームもサポートされていますが、十分テストされてはいません。
最近の状況については、
<a href="http://cvsweb.netbsd.org/bsdweb.cgi/src/tools/compat/README?rev=HEAD&amp;content-type=text/x-cvsweb-markup">src/tools/compat/README</a> をご覧ください。

</dd></dl>
<p><h3>
<a name="build-tree">build tree を用意する</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
まず第一に、NetBSD ソースコードツリー全体を入手する必要があります。
詳しくは <a href="../current/">"NetBSD-currentの追跡"</a> を見てください。
以下の記述において、ツリーは $TOP/src の下にあると仮定します。
<p>
</dd></dl>
<p><h3>
<a name="create-toolchain">クロスコンパイラー toolchain を作る</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
たとえば <em>macppc</em> 用の toolchain を、 /usr/cross/{bin,include,lib,libexec,...}
ディレクトリー以下に作るには、次のようにします:
<pre>
	% cd $TOP/src
	% ./build.sh -m macppc -T /usr/cross tools
</pre>
このほかのオプション (チェックアウトされたソースツリーをもとにした完全な NetBSD
ツリーの構築を含む) については、
<p>
<pre>
./build.sh -h
</pre>
で参照できます。

</dd></dl>
<p><h3>
<a name="compile-kernel">クロスコンパイルの実際 - カーネル</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
カーネルの構築には、構築スクリプトで作成した toolchain を使います。
NetBSD の <a href="http://man.netbsd.org/man/config+8+NetBSD-current">config(8)</a> は、アーキテクチャーに依存しないので、
ホストシステムの物を使うことができます。 (ただし、バージョンには依存します。
-current の config を使って 1.6 のカーネルを作ることはできませんので、
以下ではクロスバイナリーディレクトリーにある nbconfig バイナリーを使います。)
<pre>
% cd $TOP/src/sys/arch/macppc/conf
% cp GENERIC MYCONF
% vi MYCONF
</pre>

カーネルのクロス構築を手作業でする場合は、以下のコマンドを使います:
<pre>
% /usr/cross/bin/nbconfig MYCONF
% cd ../compile/MYCONF
% /usr/cross/bin/nbmake-macppc depend
% /usr/cross/bin/nbmake-macppc 
</pre>

手作業で行なうかわりに、作業をすべて ./build.sh にやらせることができます:
<pre>
% cd $TOP/src
% ./build.sh kernel=MYCONF
</pre>  

<p>

</dd></dl>
<p><h3>
<a name="compile-userland">クロスコンパイルの実際 - ユーザーランド</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
ツリー全体の構築には構築スクリプトを用い、
<a href="../current/">"NetBSD-currentの追跡"</a> に書かれているように
します。
<pre>
# cd $TOP/src
# ./build.sh -D $DESTDIR -d
</pre>

</dd></dl>
<hr>
<h2>一般的な問題</h2><hr>
<p><h3>
<a name="compiler-issue">コンパイラーが内部エラーか同じような何らかの原因でお亡くなりになります。</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
クロス構築におけるコンパイラーの設定は、より巧妙なものになります。
クロス構築設定においては、コンパイラーのバグが現れやすくなります。
また、セルフ構築と異なるバージョンのコンパイラーを使う必要があることもあり、
それで、コンパイラーの互換性問題( GCC のバージョンが違うとか、他のベンダーのコンパイラー
であるとか)が頭痛の種となることがあります。
<p>

正しい cpp を使ってください。さもないと
 <tt>__NO_LEADING_UNDERSCORES__</tt> や <tt>__LITTLE_ENDIAN__</tt> のような、
あらかじめ定義されたシンボルで困ることになります。
<p>

もちろん、クロス構築をもっと安定させる必要はあります。

<p>

これに対しては魔法の杖はありません:
<ul>
<li>コンパイルスクリプトの中身を検討します。
	もし、(クロス構築中に /usr/bin/as を使うなどのように)
	異なるターゲット向けのコンパイラーが混ざると、問題を起こします。
<li>次善策として、実行時にコンパイラーの設定を変え、
	最適化レベルを下げて試してみます( -O2 から -O のように)
<li>クロスコンパイラー生成時のコンパイラーの設定を検討します。
<li>もし、それを再現する方法がわかっていて、 gcc を使っているなら、
	<a href="http://www.gnu.org/software/gcc/bugs.html">
	gcc の人たちにバグレポートを申し出ましょう</a>。
</ul>

</dd></dl>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
	src="../../../images/NetBSD-flag.gif" origlink="../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../"><img
	src="../../../images/empty.gif" origlink="../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">ホームページ</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../Documentation/"><img
	src="../../../images/NetBSD-flag.gif" origlink="../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../Documentation/"><img
	src="../../../images/empty.gif" origlink="../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  (連絡先 - <a href="http://www.netbsd.org/cgi-bin/feedback.cgi">英語</a>,
       <a href="mailto:www@JP.NetBSD.ORG">日本語:
       www@JP.NetBSD.ORG</a>)<br>
  $NetBSD: index.html,v 1.17 2003/03/28 16:57:08 kano Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
