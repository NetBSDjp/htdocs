<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
<!-- Copyright (c) 1994-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.org">
<title>NetBSD Documentation: Vendor-specific ELF Note Elements</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">

<table><tr><td>
<a href="../../Misc/disclaimer.html#bsd-daemon">
<img align="middle" src="../../images/BSD-daemon.jpg" border=0
width=146 height=129 alt="BSD daemon"></a>
</td><td align=center>
<h1>NetBSD Documentation:</h1>
<h1>Vendor-specific ELF Note Elements</h1>
</td></tr></table>
<p>


Various operating system vendors are shipping ELF binaries and those
binaries expect different system call interfaces.  In order to help
operating systems correctly determine whether or not they can run an
ELF program, and how to run it (e.g. what OS emulation to use), some
operating system vendors have begun marking their ELF binaries with
vendor-specific note elements, and placing those notes in the
binaries' PT_NOTE sections.

<p>
This page is meant to be a repository of knowledge about vendor-specific
note elements used in binaries PT_NOTE sections for operating system
identification.  It contains the following information:

<ul>
<li><a href="#note-format">Format of an ELF Note Element</a>
<li><a href="#note-names">Known ELF Note Names</a>
<li><a href="#note-contents">Vendor-specific ELF Notes</a>
<li><a href="#note-creation">Creating ELF PT_NOTE Sections</a>
<li><a href="#netbsd-note">Creating a NetBSD ELF PT_NOTE Section</a>
</ul>

<p>
If your operating system uses vendor-specific note elements to
mark its binaries and is not listed here, please send mail to
<a href="mailto:cgd@NetBSD.org">Chris Demetriou</a>
with information about those notes.


<h2><a name="note-format">Format of an ELF Note Element</a></h2>

All ELF Note elements have the same basic structure:

<pre>
	Name Size	4 bytes (integer)
	Desc Size	4 bytes (integer)
	Type		4 bytes (usually interpreted as an integer)
	Name		variable size, padded to a 4 byte boundary
	Desc		variable size, padded to a 4 byte boundary
</pre>

<p>
The Name Size and Desc Size fields are integers (in the byte order
specified by the binary's ELF header) which specify the size of the
Name and Desc fields (excluding padding).

<p>
The Name field specifies the vendor who defined the format of the Note.
Typically, vendors use names which are related to their project and/or
company names.  For instance, the GNU Project uses "GNU" as its name.
No two vendors should use the same ELF Note Name, lest there be confusion
when trying to interpret the meanings of notes.

<p>
The Type field is vendor specific, but it is usually treated as an
integer which identifies the type of the note.

<p>
The Desc field is vendor specific, and usually contains data which
depends on the note type.


<h2><a name="note-names">Known ELF Note Names</a></h2>

The following are the strings known to be used as ELF Note Names, along
with the organizations that use them.  Names with lengths that are
not a multiples of 4 are padded in the note, but only the given length
should be checked.

<pre>
    Note Name String            Organization
    ----------------            ------------
    "NetBSD\0"                  <a href="#note-contents-netbsd">The NetBSD Project</a>
    0x4e 0x65 0x74 0x42 0x53 0x44 0x00 (length 7)

    "GNU\0"                     <a href="#note-contents-gnu">The GNU Project</a>
    0x47 0x4e 0x55 0x00 (length 4)
</pre>


<h2><a name="note-contents">Vendor-specific ELF Notes</a></h2>

This section contains information about the formats of ELF notes which
vendors use in their PT_NOTE sections, and is split up by vendor.

<dl>

<dt><b><a name="note-contents-netbsd">The NetBSD Project</a></b>
<dd>
There are two vendor-specific ELF Notes for NetBSD, an OS Version note and
an Emulation Name note.
The former is used to indicate what OS Version
native binaries were built with, and can be used to identify native
binaries.
The latter is used to mark binaries (both native an non-native) with
a name that indicates which set of binary emulation code is to be used
when they are run.

<p>
The format of the NetBSD OS Version note is:

<pre>
    Name Size:          7
    Desc Size:          4
    Type:               4-byte integer containing the value 0x01
    Name:               "NetBSD\0" (padded to 8 bytes)
    Desc:               4-byte integer containing the NetBSD OS version
                        constant
</pre>

<p>
The format of the NetBSD Emulation Name note is:

<pre>
    Name Size:          7
    Desc Size:          variable
    Type:               4-byte integer containing the value 0x02
    Name:               "NetBSD\0" (padded to 8 bytes)
    Desc:               NUL-terminated string naming the
                        emulation to be used to run the binary
                        (padded to the next 4-byte boundary)
</pre>

<dt><b><a name="note-contents-gnu">The GNU Project</a></b>
<dd>
Starting with glibc 2.1, the GNU project will be using a single ELF Note
to indicate which GNU operating system and which version of that system
a binary was built for.  The format of that note is:

<pre>
    Name Size:          4
    Desc Size:          16
    Type:               4-byte integer containing the value 0x01
    Name:               "GNU\0"
    Desc:               Four 4-byte integers containing, in order:
			OS (0 = Linux, 1 = Hurd, 2 = Solaris)
			Major, Minor, and Teeny (of earliest
			    OS version that supports this ABI)
</pre>

For more documentation on the GNU C Library's use of ELF notes,
consult the sources:
<a href="http://sources.redhat.com/cgi-bin/cvsweb.cgi/libc/abi-tags?cvsroot=glibc">abi-tags</a>
and
<a href="http://sources.redhat.com/cgi-bin/cvsweb.cgi/libc/csu/abi-note.S?cvsroot=glibc">csu/abi-note.S</a>.

</dl>

<h2><a name="note-creation">Creating ELF PT_NOTE Sections</a></h2>

If you're using the GNU binutils 2.8 or greater to create your binaries,
you can generate PT_NOTE sections in your final object files.
To create a PT_NOTE section, create a section in one of your object
files (for systems which generate PT_NOTE entries by default, this
is typically the runtime startup code) with a name starting
with ".note" and having the "allocate" property set.
Put properly formed ELF Notes entries in that section.
When final linking is done, all sections which have names starting
with ".note" and which are marked "allocate" will be put into PT_NOTE
sections in the final object file.

<p>
An example of GNU assembler input which will create a PT_NOTE section
during final link is:

<pre>
    .section ".note.ident", "a"
    .p2align 2
    .long 1f - 0f           # name size (not including padding)
    .long 3f - 2f           # desc size (not including padding)
    .long 0x01234567        # type
0:  .asciz "NaMe"	    # name
1:  .p2align 2
2:  .long 0x76543210        # desc
    .long 0x89abcdef
3:  .p2align 2
</pre>

<p>
That example will create a section called ".note.ident", marked "allocate"
(so that it will be turned into a PT_NOTE section during final link), which
contains a single note.  That note has a type of 0x012345678, has the name
"NaMe\0", and has a desc value consisting of two 4-byte integers,
0x76543210 and 0x89abcdef.
<p>

<h2><a name="netbsd-note">Creating a NetBSD ELF PT_NOTE Section</a></h2>

The NetBSD kernel will return ENOEXEC if an ELF binary does not contain
a recognized PT_NOTE section. Normally, <code>crtbegin.c</code>
contains this section
for native NetBSD applications. The example below creates such a section
on NetBSD/alpha. (Other ports may use slightly different assembler syntax,
but, except for endian variations, they all use the same bits.)

<pre>
        .section ".note.netbsd.ident", "a"
        .long   2f-1f
        .long   4f-3f
        .long   1
1:      .asciz "NetBSD"
2:      .p2align 2
3:      .long   199905
4:      .p2align 2
</pre>

<hr>
<a href="./">Up to <em>NetBSD Documentation: Kernel</em></a>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
        src="../../images/NetBSD-flag.png" border="0"
        width="90" height="90" alt=""></a>
  </td><td>
    <a href="../../"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Home Page</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../Documentation/"><img
        src="../../images/NetBSD-flag.png" border="0"
        width="90" height="90" alt=""></a>
  </td><td> 
    <a href="../../Documentation/"><img
        src="../../images/empty.gif" border="0"
        width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  <a href="http://www.NetBSD.org/cgi-bin/feedback.cgi">(Contact us)</a>
  $NetBSD: elf-notes.html,v 1.20 2006/12/03 12:48:05 kano Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
  The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>

