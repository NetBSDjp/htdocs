<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>
<!-- Copyright (c) 2000-2002
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@NetBSD.ORG">
<link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
<title>NetBSD Bootable CD ROM HOWTO</title>
</head>
<body bgcolor="#FFFFFF" text="#000000">
<HEADING>Bootable CD ROM How-To

<LIST>

<SECTION>Overview

<ENTRY>introduction Introduction and Purpose

This document attempts to explain how to make bootable NetBSD
CD ROM's.

<SECTION>Creating the CD image
The first step in making a CD ROM is to create an image of the CD.
This image will initially be stored as a (rather large, up to 650 Mb)
file on your hard drive and then later written to the CD.

This section assumes you have access to the program
<tt>mkisofs</tt>.  If you are making the CD image on a NetBSD
machine, you can install <tt>mkisofs</tt> from the
<PKGSRC>sysutils/cdrecord
package.

It is assumed the directory <tt>/cdsources</tt> exists on your system
and contains all the files which you want to end up on the CD ROM.
One suggested layout for making an install CD is to follow the
directory structure on <a
href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5.3/">ftp.netbsd.org</a>.  For example:
<pre>
  /cdsources/i386/.....
  /cdsources/sparc/.....
</pre>


<ENTRY>alphaimage NetBSD/alpha
There are 2 steps involved in making a NetBSD/alpha bootable CD ROM.
The first is to create an ISO 9660 image of whatever you want
to put on the CD.  This image must have the secondary boot program and
kernel in its root directory.  In addition, the primary boot program
will be needed for the second step.  To put the boot programs and 
kernel in the right places, do the following:
<pre>
  cd /cdsources/alpha/binary/sets
  tar -zxvf base.tgz ./usr/mdec/boot ./usr/mdec/bootxx_cd9660
  mv -f ./usr/mdec/boot /cdsources/boot
  mkdir /tmp/mdec.alpha
  mv -f ./usr/mdec/bootxx_cd9660 /tmp/mdec.alpha/bootxx_cd9660
  rmdir ./usr/mdec
  cd /cdsources/alpha/installation/instkernel
  cp -f netbsd.gz /cdsources/netbsd.gz
</pre>
Now create the ISO 9660 image.
<pre>
  mkisofs -o output.iso -l -J -r -L /cdsources
</pre>
The second step is to install NetBSD/alpha disk and CD ROM bootstrap
software using <tt>installboot(8)</tt>.  This is done with the
following command:
<pre>
  installboot -m alpha -v output.iso /tmp/mdec.alpha/bootxx_cd9660 
</pre>

<ENTRY>i386image NetBSD/i386
This section shows how to make a NetBSD/i386 bootable CD ROM.  The
particular example is how to make a NetBSD-1.5.3/i386 install CD.  It
is assumed that the directory <tt>/cdsources/</tt> exists on your system
and contains all the files and the directory structure from the 
<a
href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5.3/i386/">NetBSD-1.5.3/i386</a>
The exact contents depend on what you want on your CD.  The
important part is that
<tt>/cdsources/i386/installation/floppy/boot-big.fs</tt> exists as that will
be used as the bootable image.

To create the CD image use the following command:
<pre>
  mkisofs -o output.iso -b i386/installation/floppy/boot-big.fs \ 
           -c boot.catalog -l -J -r -L /cdsources
</pre>
This will create a file, <tt>output.iso</tt>, which is the CD image.
The options are:
<ul>
<li><tt>-b i386/installation/floppy/boot-big.fs</tt> -- specifies the boot
image to be used.
<li><tt>-c boot.catalog</tt> -- creates a boot catalog.
<li><tt>-l</tt> -- Allow long (32 character) file names.
<li><tt>-J</tt> -- Includes Joliet extensions.
<li><tt>-r</tt> -- Sets file permissions.
<li><tt>-L</tt> -- Allows filenames to begin with ".".
<li><tt>/cdsources</tt> -- Specifies that the directory
<tt>/cdsources</tt> is the root of the CD image.
</ul>

<ENTRY>macppcimage NetBSD/macppc
All supported macppc models can boot from the first session of a CD ROM.
The procedure for making a CD bootable depends on what version of Open
Firmware your model has. Refer to the <a
href="../Ports/macppc/models.html">NetBSD/macppc Model Support Page</a> to
determine your system's Open Firmware version and its support status. 

<p>It is assumed that the directory <tt>/cdsources/</tt> exists on your
system and contains all the files and the directory structure from the
<a href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.6/macppc/"
>NetBSD-1.6/macppc</a> distribution.
The exact contents depend on what you want on your CD.

<p>Make sure your <tt>/cdsources/</tt> has <tt>ofwboot.xcf</tt> (the macppc
bootloader) and a kernel (we suggest <tt>netbsd.GENERIC_MD</tt>, the 
ramdisk-based install kernel that supports all models).

<pre>
  cd /cdsources
  cp macppc/binary/kernel/netbsd.GENERIC_MD.gz netbsd.gz
  cp macppc/installation/ofwboot.xcf .
</pre>

The NetBSD/macppc official ISO image is bootable on all supported models
because it does some special magic.  See 
<tt><a href="http://cvsweb.netbsd.org/bsdweb.cgi/basesrc/distrib/cdrom/"
>src/distrib/cdrom</a></tt> if you want to learn about it.

<p>To create the CD image for an Open Firmware 1.0.5, 1.1.22, or 2.0.x system,
use the following command:

<pre>
  mkisofs -o output.iso -l -J -r -L /cdsources
</pre>

<p>To create the CD image for an Open Firmware 2.4 or 3 system,
use the following command:

<pre>
  mkisofs -o output.iso -hfs -part -l -J -r -L /cdsources
</pre>

<p>Once you have burnt the CD, make sure Open Firmware can find the
bootloader on your new CD ROM (see
<a href="../Ports/macppc/faq.html#ofw-dir-listing">How do I get a listing (in
Open Firmware) of the files on my disk?</a> in the FAQ).  This is
important, since Open Firmware treats the boot file name as case
sensitive.  Most (if not all) Open Firmware 1.0.5, 1.1.22, and 2.0.x systems 
will think the bootloader is <tt>OFWBOOT.XCF</tt> and Open Firmware 3 should
properly see it as <tt>ofwbot.xcf</tt>. 

<p>Remember, you must enter Open Firmware to boot from this CD, you cannot
simply hold down the "<tt>c</tt>" key.

<ENTRY>pmaximage NetBSD/pmax
NetBSD/pmax can boot from either a FFS or ISO 9660 CD ROM.  This
section assumes you are making an ISO 9660 CD ROM.   Please note that 
the bootxx_cd9660 program was not added until <em>after</em> NetBSD-1.4.x.
If you're running NetBSD-1.4.x, you can obtain <tt>boot.pmax</tt>,
<tt>installboot</tt>, and <tt>bootxx_cd9660</tt> from a -current snapshot.
Make sure the sources are from <em>after</em> late November, 1999.

There are 2 steps involved in making a NetBSD/pmax bootable CD ROM.
The first is to create an ISO 9660 image of whatever you want
to put on the CD.  This image must have the secondary boot program
and kernel in its root directory.
In addition, the primary boot program 
will be needed for the second step.  To put the boot programs and 
kernel in the right places, do the following:
<pre>
  cd /cdsources/pmax/binary/sets
  tar -zxvf base.tgz ./usr/mdec/boot.pmax ./usr/mdec/bootxx_cd9660
  mv -f ./usr/mdec/boot.pmax /cdsources/boot.pmax
  mkdir /tmp/mdec.pmax
  mv -f ./usr/mdec/bootxx_cd9660 /tmp/mdec.pmax/bootxx_cd9660
  rmdir ./usr/mdec

  cd /cdsources/pmax/binary/kernel
  cp -f install.gz /cdsources/netbsd.pmax.gz
  gunzip /cdsources/netbsd.pmax.gz
</pre>
Now create the ISO 9660 image.
<pre>
  mkisofs -o output.iso -l -J -r -L /cdsources
</pre>
The second step is to install NetBSD/pmax disk and CD ROM bootstrap
software using <tt>installboot(8)</tt>.  The
<tt>installboot(8)</tt> command is used in the following way:
<pre>
  installboot -m pmax -v output.iso /usr/mdec/bootxx_cd9660 
</pre>

<ENTRY>sparcimage NetBSD/sparc
There are three steps involved in making a NetBSD/sparc bootable CD ROM.
Step 1 is to create an "almost" full ISO 9660 image of whatever you want
to put on the CD.  For example:
<pre>
  mkisofs -o output.iso -l -J -r -L /cdsources
</pre>
Now get a bootable floppy image.  For NetBSD-1.5.3/sparc, this image
may be found at
<URL>ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-1.5.3/sparc/installation/bootfs/boot.fs.gz

The final step is to rewrite the ISO image with (a) a sun disklabel at
the start, (b) the original image at the end, and (c) with the right
offset/size values in the disklabel for the bootloader.  The program
<tt>mksunbootcd</tt> will perform this task.  If <tt>mksunbootcd</tt>
is not installed on your system, it can be installed from the
<PKGSRC>sysutils/mksunbootcd
package.  If you're creating the image on a non-NetBSD system, you
can try compiling <tt>mksunbootcd</tt> on your system.  The sources
are available at
<a href="ftp://ftp.netbsd.org/pub/NetBSD/misc/mksunbootcd/">ftp://ftp.netbsd.org/pub/NetBSD/misc/mksunbootcd/</a>.  

To use <tt>mksunbootcd</tt> use the following:
<pre>
  mksunbootcd output.iso boot.fs boot.fs boot.fs
</pre>
The bootable image is listed three times corresponding to what will get
booted by a sun4, sun4c and sun4m system respectively.  If you have
different bootable images for the three machines, or if you also have
a bootable image for sun2, sun3, and sun3x systems, you can do something
like:
<pre>
  mksunbootcd output.iso boot-sun4.fs boot-sun4c.fs boot-sun4m.fs boot-sun3.fs
</pre>

Note that <tt>mksunbootcd</tt> rewrites the <tt>output.iso</tt> file, so
don't run it multiple times.

As a note, this step is fine to perform on a NFS mounted directory.  Ie, 
if your ISO image is on a remote machine, it can be mounted on a NetBSD
machine for running <tt>mksunbootcd</tt> without requiring extreme amounts
of data to be transfered over the network.

<ENTRY>sparc64image NetBSD/sparc64
Currently there is no support for booting NetBSD/sparc64 from CD.  It is
on the sparc64 TODO list however and the hardware certainly will support
this.

<ENTRY>sun2image NetBSD/sun2
To make a NetBSD/sun2 bootable CD ROM, follow the procedure below for 
making a NetBSD/sun3 bootable CD ROM.  This procedure makes a single 
CD ROM that will boot on both sun2 and sun3 systems.

<p>
<em>Optional:</em> When following the procedure below, it is beneficial
to uncompress the sun2 miniroot 
(<tt>/cdsources/sun2/installation/miniroot.fs.gz</tt>) and binary sets 
(<tt>/cdsources/sun2/binary/sets/*.tgz</tt>) 
before writing the ISO 9660 image.  This is entirely optional, and consumes
a lot of space on the ISO 9660 image, but saves time during installation 
because decompression is very slow on the sun2.

<ENTRY>sun3image NetBSD/sun3
There are three steps involved in making a NetBSD/sun3 bootable CD ROM, and
this will result in a CD ROM that can also boot NetBSD/sun2.

<p>
Step 1 is to create an "almost" full ISO 9660 image of whatever you want
to put on the CD.  For example:
<pre>
  mkisofs -o output.iso -l -J -r -L /cdsources
</pre>
Now build a bootable ffs image.  This image is currently not included in
the release, so you have to put it together yourself.

<pre>
  mkdir /tmp/boot-sun3
  cd /tmp/boot-sun3
  gzip -cd &lt; /cdsources/sun2/binary/kernel/netbsd.RAMDISK.gz &gt; netbsd.sun2
  ln netbsd.sun2 vmunix
  gzip -cd &lt; /cdsources/sun3/binary/kernel/netbsd.RAMDISK.gz &gt; netbsd.sun3
  gzip -cd &lt; /cdsources/sun3/binary/kernel/netbsd.RAMDISK3X.gz &gt; netbsd.sun3x
  tar xzvf /cdsources/sun3/binary/sets/base.tgz ./usr/mdec
  mv usr/mdec/ufsboot .
  mv usr/mdec/bootxx /tmp/bootxx.sun3
  rm -rf /tmp/boot-sun3/usr

  echo /set type=file uname=root gname=wheel mode=0755 &gt; /tmp/boot-sun3.spec
  echo . type=dir &gt;&gt; /tmp/boot-sun3.spec
  echo ufsboot mode=0644 &gt;&gt; /tmp/boot-sun3.spec
  /bin/ls netbsd* vmunix &gt;&gt; /tmp/boot-sun3.spec

  makefs -t ffs -B be -F /tmp/boot-sun3.spec /tmp/boot-sun3.fs /tmp/boot-sun3

  installboot -m sun3 -v /tmp/boot-sun3.fs /tmp/bootxx.sun3 ufsboot
</pre>

The final step is to rewrite the ISO image with (a) a sun disklabel at
the start, (b) the original image at the end, and (c) with the right
offset/size values in the disklabel for the bootloader.  The program
<tt>mksunbootcd</tt> will perform this task.  If <tt>mksunbootcd</tt>
is not installed on your system, it can be installed from the
<PKGSRC>sysutils/mksunbootcd
package.  If you're creating the image on a non-NetBSD system, you
can try compiling <tt>mksunbootcd</tt> on your system.  The sources
are available at
<a href="ftp://ftp.netbsd.org/pub/NetBSD/misc/mksunbootcd/">ftp://ftp.netbsd.org/pub/NetBSD/misc/mksunbootcd/</a>.  

To use <tt>mksunbootcd</tt> use the following:
<pre>
  mksunbootcd output.iso /tmp/boot-sun3.fs 
</pre>
Note that <tt>mksunbootcd</tt> is also used to make a bootable CD ROM
for sparc systems.  It is possible to make a bootable CD ROM that will
boot on sparc, sun2, sun3, and sun3x by doing something like:
<pre>
  mksunbootcd output.iso boot-sun4.fs boot-sun4c.fs boot-sun4m.fs boot-sun3.fs
</pre>

You can rearrange the ordering of the bootable filesystems in any way
you want; this only changes the partition numbers that the different
filesystems end up with, thus changing the partition number you need
to give to the PROM <tt>b</tt> or <tt>boot</tt> command to boot the
right filesystem for a given architecture.

<p>
Note that <tt>mksunbootcd</tt> rewrites the <tt>output.iso</tt> file, so
don't run it multiple times.

<p>
As a note, this step is fine to perform on a NFS mounted directory.  Ie, 
if your ISO image is on a remote machine, it can be mounted on a NetBSD
machine for running <tt>mksunbootcd</tt> without requiring extreme amounts
of data to be transfered over the network.

<ENTRY>vaximage NetBSD/vax
NetBSD/vax can boot from either a FFS or ISO 9660 CD ROM.  This
section assumes you are making an ISO 9660 CD ROM.   Please note that
this capability was not added until NetBSD-1.5

There are 2 steps involved in making a NetBSD/vax bootable CD ROM.
The first is to create an ISO 9660 image of whatever you want
to put on the CD.  This image must have the secondary boot program
and kernel in its root directory.
In addition, the primary boot program
will be needed for the second step.  To put the boot programs and
kernel in the right places, do the following:
<pre>
  cd /cdsources/vax/binary/sets
  tar -zxvf base.tgz ./usr/mdec/boot ./usr/mdec/xxboot
  mv -f ./usr/mdec/boot /cdsources/boot.vax
  mkdir /tmp/mdec.vax
  mv -f ./usr/mdec/xxboot /tmp/mdec.vax/xxboot
  rmdir ./usr/mdec

  cd /cdsources/vax/installation/netboot
  cp -f install.ram.gz /cdsources/netbsd.vax.gz
  gunzip -f /cdsources/netbsd.vax.gz
</pre>
Now create the ISO 9660 image.
<pre>
  mkisofs -o output.iso -l -J -r -L /cdsources
</pre>
The second step is to install NetBSD/vax disk and CD ROM bootstrap
software using <tt>installboot(8)</tt>.  The
<tt>installboot(8)</tt> command is used in the following way:
<pre>
  installboot -m vax -v output.iso /usr/mdec/xxboot
</pre>

<ENTRY>multiimage Multiple Machine

NetBSD-current has infrastructure in
<tt><a href="http://cvsweb.netbsd.org/bsdweb.cgi/basesrc/distrib/cdrom/"
>src/distrib/cdrom</a></tt>
to build CDs which can boot multiple machines.
This has been used to build a four CD set containing thirty-nine platforms,
with eight platforms able to boot off the CDs.
This technique requires <tt>mkisofs</tt> version 1.15a34 or newer.

<p>

Alternatively, multiple machine boot CDs can be created with the
following manual procedure.
This procedure
has been successfully used to create a single CD which is bootable on
alpha, i386, pmax, and sparc.  It should be possible to also make the
CD bootable on macppc, vax and on sun2, sun3 and sun3x.
To create a CD which is bootable by multiple architectures, use the
following steps in this order.  Please note that the order is critical.

<ul>

<li>Make sure you have all the required files including the various
kernels and boot programs listed in the individual machine
sections.  

<li>Include a directory somewhere in the <tt>cdsources</tt> directory called <tt>mdec.pmax</tt>
and include the pmax <tt>bootxx_cd9660</tt> file there.  For example,
<tt>/cdsources/usr/mdec.pmax/bootxx_cd9660</tt>.

<li>Include a directory somewhere in the <tt>cdsources</tt> directory called <tt>mdec.vax</tt>
and include the vax <tt>xxboot</tt> file there.  For example,
<tt>/cdsources/usr/mdec.vax/xxboot</tt>.

<li>Include the macppc <tt>ofwboot.xcf</tt> bootloader in <tt>/cdsources</tt>.

<li>Create an i386 bootable image.
<pre>
  sh
  mkisofs -v -v -o output.iso -b i386/installation/floppy/boot-big.fs \ 
           -c boot.catalog -l -J -r -L /cdsources 2&gt;&1 | tee /tmp/mkisofs.log
  exit
</pre>
Note that the appearance of the <tt>-v</tt> flag twice is required.  If you are
making a bootable CD for an Open Firmware 3 macppc model, make sure to include
<tt>-hfs -part</tt> in the parameters for <tt>mkisofs</tt>.

<li>Run <tt>mksunbootcd</tt> on a NetBSD/sparc machine to install sparc
and sun2/sun3 bootblocks.  Alternatively, install the 
<PKGSRC>sysutils/mksunbootcd
package on your favorite NetBSD machine.
<pre>
  mksunbootcd output.iso boot-sun4.fs boot-sun4c.fs boot-sun4m.fs boot-sun3.fs
</pre>

<li>Run the <tt>installboot(8)</tt> program targeted for
NetBSD/pmax to install the pmax bootblocks.
Note that in order to coexist with other NetBSD boot blocks, the pmax
boot block is appended to the end of the ISO file system.
<pre>
  installboot -m pmax -v -o append,sunsum output.iso /tmp/mdec.pmax/bootxx_cd9660
</pre>
The <tt>-o append,sunsum</tt> option appends the first stage boot block to
the end of the ISO file system, and restores the checksum used when booting
on a sun.

<li>Run the <tt>installboot(8)</tt> program targeted for
NetBSD/vax to install the vax bootblocks.
Note that in order to coexist with other NetBSD boot blocks, the vax
boot block is appended to the end of the ISO file system.
<pre>
  installboot -m vax -v -o append,sunsum output.iso /tmp/mdec.vax/xxboot
</pre>
(See the pmax entry above for an explanation of the flags).

<li>Run the <tt>installboot(8)</tt> program targeted for
NetBSD/alpha to install the alpha bootblocks.
<pre>
  installboot -m alpha -v -o append,sunsum output.iso /tmp/mdec.alpha/bootxx_cd9660
</pre>
Note that the alpha installboot must occur after the others, because
currently it's the only machine dependent back-end for
<tt>installboot(8)</tt> that can calculate the alpha checksum.
(See the pmax entry above for an explanation of the flags).

</ul>

<SECTION>Examining the CD image
It is possible to mount the cd image to examine the filesystem you
just created.

<ENTRY>netbsd_mountimage Under NetBSD
Mount the CD image using the following:
<pre>
  vnconfig -c vnd0 output.iso
  mount -t cd9660 /dev/vnd0c /mnt
</pre>
Please note that on i386 systems, you should <tt>/dev/vnd0d</tt> instead
of <tt>/dev/vnd0c</tt>.
Now you can cd to /mnt and explore your newly created CD image.
To unmount the image, do the following:
<pre>
  umount /mnt 
  vnconfig -u vnd0
</pre>

<ENTRY>linux_mountimage Under Linux
Linux has a similar capability.  To mount the CD image:
<pre>
  mount -t iso9660 -o ro,loop=/dev/loop0 output.iso /mnt
</pre>
and to unmount the CD image:
<pre>
  umount /mnt
</pre>

<ENTRY>solaris_mountimage Under Solaris
Solaris-8 and newer is reported to be able to also mount
the CD image.  See the <tt>lofiadm</tt> manpage on solaris
for more details on how to do this. 
<P>
For older versions of Solaris, you might want to try the
<tt>fbk</tt> driver written by Joerg Schilling.  The <tt>fbk</tt> driver
is available from
<a href="ftp://ftp.fokus.gmd.de/pub/unix/kernel/fbk/">ftp://ftp.fokus.gmd.de/pub/unix/kernel/fbk/</a>
Please refer to the <tt>fbk</tt> documentation for installation instructions.
Once the <tt>fbk</tt> driver is installed on your system, you can mount the ISO 9660 image
with the following command:
<pre>
  mount -F fbk -o ro,type=hsfs /dev/fbk0:output.iso  /mnt
</pre>
and to unmount the CD image:
<pre>
  umount /mnt
</pre>

<SECTION>Burning the CD

<ENTRY>cdrecord Using cdrecord (U*nix)
The program <tt>cdrecord</tt> may be used to burn the CD image to the
CD. <tt>cdrecord</tt> is of course, included in the
<PKGSRC>sysutils/cdrecord
package.

An example of the use of <tt>cdrecord</tt> is the following:
<pre>
  cdrecord -v speed=4 dev=/dev/cd1c output.iso
</pre>
You will need to substitute the correct speed for your CD writer and
the correct device for your system (for i386 it would be
<tt>/dev/cd1d</tt>).

<ENTRY>winrecord Under Windows
There are several programs available for Windows which will write an
ISO 9660 image to a CD.  This section is not an endorsement for any of
these programs in particular, but is intended to at least mention some
of the alternatives.
<ul>
<li><a href="http://www.goldenhawk.com/cdrwin.htm">CDRWIN</a>.
Commercial software that can create bootable (by i386) ISO 9660 images
and write them to CD.
<li><a href="http://www.goldenhawk.com/freeware.htm">FILE2CD</a>.
Freeware program which can write an ISO 9660 image to CD.
<li><a
href="http://www.adaptec.com/products/overview/ecdc.html">
Adaptec Easy CD Creator Deluxe</a>.  Commercial software.
<li>Adaptec Easy CD Creator.  Comes with many Windows based CD writers.
</ul>

<ENTRY>macrecord Under MacOS
There are several programs available for MacOS which will write an
ISO 9660 image to a CD.  This section is not an endorsement for any of
these programs in particular, but is intended to at least mention some
of the alternatives.
<ul>
<li><a
href="http://www.adaptec.com/products/overview/toast.html">
Adaptec Toast</a>.  Commercial software.
</ul>


</LIST>

<DOCLINK>

<hr>
<address>
  <small>
  <a href="../Misc/feedback.html">(Contact us)</a>
  $NetBSD: bootcd.list,v 1.40 2002/10/05 14:26:10 grant Exp $<br>
  <a href="../Misc/disclaimer.html">Copyright &copy; 2000-2002
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>

