<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<html>
<head>

<!-- DO NOT EDIT THIS FILE. EDIT 'index.list' AND RUN 'make' -->

<!-- Copyright (c) 1994-2003
	The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED. -->
<link rev="made" href="mailto:www@JP.NetBSD.ORG">
<link rel="shortcut icon" href="../../../favicon.ico" origlink="/favicon.ico" type="image/x-icon">
    <title>NetBSD-currentの追跡</title>
  </head>

<body bgcolor="#FFFFFF" text="#000000">

<table><tr><td>
    <a href="../../Misc/disclaimer.html#bsd-daemon"><img
     align="middle" src="../../../images/BSD-daemon.jpg" origlink="../../images/BSD-daemon.jpg" border="0"
     width=146 height=129 alt="BSD daemon"></a>
  </td><td align=center>
    <h1>NetBSD ドキュメンテーション:</h1>
    <h1>NetBSD-currentの追跡</h1>
</td></tr></table>
<p>

<h2><a name="top">よくある質問</a></h2>
<ul>
<li>
<a href="#why-track">なぜ NetBSD-current を追跡するのか?</a></li>
<li>
<a href="#downloading">current のダウンロード</a></li>
<li>
<a href="#building">配布物の構築</a></li>
<li>
<a href="#updating">既存システムのアップデート</a></li>
<li>
<a href="#what-to-do">覚えておくべきこと</a></li>
<li>
<a href="#build-targets">Makefileのいろいろなターゲットと実際の構築方法は?</a></li>
<li>
<a href="#using-anoncvs">anoncvs を用いた NetBSD-current の追跡</a></li>
<li>
<a href="#using-anoncvs-over-ssh">anoncvs over ssh の利用</a></li>
<li>
<a href="#using-sup-into-cvs">SUP と CVS の組合せによる NetBSD-current の追跡</a></li>
<li>
<a href="#getrepos">リポジトリー全体の入手</a></li>
<li>
<a href="#error">エラーが出た場合は ?</a></li>
<li>
<a href="#etcupdate">etcupdate を使った設定ファイルと起動ファイルの更新</a></li>
</ul>
<h2>特定の問題</h2>
<ul>
<li>
<a href="#wscons">wsconsにアップデートした後コンソールが使えない</a></li>
</ul>


<hr>
<h2>よくある質問</h2><hr>
<p><h3>
<a name="why-track">なぜ NetBSD-current を追跡するのか?</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
NetBSDの開発者はそのときどきの開発中のソースをいくつかの理由から一般に
公開してきました。まず、NetBSD-currentを用意することで、より安定した、
利用しやすいシステムを作ることができます。
<p>
これにより、NetBSDの開発に熱中するのが容易になります。最新の開発中ソー
スを配布することで、システムが今どうなっているのかが多くの人に明らかに
なりますし、新機能が実装されればすぐにそれを試してみることができます。
また、利用者からの変更を統合するのも楽になります。もし利用者が最新の開
発中ソースに対して変更を加えたならば、その変更をマスターソースツリーに
取り込むための作業は事実上要らなくなります。
<p>
また、そうすることでソフトウェアが開発されてすぐに広い範囲のテストをす
ることができます。NetBSD-currentの利用者は最新のソースについての<a
href="../../Misc/send-pr.html">バグレポート</a>を出すことが奨励されます。
これはバグを見つけたり修正したりする助けになります。ソフトウェアが書か
れてからすぐに多くの人がそれをテストするために、より多くのバグを見つけ
出して退治することができます。

</dd></dl>
<p><h3>
<a name="downloading">current のダウンロード</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
<a href="#using-anoncvs">anoncvs</a>を使ったり、 ftpで<a
href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-current/tar_files/src/">
ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-current/tar_files/src/</a>から、
あるいは <a href="ftp://ftp.netbsd.org/pub/NetBSD/README.sup">sup</a>
を使って -current のソースをダウンロードします。最寄りの<a
href="../../mirrors/">NetBSDミラーサイト</a>も
調べた方がいいでしょう。ダウンロード済のものをアップデートするには、
そのソースツリーのルートで '<code>cvs -q update -dP</code>'
を実行します。そのソースツリーが新しいものであっても、 cvs で
<code>-P</code> フラグを必ず使うようにしてください。
<p>
もし、NetBSD のソースに対するローカルな変更を追跡したいならば、
ローカルな CVS ツリーをセットアップし、<a href="#using-sup-into-cvs">sup 
で行なわれた変更を import</a> した方が良いでしょう。

</dd></dl>
<p><h3>
<a name="building">配布物の構築</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>

<em><a
href="http://cvsweb.netbsd.org/bsdweb.cgi/src/BUILDING">src/BUILDING</a> と
<a
href="http://cvsweb.netbsd.org/bsdweb.cgi/src/UPDATING">src/UPDATING</a> を見て、
最新の変更点を確認するのを忘れないようにしてください。</em>
<p>
ソースツリーのルートで '<code>./build.sh distribution -D DESTDIR
-R RELEASEDIR</code>' を実行します。ここで、 DESTDIR はフルインストールに十分な容量が、
RELEASEDIR には十分な tarfile 群があるものとします。完了すると、
インストールメディアとノートを含む、
インストールに必要なものがすべて出来上がります。
<p>
別のアーキテクチャー用にクロスコンパイルしたい場合は、
'<code>-a ARCH</code>' を追加します。より詳しくは
<a href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-current/src/BUILDING">BUILDING</a> ファイルを参照するか '<code>./build.sh -h</code>' を実行してください。

</dd></dl>
<p><h3>
<a name="updating">既存システムのアップデート</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
最初に新しいカーネルを構築してインストールすることが必要です。その後、
これに対応するようユーザーランドをアップデートします。
問題が起きたら、 <a href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-current/src/UPDATING">UPDATING</a> ファイルを参照してください。
<ul>
<li>toolchain を構築する。<br>
    ソースツリーのルートで、 '<code>./build.sh tools</code>'
    を実行します。これで、
    <code>tools/obj/tools.&lt;hostplatform&gt;/bin</code> に toolchain が構築されます。
<li>カーネルの構築とインストールをする:
    <ul>
    <li><code>./build.sh kernel=GENERIC</code></li>
    <li><code>mv /netbsd /onetbsd</code></li>
    <li><code>mv sys/arch/&lt;ARCH&gt;/compile/GENERIC/netbsd /</code></li>
    </ul>
<li>新しいカーネルでリブートする</li>
<li><code>./build.sh distribution</code> を実行する</li>
<li>最後に、新しいユーザーランドをインストールする: <code>./build.sh install=/</code></li>
<li>動作中のサービス群がすべて新しいバイナリーを使うようにするため、
リブートする (これはしなくてもよい)</li>
</ul>

</dd></dl>
<p><h3>
<a name="what-to-do">覚えておくべきこと</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
<ul>
 <li>
  より新しいバージョンの-currentにアップグレードするときは、どれかの新しい
  ライブラリー(<a href="#star">*</a>)をインストールする前に<em>必ず</em>
  新しいカーネルをコンパイルし、それで起動していなければなりません。
  一般的にもっともよいのは他のどれよりも先に新しいカーネルを試し、何か問
  題にぶつかったら(<a
  href="../kernel/#problems_compiling_a_current_kernel">
  カーネル FAQ</a>にある項目を御覧ください)新しいカーネルをインストールするのに
  必要な最小限のツールをコンパイルしてインストールするやりかたです。
  <p>
  カーネルが動き出したらソースツリーの一番上の BUILDING
  ファイルを一読し、 build.sh スクリプトを使って新しいユーザーランドを
  作るといいでしょう。
  <p>

 <li>
  -current のカーネルをコンパイルする際には、常に
  COMPAT_&lt;最新のリリース&gt; オプション (例えば COMPAT_14)
  を含めるのを忘れないでください。current が最新の安定版リリース
  からかけはなれていくと互換性のコードが加えられますが、
  このオプションが設定されている時だけ有効になります。
  少なくとも、この互換性のためのコードは、新しいカーネルをブートして、
  <tt>build.sh</tt> による構築が終了するまでは必要です。
  <p>

 <li>
  NetBSD-currentを使っている人は<b><a
  href="../../MailingLists/#current-users">current-users</a></b>
  メーリングリストを購読することを強く薦めます。<b><a
  href="../../MailingLists/#source-changes">source-changes</a></b>
  を読むのも興味深いでしょう。
</ul>
<p>

<a name="star">*</a>: もし新たなシステムコールが追加されていないことが
確かでなければ、とりあえずこうしてください。それがより安全です。

</dd></dl>
<p><h3>
<a name="build-targets">Makefileのいろいろなターゲットと実際の構築方法は?</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
もっとも明らかなターゲットは<a
href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-current/src/Makefile">/usr/src/Makefile</a>
の'make build'です。これは更新された'mk'ファイル、インクルードファイル、
ライブラリーをインストールして、それからシステムを再構築します。もしソー
スツリーを更新していれば、新しいシステムコールが追加されていたときのた
めに備えて、他のどれよりも<em>先に</em>カーネルをコンパイルしてインス
トールするべきです。他の便利なターゲットは<a
href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-current/src/share/mk/bsd.README">/usr/src/share/mk/bsd.README</a>
に記述されています。これは<tt>/usr/share/mk/</tt>にインストールされます。
'make build' を使った構築は、更新された toolchain に制約され続けてきており、
今はかなり使えなくなっています。
'build.sh' スクリプト (ソースディレクトリーの最上層にあります) を使った
新しい toolchain の使用に関する文書は、
<a href="ftp://ftp.netbsd.org/pub/NetBSD/NetBSD-current/src/BUILDING">BUILDING</a> ファイルに書かれています。

</dd></dl>
<p><h3>
<a name="using-anoncvs">anoncvs を用いた NetBSD-current の追跡</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>

<h4>セットアップ</h4>

<p>ここでは暗号化されていない anoncvs 接続について説明します。
  暗号化プロトコルを使いたい場合は、この説明を
  <a href="#using-anoncvs-over-ssh">こちらの説明</a>で置き換えてください。

<ol>
<li><a href="ftp://ftp.netbsd.org/pub/NetBSD/packages/pkgsrc/devel/cvs/README.html">cvs</a> をインストールします。<em>もし NetBSD が
2000-09-04 以降の -current のソースから構築されていれば、cvs はすでにインストールされています</em>
<p>

<li>環境変数 CVSROOT を お好きな anoncvs サーバーを指すように設定します。
      anoncvs サーバーとしては anoncvs.netbsd.org か、それの <a href="../../mirrors/#anoncvs">ミラー</a>を
      使用することができます:
<ul>
    <li><a href="http://man.netbsd.org/man/csh+1+NetBSD-current">csh(1)</a> または <a href="ftp://ftp.netbsd.org/pub/NetBSD/packages/pkgsrc/shells/tcsh/README.html">tcsh</a> ユーザーの方:<br>
    <tt><b>setenv CVSROOT :pserver:anoncvs@anoncvs.netbsd.org:/cvsroot</b>
    </tt><br>
    <li><a href="http://man.netbsd.org/man/sh+1+NetBSD-current">sh(1)</a>, <a href="http://man.netbsd.org/man/ksh+1+NetBSD-current">ksh(1)</a>, または <a href="ftp://ftp.netbsd.org/pub/NetBSD/packages/pkgsrc/shells/bash2/README.html">bash2</a> ユーザーの方:<br>
    <tt><b>CVSROOT=:pserver:anoncvs@anoncvs.netbsd.org:/cvsroot; export CVSROOT
    </b></tt>
    </ul><p></li>

<li>
    <tt><b>cd /usr</b></tt><br>
    <tt><b>cvs login</b></tt>                      (パスワードとして "anoncvs" を使用してください)<br>
最初の checkout の際にはディレクトリーに対する書き込み権限が必要です。
その後、ソースツリーの所有者を他のユーザーに変更できます。一つの方法は
最初のチェックアウトは root で行ない、その後の使用のために
ソースツリー全体を他のユーザーの所有に変更することです。
<p>

<li>カーネルのみをチェックアウトする<br>
    <tt><b>cvs checkout -P src/sys</b></tt><br>
これにより、カーネルのソースは <tt>/usr/src/sys</tt> に用意されます。
<a href="../kernel/#how_to_build_a_kernel">カーネルの作り方</a>に
関する情報は別のページで提供されています。
<p>

<li>ソースツリー全体をチェックアウトする(カーネルも含みます)<br>
    <tt><b>cvs checkout -P src</b></tt><br>
これにより、NetBSD ソースの全体が /usr/src に用意されます。
<p>

<li>パーミッションの修正<br>
    もしソースツリーを root 以外のユーザーの所有にしたければ
    (root で)次のようにして下さい。<br>
	<tt><b>chown -R <em>user</em> /usr/src</b></tt>
</ol>

<h4>ソースの更新</h4>

<tt><b>cd /usr/src</b></tt><br>
<tt><b>cvs update -dP</b></tt>
<p>
<b>注意:</b> <tt>cvs checkout -d dir src</tt> (あるいは、他の src*
モジュールに対する同様のコマンド) を実行しても動作しません。
"existing repository ... does not match ...; ignoring module _gnusrc-cmp"
等のエラーメッセージが出ます。回避するには、 <tt>-d</tt> オプションを外して
cvs がデフォルトのディレクトリーを作るようにします。
<p>

<h4>特定の日付のソースをチェックアウトするには次のようにして下さい</h4>
<tt><b>cvs checkout -D 20020501-UTC src</b></tt>

<h4>特定の枝のソースをチェックアウトするには</h4>
<tt><b>cvs checkout -rnetbsd-1-6 src</b></tt>
<p>
CVS リポジトリーに含まれる各ブランチの説明については、
<a href="http://cvsweb.netbsd.org/bsdweb.cgi/src/doc/BRANCHES?rev=HEAD&amp;content-type=text/x-cvsweb-markup">src/doc/BRANCHES</a>
を参照してください。

<h4>有用なヒント</h4>
<p>
<ul>
<li>ツリー内のあるブランチをチェックアウトしたい場合に、
このブランチ用に新しいディレクトリーを作って、既存のディレクトリーが上書きされないように
慎重を期したい方もいるでしょう:

<tt>
<pre>
	cd /parent/dir/to/checkout/into
	mkdir NewName-temp
	cd NewName-temp
	cvs checkout ... src
	mv src ../NewName
	cd ..
	rmdir NewName
</pre>
</tt>
</li>
<li>
cvs による更新が正しく実行できるようにするためには objdirs を
使用する必要があります。もし、cvs から
<pre>
   cvs [update aborted]: could not chdir to gnu/usr.bin/gdb/gdb: Not a directory
</pre>
のようなエラーメッセージを受けたならば、<b>"make cleandir"</b> を
実行して、もう一度試して下さい。cvs による更新の後、
<b>"make obj"</b>を実行するのを忘れないように。
</li>
<li>
使用している回線が非常に細い場合、コマンドラインでコマンドの<em>前に</em>
-z5 (あるいは 1 から 9の間の他の数字)をつけると良いかも知れません
(例 "<tt><b>cvs -z5 update -dP</b></tt>"); こうすると、
全てのデータは圧縮されて転送されます。これは、cvs サーバーにとっては、余分な
負荷を与えることを心に止めておいてください。
<p>

特定のコマンドに対するスイッチはホームディレクトリーの .cvsrc に
記述しておけば、自動的に使われます。.cvsrc ファイルの例を
掲げておきます。

<pre>
   cvs -q -z5
   update -dP
   checkout -P
   diff -u
</pre>
</li>
</ul>

<h4>ソースからの NetBSD の構築</h4>

<I>(すでに、最新の NetBSD バイナリースナップショットと /usr/src に
ソースがインストールされていると仮定します; また、 BSDOBJDIR は
/usr/obj であると仮定します。):</I><p>

はじめてユーザーランドを構築する場合:<p>

<tt><b>mkdir /usr/obj</b></tt><br>
<tt><b>cd /usr/src</b></tt><br>
<tt><b>./build.sh -E -O /usr/obj -T /usr/tools build</b></tt><br>
build.sh を使って初めてシステムの構築をする場合には、
この先でコンパイルに使うツール一式も構築されますので、
最初のコンパイルにかかる時間は長くなるでしょう。

<p>

CVS update の後、ユーザーランドのバイナリーを更新する場合:<p>

<tt><b>cd /usr/src</b></tt><br>
<tt><b>./build.sh -E -O /usr/obj -T /usr/tools -u build</b></tt>
<p>

これらによって、新しいバイナリーが実行されたシステムにインストールされます。
新しいバイナリーが全て有効になるようにリブートしてください。
バイナリーをどこか他の場所にインストールする(例えば、動作する環境をだいなしに
するのが嫌な場合)には
DESTDIR を別の値に設定すれば OK です。次のように実行してください:<p>

<tt><b>./build.sh -D /usr/NetBSD-new-build -O /usr/obj -T /usr/tools -u build</b></tt><br>

</dd></dl>
<p><h3>
<a name="using-anoncvs-over-ssh">anoncvs over ssh の利用</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
    <a href="#using-anoncvs">anoncvs の利用</a>で説明した方法は、取り寄せた
    ソースが正しいものであることを保証するため、 ssh 上でも使うことができます。
    <p>
    <a href="../../mirrors/#anoncvs">anoncvs ミラー
    一覧</a>に載っているサーバーでは、各項目ごとに、必要な情報を
    列挙しています。
    <p>
    anoncvs over ssh を使うには、 cvsroot の冒頭の ':pserver:' を削除し、
    お使いのシェルに応じた方法で、変数 CVS_RSH を 'ssh' に設定します。

</dd></dl>
<p><h3>
<a name="using-sup-into-cvs">SUP と CVS の組合せによる NetBSD-current の追跡</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
    <h4>概要</h4>

    <p>currentは次の方法により追跡できます。基準となるソースのコピーを、
       標準的にはほぼ週に一回SUPを使い最新の状態に維持します。そして、
       この基準となるソースツリーを、ローカルのCVSリポジトリーにインポー
       トします。そして、リポジトリーのコピーをチェックアウトし、それ
       からcurrentを作成します。

    <p>このアプローチには3つの主要な理由があります。
    <p>
    <ol>
      <li>いつどのようにcurrentが更新されたか追跡するため。</li>
      <li>ローカルの変更をほとんど自動的に更新されたcurrentソースにマー
        ジできるようにするため。</li>
      <li>構築するときの問題に備えて、いつもまったく変更していない
	NetBSD-currentのソースツリーがあることを保証するため。</li>
    </ol>
    
    <p>このアプローチの短所は、3つの独立のソースツリーのために、実際の
      currentの構築に必要な空きを含めないで、およそ150MBのディスクスペー 
      スが必要なところです。

    <h4>必要なもの</h4>
    <ul>
      <li>CVS 1.9かそれ以降(もし、あなたが 2000-09-04 以降の -current 
	を使用していればすでにインストールされていますし、
	そうでない場合は pkgsrcか、ソースから構築のどちらでも構いません)。
	マージが上手なのでCVS 1.10かそれ以降が望ましいでしょう。</li>
      <li>SUP</li>
      <li>Perl 5(任意)附属スクリプトのため</li>
    </ul>
    <h4>詳説</h4>
    <p>currentの追跡と構築は、6つの段階からなります:
    <p>
    <ol>
      <li>マスターソースツリーにSUPでソースを更新します。</li>
      <li>SUPしたファイルをCVSにインポートし、ソースの作業用コピーを更
        新します。</li>
      <li>作業用ソースとSUPしたソースとをマージします。</li>
      <li>currentを構築してインストールします。</li>
      <li>構築に成功したソースにタグをつけます。</li> 
    </ol>
    <h3>ソースのSUP</h3>
    <p>ソースは、どのNetBSD SUPサーバーからもSUP可能です。またSUPの出
      力は後の参照のためにファイルに保存するべきです。

    <h3>ソースのインポートとマージ</h3>
    <p>ソースのインポートは次のように行ないます:
    <tt><b>
    cvs -d /misc/cvsrep import -I ! -I CVS netbsd netbsd current-<i>date</i>
    </b></tt><br>
    <p><i>date</i>は追跡のためにSUP時の日付と置き換えます。
      <code>-I ! -I CVS</code> オプションは、
      ソースツリー中の 'CVS' ディレクトリーを除く全てのファイルが
      無視されないことを保証します。これはNetBSDのソースファイルに、通
      常CVSにより無視される拡張子のものがいくつかあるからです。もしロー
      カルのパッチと衝突がある場合、importコマンドはそれらを出力し、衝
      突をマージするためのコマンドを次のように出力します:<br>
    <tt><b>cvs checkout -jnetbsd:yesterday -jnetbsd netbsd</b></tt><br>
    <p>このマージコマンドは、インポートされたNetBSDソースを正確にマー
      ジするためのものですが、SUPにより削除されたファイルは、ローカル
      に反映されません。これを行なうためのマージコマンドはこうなるでしょ
      う:<br>
    <tt><b>cvs update -j<i>previous import tag</i> -j current-<i>date</i></b></tt><br>
    <p><i>previous import tag</i>は前回のCVSインポートで使用したタグ名
      と置き換えます。<i>date</i>は、今マージしたばかりのcurrentのイン
      ポートに使用したタグ名を利用できるようにするために、現在の日付と
      置き換えます。
    <p>importコマンドにより表示される衝突は、衝突の可能性のあるもので
      す。これらは、通常updateコマンドによりマージされますが、いくつか
      の場合、実際に衝突を引き起こします。この場合、衝突行を手動でマー
      ジすることが必要です。実際に衝突がある場合、cvs update時に、
      <code>C</code>に続きファイルネームが表示されます。
    <p>手作業による衝突のマージは単純作業ではありませんが、多くの場合、
      ファイルへ行なったローカルの変更を削除し、元のNetBSDソースコード
      に似せてやることで解決します。
    <p>CVSは衝突を次のように表します:
<pre>
&lt;&lt;&lt;&lt;&lt;&lt;
  <i>ローカルファイルのコード</i>
======
  <i>インポートしたファイルのコード</i>
&gt;&gt;&gt;&gt;&gt;&gt; <i>新たにインポートされるリビジョンのローカルリビジョン番号</i>
</pre>

    <p>もしimportコマンドが何の衝突を表示しない場合でも、チェックアウ
      トしたツリーのコピーは衝突した場合と同じ方法で更新できます。
    <p>updateとcheckoutコマンドはすべて、チェックアウトしたソースのディ
      レクトリーで行なってください。私のシステムでは、これは
      <code>/usr/src/netbsd</code>です。
    <p>もし、これが最初のインポートならば、チェックアウトしたソースは
      ないでしょう。'<code>/usr/src/netbsd</code>'にソースツリーを作り
      たいと仮定すると、次のコマンドでソースをチェックアウトします。マー
      ジ作業は必要ありません。<br>
    <tt><b>cd /usr/src</b></tt><br>
    <tt><b>cvs -d /misc/cvsrep checkout netbsd</b></tt>
    <h3>currentの構築</h3>
    <ol>
    <li>configure の後、<a href="../kernel/#how_to_build_a_kernel">
	カーネルの構築</a>を行ない、できた新しいカーネルでリブートします。
    <li>-current のソースツリーのベースディレクトリーに移動し、
	<tt>"<b>./build.sh -T /usr/tools -O /usr/obj </b>"</tt>
       とタイプします。
    <li>必要ならば、/etc の中のファイルに対する変更を merge します。
    </ol>

    <h3>構築に成功したものへのタグ付け</h3>
    <p> もし、構築がうまくいって動作するバイナリーセットを作成できたの
      ならば、動作するソースにタグ付けすることで使いやすくできます。こ
      れは、万一なにかの原因で構築できないcurrentツリーになっても、ひ
      とつのCVSコマンドで、構築できるツリーに巻き戻すことを可能にしま
      す。タグ付けは次のコマンドで行えます:<br>
    <tt><b>cvs tag successful-build-<i>build date</i></b></tt>
    <h4>註</h4>
    <ul>
      <li>もし、ファイル中の<b>$Net</b><b>BSD$</b>マーカーを認識する
        NetBSDカスタムバージョンのCVSを使用しない場
        合、ファイルのNetBSDリビジョン番号を、構築時に問題が起きた場合
        に参照の目的に使用することができます。</li>
      <li>上記のSUP/インポート/マージの作業は、まったく簡単に自動化で
        きます。以下のPerlスクリプトがこの作業を自動的に行ないます。
<pre>
#!/usr/pkg/bin/perl
#
# NetBSD-currentをSUPしてそれをCVSに取り込み、手元の変更とマージする
# スクリプト
#
# 原註:
# このスクリプトはエラー処理をしていないので、対話的でない用途には向い
# ていない。
#
# このスクリプトはcvs-1.10.1とcvs-1.9.18でのみテストされている。
#
$SRCROOT="/usr/src/netbsd";
$IMPORTROOT="/misc/import";
$CVSROOT="/misc/cvsrep";
# supを実行してその標準出力をperlに取り込む
system "/usr/sbin/sup -zsv" ; # ここは最新のシステム以外では変更する
                              # 必要がある

# 新しいファイルをCVSに取り込む

chdir $IMPORTROOT or die "Could not cd to $IMPORTROOT\n";

($sec,$min,$hour,$mday,$mon,$year,$wday,$yday,$isdst) = localtime;
$date = localtime;
$shortdate = sprintf "%02d%02d%04d",$mday,$mon+1,1900+$year;
system "/usr/local/bin/cvs -d$CVSROOT import -I ! -m\"SUP Import $date\" netbsd netbsd current-$shortdate ";

# 作業ディレクトリーを手元のNetBSDソースツリーにする
chdir $SRCROOT or die "Could not change to $SRCROOT diectory\n";

# 取り込みを始める
$lastimport = `cat /usr/src/netbsd/.tag`; # `はバッククォート
$lastimport =~ s/\n//; # 文字列の終りの改行をすべて取り去る
system "/usr/local/bin/cvs update -j $lastimport  -j
current-$shortdate ";
# tag保存ファイルに最新のファイルを書き込む
open TAG,"&gt;$SRCROOT/.tag" or die "Could not open new tag file";
 print TAG "current-$shortdate";
close TAG;
    </pre> 
    <p>このスクリプトは作者がもっともよく使っているスクリプティングツー
          ルであるという理由からPerlでかかれていますが、同じことをする
          shellスクリプトを書くのはとても簡単でしょう。</li>
      <li>CVSを用いてcurrentを追跡するテクニックについてはNetBSDの
        current-usersメーリングリストで何度か議論されています。他のテ 
        クニックについてはNetBSDメーリングリストを検索してみてください。</li>
    </ul>
    <p>
    何かコメントや提案があれば、この部分を担当しているMike Pumford <a
    href="mailto:mpumford@black-star.demon.co.uk">
    mpumford@black-star.demon.co.uk</a>(訳註:英語で)、または<a
    href="mailto:www@jp.netbsd.org">www@jp.netbsd.org</a>までメイルし
    てください。

</dd></dl>
<p><h3>
<a name="getrepos">リポジトリー全体の入手</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>

以上で説明した方法では、あなたが独自に行なった変更を自分用のリポジトリーに
保存することができます。これは、あなたが NetBSD をもとにしたソフトウェアの
開発をしている場合には便利でしょう。あなたが自分の CVS リポジトリーの
保守をしているわけでなく、単に NetBSD の CVS リポジトリーをミラーしたい
だけならば、それ用の方法が三つあります。
<p>

以下に簡単に説明するいずれの方法でも、 NetBSD CVS リポジトリーのコピー
(つまり、チェックアウトされたファイルでは*なく*、 RCS の ,v ファイル)
を取得できます。その後は、自分の anoncvs サーバーをセットアップしたり、
ローカルハードディスクにチェックアウトしたりできます。また、
リポジトリーに記録されている履歴にすぐにアクセスするのにも便利です。
<p>

リポジトリー全体を取得する方法は、次のとおりです:

<dl>
<dt> sup: 
<dd> すでに sup を使って NetBSD のソースの一部をミラーしている場合は、
     sup の設定ファイルに下記の行を追加します:
<pre>
anoncvs release=all  host=sup.netbsd.org hostbase=/ftp/pub base=/usr prefix=/usr backup use-rel-suffix compress
</pre>
     それから、 "sup /path/to/supfile anoncvs" を実行してファイルを取得します。
     <p>

     sup ファイルの例が <tt>/usr/share/examples/supfiles</tt> にいくつかあります。
     また、 <a href="../../mirrors/#sup">SUP ミラーのリスト</a> で、
     あなたの近所のサーバーを探すようにしてください。

<dt> ftp:
<dd> お好みのミラープログラム (たとえば <a href="ftp://ftp.netbsd.org/pub/NetBSD/packages/pkgsrc/net/mirror/README.html">mirror</a>) をセットアップし、
     ftp://ftp.netbsd.org/pub/NetBSD-cvs/main/ からファイルを取得します。
     <p>

     <a href="../../mirrors/#ftp">FTP ミラーのリスト</a>をご覧ください !
<dt> rsync:
<dd> rsync は rsync サーバーに大きな負荷をかけることに注意してください。
     このため、同時に利用できる rsync ユーザー数に制限があります。それでもなお
     rsync したい場合、リポジトリー取得のコマンドは次のとおりです:
     
<pre>
rsync -v -a rsync://rsync.netbsd.org/anoncvs/
</pre>

     <a href="../../mirrors/#rsync">rsync ミラーのリスト</a>をご覧ください !
<dt> cvsup:
<dd> M3 コンパイラーが移植されていないため、現在、 CVSup はすべての NetBSD
    アーキテクチャーで使えるわけではありません。 i386 では、 <a href="ftp://ftp.netbsd.org/pub/NetBSD/packages/pkgsrc/devel/cvsup/README.html">cvsup</a>
     パッケージと下記の設定ファイルを使って、 cvsup.de.netbsd.org から
     リポジトリーをミラーできます:
<pre>
*default host=cvsup.de.netbsd.org
*default base=/usr
*default prefix=/local/NetBSD-cvs
*default release=cvs
*default delete use-rel-suffix
*default compress

netbsd
</pre>
     <p>

     <a href="../../mirrors/#cvsup">CVSup ミラーのリスト</a>をご覧ください!
</dl>

</dd></dl>
<p><h3>
<a name="error">エラーが出た場合は ?</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
スナップショットや以前の -current をもとに -current の構築をしようとして
うまくいかなくても、慌てないでください。次の手順を踏んでみてください:
<ol>
<li>構築をしようとしているリリースの <a
    href="http://cvsweb.netbsd.org/bsdweb.cgi/src/UPDATING">UPDATING</a>
    ファイルを読みます。
<li>手がかりを得るために <a
    href="http://mail-index.netbsd.org/current-users/">current-users
    アーカイブ</a>を読みます。
<li>再度アップデートします。関連あるファイル群のコミットの合間に
    リポジトリーを受け取っていた可能性もありますし、あるいは問題が修正
    されているかもしれません。
<li>どれも失敗した場合、 current-users にメールを送って、
    問題を説明してください。これには、日付、時刻、 -current のソースの
    入手方法と、あなたが加えた変更点をすべて含めてください。それから、
    出たエラーメッセージを含む<b>短い</b>スクリプトを入れてください。
    おそらく、誰かがすぐに問題を解決してくれるでしょう。
</ol>

</dd></dl>
<p><h3>
<a name="etcupdate">etcupdate を使った設定ファイルと起動ファイルの更新</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>

<h4>概観</h4>

etcupdate は、オペレーティングシステムのアップグレード後の、 /dev、 /etc、
/root 以下の新しい設定ファイルや起動ファイル (つまり、 etc.tgz
配布セットに含まれるファイル) の比較・マージ・インストールを
手伝ってくれるスクリプトです。オペレーティングシステムのアップグレードは、
ソースからのコンパイル、バイナリー配布物の展開の、いずれの方法でも
おこなうことができます。

<h4>etcupdate のインストール</h4>

<ol>
<li>etcupdate の最新バージョンを入手します
<pre>
# <b>cd /usr/pkgsrc/sysutils</b>
# <b>cvs update -dP etcupdate</b>
</pre>

<li>pkgsrc からインストールします
<pre>
# <b>cd /usr/pkgsrc/sysutils/etcupdate</b>
# <b>make install clean</b>
</pre>
</ol>

<h4>ソースファイルに etcupdate を使う</h4>

ソースが /usr/src 以下に置かれている場合は、
下記のコマンドで十分なはずです:

<pre>
# <b>etcupdate</b>
</pre>

しかし、 NetBSD のソースがこれ以外の場所、たとえば /home/jdoe/netbsd/src
にある場合はどうでしょうか? 案ずることはありません。ソースツリーの場所を
-s srcdir を使って etcupdate に教えてやれば、うまくいきます:

<pre>
# <b>etcupdate -s /home/jdoe/netbsd/src/etc</b>
</pre>

<h4>バイナリー配布セットに etcupdate を使う</h4>

時には、ソースが用意されていないけれども設定ファイルや起動ファイルを
更新したいときがあるでしょう。この場合の解決法は、必要な配布セット
(少なくとも etc.tgz) を展開し、 -b srcdir を使って etcupdate に
「ソースはなく公式配布セットがあるだけである」ことを伝えます。

<pre>
# <b>mkdir /tmp/temproot</b>
# <b>cd /tmp/temproot</b>
# <b>tar xpzf /some/where/etc.tgz</b>
# <b>etcupdate -b /tmp/temproot</b>
</pre>

<h4>さらなる読みもの</h4>

設定ファイルと起動ファイルの更新に関する
<a href="http://www.bsdtoday.com/2001/December/Features605.html">BSD Today
の記事</a>を、併せてお読みになることをおすすめします。

</dd></dl>
<hr>
<h2>特定の問題</h2><hr>
<p><h3>
<a name="wscons">wsconsにアップデートした後コンソールが使えない</a>
<font size="-1">(<a href="#top">top</a>)</font>
</h3><dl><dt><dd>
以下の手順が必要です。<a
href="ftp://ftp.jp.netbsd.org/pub/NetBSD/NetBSD-current/src/etc/">src/etc</a>
にある適切なetc.<i>port</i>ディレクトリーから最新のMAKEDEVファイルを
<tt>/dev</tt>にコピーしてシングルユーザーで起動してください。そのあと
以下をタイプします:
<ul>
<li>fsck -p
<li>mount -vt nonfs
<li>cd /dev
<li>./MAKEDEV wscons
</ul>

</dd></dl>
<hr>

<table width="100%"><tr><td>
  <table><tr><td>
    <a href="../../"><img
	src="../../../images/NetBSD-flag.gif" origlink="../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../"><img
	src="../../../images/empty.gif" origlink="../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">ホームページ</a>
  </td></tr></table>
</td><td>
  <table><tr><td>
    <a href="../../Documentation/"><img
	src="../../../images/NetBSD-flag.gif" origlink="../../images/NetBSD-flag.gif" border="0"
	width="91" height="42" alt=""></a>
  </td><td>
    <a href="../../Documentation/"><img
	src="../../../images/empty.gif" origlink="../../images/empty.gif" border="0"
	width="1" height="1" alt="NetBSD ">Documentation top level</a>
  </td></tr></table>
</td></tr></table>

<hr>
<address>
  <small>
  (連絡先 - <a href="http://www.netbsd.org/cgi-bin/feedback.cgi">英語</a>,
       <a href="mailto:www@JP.NetBSD.ORG">日本語:
       www@JP.NetBSD.ORG</a>)<br>
  $NetBSD: index.html,v 1.42 2003/03/08 19:44:16 grant Exp $<br>
  <a href="../../Misc/disclaimer.html">Copyright &copy; 1994-2003
    The NetBSD Foundation, Inc.  ALL RIGHTS RESERVED.</a>
  </small>
</address>

</body>
</html>
