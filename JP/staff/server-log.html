<HTML>
<HEAD>
<TITLE>JP.NetBSD.ORG server log</TITLE>
</HEAD>

<BODY>
<H1>JP.NetBSD.ORG計算機上での作業記録その他</H1>

<H2>pigu.iri.co.jpでの作業記録</H2>
<UL>分類
  <LI><A HREF="#mailinglist">Mailing List</A></LI>
  <LI><A HREF="#ftp">ftp</A></LI>
  <LI><A HREF="#rsync">rsync</A></LI>
  <LI><A HREF="#sup">sup</A></LI>
  <LI><A HREF="#news">news</A></LI>
  <LI><A HREF="#anoncvs">anoncvs</A></LI>
  <LI><A HREF="#httpd">httpd</A></LI>
</UL>

<H2><A NAME="mailinglist">[Mailing List]</A></H2>
<UL>まだindexからlinkとかは張らない
 <LI>MHonARCでML archiveのhtml化(www-changes-ja) 1999/2/26 - ichiro<br>
 	<A HREF="http://www.jp.netbsd.org/ja/JP/ml/www-changes-ja/index.html">http://www.jp.netbsd.org/ja/JP/ml/www-changes-ja/index.html</A><br>
 	テスト的にwww-changes-jaをhtml化. html&search対象MailingListの選定は??</LI>
 <LI>MHonARCでML archiveのhtml化 1999/4/26 - ichiro</LI>
    <UL>
	<LI><A HREF="http://www.jp.netbsd.org/ja/JP/ml/admin-ja/index.html">http://www.jp.netbsd.org/ja/JP/ml/admin-ja/index.html</A>
	<LI><A HREF="http://www.jp.netbsd.org/ja/JP/ml/announce-ja/index.html">http://www.jp.netbsd.org/ja/JP/ml/announce-ja/index.html</A>
	<LI><A HREF="http://www.jp.netbsd.org/ja/JP/ml/hpcmips-changes-ja/index.html">http://www.jp.netbsd.org/ja/JP/ml/hpcmips-changes-ja/index.html</A>
	<LI><A HREF="http://www.jp.netbsd.org/ja/JP/ml/port-mips-ja/index.html">http://www.jp.netbsd.org/ja/JP/ml/port-mips-ja/index.html</A>
	<LI><A HREF="http://www.jp.netbsd.org/ja/JP/ml/port-powerpc-ja/index.html">http://www.jp.netbsd.org/ja/JP/ml/port-powerpc-ja/index.html</A>
	<LI><A HREF="http://www.jp.netbsd.org/ja/JP/ml/tech-pkg-ja/index.html">http://www.jp.netbsd.org/ja/JP/ml/tech-pkg-ja/index.html</A>
	<LI><A HREF="http://www.jp.netbsd.org/ja/JP/ml/staff/index.html">http://www.jp.netbsd.org/ja/JP/ml/staff/index.html</A>
		staff-mlはとりあえずアクセス制限付<br>
    </UL>	
 <LI>Namazu<A HREF="http://www.jp.netbsd.org/ja/JP/ml/search.html">全文検索</A> 1999/4/26 - ichiro</LI>
 <LI>MHonARC 2.4.6+patch, mlist2html 0.07 にversion up 2000/9/17- ichiro</LI>

 <LI>Mailing List 作成方法
    <UL>
    <LI>オープンなmlの場合(設定が異なる場合は、ezmlm-makeのoptionを変更する)
<PRE>
su; csh;
setenv NEWML メーリングリスト名
~ezmlm/ezmlm-make -aiklnpr -5 staff@jp.netbsd.org \
	/var/mlist/ml/${NEWML} \
	/var/qmail/alias/.qmail-${NEWML} \
	${NEWML} jp.netbsd.org
cd /var/mlist/ml/port-mips-ja
tar cf - charset header* msgsize sequence | ( cd ../${NEWML}; tar xpvf -)
cd ..
chown -R alias ${NEWML}
chmod 711 ${NEWML}
chmod 755 ${NEWML}/archive

su -m alias
~ezmlm/ezmlm-sub /var/mlist/ml/${NEWML} ${NEWML}-html@pigu.iri.co.jp
echo "|/usr/local/bin/mlist2html /var/mlist/html ${NEWML} || exit 0" > /var/qmail/alias/.qmail-${NEWML}-html
mkdir /var/mlist/html/${NEWML}
chmod 755 /var/mlist/html/${NEWML}
cp /var/mlist/html/.[fh]* /var/mlist/html/${NEWML}
</PRE>
    <LI>投稿者を参加者に制限する場合<BR>
この場合はenvelope-fromを見て制限するので使用に注意すること。
<PRE>
~ezmlm/ezmlm-make -aiklnpru /var/mlist/ml/${NEWML} \
	/var/qmail/alias/.qmail-${NEWML} \
	${NEWML} jp.netbsd.org
</PRE>
すでに作成されたMLの場合はoptionに'e'を加える。
<PRE>
~ezmlm/ezmlm-make -eaiklnpru /var/mlist/ml/${NEWML}
</PRE>
    <LI>htdocs/JP の ml.html と search.html、
        localsrc/namazu-index の NMZ.foot.ja と etc/daily.sh に
	作成したmailing listを追加する。
    <LI>annount-ja,members-jaなどに告知。htdocs/JP の index.html,news.htmlに追加
    </UL>
</UL>

<H2><A NAME="ftp">[ftp]</A></H2>
<UL>
 <LI>
</UL>

<H2><A NAME="rsync">[rsync]</A></H2>
<UL>
 <LI>
</UL>

<H2><A NAME="sup">[sup]</A></H2>
<UL>
 <LI>概要
   <P>
   現在 ftp/sup/rsync で提供している内容のうち、cvsリポジトリを除く全
   ては、sup で取得しています。(cvsリポジトリはrsyncで取得しています。)
   </P>

 <LI>クライアント設定
   <P>
   <DL>
   <DT><STRONG>/etc/supfiles/coll.list</STRONG><DD>
<PRE>
mirror	release=all-export host=sup.NetBSD.ORG hostbase=/ftp/pub base=/etc/supfiles prefix=/ftp/pub/NetBSD use-rel-suffix old delete
</PRE>
   </DL>
   この設定で、「sup -s」を使って sup しています。
   <P>
   sup のクライアントの運用には、注意が必要です。sup が失敗した場合、
   /etc/supfiles/sup/mirror/last.all-export の内容が obsolete になるので、
   再生成してやる必要があります (ほとんどバグ)。
   ftp/sup サーバーの場合、本家と同一の内容であり、ローカルに生成したファ
   イルはない筈ですから、下記のコマンドで再生成できます。
<PRE>
cd /ftp/pub/NetBSD
find . -print | sed 's:^\./::' >/etc/supfiles/sup/mirror/last.all-export
</PRE>

   /etc/supfiles/sup の下は、かなり大きくなるので、実体は /var の下に
   持ってます。
   </P>
 
 <LI>サーバー設定
   <P>
   <DL>
   <DT><STRONG>/etc/supfiles/coll.dir</STRONG><DD>
<PRE>
anoncvs		/ftp/pub
current		/ftp/pub
release		/ftp/pub
mirror		/ftp/pub
</PRE>

   <DT><STRONG>/etc/supfiles/coll.host</STRONG><DD>
<PRE>
anoncvs		サーバーのホスト名
current		サーバーのホスト名
release		サーバーのホスト名
mirror		サーバーのホスト名
</PRE>
   </DL>
   <P>
   この設定の場合、SUP サーバーの list ファイルの設定は
   <UL>
   <LI> /ftp/pub/sup/コレクション名/releases
   <LI> /ftp/pub/sup/コレクション名/list/リリース名
   </UL>
   を参照することになります（上述の coll.dir ファイルの設定の結果です）。
   これらの設定ファイルに関しては、下記のようにして、本家から ftp で
   ミラーしています。
<PRE>
supconf=ftp://ftp.netbsd.org/pub/sup
hostbase=/ftp/pub

cd $hostbase &&
wget --no-host-directories --cut-dirs=1 --mirror \
	$supconf/mirror/releases \
	$supconf/mirror/list \
	$supconf/mirror/list.export \
	$supconf/anoncvs/releases \
	$supconf/anoncvs/list \
	$supconf/current/releases \
	$supconf/current/list \
	$supconf/release/releases \
	$supconf/release/list
</PRE>
   <P>
   「sup -s -v」および上記の releases/list 設定ファイルのミラー後、
   「supscan -s」を実行して、ファイルの更新時刻情報をキャッシュして
   います。キャッシュは、上記の releases ファイルの設定の結果、
	/ftp/pub/sup/コレクション名/scan/リリース名
   に生成されます。
</UL>

<H2><A NAME="news">[news]</A></H2>
<UL>
 <LI>
</UL>

<H2><A NAME="anoncvs">[anoncvs]</A></H2>
<UL>
  <LI>CVS Repository
  <TABLE>
    <TR><TH>cvs.netbsd.org <TD>/ftp/pub/NetBSD-cvs
	<TD>~mirror/etc/mirror.anoncvsでrsync
	<TD>/cvs/cvsroot
    <TR><TH>jp.netbsd.org <TD>/ftp/pub/NetBSD-jp/cvs
	<TD>moguからrsync
	<TD>/cvs/jproot
  </TABLE>
  <LI>anoncvs serverは localsrc/pserver + patched cvs-1.10。<BR>
	inetdよりpserver起動後 /ftpにchrootして user anoncvsで動作。<BR>
	/ftp/cvs/{cvsroot,jproot}
  <LI>cvswebは localsrc/cvsweb。README.piguのように/var/wwwに置く。<BR>
	cp -p /var/www/cvsweb/cvsweb.cgi /var/www/cgi-bin
</UL>

<H2><A NAME="httpd">[httpd]</A></H2>
<UL>
 <LI>apache 1.3.3 導入 (1998/11/2 - kawamoto)<BR>
   pkgではなく、ソースからコンパイル（あまり理由なし）。<BR>
   <TT>./configure --prefix=/var/www --compat</TT>
 <LI>apache 1.3.4 (1999/1/29 - kawamoto)<BR>
   <TT>./configure --prefix=/var/www --with-layout=Apache</TT>
 <LI>apache 1.3.6 (1999/4/14 - kawamoto)
 <LI>基本設定
 <UL>
  <LI>/var/wwwの下にインストール。
  <LI>設定ファイルは/etc/www/の下（/var/www/confからのシンボリックリンク）。
  <LI>web documentsは/htdocsの下。/htdocsの内容もどこかに書かないと。
  <LI>/var/www/bin/dailyがroot権限で0時0分に実行される。ログファイルのrotate。
  <LI>/etc/www/crontabという内容がhttpd権限で2時間ごとに実行される。
      cvs update。
 </UL>
 <LI>cvsweb.netbsd.org追加 (1998/8/23 - kawamoto)
 <UL>
  <LI>VirtualHostを設定。
      cvsweb.netbsd.orgの時は、/から/cgi-bin/cvsweb.cgiへRedirect。
 </UL>
 <LI>VirtualHost設定時の注意点
 <UL>
  <LI>&lt;VirtualHost ...&gt; &lt;/VirtualHost&gt;へ入れる項目は、
      外では定義しないこと。入れるなら全部入れる。
 </UL>
 <LI>mod_rewriteを追加 (1998/8/25 - kawamoto)
 <UL>
  <LI>src/Configuration.tmplのAddModule .../mod_rewrite.oを生かす。
  <LI>/ja/以下で/ja/JP/以外について、ファイル存在チェックのルールを追加。
 </UL>
 <LI>apache 1.3.9 (1999/9/14 - kawamoto)
 <LI>apache 1.3.17 (2001/2/20 - kawamoto)
 <UL>
  <LI>AddCharsetがエラーになるので消す。mod_mimeはあるのに何で?
 </UL>
</UL>

<H2>pigu.iri.co.jpのアカウント申請</H2>
<UL>
  <LI>admin-jaで作業内容を申告する</LI>
  <LI>su rootに必要なpasswd entry or skeyを渡す</LI>
  <LI>pigu -> moguのsshは、UsePriviledgedPort noする</LI>
</UL>

<H5>
$Id: server-log.html,v 1.18 2001/02/20 01:47:36 kawamoto Exp $
</H5>
</BODY>
</HTML>
