
		 NetBSD Security Advisory 2003-003
		 =================================

トピック:	file(1) におけるバッファーオーバーフロー問題
                (Buffer Overflow in file(1)

バージョン:	NetBSD-current:	2003 年 2 月 27 日より前のソース
		NetBSD 1.6:	影響あり
		NetBSD-1.5.3:	影響あり
		NetBSD-1.5.2:	影響あり
		NetBSD-1.5.1:	影響あり
		NetBSD-1.5:	影響あり

影響範囲:	file(1) を実行させることができれば、その実行したユーザーの権限で
                任意のコードを実行させることができる危険性がある。
                (Inducing a user to run file(1) could execute code as the user)

		Amavis antivirus を使っているユーザーは、リモートからの攻撃を
		許す可能性がある
		(Amavis antivirus users are remotely vulnerable)

修正日:		NetBSD-current:		2003 年 2 月 26 日
		NetBSD-1.6 branch:	2003 年 3 月 8 日 (1.6.1 は修正ずみ)
		NetBSD-1.5 branch:	2003 年 3 月 9 日 (1.5.4 は修正ずみ)


概要 - Abstract
===============

攻撃者は、ある特殊な細工を施した ELF ファイルに対して file(1) が
実行された時に発生するスタックオーバフローを悪用し、その file(1) を
実行したユーザーの権限を不正に獲得できる可能性があります。

注意:  Amavis antivirus scanner のユーザーは、このオーバフローを
       リモートから悪用される危険性があります。Amavis は file コマンドを
       使ってデーターのスキャンを行なうためです。攻撃者は、Amavis を
       実行している UID の権限を不正に得ることができる可能性があり、
       多くのメールサーバーでは、これがメール受信者の権限になるように
       設定されています。つまり、Amavis でメールをスキャンするように
       設定されているユーザーのアカウントすべてが脅威に晒される可能性
       があります。


技術的な詳細 - Technical Details
================================

file(1) プログラムにバッファーオーバーフロー問題が発見されました。
ユーザーが特殊な細工が施された ELF ファイルに対して file(1) を実行すると、
その際に攻撃者が仕込んだ任意のコードが実行される危険性があります。
したがって攻撃者は、自分が内容を操作できるファイルに対して file(1) を
実行するようにユーザーを仕向けることで、そのユーザーがシステム上で
持っている権限を不正に獲得できるかも知れません。

詳細は iDEFENSE Security Advisory 03.04.03 をご覧ください。
http://www.idefense.com/advisory/03.04.03.txt


回避方法と解決策 - Solutions and Workarounds
============================================

Amavis antivirus を使っている場合は、下に示す方法でただちに file(1) を
アップグレードしてください。すぐにアップグレードできない場合は、
Amavis を停止するか、file(1) を更新するまで、外から来るメールを
受けとらないようにしてください。

NetBSD セキュリティーオフィサーは、このセキュリティー勧告について
NetBSD-1.6 用のバイナリーパッチを提供しています。バイナリーパッチを
提供するのは、この勧告が初めてです。ぜひ、使い心地に関するご意見・ご感想を
security-officer@netbsd.org までお寄せください。

バイナリーパッチの適用手順は、下の NetBSD-1.6 の項で説明しています。

次に示す手順は、ソースツリーを更新して再構築し、新しいバージョンの
file(1) をインストールすることで、file(1) バイナリーをアップグレード
する方法を説明したものです。

* NetBSD-current:

        2003 年 2 月 27 日より前の NetBSD-current は、
        2003 年 2 月 27 日、もしくはそれ以降の NetBSD-current に
        アップグレードする必要があります。

        CVS ブランチ netbsd-current (別名 HEAD) において
        更新が必要なファイルは、次のとおりです。
		src/usr.bin/file/readelf.c:	1.17
		src/usr.bin/file/softmagic.c:	1.31

        CVS を使ってファイルを更新し、再構築・再インストールするには、
        次のコマンドを実行してください。
		# cd src
		# cvs update -d -A -P usr.bin/file
		# cd usr.bin/file

		# make cleandir dependall
		# make install


* NetBSD 1.6:

        NetBSD 1.6 のバイナリー配布物には、このセキュリティー上の弱点が
        含まれています。

	* バイナリーパッチ

	バイナリーパッチの適用は、次の手順で行ないます。
	ARCH の部分は、あなたが実行している NetBSD のアーキテクチャー
	(たとえば i386 など) に置き換えてください。

	ftp://ftp.netbsd.org/pub/NetBSD/security/patches/SA2003-003-file/netbsd-1-6/ARCH-file.tgz
	cd / && tar xzvf /path/to/ARCH-file.tgz

	この tar ファイルは、新しい /usr/bin/file を展開し、
	弱点を持ったバイナリーを上書きします。

	* ソースパッチ

        2003 年 3 月 9 日より前の NetBSD 1.6 は、
        2003 年 3 月 9 日、もしくはそれ以降の NetBSD 1.6 に
        アップグレードする必要があります。

        NetBSD 1.6.1 には、この弱点に対する修正が含まれる予定です。

        CVS ブランチ netbsd-1-6 において
        更新が必要なファイルは、次のとおりです。
		src/usr.bin/file/readelf.c:	1.13.2.1
		src/usr.bin/file/softmagic.c:	1.26.2.1

        CVS を使ってファイルを更新し、再構築・再インストールするには、
        次のコマンドを実行してください。

		# cd src
		# cvs update -d -r netbsd-1-6 -P usr.bin/file
		# cd usr.bin/file

		# make cleandir dependall
		# make install


* NetBSD 1.5, 1.5.1, 1.5.2, 1.5.3:

        NetBSD 1.5 のバイナリー配布物には、このセキュリティー上の弱点が
        含まれています。

        2003 年 3 月 10 日より前の NetBSD-1.5, 1.5.1, 1.5.2, 1.5.3 は、
        2003 年 3 月 10 日、もしくはそれ以降の NetBSD-1.5.* に
        アップグレードする必要があります。

        CVS ブランチ netbsd-1-5 において
        更新が必要なファイルは、次のとおりです。
		src/usr.bin/file/readelf.c:	1.6.4.3
		src/usr.bin/file/softmagic.c:	1.18.4.2

        CVS を使ってファイルを更新し、再構築・再インストールするには、
        次のコマンドを実行してください。
		# cd src
		# cvs update -d -r netbsd-1-5 -P usr.bin/file
		# cd usr.bin/file

		# make cleandir dependall
		# make install


謝辞 - Thanks To
================

Lubomir Sedlacik 氏および Antti Kantee 氏: このセキュリティー上の弱点が
問題であることを指摘してくれました。

Christos Zoulas 氏: 解決方法とこの勧告をまとめる作業に協力してくれました。

Chuck Yerkes 氏: Amavis が file(1) を使っていることを指摘してくれました。


改訂履歴 - Revision History
===========================

	2003-03-12	初版公開
        2003-03-12      Amavis に関する情報を更新
        2003-03-13      Amavis に関する情報を更新し、バイナリーパッチを追加


詳細と参考資料 - More Information
=================================

新しい情報が判明した場合、セキュリティー勧告は更新されることがあります。
PGP 署名されたこの勧告の最新版は、次の場所から入手できます。
  ftp://ftp.netbsd.org/pub/NetBSD/security/advisories/NetBSD-SA2003-003.txt.asc

NetBSD と、NetBSD のセキュリティーに関する情報は、次の場所から入手できます。
http://www.NetBSD.ORG/ and http://www.NetBSD.ORG/Security/.


Copyright 2003, The NetBSD Foundation, Inc.  All Rights Reserved.
Redistribution permitted only in full, unmodified form.

$NetBSD: NetBSD-SA2003-003.txt.asc,v 1.3 2003/03/29 03:33:50 yyamano Exp $
