<!-- $NetBSD: getting.xml,v 1.24 2009/05/13 10:49:00 wiz Exp $ -->
<!-- Based on english version: -->
<!-- NetBSD: getting.xml,v 1.24 2009/05/13 10:49:00 wiz Exp   -->

<chapter id="getting">
<title>どこからpkgsrcを得て、どうやって最新に保つか</title>

<para>ファイルをダウンロードして展開する前に、
ファイルを展開する場所を決めておく必要があります。
pkgsrc を root ユーザーとして使う場合、pkgsrc は通常は
<filename>/usr/pkgsrc</filename> にインストールされます。
ソースおよびバイナリーパッケージは、
ファイルシステム中のどこでも好きな場所にインストールしてかまいませんが、
シェルその他のプログラムにとって特別な意味を持つスペースなどの文字は、
パス名に含めてはいけません。
アルファベット、数字、下線とダッシュだけを使うのが安全な方法です。</para>

<sect1 id="getting-first">
<title>pkgsrc を初めて入手する</title>

	<para>pkgsrc のファイルをダウンロードする前に、
	<emphasis>current</emphasis> 枝と <emphasis>stable</emphasis>
	(安定版) 枝のどちらを使うのかを決めます。
	後者は、current 枝から四半期ごとに分岐するもので、
	セキュリティー上の更新に限って修正されます。
	stable 枝の名前は、年と四半期を組み合わせたもので、たとえば
	<literal>2009Q1</literal> となります。</para>

	<para>次に、pkgsrc を<emphasis>どの方法で</emphasis>
	ダウンロードするかを決めます。方法としては、tarファイル、SUP経由、
	CVS経由があります。ここではこの三つとも説明します。</para>

<sect2 id="getting-via-tar">
<title>tar ファイル</title>

	<para>pkgsrc のあらゆるファイルの一次配布元は
	<ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/"/> です。
	目的別に多数のサブディレクトリーがありますが、
	それについては <xref linkend="ftp-layout"/> で詳しく説明しています。</para>

	<para>current 枝の tar ファイルは、
	<filename>current</filename> ディレクトリー内にあり、ファイル名は <ulink
	url="ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz"><filename>pkgsrc.tar.gz</filename></ulink> です。
	このファイルは、毎日、自動生成されます。</para>

	<para>安定版の 2009Q1 枝の tar ファイルは、
	<filename>pkgsrc-2009Q1</filename> ディレクトリー内にあり、ファイル名は同じく <ulink
	url="ftp://ftp.NetBSD.org/pub/pkgsrc/pkgsrc-2009Q1/pkgsrc-2009Q1.tar.gz"><filename>pkgsrc-2009Q1.tar.gz</filename></ulink> です。</para>

	<para>安定版 pkgsrc の tarball をダウンロードするには、以下のコマンドを実行します。</para>

<screen>
&uprompt; <userinput>ftp ftp://ftp.NetBSD.org/pub/pkgsrc/<replaceable>pkgsrc-200xQy</replaceable>/<replaceable>pkgsrc-200xQy</replaceable>.tar.gz</userinput></screen>

	<para>ここで、<replaceable>pkgsrc-200xQy</replaceable> は、
	ダウンロードする安定版の枝名にします。たとえば、
	<quote>pkgsrc-2009Q1</quote> になります。</para>
<!--
	<para>tar ファイルをダウンロードしたら、
	pkgsrc を置く場所のディレクトリーへ移動します。
	ふつうは <filename>/usr</filename> です。
	次に、<command>gzcat
	pkgsrc.tar.gz | tar xf -</command> を実行してファイルを展開します。</para>
-->
	<para>ダウンロードしたら、以下のようにして展開します。</para>

<screen>&uprompt; <userinput>tar -xzf <replaceable>pkgsrc-200xQy</replaceable>.tar.gz -C /usr</userinput></screen>

	<para>こうすると、<filename>/usr/</filename> に
	<filename>pkgsrc/</filename> ディレクトリーが作られ、
	<filename>/usr/pkgsrc/</filename> 以下に全パッケージのソースが置かれます。</para>

	<para>pkgsrc-current をダウンロードするには、以下のコマンドを実行します。</para>

<screen>&uprompt; <userinput>ftp ftp://ftp.NetBSD.org/pub/pkgsrc/current/pkgsrc.tar.gz</userinput></screen>

</sect2>
<sect2 id="getting-via-sup">
<title>SUP 経由</title>

	<para>tar ファイルのかわりに、ソフトウェア更新プロトコル(Software Update Protocol) SUPを使い
	pkgsrcを入手することもできます。まず、supfileの中に

<programlisting>
release=pkgsrc
</programlisting>

	という
	行があることを確認してください。例えば、<filename>/usr/share/examples/supfiles</filename>を見て
	ください。それから<filename>/usr/pkgsrc</filename>ディレクトリーが存在することを確認してください。
	後は、以下のコマンドを実行するだけです。</para>

<screen>&uprompt; <userinput>sup -v <replaceable>/path/to/your/supfile</replaceable></userinput>.</screen>

</sect2>
<sect2 id="getting-via-cvs">
<title>anonymous CVS 経由</title>

	<para>pkgsrcを初めて(完全に)チェックアウトする際は、
	まず環境変数を設定しておく必要があります。C シェルの場合は、
	以下のようにします。</para>

<screen>&cprompt; <userinput>setenv CVSROOT anoncvs@anoncvs.NetBSD.org:/cvsroot</userinput>
&cprompt; <userinput>setenv CVS_RSH ssh</userinput>
</screen>

	<para>bourne シェルの場合は、以下のようにします。</para>

<screen>&uprompt; <userinput>export CVSROOT="anoncvs@anoncvs.NetBSD.org:/cvsroot"</userinput>
&uprompt; <userinput>export CVS_RSH="ssh"</userinput>
</screen>

	<para>CVS は、標準状態では、多くの人の望む挙動をしてくれません。
	しかし、
	以下の内容の <filename>.cvsrc</filename>
	というファイルをホームディレクトリーに置いておけば、
	標準での挙動を変えることができます。このファイルを置いておけば、
	あなたの悩みや、余計なバグ報告もなくなるでしょうから、
	そうすることを強くおすすめします。
	このファイルに関する説明は、
	CVS のドキュメンテーションにあります。</para>

<programlisting>
# recommended CVS configuration file from the pkgsrc guide
checkout -P
update -dP
release -d
diff -upN
cvs -q -z3
rdiff -u
</programlisting>


<para>何もないところに、pkgsrc の stable 枝名を指定して取得するためには、以下のコマンドを実行します。</para>

<screen>&uprompt; <userinput>cd /usr</userinput>
&uprompt; <userinput>cvs checkout -r <replaceable>pkgsrc-200xQy</replaceable> -P pkgsrc</userinput></screen>

	<para>ここで、<replaceable>pkgsrc-200xQy</replaceable> は、
	チェックアウトする stable 枝名にします。たとえば <quote>pkgsrc-2009Q1</quote> になります。</para>

	<para>こうすると、<filename>/usr/</filename> ディレクトリーに
	<filename>pkgsrc/</filename> ディレクトリーが作られ、
	<filename>/usr/pkgsrc/</filename> 以下に全パッケージのソースが置かれます。</para>

<para>pkgsrc current を取得するには、以下のコマンドを実行します。</para>

<screen>&uprompt; <userinput>cd /usr</userinput>
&uprompt; <userinput>cvs checkout -P pkgsrc</userinput></screen>

</sect2>
</sect1>

<sect1 id="uptodate">
<title>pkgsrc を最新の状態に保つ</title>

	<para>pkgsrc を最新の状態に保つ方法としては、CVS をおすすめします
	(最初に tar ファイルを使ってインストールした場合でも、更新には
	CVS を使えます)。 CVS を使えば、tar ファイルをあらためてダウンロードした場合にくらべ、
	帯域やハードディスクの負荷を減らすことができます。</para>

<sect2 id="uptodate-tar">
<title>tar ファイルを使用</title>

	<warning><para>tar ファイルを使って更新する場合は、まず、
	これまで使っていた pkgsrc ディレクトリーを完全に削除する必要があります。
	さもないと、それまでの間に pkgsrc から削除されたファイルがローカルディスクに残ったままになり、
	不整合が生じてしまいます。
	これまで使っていたファイルを消す場合、pkgsrc のファイルに独自に施した変更が、
	更新後にすべて失われてしまいます。
	このため、CVS を使った更新を強くおすすめします。</para></warning>

	<para>なお、distfile とバイナリーパッケージは、標準ではいずれも
	pkgsrc ツリー内に置かれますので、pkgsrc ツリーを更新する前に退避させておくことを忘れないでください。
	<varname>DISTDIR</varname> と <varname>PACKAGES</varname>
	を設定して、標準のディレクトリーとは別の場所を
	pkgsrc が使うような構成にすることもできます。
	詳細は<xref linkend="configuring"/>をご覧ください。</para>

	<para>tar ファイルを使って pkgsrc を更新するためには、
	初回の入手時と同様に、tar ファイルをダウンロードします。
	次に、pkgsrc ディレクトリーに独自の変更を何も加えていないことを確認します。
	pkgsrc ディレクトリーを削除してから、新しい tar ファイルを展開します。これで完了です。</para>

</sect2>
<sect2 id="uptodate-cvs">
<title>CVS 経由</title>

	<para>CVS を使って pkgsrc を更新するためには、環境変数
	<varname>CVS_RSH</varname> を初回の入手時と同じものに設定しておいてください。次に、
	<filename>pkgsrc</filename> ディレクトリーへ移動して、cvs を実行します。</para>

<screen>&uprompt; <userinput>cd /usr/pkgsrc</userinput>
&uprompt; <userinput>cvs update -dP</userinput></screen>

<sect3 id="uptodate-cvs-switch">
<title>pkgsrc の別の枝に移る</title>

	<para>pkgsrc の更新時、CVS プログラムはそれまで使っていた枝をそのまま追いつづけます。
	しかし、何らかの理由で stable 枝から current 枝に移りたい場合は、
	<quote>update</quote> キーワードの後に <quote>-A</quote>
	オプションを追加して current に移ることができます。
	current 枝から stable 枝に戻るには、
	<quote>-rpkgsrc-2009Q1</quote> オプションを追加します。</para>

</sect3>
<sect3 id="uptodate-cvs-changes">
<title>私がおこなった変更は、更新時にどうなるか?</title>

	<para>pkgsrc の更新時、CVS プログラムは
	CVS リポジトリーに登録されたファイルだけに手を加えます。
	このため、あなたが独自に作成したパッケージは、変更されずに残ります。
	あなたが CVS の管理下にあるファイルを独自に修正している場合、
	CVS による更新時には、あなた独自の変更と他の人による
	(CVS リポジトリーに反映されている) 変更を統合しようとします。
	詳細は、CVS のマニュアルの <quote>update</quote> の章をご覧ください。</para>

</sect3>
</sect2>
</sect1>
</chapter>
