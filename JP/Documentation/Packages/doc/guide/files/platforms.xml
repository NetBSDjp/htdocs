<!-- $NetBSD: platforms.xml,v 1.50 2007/01/11 03:39:59 rillig Exp $ -->
<!-- Based on english version: -->
<!-- NetBSD: platforms.xml,v 1.50 2007/01/11 03:39:59 rillig Exp   -->

<chapter id="platforms">
  <title>&os; 以外のシステムで pkgsrc を使う</title>

<sect1 id="binarydist">
<title>バイナリー配布</title>
<para>
&os; 以外のプラットフォーム用のブートストラップキットを、
ソースとバイナリーの両形態で用意してあります。これは、パッケージ管理ツールおよび、
pkgsrc の使用とパッケージの構築のために必要なツールをまとめたものです。
</para>

<note><para>
古いバイナリースナップショットは、ftp.NetBSD.org の
<ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/archive/">bootstrap-pkgsrc/archive</ulink>
ディレクトリーにあります。</para>
</note>

<table id="binary-kits">
  <title>バイナリーキットおよび利用可能なパッケージ</title>
  <tgroup cols="4">
    <thead>
      <row>
	<entry>プラットフォーム</entry>
	<entry>最新スナップショット</entry>
	<entry>バイナリーキット</entry>
	<entry>バイナリーパッケージ</entry>
      </row>
    </thead>
    <tbody>
      <row>
	<entry role="osname">Darwin 5.5/powerpc (Mac OS X 10.1.5)</entry>
	<entry role="date">20021209</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Darwin-5.5-powerpc-20021209.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Darwin 6.6/powerpc (Mac OS X 10.2.6)</entry>
	<entry role="date">20030623</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Darwin-6.6-powerpc-20030623.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Darwin 7.6/powerpc (Mac OS X 10.3.6)</entry>
	<entry role="date">20041219</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Darwin-7.6.0-powerpc-20041219.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/Darwin-7.6/">バイナリーパッケージ</ulink></entry>
      </row>
      <row>
	<entry role="osname">Darwin 7.8/powerpc (Mac OS X 10.3.8)</entry>
	<entry role="date">20050320</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Darwin-7.8.0-powerpc-20050320.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
     <row>
        <entry role="osname">Darwin 8.1/powerpc (Mac OS X 10.4.1)</entry>
        <entry role="date">20050625</entry>
        <entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Darwin-8.1.0-powerpc-20050625.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/Darwin-8.1/powerpc/current/">バイナリーパッケージ</ulink></entry>
      </row>
      <row>
	<entry role="osname">Debian GNU Linux/i386</entry>
	<entry role="date">20031023</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Linux-2.4.22-debian-i386-20031023.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Fedora Core 2 Linux/i386</entry>
	<entry role="date">20050618</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Linux-2.6.10-i386-fc2-20050618.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Fedora Core 4 Linux/i386</entry>
	<entry role="date">20060105</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Linux-2.6.11-i386-fc4-20060105.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">FreeBSD 3.5/i386</entry>
	<entry role="date">20030411</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-FreeBSD-3.5-STABLE-i386-20030411.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">FreeBSD 4.7/i386</entry>
	<entry role="date">20021211</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-FreeBSD-4.7-RELEASE-i386-20021211.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">FreeBSD 5.0/i386</entry>
	<entry role="date">20030411</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-FreeBSD-5.0-RELEASE-i386-20030411.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">FreeBSD 5.1/i386</entry>
	<entry role="date">20030630</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-FreeBSD-5.1-RELEASE-i386-20030630.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">FreeBSD 5.2.1/i386</entry>
	<entry role="date">20040227</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-FreeBSD-5.2.1-RELEASE-i386-20040227.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">FreeBSD 5.3/i386</entry>
	<entry role="date">20050119</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-FreeBSD-5.3-RELEASE-i386-20050119.tar">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Interix 3.5</entry>
	<entry role="date">20061106</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Interix-3.5-i386-20061106.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">IRIX 6.5 n32-bit ABI</entry>
	<entry role="date">20040911</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-IRIX-6.5-mips-20040911.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/IRIX-6.5/n32/">バイナリーパッケージ</ulink></entry>
      </row>
      <row>
	<entry role="osname">IRIX 6.5 64-bit ABI</entry>
	<entry role="date">20040912</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-IRIX64-6.5-mips-20040912.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/IRIX-6.5/64/">バイナリーパッケージ</ulink></entry>
      </row>
      <row>
	<entry role="osname">OpenBSD 3.2/i386</entry>
	<entry role="date">20030420</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-OpenBSD-3.2-i386-20030420.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">OpenBSD 3.3/i386</entry>
	<entry role="date">20030503</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-OpenBSD-3.3-i386-20030503.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">OpenBSD 3.5/i386</entry>
	<entry role="date">20040703</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-OpenBSD-3.5-i386-20040703.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Slackware Linux 8.1/i386</entry>
	<entry role="date">20030417</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Linux-2.4.18-slackware-20030417.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Slackware Linux 9/i386</entry>
	<entry role="date">20040703</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-Linux-2.4.22-i386-slackware9-20040703.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Solaris 8/sparc</entry>
	<entry role="date">20050220</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-SunOS-5.8-sparc-20050220.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Solaris 8/i386</entry>
	<entry role="date">20050220</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-SunOS-5.8-i386-20050220.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Solaris 9/sparc</entry>
	<entry role="date">20060713</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-SunOS-5.9-sparc-pkgsrc-2006Q2.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
      <row>
	<entry role="osname">Solaris 9/i386</entry>
	<entry role="date">20030411</entry>
	<entry role="kit-url"><ulink url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/bootstrap-pkgsrc-SunOS-5.9-i386-20030411.tar.gz">バイナリーキット</ulink></entry>
	<entry role="binary-pkgs-url"></entry>
      </row>
    </tbody>
  </tgroup>
</table>

<para>
お使いのプラットフォーム用のバイナリーキットをダウンロードして、
<filename>/</filename> に展開するだけです。たとえば以下のようにします。
</para>

<screen>&rprompt; <userinput>cd /</userinput>
&rprompt; <userinput>gzip -c -d /tmp/bootstrap-pkgsrc-SunOS-5.9-sparc-20031023.tar.gz \
  | tar -xpf -</userinput></screen>

<para>
もちろん、すべてのバイナリー配布物は、展開前にチェックサムを計算して <ulink
url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/SUM">SUM</ulink>
または <ulink
url="ftp://ftp.NetBSD.org/pub/pkgsrc/packages/bootstrap-pkgsrc/CKSUM">CKSUM</ulink>
と照合したうえで、内容を確認することをおすすめします。
</para>
</sect1>

  <sect1 id="bootstrapping-pkgsrc">
    <title>pkgsrc を使う準備をする</title>

    <para>ブートストラップキットは、以下のようにして簡単にソースからインストールすることができます。</para>

    <screen>
&rprompt; <userinput>env CVS_RSH=ssh cvs -d anoncvs@anoncvs.NetBSD.org:/cvsroot checkout pkgsrc</userinput>
&rprompt; <userinput>cd pkgsrc/bootstrap</userinput>
&rprompt; <userinput>./bootstrap</userinput>
    </screen>

    <para>bootstrap を実行する前に、上で例示した方法以外で
    pkgsrc を取得する方法については、<xref linkend="getting"/>を参照してください。
    上で例示した <command>bootstrap</command> コマンドでは、
    <emphasis>prefix</emphasis> (プログラムのインストール先) をデフォルトの
    <filename>/usr/pkg</filename> とし、
    パッケージデータベースのディレクトリー (pkgsrc 内部の記録用) を
    <filename>/var/db/pkg</filename> とします。
    これらをコマンドライン引数で設定することもできます。</para>

    <para>対応プラットフォーム用に、 pkgsrc のツールと初期導入パッケージ一式を
    バイナリーパッケージにしたものを用意してあります。
    最新の一覧は <ulink url="http://www.pkgsrc.org/">www.pkgsrc.org</ulink> にあります。
    なお、このパッケージは、インストールを <filename>/usr/pkg</filename>
    以下におこなう、特権的な構築用としてしか使えません。</para>

    <note>
      <para>bootstrap は  <command>bmake</command> ツールをインストールします。
      pkgsrc で構築をおこなう際には、この <command>bmake</command> を使ってください。
      たとえばこの手引きにおいて <quote>make</quote> は
      <command>bmake</command> に読み替えてください。</para>
    </note>

  </sect1>

  <sect1 id="platform-specific-notes">
    <title>プラットフォーム別の覚書</title>

    <para>いくつかのプラットフォームについては、以下のことを知っておくとよいでしょう。</para>

    <sect2 id="darwin">
      <title>Darwin (Mac OS X)</title>

      <para>対応は、 Darwin 5.x 以上に対しておこなわれています。
	Mac OS X で pkgsrc を使う方法としては、<link linkend="platform.osx-image">ディスクイメージ
	</link>を使う方法と<link linkend="platform.osx-part">UFS または HFSX
	  パーティション</link>を使う方法の二種類があります。</para>

      <para>始める前に、Apple Developer Connection から Mac OS X Developer
      Tools をダウンロードしてインストールする必要があります。詳細は <ulink
      url="http://developer.apple.com/macosx/">http://developer.apple.com/macosx/</ulink>
      をご覧ください。また、X11 Window System を使うパッケージを構築したい場合は、<ulink
      url="http://www.apple.com/macosx/x11/download/">http://www.apple.com/macosx/x11/download/</ulink>
      から X11 for Mac OS X および X11 SDK をインストールしておくことも必要です。</para>

      <para>UFS または HFSX パーティションがすでにある場合、または、
      UFS または HFSX でフォーマット可能な未使用のパーティションがある場合は、
      ディスクイメージではなくそれを使うことをおすすめします。
      多少速くなりますし、ブート時に自動的にマウントすることができます
      (ディスクイメージは手動でマウントすることが必要です)。</para>

      <note>
	<para>通常の HFS+ ファイルシステムを pkgsrc 用に使うことはできません。pkgsrc は現在のところ、
	  大文字と小文字を区別するファイルシステムを必要とするのですが、HFS+ は大文字と小文字を区別しないからです。しかし、Darwin 7.0 以降にある、大文字と小文字を区別する HFS+ (別名 HFSX) ファイルシステムは使うことができます。</para>
      </note>

      <sect3 id="platform.osx-image">
	<title>ディスクイメージを使う</title>

	<para>ディスクイメージを作ります。</para>

	<screen>&rprompt; <userinput>cd pkgsrc/bootstrap</userinput>
&rprompt; <userinput>./darwindiskimage create ~/Documents/NetBSD 512</userinput> # megabytes - season to taste
&rprompt; <userinput>./darwindiskimage mount ~/Documents/NetBSD</userinput>
&rprompt; <userinput>sudo chown `id -u`:`id -g` /Volumes/NetBSD</userinput></screen>

	<note>
	  <para>darwindiskimage はファイルシステムを nosuid でマウントするため、setgid に依存するパッケージでは問題があります。また、UFS の場合は、ファイルシステムを非同期でマウントするため、mount(8) マニュアルページに書かれているような危険があります。HFSX の場合は、ジャーナリングを無効化します。</para>
	</note>

	<para>suid を許すには、以下のようにします。</para>
	<screen>&rprompt; <userinput>sudo mount -u -o suid /Volumes/NetBSD</userinput></screen>
      </sect3>

      <sect3 id="platform.osx-part">
	<title>UFS または HFSX パーティションを使う</title>

	<para>標準状態では、 <filename>/usr</filename> がルートファイルシステム
	(通常は HFS+) 上にあるでしょう。<filename>/usr/pkg</filename> を
	UFS または HFSX 上にあるディレクトリーへのシンボリックリンクにすれば、
	無指定時の <emphasis>prefix</emphasis> である <filename>/usr/pkg</filename>
	を使うことができます。また、パッケージデータベースディレクトリーを
	<emphasis>prefix</emphasis> 以外の場所にしたい場合は、
	明らかに別のシンボリックリンクが必要になります。たとえば、</para>

	<screen>&rprompt; <userinput>./bootstrap --pkgdbdir /usr/pkg/pkgdb</userinput></screen>

	<para>Mac OS X のインストール時にパーティションを作り、
	UFS または HFSX でフォーマットした場合は、ブート時に自動的に
	<filename>/Volumes/&lt;volume name&gt;</filename>
	にマウントされるはずです。パーティションを UFS または HFSX で
	(再)フォーマットする場合は、パーティションマップが
	<quote>Apple_HFS</quote> ではなく <quote>Apple_UFS</quote> または <quote>Apple_HFSX</quote>
	を適切に反映していることを確認する必要があります。</para>

	<para>問題は、ディスクツールではブートに使ったディスクを変更できないことです。
	パーティションをアンマウントすることはできますが、たとえこのパーティションを
	newfs したとしても、パーティションの型が間違ったものになり、
	automounter はこのパーティションをマウントしません。
	手動でマウントすることはできますが、 Finder では見られません。</para>

	<para>OS X Installation (User) CD からブートする必要があります。
	インストールプログラムが起動したら、メニューから Disk
	Utility を選択します。これで、 UFS または HFSX にしたいパーティションを選んで
	Apple UFS または HFSX でフォーマットすることができます。
	Disk Utility を終了し、インストーラーを終了するとコンピューターが再起動します。
	これで、新しい UFS パーティションが Finder で見られます</para>

	<para>新しいパーティション上のパーミッションは、
	root のみが書き込み可能となることにご注意ください。</para>

	<para>この覚書は 10.2 (Jaguar) にもとづくもので、これより前のバージョンも該当します。
	うまくいけば、Apple は 10.3 (Panther) で Disk Utility を修正してくれるでしょう。</para>
      </sect3>
    </sect2>

    <sect2 id="freebsd">
      <title>FreeBSD</title>

      <para>確認および対応は、 FreeBSD 4.7 および 5.0 に対しておこなわれています。
      これら以外のバージョンでも動くかもしれません。</para>

      <para>ブートストラップキットのインストールに際しては、
      FreeBSD のユーザーランドのツールと衝突することがないように注意を払ってください。以下のような複数の事項があります。</para>

      <orderedlist>
	<listitem>
	  <para>FreeBSD の ports は、 <filename>/var/db/pkg</filename>
	  以下にパッケージデータベースを置きます。このため、
	  ブートストラップスクリプトの --pkgdbdir オプションで、
	  別の場所 (たとえば <filename>/usr/pkgdb</filename>)
	  を指定することをおすすめします。</para>
	</listitem>

	<listitem>
	  <para>FreeBSD ports のツールを使う予定がない場合は、混同を避けるために、
	  それらを移動してしまってもいいかもしれません。たとえば以下のようにします。</para>

	  <screen>
&rprompt; <userinput>cd /usr/sbin</userinput>
&rprompt; <userinput>mv pkg_add pkg_add.orig</userinput>
&rprompt; <userinput>mv pkg_create pkg_create.orig</userinput>
&rprompt; <userinput>mv pkg_delete pkg_delete.orig</userinput>
&rprompt; <userinput>mv pkg_info pkg_info.orig</userinput>
	  </screen>
	</listitem>

	<listitem>
	  <para>ブートストラップスクリプトを使った際、
	  <filename>/etc/mk.conf</filename> ファイルの例は
	  <filename>/etc/mk.conf.example</filename> ファイルに置かれます。</para>
	</listitem>
      </orderedlist>
    </sect2>

    <sect2 id="interix">
      <title>Interix</title>

      <para>Interix は Windows NT カーネルの POSIX 準拠のサブシステムで、
      Cygwin よりも密接にカーネルと統合された Unix 風の環境を提供します。
      Interix は Windows Services for Unix パッケージの一部であり、
      ライセンスされた Windows 2000, XP (XP Home は含まず), 2003 のコピー用として、
      無料で使うことができます。SFU は、<ulink
      url="http://www.microsoft.com/windows/sfu/">http://www.microsoft.com/windows/sfu/</ulink> からダウンロードできます。</para>

      <para>確認は、Services for Unix 3.5 に対しておこなわれています。 3.0
      や 3.1 でも動作するかもしれませんが、公式には対応していません。  (3.0/3.1 の主な違いは、
      pthreads がないことですが、このほかにも libc に欠けているものがあるかもしれません。)</para>

      <para>Services for Unix Applications (別名 SUA) は、Windows Server 2003 R2
      および Windows Vista に統合されている構成要素です。本稿執筆時点において、
      SUA の Interix 5.x サブシステムで、pkgsrc を使った確認はおこなわれていません。</para>

      <sect3 id="platform.interix-sfu-install">
	<title>Interix/SFU のインストールに際して</title>

	<para>pkgsrc を使うためには、Windows Services for Unix 3.5 の配布物のうち、
	最低限、以下のパッケージをインストールする必要があります。</para>

	<itemizedlist>
	  <listitem><para>Utilities -&gt; Base Utilities</para></listitem>
	  <listitem><para>Interix GNU Components -&gt; (all)</para></listitem>
	  <listitem><para>Remote Connectivity</para></listitem>
	  <listitem><para>Interix SDK</para></listitem>
	</itemizedlist>

	<para>Interix 上で pkgsrc を使う場合、Utilities 以下の "UNIX Perl"
	はインストールしないでください。これは共有モジュールに対応していない Perl 5.6 で、
	/usr/local にインストールされますが、混乱を起こすだけです。これのかわりに、
	pkgsrc (またはバイナリーパッケージ) の Perl 5.8 をインストールします。</para>

	<para>Remote Connectivity 以下の "Windows Remote Shell Service"
	のインストールは必須ではありませんが、inetd を動作させるために Remote Connectivity
	そのものはインストールすることをおすすめします。</para>

	<para>インストール中に、Interix のプログラムに対して setuid を有効にするかどうか、
	また、パス名の大文字と小文字を標準で区別するかどうかを尋ねられるかもしれません。
	setuid は有効にするようにし、また大文字と小文字はかならず区別するようにします。
	(大文字と小文字を区別しないと、
	perl をはじめ多くのプログラムが構築できなくなります。)</para>

	<para>註:  最近の Windows サービスパックでは、
	バイナリーを実行する方法を (データ実行防止機能を使ったものに) 変更します。
	pkgsrc その他の gcc でコンパイルされたバイナリーを信頼して使うためには、
	POSIX.EXE, PSXDLL.DLL, PSXRUN.EXE, PSXSS.EXE (899522 またはこれより新しいもの)
	を含んだホットフィックスをインストールする必要があります。
	ホットフィックスは Microsoft からサポート窓口を通じて提供されていますが、
	ある NetBSD 開発者が、ほとんどの Interix ホットフィックスを個人的に使えるように <ulink
	url="http://www.duh.org/interix/hotfixes.php">http://www.duh.org/interix/hotfixes.php</ulink>
	に用意しています。</para>

	<para>Interix を使えるようにするためには、上述のホットフィックスのほか、
	Data Execution Prevention を完全に無効化する必要があるかもしれません。
	これが必要となるのは、ある種の CPU を使っている場合だけです。
	上述のホットフィックスのいずれかひとつをインストールした後にも
	gcc その他のアプリケーションが依然として繰り返し segfault する場合には、
	Windows ブートドライブ上の適切な "boot.ini" 行に、
	以下のオプションを追加することができます: /NoExecute=AlwaysOff
	(警告: これは DEP を完全に無効化するものであり、
	Administrators グループのユーザーとしてアプリケーションをよく実行する場合には、
	セキュリティー上の危険となる可能性があります。)</para>

      </sect3>

      <sect3 id="platform.interix-sfu-postinstall">
	<title>Interix/SFU がインストール済みの場合はどうすればよいか</title>

	<para>SFU がすでにインストールされており、その設定を変更して
	pkgsrc が動作するようにしたい場合は、以下のことに気をつけてください。</para>

	<itemizedlist>
	  <listitem>
	    <para>UNIX Perl をアンインストールするため、Add/Remove Programs を使い、Microsoft
	    Windows Services for UNIX を選んで Change をクリックします。インストーラーで
	    Add or Remove を選んでから Utilities-&gt;UNIX Perl のチェックを外します。</para>
	  </listitem>
	  <listitem>
	    <para>ファイルシステムの大文字と小文字の区別を有効にするため、REGEDIT.EXE を実行して
	    以下のレジストリーキーを変更します。</para>
	    <para>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\kernel</para>
	    <para>DWORD 値 "obcaseinsensitive" を 0 に設定した後、リブートします。</para>
	  </listitem>
	  <listitem>
	    <para>setuid バイナリーを有効にするため (これは必須ではありません)、REGEDIT.EXE を実行して
	    以下のレジストリーキーを変更します。</para>
	    <para>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Services for UNIX</para>
	    <para>DWORD 値 "EnableSetuidBinaries" を 1 に設定した後、リブートします。</para>
	  </listitem>
	</itemizedlist>

      </sect3>
      <sect3 id="platform.interix-notes">
	<title>pkgsrc を使ううえで重要な覚書</title>

	<para>パッケージの管理者 (pkgsrc の "su" ユーザーと
	"pkg_add" を実行するユーザーのいずれかまたは両方) は、ローカルの Administrators
	グループに所属している必要があります。bootstrap を実行するユーザーも同様です。これは、通常の
	pkgsrc が "root" を要求するのにくらべ、若干緩い条件です。</para>

	<para>パッケージの管理者は umask を 002 に設定するようにします。そうしておかないと、
	自動的に "make install" が文句をいうようになります。こう設定することで、
	/var/db/pkg 以下に書かれるディレクトリーに Administrators グループが確実に書き込み可能とできます。</para>

	<para>http://www.interopsystems.com/ にある人気のある Interix バイナリーパッケージは、
	古いバージョンの pkgsrc の pkg_* ツールを使います。
	理想的には、これらは pkgsrc と混用しないほうがよいものです。
	これらを pkgsrc のパッケージと同時に使う場合は、かならず、
	それぞれのバイナリーパッケージに応じて適切な pkg_* ツールを使うようにしてください。</para>

	<para>DOS 型のコンソールウィンドウ (csh および ksh
	のスタートアップショートカットから起動されるものを含む)
	用の TERM の設定は "interix" です。
	たいていのシステムには、そのような termcap/terminfo エントリーがありませんが、
	ほとんどの場合、以下のような .termcap エントリーを用意すれば十分です。</para>

	<programlisting>
	  interix:kP=\E[S:kN=\E[T:kH=\E[U:dc@:DC@:tc=pcansi:
	</programlisting>

      </sect3>
      <sect3 id="platform.interix-limits">
	<title>Interix プラットフォームの制約</title>

	<para>Interix は、完全な Unix 風のプラットフォームの
	とっつきやすく柔軟な代替品としては十分なものですが、Interix
	を最大限に活用したい場合は、若干の制約があることを知っておくとよいでしょう。</para>

	<itemizedlist>

	  <listitem><para><emphasis role="strong">X11:</emphasis></para>
	  <para>Interix には標準的な X11R6 クライアントライブラリー一式が附属しており、
	  X11 にもとづくアプリケーションを実行することができますが、
	  X サーバーは附属<emphasis>しません</emphasis>。X サーバーの選択肢としては、
	  <ulink url="http://www.starnet.com/products/xwin32/">StarNet X-Win32</ulink>,
	  <ulink url="http://connectivity.hummingbird.com/products/nc/exceed/">Hummingbird Exceed</ulink>
	  (Interix 用に調整された
	  <ulink url="http://www.interopsystems.com/InteropXserver.htm">Interop X Server</ulink>
	  というものを、Interop Systems が提供しています) や、
	  <ulink url="http://x.cygwin.com/">Cygwin</ulink>
	  に含まれるフリーの X11 サーバーがあります。</para>
	  </listitem>

	  <listitem><para><emphasis role="strong">X11 アクセラレーション:</emphasis></para>
	  <para>Interix は、Win32 アプリケーションとは完全に別の
	  NT サブシステム内で動いているため、現在のところ、アクセラレーションのための
	  X11 プロトコルの各種拡張 (MIT-SHM や DGA など) には対応していません。
	  ローカルの X サーバーを使った対話的なアプリケーションのほとんどは、
	  そこそこ速く動きますが、フルモーションビデオなど画像に特化したアプリケーションを動かすには、
	  思ったよりも速い CPU が必要になるかもしれません。</para></listitem>

	  <listitem><para><emphasis role="strong">オーディオ:</emphasis></para>
	  <para>Interix は、オーディオ出力にネイティブで対応していません。
	  オーディオに対応するため、pkgsrc では Interix 上で <command>esound</command>
	  クライアントサーバー型オーディオシステムを使っています。
	  他のほとんどのプラットフォームとは異なり、
	  <filename role="pkg">audio/esound</filename> パッケージには、
	  <command>esd</command> サーバーが含まれません。
	  Interix ホストを経由してオーディオを出力するには、
	  <filename role="pkg">emulators/cygwin_esound</filename>
	  パッケージもあわせてインストールする必要があります。</para></listitem>

	  <listitem><para><emphasis role="strong">CD/DVD, USB, SCSI:</emphasis></para>
	  <para>現在のところ、Interix はデバイスへの直接のアクセスに対応していませんので、
	  CD/DVD ドライブ、USB デバイス、SCSI デバイスを、
	  ファイルシステム経由以外の方法で使うことはできません。このため、
	  Interix を使って、直接 CD/DVD を焼くことなどはできません。</para></listitem>

	  <listitem><para><emphasis role="strong">テープドライブ:</emphasis></para>
	  <para>CD-ROM や SCSI デバイスと同様の制約があるため、
	  Interix ではテープドライブに直接アクセスすることもできません。ただし、
	  Cygwin を介して使うことで (Cygwin の esound
	  サーバーを介してオーディオを使えるように)
	  テープドライブにアクセスできるようにするための作業がおこなわれています。</para></listitem>

	</itemizedlist>
      </sect3>
      <sect3 id="platform.interix-knownissues">
	<title>Interix 上での pkgsrc に関する、既知の問題</title>

	<para>一般的に、Windows システム上に "root" ユーザーを用意することは必須ではありません。
	ユーザーがローカルの Administrators グループに属してさえいれば、それで十分です。
	ただし、現在のところ、パッケージのなかには
	"root" という名前のユーザーが特権ユーザーであることを前提にしているものがあります。
	そのようなパッケージのために、"root" という名前のユーザーを作ってもかまいませんが、
	ローカルの Administrators グループ (または、お使いの言語でこれに対応するもの)
	に属させるようにしてください。</para>

	<para><command>pkg_add</command> は、<filename>$PKG_DBDIR</filename> 内のディレクトリーを、モード 0775 ではなく
	0755 で作成します。この問題を回避するため、当面は、ローカルの
	Administrator (または、お使いの言語でこれに対応するもの)
	としてパッケージをインストールするか、
	各パッケージのインストール後に以下のコマンドを実行してください。</para>

	<screen>
&rprompt; <userinput>chmod -R g+w $PKG_DBDIR</userinput>
	</screen>

      </sect3>
    </sect2>

    <sect2 id="irix">
      <title>IRIX</title>

      <para>機能する C コンパイラー、つまり、 gcc または SGI の MIPS
      および MIPSpro コンパイラー (cc/c89) が必要です。 <varname>CC</varname> 環境変数を、
      使用するコンパイラーに応じて設定してください。
      MIPSpro コンパイラースイートのライセンスがない場合は、<ulink
      url="http://freeware.sgi.com/">http://freeware.sgi.com/</ulink>
      から gcc の tar 配布ファイルをダウンロードすることができます。</para>

      <para>IRIX 6.5.17 以上が必要です。
      このバージョンの IRIX で &man.if.indextoname.3;, &man.if.nametoindex.3;
      などへの対応がおこなわれたからです。</para>

      <para>現在のところ、pkgsrc は同時には一つの ABI にしか対応しません。つまり、
	古い 32 ビット ABI、新しい 32 ビット ABI、64 ビット ABI を切り替えることはできません。
	最初に "abi=n32" を使って始めた場合は、
	すべてのパッケージがこれを使って構築されることになります。</para>

      <para>このため、環境変数または <filename>/etc/mk.conf</filename> の
      <varname>CFLAGS</varname> が衝突しないようにしてください。
      特に、 n32 オブジェクトファイルに lib64 を、また、その逆の組合せを、
      リンクしないようにしてください。
      <filename>/etc/compiler.defaults</filename> を確認してください。</para>

      <para>pkgsrc ツリーの実体を別ホストから NFS を使ってマウントしている場合は、必ず
      <varname>WRKOBJDIR</varname> をローカルのディレクトリーに設定しておいてください。
      IRIX のリンカーは、ネットワーク経由でマウントされたファイルシステム越しにリンクするときに
      問題を起こすことが時々あるからです。</para>

      <para>事前準備の過程では、imake(1) などのプログラムにすべて正しいオプションが設定されるはずですが、
      ローカルの設定に依存するオプションを設定したい場合があるかもしれません。
      詳細は、<filename>pkgsrc/mk/defaults/mk.conf</filename> をご覧ください。
      そしてもちろん、お使いのコンパイラーのマニュアルページもご覧ください。</para>

      <para>SGI の MIPSPro コンパイラーを使っている場合は、
         <filename>/etc/mk.conf</filename> で

      <programlisting>
	PKGSRC_COMPILER=        mipspro
      </programlisting>

      を設定してください。これを設定しないと、
      pkgsrc は gcc を使っていることを仮定するので、コンパイラーに不適切なフラグを渡すことがあります。
      なお、標準状態では、bootstrap は適切な <filename>mk.conf.example</filename>
      を作成するはずです。</para>

      <para>gcc と MIPSPro コンパイラーチェインの両方をインストールしているが、
      必ず MIPSPro を使うようにしたい場合は、<varname>PATH</varname>
      に gcc の場所 (ありがちなのは
      <filename>/usr/freeware/bin</filename>) を<emphasis>含めない</emphasis>でください。さらに (重要)、
      '--preserve-path' フラグを bootstrap に渡してください。</para>
    </sect2>

    <sect2 id="linux">
      <title>Linux</title>

      <para>Linux のなかには、libtermcap と libcurses (libncurses) のいずれかを必要とするものがあります
      (たとえば Debian GNU/Linux など)。そのようなディストリビューションでは
      libncurses-dev パッケージ (または相当品) をインストールすれば問題なくなるはずです。</para>

      <para>pkgsrc は gcc (GNU Compiler Collection) と icc
      (Intel C++ Compiler) のどちらにも対応しています。gcc が標準で使われます。
      icc は i386 上の icc 8.0 と 8.1 で確認がおこなわれています。      </para>

      <para>icc を使って bootstrap をおこなうには、以下のようにします
      (icc は標準のディレクトリーにインストールされているものとします)。</para>

      <programlisting>
	env CC=/opt/intel_cc_80/bin/icc LDFLAGS=-static-libcxa \
	ac_cv___attribute__=yes ./bootstrap
      </programlisting>

      <note>
	<para>icc 8.1 では、引数の -static-libcxa を `-i-static' にする必要があります。</para>
      </note>

      <para>icc は __attribute__ に対応していますが、GNU configure のテストではネストした関数を使っており、
      icc はネストした関数に対応していません。__attribute__ を #undef してしまうと、
      Linux の多くのヘッダーファイルが __attribute__ なしでは正しくコンパイルできず、
      壊れてしまうという副作用があります。このため、テストは、コンパイラーが
      __attribute__ に対応しているとしたもので上書きする必要があります。</para>

      <para>bootstrap した後に、<filename>/etc/mk.conf</filename> で
      <varname>PKGSRC_COMPILER</varname> を設定します。</para>

      <programlisting>
	PKGSRC_COMPILER=        icc
      </programlisting>

      <para>icc がインストールされるディレクトリーは標準では
      <filename>/opt/intel_cc_80</filename> であり、pkgsrc
      でもこのディレクトリーを標準としています。これ以外のディレクトリーに
      icc をインストールしている場合は、<filename>/etc/mk.conf</filename> で
      <varname>ICCBASE</varname> を設定してください。</para>

      <programlisting>
	ICCBASE=                /opt/icc
      </programlisting>

      <para>pkgsrc は、icc が提供する実行時ライブラリーを静的リンクするので、
      作られたバイナリーはその共有ライブラリーがインストールされていないシステムでも
      動かすことができます。</para>

      <para>ただし、libtool は、C++ の共有ライブラリーをリンクして記録する時に実行された
      (ライブラリーごとに -Bstatic や -Bdynamic オプションの指定がまちまちな)
      &man.ld.1; コマンドをもとにライブラリーの一覧を展開します
      このことから、libtool でリンクされた C++ の共有ライブラリーは、libtool が修正されない限り、
      icc のライブラリーに対して実行時依存性を持った状態になります。</para>

    </sect2>

    <sect2 id="openbsd">
      <title>OpenBSD</title>

      <para>確認および対応は、 OpenBSD 3.0 および 3.2 に対しておこなわれています。</para>

      <para>ブートストラップキットのインストールに際しては、
	OpenBSD のユーザーランドのツールと衝突することがないように注意を払ってください。以下のような複数の事項があります。</para>

      <orderedlist>
	<listitem>
	  <para>OpenBSD の ports は、 <filename>/var/db/pkg</filename>
	  以下にパッケージデータベースを置きます。このため、
	  ブートストラップスクリプトの --pkgdbdir オプションで、
	  別の場所 (たとえば <filename>/usr/pkgdb</filename>)
	  を指定することをおすすめします。</para>
	</listitem>

	<listitem>
	  <para>OpenBSD ports のツールを使う予定がない場合は、混同を避けるために、
	  それらを移動してしまってもいいかもしれません。たとえば以下のようにします。</para>

	  <screen>
&rprompt; <userinput>cd /usr/sbin</userinput>
&rprompt; <userinput>mv pkg_add pkg_add.orig</userinput>
&rprompt; <userinput>mv pkg_create pkg_create.orig</userinput>
&rprompt; <userinput>mv pkg_delete pkg_delete.orig</userinput>
&rprompt; <userinput>mv pkg_info pkg_info.orig</userinput>
	  </screen>
	</listitem>

	<listitem>
	  <para>ブートストラップスクリプトを使った際、
	    <filename>/etc/mk.conf</filename> ファイルの例は
	    <filename>/etc/mk.conf.example</filename> ファイルに置かれます。
	    OpenBSD の make プログラムは
	    <filename>/etc/mk.conf</filename> も使います。
	    このファイル中の pkgsrc 特有の記述を以下のように括ることで、
	    回避することができます。</para>

	  <programlisting>
	    .ifdef BSD_PKG_MK
	    # pkgsrc の記述。たとえば defaults/mk.conf の挿入など
	    .else
	    # OpenBSD の記述
	    .endif
	  </programlisting>
	</listitem>
      </orderedlist>
    </sect2>

    <sect2 id="solaris">
      <title>Solaris</title>

      <para>対応は x86 と sparc それぞれの Solaris 2.6 から 9 までに対しておこなわれています。
      機能する C コンパイラーが必要です。 gcc 2.95.3 および
      Sun WorkShop 5 の両者で確認がおこなわれています。</para>

      <para>Solaris 8 でのブートストラップ過程およびパッケージの構築では、
      以下の各パッケージが必要になります。</para>

      <itemizedlist>
	<listitem><para>SUNWsprot</para></listitem>
	<listitem><para>SUNWarc</para></listitem>
	<listitem><para>SUNWbtool</para></listitem>
	<listitem><para>SUNWtoo</para></listitem>
	<listitem><para>SUNWlibm</para></listitem>
      </itemizedlist>

      <para>なお、2006 年 6 月現在、Solaris 上では GNU binutils
      はサポートされて<emphasis>いません</emphasis>。</para>

      <para>どのコンパイラーを使うにせよ、コンパイラーツールと
      $prefix を、必ず <varname>PATH</varname> に含めてください。
      これは、<filename>/usr/ccs/{bin,lib}</filename>
      や、たとえば <filename>/usr/pkg/{bin,sbin}</filename> などです。</para>

      <sect3 id="solaris-gcc-note">
	<title>gcc を使う場合</title>

	<para>どのパッケージの構築にも同じ gcc だけを使うようにすると、
	話が簡単になります。</para>

	<para>外部から導入した gcc を使うのはブートストラップの時だけにして、
	その後は gcc を
	<filename role="pkg">lang/gcc</filename> から構築するかバイナリーパッケージをインストールして、
	ブートストラップで使った gcc は削除することをおすすめします。</para>

	<para>gcc のバイナリーパッケージは、<ulink
	url="http://www.sunfreeware.com/"/> から辿れます。</para>
      </sect3>

      <sect3 id="solaris-sun-workshop-note">
	<title>Sun WorkShop を使う場合</title>

	<para>少なくとも、以下の各パッケージを (WorkShop 5.0 から)
	インストールしておく必要があります。</para>

	<itemizedlist>
	  <listitem><para>SPROcc
	  - Sun WorkShop Compiler C 5.0</para></listitem>
	  <listitem><para>SPROcpl
	  - Sun WorkShop Compiler C++ 5.0</para></listitem>
	  <listitem><para>SPROild
	  - Sun WorkShop Incremental Linker</para></listitem>
	  <listitem><para>SPROlang
	  - Sun WorkShop Compilers common components</para></listitem>
	</itemizedlist>

	<para><filename>/etc/mk.conf</filename> で <varname>CC</varname> および <varname>CXX</varname>
	を設定します。<varname>CPP</varname> もここで設定して結構です。
	たとえば以下のようにします。</para>

	<programlisting>
	  CC=     cc
	  CXX=    CC
	  CPP=    /usr/ccs/lib/cpp
	</programlisting>

      </sect3>
      <sect3 id="solaris-sunpro-64">
	<title>SunPro を使って 64 ビットバイナリーを構築する</title>

	<para>64 ビットバイナリーの構築は、少し巧妙なやり方になります。
	最初に、pkgsrc のブートストラップを 64 ビットモードでおこなう必要があります。
	ここでの問題は、ブートストラップキットに含まれているプログラムのひとつ
	(<filename>bmake</filename>) の構築中に、<varname>CFLAGS</varname>
	変数が、たとえ環境変数に設定しても、無視されることです。
	このバグを回避するには、以下のような簡単なシェルスクリプトを、
	<filename>cc64</filename> という名前で <varname>PATH</varname>
	中のどこかに置きます。</para>

	<programlisting>
	  #! /bin/sh
	  exec /opt/SUNWspro/bin/cc -xtarget=ultra -xarch=v9 ${1+"$@"}
	</programlisting>

	<para>次に、<varname>CC</varname> の定義を
	<command>bootstrap</command> コマンドの環境変数に渡します。</para>

	<programlisting>
	  &uprompt; <userinput>cd bootstrap</userinput>
	  &uprompt; <userinput>CC=cc64 ./bootstrap</userinput>
	</programlisting>

	<para>ブートストラップをした後は、パッケージのバグを見つけたいのか、
	システムを手っ取り早く使えるようにしたいだけなのかによって、
	二通りの選択肢があります。システムを使えるようにしたいだけの場合は、
	以下の各行を <filename>mk.conf</filename>
	ファイルに付け足します。</para>

	<programlisting>
	  CC=                     cc64
	  CXX=                    CC64
	  PKGSRC_COMPILER=        sunpro
	</programlisting>

	<para>この方法を使うと、あらゆるコンパイラーの呼び出しが、
	上で定義されたラッパーを介しておこなわれるようになり、
	必要な ABI オプションが自動的に追加されます。(シェルスクリプト
	<filename>CC64</filename> も忘れずに作っておいてください。)</para>

	<para>ユーザーが指定した
	<varname>CFLAGS</varname> や <varname>CXXFLAGS</varname>
	を無視するパッケージを見つけるには、以下の各行を <filename>mk.conf</filename>
	ファイルに付け足します。</para>

	<programlisting>
	  CC=                     cc
	  CXX=                    CC
	  PKGSRC_COMPILER=        sunpro
	  CFLAGS=                 -xtarget=ultra -xarch=v9
	  CXXFLAGS=               -xtarget=ultra -xarch=v9
	  LDFLAGS=                -xtarget=ultra -xarch=v9
	</programlisting>

	<para>設定ファイルで指定されたフラグを使わないパッケージは、
	32 ビットバイナリーを構築しようとして、リンクに失敗します。
	このようなものを見つけることは、
	エラーが表に出ずに黙って先に進むような他のプラットフォームでのバグを予防するために、
	有用です。</para>

      </sect3>

      <sect3 id="plat.sunos.problems"><title>ありがちな問題</title>

      <para><command>libtool</command> を使っていると、時々、<filename>/bin/ksh</filename>
      がセグメンテーションフォールトを起こしてクラッシュすることがあります。
      回避策は、たとえば <filename
      role="pkg">shells/bash</filename> をインストールして、
      以下の各行を <filename>mk.conf</filename> に追加するなどして、
      別のシェルを configure スクリプト用に使うことです。</para>

      <programlisting>
	CONFIG_SHELL=   ${LOCALBASE}/bin/bash
	WRAPPER_SHELL=  ${LOCALBASE}/bin/bash
      </programlisting>

      <para>こうしてから、<filename
      role="pkg">devel/libtool-base</filename> パッケージを構築しなおします。</para>

      </sect3>
    </sect2>
  </sect1>
</chapter>
