<!-- $NetBSD: submit.xml,v 1.22 2009/08/21 12:54:07 wiz Exp $ -->
<!-- Based on english version: -->
<!-- NetBSD: submit.xml,v 1.22 2009/08/21 12:54:07 wiz Exp   -->

<chapter id="submit"> <?dbhtml filename="submit.html"?>
<title>提出およびコミット</title>

<sect1 id="submitting-binary-packages">
<title>バイナリーパッケージの提出</title>

	<para>  我々は、トロイの木馬等を含まないことを保証するために、pkgsrc 開発者からし
	かバイナリーを受け取りません。これは、誰かを排斥するものではなく、
	むしろユーザーを保護するための方針です。しかしながら、あなたの作ったバイ
	ナリーパッケージをどこかに置き、配布することは自由に行なってもかまいま
	せん。NetBSD 開発者がバルクビルドを実行してパッケージをアップロードしたい場合は、
	<xref linkend="bulk-upload"/>を参照してください。</para>

</sect1>

<sect1 id="submitting-your-package">
<title>ソースパッケージの提出 (NetBSD 開発者以外の方向け)</title>

	<para>最初にパッケージが完全かどうか、コンパイル、実行できるかどうかを確認して
	ください。
	このドキュメントの<xref linkend="debug"/>、その他が参考になるでしょう。次に、
	パッケージを構成するファイルすべてからなる &man.tar.1;
	アーカイブを作り、gzip して uuencode してください。
	最後に、このパッケージを pkgsrc のバグ追跡システムに送信してください。
	&man.send-pr.1; コマンドを使って送信するか、このコマンドがない場合は web ページ
	<ulink url="http://www.NetBSD.org/support/send-pr.html"/>
	をご覧ください。この web ページには、説明と、
	パッケージを提出できるフォームへのリンクがあります。
	これらのかわりに、
	<filename role="pkg">sysutils/gtk-send-pr</filename>
	パッケージを使って提出することもできます。
	</para>

	<para>問題報告においては、カテゴリー (category) は
	<quote>pkg</quote> とし、問題の概要 (synopsis) にパッケージ名とバージョン番号を含めます。
	また、説明 (description) のフィールドに、パッケージの簡単な説明
	(COMMENT 変数または DESCR ファイルの内容でもOKです)
	を書きます。uuencode したパッケージのデータは
	<quote>fix</quote> フィールドに含めます。</para>

	<para>複数のパッケージを提出したい場合は、一つのパッケージにつき一つのPRにわけ
	て送ってください。そうすることで、私たちが追跡しやすくなります。</para>

	<para>以上のようにするほか、新しいパッケージは pkgsrc-wip
	(<quote>pkgsrc work-in-progress</quote>) に入れることもできます。
	詳細は、ホームページ <ulink url="http://pkgsrc-wip.sourceforge.net/"/>
	をご覧ください。</para>

</sect1>

<sect1 id="general-notes-for-changes">
<title>パッケージを追加・更新・削除する際の一般的な覚書</title>

	<para>パッケージの追加、更新、移動、および削除は、すべて
	<filename>pkgsrc/doc/CHANGES-<replaceable>YYYY</replaceable></filename> に書いてください。
	このファイルを、これまでと同じ形式のまま最新の状態に保つことは非常に重要なことです。
	なぜなら、このファイルはスクリプトにより <ulink
	url="http://www.NetBSD.org/">www.NetBSD.org</ulink>
	や他のサイトのページを自動的に更新するために使用されているからです。
	また、<filename>pkgsrc/doc/TODO</filename> ファイルを確認し、
	今回更新あるいは削除したパッケージのことが書かれている場合は、
	その部分を削除してください。</para>

	<para>パッケージの <varname>PKGREVISION</varname> を引き上げた時に、
	その変更がセキュリティーに関するものやその他関連のあるものである場合は、
	<filename>pkgsrc/doc/CHANGES-<replaceable>YYYY</replaceable></filename> に載せるようにします。
	依存性の更新にともなう大量の引き上げについては、ここには書かないでください。
	これら以外の場合は、書くべきかどうかは開発者が自分で決めることです。</para>

<para>正しい <filename>CHANGES-<replaceable>YYYY</replaceable></filename>
  の項目を作るのを手伝ってくれる make ターゲット、 <command>make
  changes-entry</command> があります。このターゲットは <varname>CTYPE</varname>
  および <varname>NETBSD_LOGIN_NAME</varname> というオプションの変数を使います。
  一般的な使い方は、まず <filename>CHANGES-<replaceable>YYYY</replaceable></filename>
  ファイルを (あとで衝突して修正する必要が起こらないように)
  最新の状態にした上で、パッケージのディレクトリーに <command>cd</command>
  します。パッケージを更新した場合は <command>make changes-entry</command>
  だけで十分です。新規パッケージの追加や、パッケージの移動または削除の場合は、
  コマンドラインで <varname>CTYPE</varname> 変数を "Added",
  "Moved" または "Removed" に設定します。ローカルのログイン名が
  NetBSD のログイン名と異なる場合は、&mk.conf; で
  <varname>NETBSD_LOGIN_NAME</varname> を設定することができます。
  また、このターゲットは、<filename>TODO</filename> ファイルから、
  当該パッケージの項目を自動的に削除してくれます。最後に、
  <command>make changes-entry-commit</command> などとして
  <filename>pkgsrc/doc/CHANGES-<replaceable>YYYY</replaceable></filename> の変更を
  commit するのを忘れないでください。</para>
</sect1>

<sect1 id="committing-importing">
<title>コミット: パッケージのCVSへのインポート</title>
<para>このセクションは、pkgsrcリポジトリーへの書き込みアクセス権限を持っ
  ている pkgsrc 開発者にのみ意味があるものです。cvsはカレントディレクトリーから
  の相対位置にファイルをインポートすることと、<command>cvs import</command>コマンドに渡したパ
  ス名からリポジトリー中のファイルの位置が決まることを忘れないでください。新
  しく作ったパッケージは、<quote>TNF</quote>のベンダータグと<quote>pkgsrc-base</quote>のリリースタ
  グでインポートしてください。例えば:</para>

<programlisting>
&uprompt; cd .../pkgsrc/category/pkgname
&uprompt; cvs import pkgsrc/category/pkgname TNF pkgsrc-base
</programlisting>

<para>また、インポートに使ったディレクトリーは、忘れずに邪魔にならないところに移
  しておいてください。そうしておかないと、ソースツリーを次に<quote>cvs
  update</quote>した
  ときにcvsが文句を言います。さらに、この新しいパッケージを、categoryの
  <filename>Makefile</filename>に忘れずに追加してください。</para>

<para>初回のインポートでは、コミットメッセージに<filename>DESCR</filename>ファイルの内容を含めておき、
  どういうパッケージなのかがメーリングリストの読者にわかるようにしてください。</para>

<para>新しいパッケージを追加する場合は、<quote>cvs
  add</quote>ではなく<quote>cvs import</quote>を使うように
  してください。"cvs import"なら、単一のコマンドですべて記述することができ、
  また、一貫したタグを打つことができるからです。</para>
</sect1>

<sect1 id="updating-package">
<title>パッケージを新しいバージョンに更新する</title>
<para>パッケージを更新するときは、新旧バージョン間の変更点の簡潔で適切で意味のあ
  る要約を、コミットログに必ず書いてください。そうすべき理由はいろいろありま
  す:</para>

<itemizedlist>
<listitem>
<para>URLは不安定なものであり、時間がたつと変わることがあります。完全になくなる
  かもしれませんし、新しい情報に書き換わるかもしれません。</para>
</listitem>

<listitem>
<para>新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、cvsやanoncvsの
  利用者にとって、非常に便利です。</para>
</listitem>

<listitem>
<para>新旧バージョン間の変更点をCVSリポジトリーに保持しておくと、pkgsrc-changes
  メーリングリストの読者が、パッケージをいつ更新するかの戦術を立てられるよう
  になり、非常に便利です。</para>
</listitem>
</itemizedlist>

<para>また、あるパッケージに新しいバージョンがリリースされたというだけの理由で、
  CVSリポジトリー上のパッケージを更新しないほうがいいことを認識してください。
  私たちは、pkgsrcに含まれるパッケージに関して保守的であることを好みます。と
  いうのも、開発版やベータ版のパッケージは、pkgsrcが使われる場面のほとんどに
  対して、まったくふさわしくないからです。どのバージョンをpkgsrcに入れるのが
  よいか、分別をもって判断してください。新機能(テストされていない機能があるか
  もしれません)よりも安定性のほうが好ましいことを念頭に置いてください。</para>
</sect1>

<sect1 id="renaming-package">
<title>pkgsrc のパッケージの名前を変更する</title>

<para>パッケージ名の変更は、なるべくしないようにしてください。</para>


<para>パッケージ名を変更する際には、かならず、
  他の Makefile やオプションや buildlink などで古い名前を参照している箇所をすべて修正します。</para>

<para>パッケージ名を変更する際には、さらに、
  <varname>SUPERSEDES</varname> を旧パッケージのパッケージ名と
  dewey 式のバージョン番号に設定します。
  名前が複数回変わっている場合は、複数並べて設定することができます。
  これで、新しいパッケージで旧名のパッケージを置き換える作業は完了です。
</para>

<para>なお、CHANGES-<replaceable>YYYY</replaceable> ファイルにおける
  <quote>successor</quote> の記述は、必ずしも、<emphasis>supersedes</emphasis>
  の意味ではありません。successor は、厳密な同等品でなくても、
  代替として使えるものを助言するものでもいいからです。</para>

</sect1>

<sect1 id="moving-package">
<title>pkgsrcのパッケージを移動する</title>

<para>パッケージの名前の変更や移動は、しないほうがよいのですが、
  それでも必要な場合は、以下の手順でおこないます。
</para>

<orderedlist>
<listitem><para>パッケージのディレクトリーをどこかにコピーします。</para></listitem>

<listitem><para>コピーしたものからCVSディレクトリーをすべて削除します。</para>
<para>手順1,2は、以下のようにすることもできますので、今後の作業にはこちらを使ってください:</para>
<screen>&cprompt; <userinput>cvs -d user@cvs.NetBSD.org:/cvsroot export -D today pkgsrc/category/package</userinput></screen>
</listitem>

<listitem><para><varname>CATEGORIES</varname>を修正します。また、<quote>../../category/package</quote>のかわりに単に
<quote>../package</quote>とすることができる<varname>DEPENDS</varname>のパスをすべて修正します。</para>
</listitem>

<listitem><para>修正後のパッケージの Makefile で、
<varname>PREV_PKGPATH</varname> を、移動前のカテゴリー/パッケージのパス名に設定します。
この <varname>PREV_PKGPATH</varname> は、
パッケージの更新を pkgsrc の構築によっておこなうツールが使います。
たとえば、そういったツールは &man.pkg.summary.5; データベースから
(<varname>SUPERSEDES</varname> がない場合)
<varname>PREV_PKGPATH</varname> を検索して、これをもとにパッケージの移動後の
<varname>PKGPATH</varname> を調べることができます。
なお、この検索で複数のパスが見つかることもありえるので、
ツールの側では <varname>PKGBASE</varname> もあわせて検査します。
この <varname>PREV_PKGPATH</varname> の値を設定するのは、
<varname>SUPERSEDES</varname> が設定されない場合
(つまり、<varname>PKGBASE</varname> が変わらない場合) です。  </para>
</listitem>

<listitem><para>新しい場所で、修正後のパッケージを<command>cvs import</command>
します。</para></listitem>

<listitem><para>このパッケージに依存しているパッケージを調べます:
<screen>&cprompt; <userinput>cd /usr/pkgsrc</userinput>
&cprompt; <userinput>grep /package */*/Makefile* */*/buildlink*</userinput></screen></para>
</listitem>

<listitem><para>手順5で見つかったものに対して、このパッケージへのパスを、新しい場所を指すように修正します。</para></listitem>

<listitem><para>古い場所で、移動前のパッケージを<command>cvs rm (-f)</command>します。</para></listitem>

<listitem><para><filename>oldcategory/Makefile</filename> からこのパッケージを削除します。</para></listitem>

<listitem><para><filename>newcategory/Makefile</filename> にこのパッケージを追加します。</para></listitem>

<listitem><para>変更および削除されたファイルを commit します:</para>
<screen>&cprompt; <userinput>cvs commit oldcategory/package oldcategory/Makefile newcategory/Makefile</userinput></screen>
<para>(もちろん、手順5の各パッケージもです)。</para>
</listitem>
</orderedlist>

</sect1>

</chapter>
